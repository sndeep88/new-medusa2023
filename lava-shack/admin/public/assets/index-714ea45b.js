import{r as g,a as e,M as F,j as i,B as z,d as H,G as Ue,ag as qe,af as ze,ah as Ve,S as K,F as L,e as be,C as Le,ai as ye,aj as Qe,ak as Ee,Z as ge,al as Ye,u as ve,a8 as We,am as Ie,m as xe,q,c as Je,an as Ze,ao as Xe,ap as Ke,R as et,b as ce}from"./index-effbfb95.js";import{h as Ge}from"./moment-fbc5633a.js";import{f as ne,B as me,s as Pe,n as tt}from"./index-84767cd7.js";import{D as nt}from"./index-714f5540.js";import{E as Ne}from"./edit-icon-8c1c10d1.js";import{P as at,U as Se}from"./index-4a064b3c.js";import{B as rt}from"./index-d895e52c.js";import{S as Oe}from"./index-f2ff65ef.js";import{B as ee}from"./body-card-d3fddb8c.js";import{R as st}from"./index-698bc9f9.js";import{u as U,n as ae,T as lt,X as it,_ as ot}from"./use-notification-9f7c3c92.js";import{g as M}from"./error-messages-d2d0bb30.js";import{u as W,C as R,b as we,F as ct,a as dt,c as Ce}from"./index.esm-5a89640b.js";import{S as De,R as je}from"./index-b6a697c3.js";import{T as ut,a as Y,P as te,I as X}from"./index-dd9f9076.js";import{C as O}from"./index-dbc7810f.js";import{$ as mt,a as ft,C as pt,b as ht,c as bt}from"./chevron-down-6a69fe38.js";import{R as yt}from"./refresh-icon-ede960a5.js";import{p as gt}from"./images-e8c4b691.js";import{F as G}from"./form-validator-a60b1f3b.js";import{T as Q}from"./trash-icon-abcb5140.js";import{_ as vt,l as fe}from"./lodash-72dfe3e0.js";import{v as xt}from"./v4-cf522c50.js";import{T as D,r as pe,A as Nt,a as St}from"./index-0d9858ea.js";import{D as ke}from"./delete-prompt-37f35e36.js";import{F as Re}from"./index-a2e12c2a.js";import{n as wt}from"./nested-form-c66382a0.js";import{T as Ct}from"./index-4192ae3e.js";import{T as _e}from"./index-d74195ae.js";import{$ as Dt,a as _t,b as Ft}from"./index-e25e2e97.js";import{A as Pt}from"./arrow-down-icon-49435f5a.js";import{A as Tt}from"./arrow-up-icon-ff67c91c.js";import{P as At}from"./index-99af6790.js";import{c as zt}from"./react-select.esm-1ec1493a.js";import{S as Me}from"./index-04f3341e.js";import{u as Et,v as It}from"./validate-email-bd4107a8.js";import{r as Gt}from"./time-5c3c185e.js";import{P as he}from"./shared-f9889298.js";import{M as Ot}from"./api-9aff074a.js";import"./index-e0338379.js";import"./toConsumableArray-6f61c395.js";import"./unsupportedIterableToArray-27301055.js";import"./index-0f96226b.js";import"./index-a4458bf1.js";import"./index-1ec19c89.js";import"./index-903c1727.js";import"./index-740955bd.js";import"./react-select-creatable.esm-e43d0869.js";import"./index.esm-841d990e.js";import"./createSuper-ad9f6885.js";import"./axios-4a70c6fc.js";const jt=({handleClose:n,handleSave:t,updating:a,regions:s,region:l})=>{const{control:r,handleSubmit:o}=W({defaultValues:{region:{value:l.id,label:l.name}}}),m=c=>{t({region_id:c.region.value})},f=g.useMemo(()=>(s==null?void 0:s.map(c=>({label:c.name,value:c.id})))||[],[s]);return e(F,{handleClose:n,isLargeModal:!0,children:e("form",{onSubmit:o(m),children:i(F.Body,{isLargeModal:!0,children:[e(F.Header,{handleClose:n,children:e("span",{className:"inter-xlarge-semibold",children:"Edit Gift Card Details"})}),e(F.Content,{children:e(R,{control:r,name:"region",render:({field:{value:c,onChange:h}})=>e(De,{label:"Region",options:f,value:c,onChange:h})})}),e(F.Footer,{children:i("div",{className:"w-full flex justify-end",children:[e(z,{variant:"ghost",size:"small",onClick:n,className:"mr-2",type:"button",children:"Cancel"}),e(z,{loading:a,disabled:a,variant:"primary",className:"min-w-[100px]",size:"small",type:"submit",children:"Save"})]})})]})})})},kt=({handleClose:n,handleSave:t,currencyCode:a,giftCard:s,updating:l})=>{const{control:r,handleSubmit:o}=W({defaultValues:{balance:s.balance}}),m=we({control:r,name:"balance"});return e(F,{handleClose:n,children:e(F.Body,{children:i("form",{onSubmit:o(t),children:[i(F.Header,{handleClose:n,children:[e("span",{className:"inter-xlarge-semibold",children:"Update Balance"}),e("span",{className:H("inter-small-regular text-rose-50 mt-2xsmall transition-display delay-75",{hidden:!(m>s.value)}),children:"Balance can't be updated to a value that is greater than the original amount"})]}),e(F.Content,{children:e(O.Root,{readOnly:!0,currentCurrency:a,size:"small",children:e(R,{control:r,name:"balance",rules:{required:!0},render:({field:{value:f,onChange:c}})=>e(O.Amount,{amount:f,label:"Price",onChange:c})})})}),e(F.Footer,{children:i("div",{className:"w-full flex justify-end",children:[e(z,{variant:"ghost",size:"small",onClick:n,className:"mr-2",type:"button",children:"Cancel"}),e(z,{loading:l,variant:"primary",className:"min-w-[100px]",size:"small",type:"submit",disabled:m>s.value||l,children:m>s.value?e(ut,{content:"Balance is above original value",children:"Save"}):"Save"})]})})]})})})},Rt=()=>{var u;const{id:n}=Ue(),{gift_card:t,isLoading:a}=qe(n,{enabled:!!n}),{regions:s}=ze(),l=Ve(t==null?void 0:t.id),r=U(),[o,m]=g.useState(!1),[f,c]=g.useState(!1),h=[{label:"Edit",onClick:()=>c(!0),icon:e(Ne,{size:20})},{label:`${t!=null&&t.is_disabled?"Activate":"Disable"}`,onClick:()=>b({is_disabled:!(t!=null&&t.is_disabled)}),icon:t!=null&&t.is_disabled?e(at,{size:20}):e(Se,{size:20})},{label:"Update balance",onClick:()=>m(!0),icon:e(nt,{size:20})}],b=v=>{l.mutate({...v},{onSuccess:()=>{r("Success","Succesfully updated Gift Card","success"),c(!1),m(!1)},onError:d=>r("Error",M(d),"error")})};return i("div",{children:[e(rt,{currentPage:"Gift Card Details",previousBreadcrumb:"Gift Cards",previousRoute:"/a/gift-cards"}),a||!t?e("div",{className:"w-full bg-grey-0 border border-grey-20 rounded-rounded py-xlarge flex items-center justify-center",children:e(K,{size:"large",variant:"secondary"})}):i(L,{children:[e(ee,{className:"h-auto min-h-0 w-full",title:`${t==null?void 0:t.code}`,subtitle:`Gift Card id: ${t==null?void 0:t.id}`,status:e(Oe,{isDraft:!!(t!=null&&t.is_disabled),activeState:"Active",draftState:"Disable",onChange:()=>b({is_disabled:!(t!=null&&t.is_disabled)})}),actionables:h,children:i("div",{className:"flex justify-between",children:[i("div",{className:"flex mt-6 space-x-6 divide-x",children:[i("div",{className:"flex flex-col",children:[e("div",{className:"inter-smaller-regular text-grey-50 mb-1",children:"Original amount"}),e("div",{children:ne({amount:t==null?void 0:t.value,currency:t==null?void 0:t.region.currency_code})})]}),i("div",{className:"flex flex-col pl-6",children:[e("div",{className:"inter-smaller-regular text-grey-50 mb-1",children:"Balance"}),e("div",{children:ne({amount:t==null?void 0:t.balance,currency:t==null?void 0:t.region.currency_code})})]}),i("div",{className:"flex flex-col pl-6",children:[e("div",{className:"inter-smaller-regular text-grey-50 mb-1",children:"Created"}),e("div",{children:Ge(t==null?void 0:t.created_at).format("DD MMM YYYY")})]})]}),e("div",{className:"flex items-end",children:e(me,{variant:"default",children:(u=t==null?void 0:t.region)==null?void 0:u.name})})]})}),e("div",{className:"mt-large",children:e(st,{data:t,title:"Raw gift card",rootName:"product"})})]}),o&&t&&e(kt,{giftCard:t,currencyCode:t==null?void 0:t.region.currency_code,handleClose:()=>m(!1),handleSave:b,updating:l.isLoading}),f&&t&&e(jt,{handleClose:()=>c(!1),handleSave:b,regions:s,region:t.region,updating:l.isLoading})]})},Mt=({visible:n,children:t,...a})=>(g.useEffect(()=>{n?ae.custom(s=>g.cloneElement(t,{toast:s}),{...a}):ae.dismiss(a.id)},[n,t]),null),$=({children:n,toast:t,isLoading:a=!1,loadingMessage:s="Hang on, this may take a few moments...",unsavedChangesMessage:l="You have unsaved changes",icon:r=e(yt,{size:"20"})})=>{const o=g.useMemo(()=>a?i("div",{className:"flex items-center p-base gap-x-base",children:[e("span",{children:e(K,{})}),e("span",{className:"inter-small-regular",children:s})]}):i(L,{children:[i("div",{className:"flex items-center p-base gap-x-base",children:[e("span",{children:r}),e("span",{className:"inter-small-regular",children:l})]}),n]}),[a,n]);return e("div",{className:H({"animate-enter":t==null?void 0:t.visible,"animate-leave":!(t!=null&&t.visible)}),...t==null?void 0:t.ariaProps,children:e("div",{className:"flex items-center rounded-rounded bg-grey-90 h-[72px] w-[344px] text-grey-0 justify-between",children:o})})},Bt=({children:n})=>e("div",{className:"border-l border-grey-70 h-full",children:g.Children.map(n,t=>e("div",{className:"flex items-center justify-center border-b border-grey-70 last:border-none h-1/2 w-[72px]",children:t}))}),$t=({children:n,className:t,...a})=>e("button",{className:H("flex items-center justify-center text-white inter-small-semibold h-full w-full",t),...a,children:n}),Ht=({children:n,className:t,...a})=>e("button",{className:H("flex items-center justify-center text-white inter-small-semibold h-full w-full",t),...a,children:n}),Ut=({children:n,className:t,actions:a})=>i(mt,{children:[i(ft,{className:H("inter-small-semibold flex items-center justify-center h-full w-full",t),children:[n,e(pt,{size:16,className:"ml-[2px]"})]}),e(ht,{className:"rounded-rounded flex bg-grey-90 text-white p-xsmall flex-col min-w-[208px]",sideOffset:10,children:a.map((s,l)=>e(bt,{children:i("button",{onClick:s.onClick,className:"p-2xsmall hover:bg-grey-80 hover:outline-none inter-small-semibold rounded-base text-left flex items-center w-full",children:[s.icon&&e("span",{className:"text-grey-0 mr-xsmall",children:be.cloneElement(s.icon,{size:20})}),s.label]})},l))})]});$.Actions=Bt;$.DiscardButton=$t;$.ActionButton=Ht;$.MultiActionButton=Ut;const qt=(n,t)=>{const a=t?Object.values(t).some(s=>s):!1;return!!Object.keys(n).length||a},Vt=({toast:n,message:t,title:a})=>{const s=()=>{ae.dismiss(n.id)};return i(lt,{visible:n.visible,children:[e("div",{children:e(it,{size:20,className:"text-rose-40"})}),i("div",{className:"flex flex-col ml-small mr-base gap-y-2xsmall flex-grow text-grey-0",children:[e("span",{className:"inter-small-semibold",children:a}),e("span",{className:"inter-small-regular text-grey-20",children:t})]}),i("div",{children:[e("button",{onClick:s,children:e(Le,{size:20,className:"text-grey-40"})}),e("span",{className:"sr-only",children:"Close"})]})]})},Lt=n=>{const{title:t,list:a,refs:s}=Qt(n);s!=null&&s[0]&&s[0].focus&&s[0].focus(),ae.custom(l=>e(Vt,{toast:l,message:a,title:t}),{position:"top-right",duration:3e3,ariaProps:{role:"alert","aria-live":"polite"}})};function Qt(n){const t=Object.values(n).reduce((r,{message:o})=>(o&&r.push(o),r),[]),a=Object.values(n).reduce((r,{ref:o})=>(o&&r.push(o),r),[]),s=e("ul",{className:"list-disc list-inside",children:t.map(r=>e("li",{children:r}))});return{title:t.length>1?`There were ${t.length} errors with your submission`:"There was an error with your submission",list:s,refs:a}}const Be=n=>(Object.keys(n).forEach(t=>{typeof n[t]=="string"?n[t]=n[t].trim():n[t]&&n[t].constructor.name==="Object"&&Be(n[t])}),n),Yt=async n=>{var a,s,l,r;const t={};if((a=n.images)!=null&&a.length){const o=await gt(n.images);t.images=o.map(m=>m.url)}return n.thumbnail&&(t.thumbnail=(s=t.images)!=null&&s.length?t.images[n.thumbnail]:void 0),{title:n.title,subtitle:n.subtitle??void 0,description:n.description??void 0,handle:n.handle??void 0,type:n.type?{id:(l=n.type)==null?void 0:l.value,value:n.type.label}:void 0,tags:((r=n.tags)==null?void 0:r.map(o=>({value:o})))??[],sales_channels:void 0,...t}},Wt=n=>{var a;let t=(a=n.images)!=null&&a.length?n.images.findIndex(s=>s.url===n.thumbnail):0;return t=t===-1?0:t,{title:n.title,subtitle:n.subtitle,description:n.description,handle:n.handle||void 0,type:n.type?{label:n.type.value,value:n.type.id}:null,tags:n.tags.map(s=>s.value),images:n.images.map(s=>({url:s.url})),thumbnail:t}},Jt=({giftCardId:n,giftCard:t,children:a})=>{const[s,l]=g.useState(!1),r=W(),o=()=>{r.reset({handle:t.handle||void 0,description:t.description||void 0,subtitle:t.subtitle||void 0,tags:t.tags||[],title:t.title||void 0,type:t.type||void 0,thumbnail:t.thumbnail||0,images:t.images||[]}),l(!1)};g.useEffect(()=>{o()},[t]);const{mutate:m}=ye(n),f=U(),c=r.handleSubmit(async h=>{const b=Be(h),u=await Yt(b);m(u,{onSuccess:()=>{f("Success","Product updated successfully","success")}})},Lt);return e(ct,{...r,children:e($e.Provider,{value:{onUpdate:c,resetForm:o,setImageDirtyState:l,additionalDirtyState:{images:s}},children:e("form",{children:a})})})},$e=be.createContext(null),Fe=()=>{const n=be.useContext($e),t=dt();if(!n)throw new Error("useGiftCardForm must be a child of GiftCardFormContext");return{form:t,...n}},Zt=(n,{control:t,name:a,keyName:s},l={defaultAmount:1e3,defaultCurrencyCode:"usd"})=>{const{defaultAmount:r}=l,{fields:o,append:m,remove:f}=Ce({control:t,name:a,keyName:s}),c=we({control:t,name:a,defaultValue:o}),h=c.map(y=>{var x;return(x=y==null?void 0:y.price)==null?void 0:x.currency_code}),b=n==null?void 0:n.filter(y=>!h.includes(y));return{fields:o.map((y,x)=>({...y,...c[x]})),appendPrice:()=>{const y=b[0];m({price:{currency_code:y,amount:r}})},deletePrice:y=>()=>{f(y)},availableCurrencies:b,selectedCurrencies:h}},Xt=({giftCard:n,storeCurrency:t,currencyCodes:a,handleClose:s})=>{const{watch:l,handleSubmit:r,control:o}=W(),m=U(),{mutate:f,isLoading:c}=Qe(n.id),h=l("default_price",1e4),{fields:b,appendPrice:u,deletePrice:v,availableCurrencies:d}=Zt(a,{control:o,name:"prices",keyName:"indexId"},{defaultAmount:h,defaultCurrencyCode:t});return e(F,{handleClose:s,isLargeModal:!0,children:e("form",{onSubmit:r(async x=>{const P=[{amount:x.default_price,currency_code:t}];x.prices&&x.prices.forEach(_=>{P.push({amount:_.price.amount,currency_code:_.price.currency_code})}),f({title:`${n.variants.length}`,options:[{value:`${x.default_price}`,option_id:n.options[0].id}],prices:P,inventory_quantity:0,manage_inventory:!1},{onSuccess:()=>{m("Success","Denomination added successfully","success"),s()},onError:_=>{m("Error",(()=>{var I,A;return((A=(I=_.response)==null?void 0:I.data)==null?void 0:A.type)==="duplicate_error"?"A denomination with that default value already exists":M(_)})(),"error")}})}),children:i(F.Body,{children:[e(F.Header,{handleClose:s,children:e("span",{className:"inter-xlarge-semibold",children:"Add Denomination"})}),i(F.Content,{children:[i("div",{className:"flex-1 mb-xlarge",children:[i("div",{className:"flex gap-x-2 mb-base",children:[e("h3",{className:"inter-base-semibold",children:"Default Value"}),e(Y,{content:"This is the denomination in your store's default currency"})]}),e(R,{control:o,name:"default_price",rules:{required:"Default value is required",max:G.maxInteger("Default value",t)},render:({field:{onChange:x,value:P,ref:_}})=>e(O.Root,{currentCurrency:t,readOnly:!0,size:"medium",children:e(O.Amount,{ref:_,label:"Amount",amount:P,onChange:x})})})]}),i("div",{children:[i("div",{className:"flex gap-x-2 mb-base",children:[e("h3",{className:"inter-base-semibold",children:"Other Values"}),e(Y,{content:"Here you can add values in other currencies"})]}),e("div",{className:"flex flex-col gap-y-xsmall",children:b.map((x,P)=>i("div",{className:"last:mb-0 mb-xsmall flex items-end",children:[e("div",{className:"flex-1",children:e(R,{control:o,name:`prices.${P}.price`,rules:{required:G.required("Price"),validate:_=>G.validateMaxInteger("Price",_.amount,_.currency_code)},defaultValue:x.price,render:({field:{onChange:_,value:w}})=>{const I=[w==null?void 0:w.currency_code,...d];return I.sort(),e(O.Root,{currencyCodes:I,currentCurrency:w==null?void 0:w.currency_code,size:"medium",readOnly:P===0,onChange:A=>_({...w,currency_code:A}),children:e(O.Amount,{label:"Amount",onChange:A=>_({...w,amount:A}),amount:w==null?void 0:w.amount})})}},x.indexId)}),e(z,{variant:"ghost",size:"small",className:"ml-large w-10 h-10",type:"button",children:e(Q,{onClick:v(P),className:"text-grey-40",size:"20"})})]},x.indexId))}),e("div",{className:"mt-large mb-small",children:i(z,{onClick:u,type:"button",variant:"ghost",size:"small",disabled:(d==null?void 0:d.length)===0,children:[e(te,{size:20}),"Add a price"]})})]})]}),e(F.Footer,{children:i("div",{className:"w-full flex justify-end",children:[e(z,{variant:"ghost",size:"small",onClick:s,className:"mr-2 min-w-[130px] justify-center",children:"Cancel"}),e(z,{variant:"primary",size:"small",className:"mr-2 min-w-[130px] justify-center",type:"submit",loading:c,disabled:c,children:"Save"})]})})]})})})},Kt=({defaultDenominations:n=[],onSubmit:t,handleClose:a,currencyCodes:s=[],defaultNewAmount:l=1e3})=>{const[r,o]=g.useState(en(n)),m=r.map(d=>d.currency_code),f=s==null?void 0:s.filter(d=>!m.includes(d)),c=d=>y=>{const x=r.slice();x[d]={...x[d],amount:y},o(x)},h=d=>y=>{const x=r.slice();x[d]={...x[d],currency_code:y},o(x)},b=d=>()=>{const y=r.slice();y.splice(d,1),o(y)},u=()=>{const d={amount:l,currency_code:f[0]};o([...r,He(d)])},v=()=>{const d=tn(r);t&&t(d)};return e(F,{handleClose:a,children:i(F.Body,{children:[e(F.Header,{handleClose:a,children:e("span",{className:"inter-xlarge-semibold",children:"Edit Denominations"})}),i(F.Content,{children:[i("div",{className:"pt-1",children:[i("div",{className:"flex items-center",children:[e("label",{className:"inter-base-semibold text-grey-90 mr-1.5",children:"Prices"}),e(Y,{content:"Helpful denominations"})]}),r.map((d,y)=>i("div",{className:"first:mt-0 mt-xsmall flex items-center",children:[e("div",{className:"flex-1",children:e(O.Root,{currencyCodes:s,currentCurrency:d.currency_code,onChange:h(y),size:"medium",children:e(O.Amount,{label:"Amount",onChange:c(y),amount:d.amount})})}),e("button",{className:"ml-2xlarge",children:e(Q,{onClick:b(y),className:"text-grey-40",size:"20"})})]},d.indexId))]}),e("div",{className:"mt-large",children:i(z,{onClick:u,type:"button",variant:"ghost",size:"small",disabled:f.length===0,children:[e(te,{size:20}),"Add a price"]})})]}),e(F.Footer,{children:i("div",{className:"w-full flex justify-end",children:[e(z,{variant:"ghost",size:"small",onClick:a,className:"mr-2 min-w-[130px] justify-center",children:"Cancel"}),e(z,{variant:"primary",size:"small",className:"mr-2 min-w-[130px] justify-center",onClick:v,children:"Save"})]})})]})})},He=n=>({...n,indexId:xt()}),en=n=>n.map(He),tn=n=>n.map(t=>vt.omit(t,"indexId")),nn=({giftCardId:n,denominations:t,defaultCurrency:a,setEditDenom:s})=>{const[l,r]=g.useState(null),o=Ee(n),m=h=>{const b=(u,v)=>{const d=u.currency_code,y=v.currency_code;return d<y?-1:d>y?1:0};return h.prices.filter(u=>u.currency_code!==a).sort(b).map(u=>Pe({currencyCode:u.currency_code,amount:u.amount})).join(", ")},f=(h,b)=>{let u=h.prices.find(v=>v.currency_code===a);return u||(u=h.prices[0]),i(D.Row,{color:"inherit",actions:[{label:"Edit denomination",onClick:()=>s(h),icon:e(Ne,{size:20})},{label:"Delete denomination",variant:"danger",onClick:()=>r(h.id),icon:e(Q,{size:20})}],children:[e(D.Cell,{children:Pe({currencyCode:u.currency_code,amount:u.amount})}),e(D.Cell,{children:m(h)}),e(D.Cell,{})]},`denomination-${b}`)},c=async()=>{o.mutateAsync(l)};return i("div",{className:"w-full h-full overflow-y-auto",children:[i(D,{children:[e(D.Head,{children:i(D.HeadRow,{children:[e(D.HeadCell,{children:"Default Value"}),e(D.HeadCell,{children:"Other Values"})]})}),e(D.Body,{className:"text-grey-90",children:t==null?void 0:t.map((h,b)=>f(h,b))})]}),l&&e(ke,{handleClose:()=>r(null),text:"Are you sure you want to delete this denomination from your Medusa Store?",heading:"Delete denomination",onDelete:()=>c(),successText:"Successfully deleted denomination",confirmText:"Yes, delete"})]})},an=({giftCard:n})=>{const[t,a]=g.useState(null),[s,l]=g.useState(!1),{store:r}=ge(),o=Ye(n.id),m=Ee(n.id),f=U(),c=(r==null?void 0:r.currencies.filter(b=>b.code!==r.default_currency_code).map(b=>b.code))||[],h=b=>{if(!b.length){m.mutate(t.id,{onSuccess:()=>{f("Success","Successfully updated denominations","success"),a(null)},onError:u=>f("Error",M(u),"error")});return}o.mutate({variant_id:t.id,prices:b.map(({amount:u,currency_code:v})=>({amount:u,currency_code:v})),title:t.title,inventory_quantity:t.inventory_quantity,options:t.options.map(u=>({option_id:u.option_id,value:u.value}))},{onSuccess:()=>{f("Success","Successfully updated denominations","success"),a(null)},onError:u=>f("Error",M(u),"error")})};return i(L,{children:[e(ee,{title:"Denominations",subtitle:"Manage your denominations",className:"h-auto w-full",actionables:[{label:"Add Denomination",onClick:()=>l(!0),icon:e(te,{size:20})}],children:e(nn,{giftCardId:n.id,denominations:n.variants||[],defaultCurrency:(r==null?void 0:r.default_currency_code)||"",setEditDenom:a})}),t&&e(Kt,{currencyCodes:r==null?void 0:r.currencies.map(b=>b.code),onSubmit:h,defaultDenominations:t.prices.map(b=>({amount:b.amount,currency_code:b.currency_code,id:b.id})),handleClose:()=>a(null)}),s&&e(Xt,{giftCard:n,handleClose:()=>l(!1),storeCurrency:r==null?void 0:r.default_currency_code,currencyCodes:c})]})},rn=({data:n,form:t,onDelete:a})=>{const{control:s,register:l,path:r}=t,o=g.useMemo(()=>[{Header:()=>e("div",{className:"ml-large min-w-[140px] max-w-[140px]",children:e("span",{children:"Image"})}),maxWidth:140,width:140,collapse:!0,accessor:"url",Cell:({cell:{value:u}})=>e("div",{className:"py-base ml-large",children:e("img",{className:"h-[80px] w-[80px] object-cover rounded",src:u})})},{Header:()=>e("span",{children:"File name"}),accessor:"nativeFile",Cell:({cell:u})=>e(R,{control:s,name:r(`${u.row.index}.nativeFile`),render:({field:{value:v}})=>i("div",{className:"w-full",children:[e("p",{className:"inter-small-regular",children:v==null?void 0:v.name}),(v==null?void 0:v.size)&&i("span",{className:"inter-small-regular text-grey-50",children:[(v.size/1024).toFixed(2)," KB"]})]})})},{Header:()=>i("div",{className:"flex gap-x-[6px] items-center justify-center",children:[e("span",{children:"Thumbnail"}),e(Y,{content:"Select which image you want to use as the thumbnail for this product"})]}),id:"thumbnail",width:120,collapse:!0,Cell:({cell:u})=>e("div",{className:"flex items-center justify-center",children:e(je.Dot,{value:u.row.index})})},{Header:()=>null,id:"delete",width:40,Cell:({row:u})=>e(z,{onClick:()=>a(u.index),variant:"ghost",size:"small",className:"p-1 text-grey-40 cursor-pointer mx-6",type:"button",children:e(Q,{size:20})})}],[]),{getTableProps:m,getTableBodyProps:f,headerGroups:c,rows:h,prepareRow:b}=pe.useTable({columns:o,data:n,defaultColumn:{width:"auto"}});return i(D,{...m(),children:[e(D.Head,{children:c==null?void 0:c.map(u=>e(D.HeadRow,{...u.getHeaderGroupProps(),children:u.headers.map((v,d)=>e(D.HeadCell,{...v.getHeaderProps(),children:v.render("Header",{index:d})}))}))}),e(D.Body,{...f(),children:h.map((u,v)=>(b(u),g.createElement(D.Row,{...u.getRowProps(),className:"px-base",key:v},u.cells.map(d=>e(D.Cell,{width:d.column.width,...d.getCellProps(),children:d.render("Cell")})))))})]})},sn=()=>{const{form:n,setImageDirtyState:t}=Fe(),{fields:a,append:s,remove:l}=Ce({control:n.control,name:"images"}),r=m=>{t(!0),l(m)},o=m=>{if(m.length){const f=m.map(c=>({url:URL.createObjectURL(c),name:c.name,size:c.size,nativeFile:c}));s(f)}};return i(ee,{title:"Images",subtitle:"Add up to 10 images to your product",children:[e("div",{className:"mt-base",children:e(R,{name:"thumbnail",control:n.control,render:({field:{value:m,onChange:f}})=>i(je.Root,{value:m?`${m}`:void 0,onValueChange:c=>{f(parseInt(c))},children:[e(rn,{data:a,form:wt(n,"images"),onDelete:r}),a.map((c,h)=>i("div",{className:"flex items-center",children:[e("input",{className:"hidden",...n.register(`images.${h}.url`),defaultValue:c.url}),c.nativeFile&&i(L,{children:[e("input",{className:"hidden",...n.register(`images.${h}.name`),defaultValue:c.name}),e("input",{className:"hidden",...n.register(`images.${h}.size`),defaultValue:c.size}),e(R,{name:`images.${h}.nativeFile`,control:n.control,defaultValue:c.nativeFile,render:()=>e(L,{})})]})]},c.id))]})})}),e("div",{className:"mt-2xlarge",children:e(Re,{onFileChosen:o,placeholder:"1200 x 1600 (3:4) recommended, up to 10MB each",filetypes:["image/gif","image/jpeg","image/png","image/webp"],className:"py-large"})})]})},ln=({rootProps:n,triggerProps:t,contentProps:a,children:s})=>{const[l,r]=g.useState(!1),o=l?Tt:Pt,m=l?"Hide additional details":"Show additional details";return i(Dt,{...n,onOpenChange:f=>r(f),children:[e(_t,{...t,type:"button",className:H({"mb-6":l},t==null?void 0:t.className),children:i("div",{className:"flex items-center",children:[e(o,{size:"20"}),e("div",{className:"ml-1",children:m})]})}),e(Ft,{...a,className:H({hidden:(a==null?void 0:a.forceMount)&&!l}),children:s})]})},on=({giftCard:n})=>{const{form:{register:t,setValue:a,control:s,formState:{errors:l}}}=Fe(),r=ve(),o=U(),{product_types:m}=We(void 0,{cacheTime:0}),f=(m==null?void 0:m.map(d=>({label:d.value,value:d.id})))||[],c=ye(n.id),h=Ie(n.id),b=d=>{const y={label:d,value:d};return f.push(y),a("type",y),y},u=()=>{c.mutate({status:n.status==="draft"?"published":"draft"},{onSuccess:()=>{o("Success","Gift card updated successfully","success")},onError:d=>{o("Error",M(d),"error")}})},v=()=>{h.mutate(void 0,{onSuccess:()=>{r("/a/gift-cards"),o("Success","Gift card updated successfully","success")},onError:d=>{o("Error",M(d),"error")}})};return e(ee,{title:"Product information",subtitle:"Manage the settings for your Gift Card",className:"h-auto w-full",status:e(cn,{currentStatus:n.status,onUpdate:u}),actionables:[{label:(n==null?void 0:n.status)!=="published"?"Publish Gift Card":"Unpublish Gift Card",onClick:u,icon:e(Se,{size:"16"})},{label:"Delete Gift Card",onClick:v,variant:"danger",icon:e(Q,{size:"16"})}],children:i("div",{className:"flex flex-col space-y-6",children:[i("div",{className:"grid grid-cols-2 gap-large",children:[e(X,{label:"Name",placeholder:"Add name",required:!0,defaultValue:n==null?void 0:n.title,...t("title",{required:G.required("Name"),pattern:G.whiteSpaceRule("Name"),minLength:G.minOneCharRule("Name")}),errors:l}),e(X,{label:"Subtitle",placeholder:"Add a subtitle",...t("subtitle",{pattern:G.whiteSpaceRule("Subtitle"),minLength:G.minOneCharRule("Subtitle")}),errors:l}),e(_e,{label:"Description",placeholder:"Add a description",...t("description",{pattern:G.whiteSpaceRule("Description"),minLength:G.minOneCharRule("Description")}),errors:l})]}),e(ln,{triggerProps:{className:"ml-2"},contentProps:{forceMount:!0},children:i("div",{className:"grid grid-cols-2 gap-large",children:[e(X,{label:"Handle",placeholder:"Product handle",...t("handle",{pattern:G.whiteSpaceRule("Handle"),minLength:G.minOneCharRule("Handle")}),tooltipContent:"URL of the product",errors:l}),e(R,{control:s,name:"type",render:({field:{value:d,onChange:y}})=>e(De,{label:"Type",placeholder:"Select type...",options:f,onChange:y,value:d,isCreatable:!0,onCreateOption:x=>b(x),clearSelected:!0})}),e(R,{name:"tags",render:({field:{onChange:d,value:y}})=>e(Ct,{label:"Tags (separated by comma)",className:"w-full",placeholder:"Spring, Summer...",onChange:d,values:y||[]}),control:s})]})})]})})},cn=({currentStatus:n,onUpdate:t})=>e(Oe,{activeState:"Published",draftState:"Draft",isDraft:n==="draft",onChange:t}),dn=()=>{const{products:n}=xe({is_giftcard:!0},{keepPreviousData:!0}),t=n==null?void 0:n[0];return t?i(Jt,{giftCard:Wt(t),giftCardId:t.id,children:[i("div",{className:"flex flex-col gap-y-large pb-xlarge",children:[e(on,{giftCard:t}),e(an,{giftCard:t}),e(sn,{})]}),e(un,{})]}):e("div",{className:"w-full h-screen flex items-center justify-center",children:e(K,{variant:"secondary",size:"large"})})},Te="edit-gc-dirty",un=({isLoading:n=!1})=>{const{form:{formState:t},onUpdate:a,resetForm:s,additionalDirtyState:l}=Fe(),[r,o]=g.useState(!1),[m,f]=g.useState(!0);g.useEffect(()=>{const h=setTimeout(f,300,!1);return()=>clearTimeout(h)},[]);const c=qt(t.dirtyFields,l);return g.useEffect(()=>(m||o(c),()=>{ot.dismiss(Te)}),[c]),e(Mt,{visible:r,duration:1/0,id:Te,position:"bottom-right",children:e($,{isLoading:n,children:i($.Actions,{children:[e($.ActionButton,{onClick:a,children:"Save"}),e($.DiscardButton,{onClick:s,children:"Discard"})]})})})},V=({title:n,thumbnail:t,actions:a,children:s})=>e("div",{className:"rounded-rounded border bg-grey-0 border-grey-20 w-full p-base medium:p-xlarge",children:i("div",{className:"flex gap-large items-start",children:[t&&e("div",{className:"min-w-[72px] min-h-[72px] w-[72px] h-[72px] rounded-base overflow-hidden",children:e("img",{src:t,alt:"Thumbnail",className:"w-full h-full object-cover"})}),i("div",{className:"w-full",children:[i("div",{className:"flex items-center justify-between pb-2",children:[e("p",{className:"inter-large-semibold",children:n}),e(Nt,{actions:a})]}),s]})]})}),mn=({cta:n,children:t})=>i("div",{children:[e("p",{className:"inter-small-regular text-grey-50 max-w-[460px] line-clamp-2",children:t}),n&&e("button",{className:"text-violet-60 inter-small-semibold mt-base",onClick:n.onClick,children:n.label})]}),fn=({children:n})=>e("div",{className:"mt-base",children:n});V.Description=mn;V.Footer=fn;const pn=({tags:n,badgeVariant:t})=>{const a=g.useRef(null),s=Et(a),l=Math.max(Math.floor(s/70)-1,1),r=n.slice(0,l),o=n.length-l;return i("div",{className:"flex items-center gap-x-2xsmall w-1/2",ref:a,children:[r==null?void 0:r.map((m,f)=>e(me,{className:"mr-2xsmall",variant:t,children:m},f)),o>0&&i(me,{variant:"default",children:["+",o]})]})},hn=({title:n,status:t,thumbnail:a,description:s,variants:l,defaultCurrency:r,onEdit:o,onUnpublish:m,onDelete:f})=>{const c=[{label:"Edit",onClick:o,icon:e(Ne,{size:16})},{label:t==="published"?"Unpublish":"Publish",onClick:m,icon:e(Se,{size:16})},{label:"Delete",onClick:f,icon:e(Q,{size:16}),variant:"danger"}],h=g.useMemo(()=>l.map(b=>{const u=b.prices.find(v=>v.currency_code===r);return u?`${tt(r,u.amount)} ${r.toUpperCase()}`:""}).filter(Boolean),[l,r,zt]);return i(V,{title:n,thumbnail:a,actions:c,children:[e(V.Description,{children:s}),e(V.Footer,{children:i("div",{className:"flex items-center justify-between",children:[e(pn,{tags:h,badgeVariant:"default"}),e(Me,{variant:t==="published"?"success":"danger",title:t==="published"?"Published":"Unpublished"})]})})]})},bn=()=>[g.useMemo(()=>[{Header:e("div",{className:"pl-2",children:"Code"}),accessor:"code",Cell:({cell:{value:t},index:a})=>e(D.Cell,{className:"text-grey-90 group-hover:text-violet-60 w-[20%] pl-2",children:t},a)},{Header:"Order",accessor:"order",Cell:({cell:{value:t},index:a})=>e(D.Cell,{className:"text-grey-90 group-hover:text-violet-60 w-[10%] pl-2",children:t&&(t!=null&&t.display_id)?`#${t.display_id}`:e("span",{className:"text-grey-90",children:"-"})},a)},{Header:"Original Amount",accessor:"value",Cell:({row:t,cell:{value:a},index:s})=>e(D.Cell,{children:t.original.region?ne({amount:a,currency:t.original.region.currency_code}):i("div",{className:"flex items-center space-x-2",children:[e("span",{children:"N / A"}),e(Y,{content:"Region has been deleted"})]})},s)},{Header:"Balance",accessor:"balance",Cell:({row:t,cell:{value:a},index:s})=>e(D.Cell,{children:a?t.original.region?ne({amount:a,currency:t.original.region.currency_code}):i("div",{className:"flex items-center space-x-2",children:[e("span",{children:"N / A"}),e(Y,{content:"Region has been deleted"})]}):e(Me,{title:"None",variant:"danger"})},s)},{Header:()=>e("div",{className:"pr-2 flex rounded-rounded w-full justify-end",children:"Created"}),accessor:"created_at",Cell:({cell:{value:t},index:a})=>e(D.Cell,{className:"pr-2",children:e("div",{className:"flex rounded-rounded w-full justify-end",children:Ge(t).format("MMM Do YYYY")})},a)}],[])],yn=["status","fulfillment_status","payment_status","created_at","q","offset","limit"],de={incomplete:{fulfillment_status:["not_fulfilled","fulfilled"],payment_status:["awaiting"]},complete:{fulfillment_status:["shipped"],payment_status:["captured"]}},gn=n=>n===null?n:Object.entries(n).reduce((a,[s,l])=>(l.includes("|")?a[s]=Gt(l):a[s]=l,a),{}),vn=(n,t)=>{var a;switch(t.type){case"setFilters":return{...n,fulfillment:t.payload.fulfillment,payment:t.payload.payment,status:t.payload.status,date:t.payload.date,query:(a=t==null?void 0:t.payload)==null?void 0:a.query};case"setQuery":return{...n,query:t.payload};case"setDate":{const s=n.date;return{...n,date:s}}case"setOffset":return{...n,offset:t.payload};case"reset":return t.payload;default:return n}},xn=(n,t)=>{if(n.size!==t.size)return!1;for(const a of n)if(!t.has(a))return!1;return!0},Nn=(n,t=null)=>{n&&n[0]==="?"&&(n=n.substring(1));const a=g.useMemo(()=>wn(n,t),[n,t]),s=g.useMemo(()=>{const p=localStorage.getItem("GiftCards::filters");if(p){const C=JSON.parse(p);if(C)return Object.entries(C).map(([N,T])=>({label:N,value:N,removable:!0,representationString:T}))}return[]},[]),[l,r]=g.useReducer(vn,a),[o,m]=g.useState(s),f=p=>{r({type:"setDate",payload:p})},c=p=>{r({type:"setFulfillment",payload:p})},h=p=>{r({type:"setPayment",payload:p})},b=p=>{r({type:"setStatus",payload:p})},u=p=>{r({type:"setDefaults",payload:p})},v=p=>{if(p>0){const C=l.offset+l.limit;r({type:"setOffset",payload:C})}else{const C=Math.max(l.offset-l.limit,0);r({type:"setOffset",payload:C})}},d=()=>{r({type:"setFilters",payload:{...l,offset:0,payment:{open:!1,filter:null},fulfillment:{open:!1,filter:null},status:{open:!1,filter:null},date:{open:!1,filter:null},query:null}})},y=p=>{r({type:"setFilters",payload:p})},x=p=>{r({type:"setQuery",payload:p})},P=()=>{const p={...l.additionalFilters};for(const[C,N]of Object.entries(l))C==="query"?N&&typeof N=="string"&&(p.q=N):C==="offset"||C==="limit"?p[C]=N:N.open&&(C==="date"?p[ue[C]]=gn(N.filter):p[ue[C]]=N.filter);return p},_=()=>{const p=P();return q.stringify(p,{skipNulls:!0})},w=p=>{const C=p??l,N={};for(const[T,S]of Object.entries(C))T==="query"?S&&typeof S=="string"&&(N.q=S):T==="offset"||T==="limit"?N[T]=S:S.open&&(N[ue[T]]=S.filter);return N},I=()=>{const p=w();return q.stringify(p,{skipNulls:!0})},A=g.useMemo(()=>P(),[l]),k=g.useMemo(()=>w(),[l]),J=g.useMemo(()=>I(),[l]),Z=g.useMemo(()=>{const p=fe.omit(k,["limit","offset"]),C=q.stringify(p),N=o.find(T=>T.representationString===C);if(N)return N.value;for(const[T,S]of Object.entries(de)){let E=!0;if(Object.keys(p).length===Object.keys(S).length){for(const[j,B]of Object.entries(S))if(j in p?Array.isArray(B)?E=Array.isArray(p[j])&&xn(new Set(p[j]),new Set(B)):E=p[j]===B:E=!1,!E)break;if(E)return T}}return null},[k,o]),se=g.useMemo(()=>[{label:"Complete",value:"complete"},{label:"Incomplete",value:"incomplete"},...o],[o]),le=p=>{let C=null;if(p in de)C=de[p];else{const N=o.find(T=>T.value===p);N&&(C=q.parse(N.representationString))}if(C){const N={...l,date:{open:!1,filter:null},payment:{open:!1,filter:null},fulfillment:{open:!1,filter:null},status:{open:!1,filter:null}};for(const[T,S]of Object.entries(C))N[Sn[T]]={open:!0,filter:S};r({type:"setFilters",payload:N})}},ie=(p,C)=>{const N=w({...C}),T=fe.omit(N,["limit","offset"]),S=q.stringify(T,{skipNulls:!0}),E=localStorage.getItem("GiftCards::filters");let j=null;if(E&&(j=JSON.parse(E)),j)j[p]=S,localStorage.setItem("GiftCards::filters",JSON.stringify(j));else{const B={};B[p]=S,localStorage.setItem("GiftCards::filters",JSON.stringify(B))}m(B=>[...B,{label:p,value:p,representationString:S,removable:!0}]),r({type:"setFilters",payload:C})},oe=p=>{const C=localStorage.getItem("GiftCards::filters");let N=null;C&&(N=JSON.parse(C)),N&&(delete N[p],localStorage.setItem("GiftCards::filters",JSON.stringify(N))),m(T=>T.filter(E=>E.value!==p))};return{...l,filters:{...l},removeTab:oe,saveTab:ie,setTab:le,availableTabs:se,activeFilterTab:Z,representationObject:k,representationString:J,queryObject:A,paginate:v,getQueryObject:P,getQueryString:_,setQuery:x,setFilters:y,setDefaultFilters:u,setDateFilter:f,setFulfillmentFilter:c,setPaymentFilter:h,setStatusFilter:b,reset:d}},Sn={status:"status",fulfillment_status:"fulfillment",payment_status:"payment",created_at:"date"},ue={status:"status",fulfillment:"fulfillment_status",payment:"payment_status",date:"created_at"},wn=(n,t=null)=>{const a={status:{open:!1,filter:null},fulfillment:{open:!1,filter:null},payment:{open:!1,filter:null},date:{open:!1,filter:null},offset:0,limit:15,additionalFilters:t};if(n){const s=q.parse(n);for(const[l,r]of Object.entries(s))if(yn.includes(l))switch(l){case"offset":{typeof r=="string"&&(a.offset=parseInt(r));break}case"limit":{typeof r=="string"&&(a.limit=parseInt(r));break}case"q":{typeof r=="string"&&(a.query=r);break}case"status":{(typeof r=="string"||Array.isArray(r))&&(a.status={open:!0,filter:r});break}case"fulfillment_status":{(typeof r=="string"||Array.isArray(r))&&(a.fulfillment={open:!0,filter:r});break}case"payment_status":{(typeof r=="string"||Array.isArray(r))&&(a.payment={open:!0,filter:r});break}case"created_at":{a.date={open:!0,filter:r};break}}}return a},Ae=15,Cn={},Dn=()=>{const n=Je(),{reset:t,paginate:a,setQuery:s,queryObject:l,representationObject:r}=Nn(n.search,Cn),o=l,m=parseInt(o==null?void 0:o.offset)||0,f=parseInt(o.limit)||Ae,[c,h]=g.useState(o==null?void 0:o.query),[b,u]=g.useState(0),{gift_cards:v,isLoading:d,count:y}=Ze(l,{keepPreviousData:!0});g.useEffect(()=>{const S=Math.ceil(y/l.limit);u(S)},[v]);const[x]=bn(),{getTableProps:P,getTableBodyProps:_,headerGroups:w,rows:I,prepareRow:A,canPreviousPage:k,canNextPage:J,pageCount:Z,gotoPage:se,nextPage:le,previousPage:ie,state:{pageIndex:oe}}=pe.useTable({columns:x,data:v||[],manualPagination:!0,initialState:{pageSize:f,pageIndex:m/f},pageCount:b,autoResetPage:!1},pe.usePagination);g.useEffect(()=>{const S=setTimeout(()=>{c?(s(c),se(0)):t()},400);return()=>clearTimeout(S)},[c]);const p=()=>{J&&(a(1),le())},C=()=>{k&&(a(-1),ie())},N=(S={})=>{const E=q.stringify(S);window.history.replaceState("/a/gift-cards","",`${`?${E}`}`)},T=()=>{const S=r;fe.isEmpty(S)?N({offset:0,limit:Ae}):N(S)};return g.useEffect(()=>{T()},[r]),e(St,{isLoading:d,hasPagination:!0,numberOfRows:l.limit,pagingState:{count:y,offset:l.offset,pageSize:l.offset+I.length,title:"Gift cards",currentPage:oe+1,pageCount:Z,nextPage:p,prevPage:C,hasNext:J,hasPrev:k},children:i(D,{filteringOptions:null,enableSearch:!0,handleSearch:h,searchValue:c,...P(),className:H({relative:d}),children:[e(D.Head,{children:w==null?void 0:w.map(S=>e(D.HeadRow,{...S.getHeaderGroupProps(),children:S.headers.map(E=>e(D.HeadCell,{...E.getHeaderProps(),children:E.render("Header")}))}))}),d||!v?e(D.Body,{..._(),children:e(D.Row,{children:e(D.Cell,{colSpan:x.length,children:e("div",{className:"flex w-full h-full absolute items-center justify-center mt-10",children:e("div",{className:"",children:e(K,{size:"large",variant:"secondary"})})})})})}):e(D.Body,{..._(),children:I.map(S=>(A(S),e(D.Row,{color:"inherit",linkTo:S.original.id,...S.getRowProps(),className:"group",children:S.cells.map((E,j)=>E.render("Cell",{index:j}))})))})]})})};function re(n){var t,a;(a=(t=document==null?void 0:document.getElementsByName(n))==null?void 0:t[0])==null||a.focus()}const _n=({onDismiss:n})=>{var v;const{isLoading:t,regions:a}=ze(),[s,l]=g.useState(null),[r,o]=g.useState(0),{register:m,handleSubmit:f}=W(),c=U(),{mutate:h,isLoading:b}=Xe();g.useEffect(()=>{t||l({value:a[0],label:a[0].name})},[t]);const u=d=>{if(!r){c("Error","Please enter an amount","error"),re("amount");return}if(!It(d.metadata.email)){c("Error","Invalid email address","error"),re("metadata.email");return}const y={region_id:s.value.id,value:Math.round(r/(1+s.value.tax_rate/100)),...d};h(y,{onSuccess:()=>{c("Success","Created Custom Gift Card","success"),n()},onError:x=>{c("Error",M(x),"error"),n()}})};return e(F,{handleClose:n,children:i(F.Body,{children:[e(F.Header,{handleClose:n,children:e("h2",{className:"inter-xlarge-semibold",children:"Custom Gift Card"})}),i(F.Content,{children:[i("div",{className:"flex flex-col",children:[e("span",{className:"inter-base-semibold",children:"Value"}),i("div",{className:"flex gap-x-2xsmall mt-4",children:[e("div",{className:"w-[267px]",children:e(De,{label:"Region",value:s,onChange:d=>l(d),options:(a==null?void 0:a.map(d=>({value:d,label:d.name})))||[]})}),e("div",{className:"w-[415px]",children:e(O.Root,{size:"medium",currencyCodes:t||a==null?void 0:a.map(d=>d.currency_code),readOnly:!0,currentCurrency:(v=s==null?void 0:s.value)==null?void 0:v.currency_code,children:e(O.Amount,{label:"Amount",amount:r,onChange:d=>{o(d||0)},name:"amount",required:!0})})})]})]}),i("div",{className:"mt-8",children:[e("span",{className:"inter-base-semibold",children:"Receiver"}),i("div",{className:"grid grid-cols-1 gap-y-xsmall mt-4",children:[e(X,{label:"Email",required:!0,...m("metadata.email",{required:!0}),placeholder:"lebron@james.com",type:"email"}),e(_e,{label:"Personal Message",rows:7,placeholder:"Something nice to someone special",...m("metadata.personal_message")})]})]})]}),e(F.Footer,{children:i("div",{className:"flex w-full justify-end gap-x-xsmall",children:[e(z,{variant:"ghost",onClick:n,size:"small",className:"w-[112px]",children:"Cancel"}),e(z,{variant:"primary",type:"submit",onClick:f(u),size:"small",className:"w-[112px]",disabled:b,loading:b,children:"Create & Send"})]})})]})})},Fn=({onClose:n})=>{const{store:t}=ge(),{refetch:a}=xe(),{mutate:s,isLoading:l}=Ke(),r=ve(),o=U(),{register:m,setValue:f,handleSubmit:c,control:h}=W({shouldUnregister:!0}),{fields:b,append:u,remove:v}=Ce({control:h,name:"denominations"}),d=P=>{const _=P[0],w=URL.createObjectURL(_);f("thumbnail",{url:w,name:_.name,size:_.size,nativeFile:_})},y=we({control:h,name:"thumbnail"});return e(F,{handleClose:n,children:e("form",{onSubmit:c(async P=>{var I;if(!P.title.trim()){o("Error","Please enter a name for the Gift Card","error"),re("name");return}if(!((I=P.denominations)!=null&&I.length)){o("Error","Please add at least one denomination","error"),re("add-denomination");return}let w=[];y&&(w=await Ot.uploads.create([y.nativeFile]).then(({data:k})=>k.uploads.map(({url:Z})=>Z))),s({is_giftcard:!0,title:P.title,description:P.description,discountable:!1,options:[{title:"Denominations"}],variants:P.denominations.map((A,k)=>({title:`${k+1}`,inventory_quantity:0,manage_inventory:!1,prices:[{amount:A.amount,currency_code:t==null?void 0:t.default_currency_code}],options:[{value:`${A.amount}`}]})),images:w.length?w:void 0,thumbnail:w.length?w[0]:void 0,status:he.PUBLISHED},{onSuccess:()=>{o("Success","Successfully created Gift Card","success"),a(),r("/a/gift-cards/manage")},onError:A=>{o("Error",M(A),"error")}})},P=>console.log(P)),children:i(F.Body,{children:[e(F.Header,{handleClose:n,children:e("div",{children:e("h1",{className:"inter-xlarge-semibold",children:"Create Gift Card"})})}),i(F.Content,{children:[e("div",{className:"mb-base",children:e("h3",{className:"inter-base-semibold",children:"Gift Card Details"})}),i("div",{className:"flex flex-col gap-y-base",children:[e(X,{label:"Name",required:!0,placeholder:"The best Gift Card",...m("title",{required:!0})}),e(_e,{label:"Description",placeholder:"The best Gift Card of all time",...m("description")})]}),i("div",{className:"mt-xlarge",children:[e("h3",{className:"inter-base-semibold",children:"Thumbnail"}),e("div",{className:"h-[80px] mt-base",children:y?i("div",{className:"flex items-center gap-x-6",children:[e("img",{src:y.url,alt:"",className:"w-20 h-20 rounded-base object-cover object-center"}),i("div",{className:"flex flex-col gap-y-1",children:[e("span",{className:"inter-small-regular",children:y.name}),e("div",{children:e("button",{className:"text-rose-50 inter-small-semibold",type:"button",onClick:()=>f("thumbnail",null),children:"Delete"})})]})]}):e(Re,{filetypes:["image/gif","image/jpeg","image/png","image/webp"],onFileChosen:d,placeholder:"1200 x 1600 (3:4) recommended, up to 10MB each"})})]}),i("div",{className:"mt-xlarge",children:[i("h3",{className:"inter-base-semibold mb-base",children:["Denominations",e("span",{className:"text-rose-50",children:"*"})]}),e("div",{className:"flex flex-col gap-y-xsmall",children:b.map((P,_)=>i("div",{className:"flex items-end gap-x-base last:mb-large",children:[e(O.Root,{currentCurrency:t==null?void 0:t.default_currency_code,readOnly:!0,size:"medium",children:e(R,{control:h,name:`denominations.${_}.amount`,rules:{required:!0,shouldUnregister:!0},render:({field:{value:w,onChange:I,ref:A}})=>e(O.Amount,{label:"Amount",amount:w||void 0,onChange:I,ref:A})})}),e(z,{variant:"ghost",size:"large",className:"w-10 h-10 text-grey-40",type:"button",onClick:()=>v(_),children:e(Q,{size:20})})]},P.id))}),i(z,{name:"add-denomination",variant:"ghost",size:"small",onClick:()=>u({amount:void 0}),type:"button",children:[e(te,{size:20}),"Add Denomination"]})]})]}),e(F.Footer,{children:i("div",{className:"flex items-center justify-end w-full",children:[e(z,{type:"submit",variant:"ghost",size:"small",className:"w-eventButton",onClick:n,children:"Cancel"}),e(z,{type:"submit",variant:"primary",size:"small",className:"w-eventButton",loading:l,disabled:l,children:"Create & Publish"})]})})]})})})},Pn=()=>{const{products:n,isLoading:t}=xe({is_giftcard:!0}),{store:a}=ge(),[s,l]=g.useState(!1),[r,o]=g.useState(!1),[m,f]=g.useState(!1),c=n==null?void 0:n[0],h=ve(),b=U(),u=ye(c==null?void 0:c.id),v=Ie(c==null?void 0:c.id),d=()=>{let _=he.PUBLISHED;(c==null?void 0:c.status)==="published"&&(_=he.DRAFT),u.mutate({status:_},{onSuccess:()=>b("Success","Successfully updated Gift Card","success"),onError:w=>b("Error",M(w),"error")})},y=()=>{v.mutate(void 0,{onSuccess:()=>{h("/a/gift-cards")}})},x=[{label:"Custom Gift Card",onClick:()=>o(!0),icon:e(te,{size:20})}],P=g.useMemo(()=>!c||!a?null:{...c,defaultCurrency:a.default_currency_code},[c,a]);return i(L,{children:[i("div",{className:"flex flex-col grow h-full pb-xlarge",children:[e(At,{title:"Gift Cards",subtitle:"Manage the Gift Cards of your Medusa store"}),t?e("div",{className:"w-full flex items-center justify-center h-44 rounded-rounded border border-grey-20",children:e(K,{variant:"secondary",size:"large"})}):i(L,{children:[e("div",{className:"mb-base",children:P?e(hn,{...P,onDelete:()=>f(!0),onEdit:()=>h("/a/gift-cards/manage"),onUnpublish:d}):e(V,{title:"Are you ready to sell your first Gift Card?",children:e(V.Description,{cta:{label:"Create Gift Card",onClick:()=>l(!0)},children:"No Gift Card has been added yet."})})}),e("div",{className:"w-full flex flex-col grow",children:e(ee,{title:"History",subtitle:"See the history of purchased Gift Cards",actionables:x,className:"h-fit",children:e(Dn,{})})})]})]}),r&&e(_n,{onDismiss:()=>o(!1)}),s&&e(Fn,{onClose:()=>l(!s)}),m&&e(ke,{handleClose:()=>f(!m),onDelete:async()=>y(),successText:"Successfully deleted Gift Card",confirmText:"Yes, delete",heading:"Delete Gift Card"})]})},_a=()=>i(et,{children:[e(ce,{path:"/",element:e(Pn,{})}),e(ce,{path:"/:id",element:e(Rt,{})}),e(ce,{path:"/manage",element:e(dn,{})})]});export{_a as default};
