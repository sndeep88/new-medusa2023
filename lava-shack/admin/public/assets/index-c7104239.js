import{r as p,a as e,q as le,c as Te,bf as qe,j as t,aE as Me,bg as Ee,bh as be,aF as xe,d as Z,a5 as ne,F as _e,M as Q,B as M,e as ee,bi as Y,af as Fe,S as ae,a1 as je,bj as $e,C as de,u as oe,bk as Re,bl as ze,G as Be,bm as He,Z as Ve,bn as Le,bo as Qe,bp as Ue,R as Ge,b as ue}from"./index-effbfb95.js";import{I as G,M as Ye,P as U}from"./index-dd9f9076.js";import{B}from"./body-card-d3fddb8c.js";import{T as We}from"./index-a6859a1b.js";import{T as _,r as me,a as Ze,C as Je}from"./index-0d9858ea.js";import{h as ve}from"./moment-fbc5633a.js";import{C as Ke,g as Xe,D as z}from"./display-total-6e4997b2.js";import{S as se}from"./index-04f3341e.js";import{u as Ne,c as es,b as O,F as ss,a as ts,C as H}from"./index.esm-5a89640b.js";import{e as Ce,d as W,g as rs,p as ls,a as ie,f as K,B as is}from"./index-84767cd7.js";import{A as ns,u as we}from"./use-notification-9f7c3c92.js";import{A as Se,a as te,R as as,C as os,e as cs,F as pe,b as ds}from"./address-modal-8731dbad.js";import{n as Pe}from"./nested-form-c66382a0.js";import{T as Ae}from"./trash-icon-abcb5140.js";import{I as ce}from"./image-placeholder-b3cbea02.js";import{C as re}from"./index-dbc7810f.js";import"./index-e417090c.js";import{S as us}from"./index-dd953a8b.js";import{S as ke,R as he}from"./index-b6a697c3.js";import{q as ms}from"./index-a99a9387.js";import{M as ps}from"./api-9aff074a.js";import{L as hs}from"./index-740955bd.js";import{i as Ie}from"./countries-bbdb373c.js";import{A as De}from"./index-5ca1a7bd.js";import{D as fs}from"./index-f258cc00.js";import{D as gs}from"./index-714f5540.js";import{T as ys}from"./index-7544f455.js";import{B as bs}from"./index-d895e52c.js";import{J as fe}from"./index-e0338379.js";import{D as xs}from"./delete-prompt-37f35e36.js";import{g as ge}from"./error-messages-d2d0bb30.js";import"./lodash-72dfe3e0.js";import"./chevron-down-6a69fe38.js";import"./react-select.esm-1ec1493a.js";import"./unsupportedIterableToArray-27301055.js";import"./toConsumableArray-6f61c395.js";import"./createSuper-ad9f6885.js";import"./index-1ec19c89.js";import"./index-a4458bf1.js";import"./index-d33be3e8.js";import"./use-debounce-438a4ce8.js";import"./form-validator-a60b1f3b.js";import"./index.esm-841d990e.js";import"./react-select-creatable.esm-e43d0869.js";import"./_isIndex-6af6139d.js";import"./index-903c1727.js";import"./axios-4a70c6fc.js";import"./index-e25e2e97.js";import"./index-0f96226b.js";const _s=()=>{const c=l=>{switch(l){case"completed":return e(se,{variant:"success",title:"Completed"});default:return e(se,{variant:"primary",title:"Open"})}};return[p.useMemo(()=>[{Header:"Draft",accessor:"display_id",Cell:({cell:{value:l,getCellProps:r}})=>e(_.Cell,{...r(),className:"pl-2",children:`#${l}`})},{Header:"Order",accessor:"order",Cell:({cell:{value:l,getCellProps:r}})=>e(_.Cell,{...r(),children:l!=null&&l.display_id?`#${l==null?void 0:l.display_id}`:"-"})},{Header:"Date added",accessor:"created_at",Cell:({cell:{value:l,getCellProps:r}})=>e(_.Cell,{...r(),children:ve(l).format("DD MMM YYYY")})},{Header:"Customer",accessor:"cart",Cell:({row:l,cell:{value:r,getCellProps:a}})=>e(_.Cell,{...a(),children:e(Ke,{customer:{first_name:(r==null?void 0:r.first_name)||"",last_name:(r==null?void 0:r.last_name)||"",email:r.email},color:Xe(l.index)})})},{Header:"Status",accessor:"status",Cell:({cell:{value:l,getCellProps:r}})=>e(_.Cell,{...r(),className:"pr-2",children:c(l)})}],[])]},vs=["q","offset","limit"],Ns=(c,n)=>{var l;switch(n.type){case"setFilters":return{...c,query:(l=n==null?void 0:n.payload)==null?void 0:l.query};case"setQuery":return{...c,offset:0,query:n.payload};case"setOffset":return{...c,offset:n.payload};case"reset":return n.payload;default:return c}},Cs=(c,n=null)=>{c&&c[0]==="?"&&(c=c.substring(1));const l=p.useMemo(()=>ws(c,n),[c,n]),[r,a]=p.useReducer(Ns,l),u=m=>{a({type:"setDefaults",payload:m})},g=m=>{if(m>0){const y=r.offset+r.limit;a({type:"setOffset",payload:y})}else{const y=Math.max(r.offset-r.limit,0);a({type:"setOffset",payload:y})}},v=()=>{a({type:"setFilters",payload:{...r,offset:0,query:null}})},d=m=>{a({type:"setFilters",payload:m})},C=m=>{a({type:"setQuery",payload:m})},o=()=>{const m={...r.additionalFilters};for(const[y,b]of Object.entries(r))y==="query"?b&&typeof b=="string"&&(m.q=b):(y==="offset"||y==="limit")&&(m[y]=b);return m},w=()=>{const m=o();return le.stringify(m,{skipNulls:!0})},P=m=>{const y=m??r,b={};for(const[x,I]of Object.entries(y))x==="query"?I&&typeof I=="string"&&(b.q=I):(x==="offset"||x==="limit")&&(b[x]=I);return b},S=()=>{const m=P();return le.stringify(m,{skipNulls:!0})},k=p.useMemo(()=>o(),[r]),f=p.useMemo(()=>P(),[r]),A=p.useMemo(()=>S(),[r]);return{...r,filters:{...r},representationObject:f,representationString:A,queryObject:k,paginate:g,getQueryObject:o,getQueryString:w,setQuery:C,setFilters:d,setDefaultFilters:u,reset:v}},ws=(c,n=null)=>{const l={offset:0,limit:15,additionalFilters:n};if(c){const r=le.parse(c);for(const[a,u]of Object.entries(r))if(vs.includes(a))switch(a){case"offset":{typeof u=="string"&&(l.offset=parseInt(u));break}case"limit":{typeof u=="string"&&(l.limit=parseInt(u));break}case"q":{typeof u=="string"&&(l.query=u);break}}}return l},ye=15,Ss=()=>{const c=Te(),{reset:n,paginate:l,setQuery:r,queryObject:a}=Cs(c.search,{}),u=a,g=parseInt(u==null?void 0:u.offset)||0,v=parseInt(u==null?void 0:u.limit)||ye,[d,C]=p.useState(u==null?void 0:u.query),[o,w]=p.useState(0),{draft_orders:P,isLoading:S,isRefetching:k,count:f}=qe(a,{keepPreviousData:!0});p.useEffect(()=>{const h=Math.ceil(f/a.limit);w(h)},[f,a]);const[A]=_s(),{getTableProps:m,getTableBodyProps:y,headerGroups:b,rows:x,prepareRow:I,canPreviousPage:T,canNextPage:s,pageCount:i,gotoPage:N,nextPage:q,previousPage:R,state:{pageIndex:D}}=me.useTable({columns:A,data:P||[],manualPagination:!0,initialState:{pageSize:v,pageIndex:g/v},pageCount:o,autoResetPage:!1},me.usePagination);p.useEffect(()=>{const h=setTimeout(()=>{d?(r(d),N(0)):n()},400);return()=>clearTimeout(h)},[d]);const F=()=>{s&&(l(1),q())},j=()=>{T&&(l(-1),R())};return e(Ze,{hasPagination:!0,numberOfRows:ye,pagingState:{count:f,offset:a.offset,pageSize:a.offset+x.length,title:"Draft Orders",currentPage:D+1,pageCount:i,nextPage:F,prevPage:j,hasNext:s,hasPrev:T},isLoading:S||k,children:t(_,{filteringOptions:[],enableSearch:!0,handleSearch:C,searchValue:d,...m(),children:[e(_.Head,{children:b==null?void 0:b.map(h=>e(_.HeadRow,{...h.getHeaderGroupProps(),children:h.headers.map((E,L)=>e(_.HeadCell,{className:"w-[100px]",...E.getHeaderProps(),children:E.render("Header",{customIndex:L})}))}))}),e(_.Body,{...y(),children:x.map(h=>(I(h),e(_.Row,{color:"inherit",linkTo:`/a/draft-orders/${h.original.id}`,...h.getRowProps(),children:h.cells.map((E,L)=>e(p.Fragment,{children:E.render("Cell")},L))})))})]})})},Oe=p.createContext(null),Ps=({children:c})=>{const n=Ne({defaultValues:{items:[],billing_address:void 0,shipping_address:void 0}}),l=es({control:n.control,name:"items"}),r=O({control:n.control,name:"region"}),{region:a}=Me(r==null?void 0:r.value,{enabled:!!r}),u=O({control:n.control,name:"shipping_option"}),{shipping_option:g}=Ee(u==null?void 0:u.value,{enabled:!!(u!=null&&u.value)});p.useEffect(()=>{u&&(n.resetField("shipping_option"),n.resetField("custom_shipping_price"))},[r]);const v=p.useMemo(()=>a?a.countries.map(w=>({label:w.display_name,value:w.iso_2})):[],[a]),{client:d}=be();p.useEffect(()=>{(async()=>{if(l.fields.length){const P=l.fields.reduce((f,A)=>(A.variant_id&&(f[A.variant_id]=A),f),{}),S=l.fields.map(f=>f.variant_id).filter(Boolean),{variants:k}=await d.admin.variants.list({id:S,region_id:a==null?void 0:a.id});l.replace(k.map(f=>{var A,m;return{quantity:P[f.id].quantity,variant_id:f.id,title:f.title,unit_price:Ce(f,a,!1),product_title:(A=f.product)==null?void 0:A.title,thumbnail:(m=f.product)==null?void 0:m.thumbnail}}))}})()},[a]);const{shipping_options:C}=xe({region_id:a==null?void 0:a.id,is_return:!1},{enabled:!!a}),o=p.useMemo(()=>{if(!C)return[];const w=l.fields.reduce((P,S)=>P+S.quantity*S.unit_price,0);return C.reduce((P,S)=>{if(S.requirements){const k=S.requirements.find(A=>A.type==="min_subtotal"),f=S.requirements.find(A=>A.type==="max_subtotal");if(k&&w<=k.amount||f&&w>=f.amount)return P}return P.push(S),P},[])},[C,l]);return e(Oe.Provider,{value:{validCountries:v,region:a,selectedShippingOption:g,items:l,shippingOptions:o},children:e(ss,{...n,children:c})})},V=()=>{const c=p.useContext(Oe),n=ts();if(!c)throw new Error("useNewOrderForm must be used within NewOrderFormProvider");return{context:c,form:n}},J=c=>c?Object.values(c).every(n=>n==null||n===""):!0,As=()=>{const{context:{validCountries:c},form:n}=V(),l=O({control:n.control,name:"shipping_address"}),r=O({control:n.control,name:"shipping_address_id"}),a=O({control:n.control,name:"same_as_shipping"}),u=()=>{a?(n.resetField("billing_address"),n.resetField("billing_address_id")):(n.setValue("billing_address",l),n.setValue("billing_address_id",r)),n.setValue("same_as_shipping",!a)};return t("div",{className:"min-h-[705px]",children:[e("span",{className:"inter-base-semibold",children:"Billing Address"}),!J(l)||r?t("div",{className:"items-center flex mt-4 mb-6 cursor-pointer",onClick:u,children:[e("div",{className:`w-5 h-5 flex justify-center text-grey-0 border-grey-30 border rounded-base ${a&&"bg-violet-60"}`,children:e("span",{className:"self-center",children:a&&e(Je,{size:16})})}),e("input",{className:"hidden",type:"checkbox",...n.register("same_as_shipping"),tabIndex:-1}),e("span",{className:"ml-3 text-grey-90",children:"Use same as shipping"})]}):null,e("div",{className:Z({"opacity-50 pointer-events-none":a}),tabIndex:a?-1:void 0,children:e(Se,{countryOptions:c,form:Pe(n,"billing_address"),type:te.BILLING})})]})},ks=({onSubmit:c,region:n})=>{const[l,r]=p.useState(0),{pop:a}=p.useContext(ne),{register:u,handleSubmit:g}=Ne(),v=d=>{const{title:C,quantity:o}=d;c(C,o,l),a()};return t(_e,{children:[e(Q.Content,{children:t("div",{className:"min-h-[705px] gap-y-xsmall",children:[e(G,{placeholder:"E.g. Gift wrapping",label:"Title",...u("title",{required:!0}),className:"my-4",required:!0}),e(re.Root,{currentCurrency:n.currency_code,size:"small",readOnly:!0,children:e(re.Amount,{required:!0,label:"Price",amount:l,onChange:d=>r(d||0)})}),e(G,{className:"my-4",label:"Quantity",...u("quantity",{required:!0}),type:"number",required:!0})]})}),e(Q.Footer,{children:t("div",{className:"flex w-full justify-end gap-x-xsmall",children:[e(M,{variant:"ghost",size:"small",className:"w-[112px]",onClick:()=>a(),children:"Back"}),e(M,{variant:"primary",className:"w-[112px]",size:"small",onClick:g(v),children:"Add"})]})})]})},Is=()=>{const{enableNextPage:c,disableNextPage:n,nextStepEnabled:l}=ee.useContext(Y),{context:{region:r,items:a},form:{control:u,register:g,setValue:v}}=V(),{client:d}=be(),{fields:C,append:o,remove:w,update:P}=a,[S,k]=p.useState(-1),[f,A]=p.useState(-1),m=p.useContext(ne),y=async s=>{const i=C.map(D=>D.variant_id),q=s.filter(D=>!i.includes(D.id)).map(D=>D.id),{variants:R}=await d.admin.variants.list({id:q,region_id:r==null?void 0:r.id});o(R.map(D=>{var F,j;return{quantity:1,variant_id:D.id,title:D.title,unit_price:Ce(D,r,!1),product_title:(F=D.product)==null?void 0:F.title,thumbnail:(j=D.product)==null?void 0:j.thumbnail}})),l||c()},b=(s,i)=>{const N=C[s];N.quantity=N.quantity+i,N.quantity>0&&P(s,N)},x=(s,i,N)=>{const q=ls(N,i);v(`items.${s}.unit_price`,q)},I=(s,i,N)=>{o({title:s,unit_price:N,quantity:i}),l||c()},T=s=>{w(s),l&&a.fields.length<1&&n()};return p.useEffect(()=>{a.fields.length?c():n()},[]),t("div",{className:"flex flex-col min-h-[705px] pt-4",children:[e("span",{className:"inter-base-semibold mb-4",children:"Items for the order"}),C.length>0&&r&&t(_,{children:[e(_.Head,{children:t(_.HeadRow,{className:"text-grey-50 border-t inter-small-semibold",children:[e(_.HeadCell,{children:"Details"}),e(_.HeadCell,{className:"text-right pr-8",children:"Quantity"}),e(_.HeadCell,{className:"text-right",children:"Price (excl. Taxes)"}),e(_.HeadCell,{})]})}),e(_.Body,{children:C.map((s,i)=>t(_.Row,{className:Z("border-b-grey-0 hover:bg-grey-0"),children:[e(_.Cell,{children:t("div",{className:"min-w-[240px] flex items-center py-2",children:[e("div",{className:"w-[30px] h-[40px] ",children:s.thumbnail?e("img",{className:"h-full w-full object-cover rounded",src:s.thumbnail}):e(ce,{})}),t("div",{className:"inter-small-regular text-grey-50 flex flex-col ml-4",children:[s.product_title&&e("span",{className:"text-grey-90",children:s.product_title}),e("span",{children:s.title})]})]})}),e(_.Cell,{className:"text-right w-32 pr-8",children:S===i?e(G,{type:"number",...g(`items.${i}.quantity`,{valueAsNumber:!0}),onBlur:()=>k(-1)}):t("div",{className:"flex w-full text-right justify-end text-grey-50 ",children:[e("span",{onClick:()=>b(i,-1),className:"w-5 h-5 flex items-center justify-center rounded cursor-pointer hover:bg-grey-20 mr-2",children:e(Ye,{size:16})}),e("button",{type:"button",className:"px-1 hover:bg-grey-20 rounded cursor-pointer",onClick:()=>k(i),children:e("input",{type:"number",...g(`items.${i}.quantity`,{valueAsNumber:!0}),className:"bg-transparent w-full text-center text-grey-90",disabled:!0})}),e("span",{onClick:()=>b(i,1),className:Z("w-5 h-5 flex items-center justify-center rounded cursor-pointer hover:bg-grey-20 ml-2"),children:e(U,{size:16})})]})}),e(_.Cell,{className:"text-right",children:f===i?e(H,{control:u,name:`items.${i}.unit_price`,render:({field:{value:N}})=>e(G,{type:"number",value:W(r.currency_code,N),onBlur:()=>{A(-1)},prefix:rs(r.currency_code),onChange:q=>{x(i,+q.target.value,r.currency_code)}})}):e(H,{name:`items.${i}.unit_price`,control:u,render:({field:{value:N}})=>e("span",{className:"cursor-pointer",onClick:()=>{A(i)},children:W(r.currency_code,N)})})}),e(_.Cell,{className:"text-right text-grey-40 pr-1",children:r.currency_code.toUpperCase()}),e(_.Cell,{children:e(M,{variant:"ghost",size:"small",onClick:()=>T(i),children:e(Ae,{size:20,className:"text-grey-50"})})})]},s.id))})]}),t("div",{className:"flex w-full justify-end mt-3 gap-x-xsmall",children:[t(M,{variant:"ghost",size:"small",className:"border border-grey-20",onClick:()=>{m.push(Os(m.pop,I,r))},children:[e(U,{size:20}),"Add Custom"]}),t(M,{variant:"ghost",size:"small",className:"border border-grey-20",onClick:()=>{m.push(Ds(m.pop,a.fields.map(s=>({id:s.variant_id})),y))},children:[e(U,{size:20}),"Add Existing"]})]})]})},Ds=(c,n,l)=>({title:"Add Products",onBack:()=>c(),view:e(as,{selectedItems:n||[],onSubmit:l})}),Os=(c,n,l)=>({title:"Add Custom Item",onBack:()=>c(),view:e(ks,{onSubmit:n,region:l})}),Ts=()=>{const{enableNextPage:c,disableNextPage:n}=ee.useContext(Y),{form:{control:l}}=V(),r=O({control:l,name:"region"}),{regions:a}=Fe(),u=p.useMemo(()=>a?a.map(g=>({label:g.name,value:g.id})):[],[a]);return p.useEffect(()=>{r?c():n()},[r]),t("div",{className:"flex min-h-[705px] flex-col",children:[e("span",{className:"inter-base-semibold mb-4",children:"Choose region"}),e(H,{control:l,name:"region",render:({field:{onChange:g,value:v}})=>e(us,{label:"Region",onChange:g,value:v,options:u})})]})},qs=()=>{const{disableNextPage:c,enableNextPage:n}=p.useContext(Y),[l,r]=p.useState(!1),{context:{region:a,shippingOptions:u},form:{control:g,setValue:v}}=V(),d=O({control:g,name:"custom_shipping_price"});p.useEffect(()=>{!l&&d&&r(!0)},[d]);const C=O({control:g,name:"shipping_option"}),o=()=>{r(!1),v("custom_shipping_price",void 0)};return p.useEffect(()=>{C||c(),C&&n()},[C]),t("div",{className:"min-h-[705px]",children:[t("span",{className:"inter-base-semibold",children:["Shipping method"," ",t("span",{className:"inter-base-regular text-grey-50",children:["(To ",a.name,")"]})]}),a?u!=null&&u.length?t("div",{className:"mt-4",children:[e(H,{control:g,name:"shipping_option",render:({field:{value:w,onChange:P}})=>e(ke,{label:"Choose a shipping method",onChange:P,value:w,options:(u==null?void 0:u.map(S=>({value:S.id,label:`${S.name} - ${ie(S.amount,a)}`})))||[]})}),t("div",{className:"mt-4",children:[!l&&e("div",{className:"w-full flex justify-end",children:e(M,{variant:"ghost",size:"small",className:"w-[125px] border border-grey-20",disabled:!C,onClick:()=>r(!0),children:"Set custom price"})}),l&&t("div",{className:"flex items-center",children:[e("div",{className:"w-full",children:e(H,{control:g,name:"custom_shipping_price",render:({field:{value:w,onChange:P}})=>e(re.Root,{readOnly:!0,size:"small",currentCurrency:a.currency_code,children:e(re.Amount,{label:"Custom Price",amount:w,onChange:P})})})}),e(M,{variant:"ghost",size:"small",onClick:o,className:"ml-8 text-grey-40 w-8 h-8",children:e(Ae,{size:20})})]})]})]}):t("div",{className:"inter-small-regular mt-6 p-4 text-orange-50 bg-orange-5 rounded-rounded flex",children:[e("div",{className:"h-full mr-3",children:e(ns,{size:20})}),t("div",{className:"flex flex-col",children:[e("span",{className:"inter-small-semibold",children:"Attention!"}),`You don't have any options for orders without shipping. Please add one (e.g. "In-store fulfillment") with "Show on website" unchecked in region settings and continue.`]})]}):e("div",{className:"flex-1 flex justify-center items-center",children:e(ae,{})})]})},Ms=c=>{var n;return{first_name:c.first_name||"",last_name:c.last_name||"",company:c.company,address_1:c.address_1||"",address_2:c.address_2,city:c.city||"",province:c.province,postal_code:c.postal_code||"",country_code:{label:Ie[(n=c.country_code)==null?void 0:n.toUpperCase()]||"",value:c.country_code||""},phone:c.phone}},Es=()=>{const[c,n]=p.useState(!1),{disableNextPage:l,enableNextPage:r}=p.useContext(Y),{context:{validCountries:a},form:u}=V(),g=async y=>{const b=ms.stringify({q:y,offset:0,limit:10},{skipNull:!0,skipEmptyString:!0});return await ps.customers.list(`?${b}`).then(({data:x})=>x.customers.map(({id:I,first_name:T,last_name:s,email:i})=>({label:`${T||""} ${s||""} (${i})`,value:I}))).catch(()=>[])},v=O({control:u.control,name:"customer_id"}),{customer:d,isLoading:C}=je(v==null?void 0:v.value,{enabled:!!(v!=null&&v.value)}),o=p.useMemo(()=>{if(!d)return[];const y=a.map(({value:b})=>b);return d.shipping_addresses.filter(({country_code:b})=>!b||y.includes(b))},[d]),w=y=>{const b=/\(([^()]*)\)$/.exec(y==null?void 0:y.label);b&&u.setValue("email",b[1])},P=()=>{u.setValue("shipping_address_id",void 0),n(!0)},S=y=>{var x;if(!d)return;const b=(x=d.shipping_addresses)==null?void 0:x.find(I=>I.id===y);b&&u.setValue("shipping_address",Ms(b))},k=O({control:u.control,name:"email"});p.useEffect(()=>{k?r():l()},[k]);const f=O({control:u.control,name:"shipping_address"}),[A,m]=p.useState(!1);return p.useEffect(()=>{if(!k){l();return}f&&!J(f)?!f.first_name||!f.last_name||!f.address_1||!f.city||!f.country_code||!f.postal_code?(l(),m(!0)):r():(r(),m(!1))},[f,k]),t("div",{className:"min-h-[705px] flex flex-col gap-y-8",children:[t("div",{children:[e("span",{className:"inter-base-semibold",children:"Customer and shipping details"}),e(H,{control:u.control,name:"customer_id",render:({field:{value:y,onChange:b}})=>e(ke,{className:"mt-4",label:"Find existing customer",options:[],enableSearch:!0,value:y||null,onChange:x=>{w(x),b(x)},filterOptions:g,clearSelected:!0})})]}),t("div",{className:"flex flex-col gap-y-4",children:[e("span",{className:"inter-base-semibold",children:"Email"}),e(G,{...u.register("email"),label:"Email",placeholder:"lebron@james.com",disabled:!!v,required:!0,prefix:v?e(hs,{size:16,className:"text-grey-40"}):void 0,tabIndex:v?-1:0})]}),C?e("div",{children:e(ae,{variant:"primary"})}):o.length&&!c?t("div",{children:[e("span",{className:"inter-base-semibold",children:"Choose existing addresses"}),e(H,{control:u.control,name:"shipping_address_id",render:({field:{value:y,onChange:b}})=>e(he.Root,{className:"mt-4",value:y,onValueChange:x=>{b(x),S(x)},children:o.map((x,I)=>{var T;return e(he.Item,{label:`${x.first_name} ${x.last_name}`,checked:!!y&&x.id===y,description:`${x.address_1}, ${x.address_2} ${x.postal_code} ${x.city} ${(T=x.country_code)==null?void 0:T.toUpperCase()}`,value:x.id},I)})})}),e("div",{className:"mt-4 flex w-full justify-end",children:e(M,{variant:"ghost",size:"small",className:"border border-grey-20 w-[112px]",onClick:P,children:"Create new"})})]}):e("div",{children:e(Se,{form:Pe(u,"shipping_address"),countryOptions:a,type:te.SHIPPING,required:A})})]})},Fs=()=>{var i;const[c,n]=p.useState(!1),[l,r]=p.useState(void 0),[a,u]=p.useState(void 0),{form:g,context:{items:v,region:d,selectedShippingOption:C}}=V(),o=O({defaultValue:void 0,control:g.control,name:"shipping_address"}),w=O({defaultValue:void 0,control:g.control,name:"billing_address"}),P=O({control:g.control,name:"email"}),S=O({control:g.control,name:"region"}),k=O({control:g.control,name:"discount_code"}),f=O({control:g.control,name:"shipping_option"}),A=O({control:g.control,name:"custom_shipping_price"}),{discount:m,status:y,isFetching:b}=$e(k,{enabled:!!k}),{shipping_options:x}=xe({region_id:S==null?void 0:S.value},{enabled:!!S&&!!f}),I=p.useMemo(()=>{if(!f||!x)return 0;const N=x.find(q=>q.id===f.value);return N&&N.amount||0},[x,f]),T=async()=>{g.setValue("discount_code",a)};p.useEffect(()=>{!m||!d||m.regions.find(N=>N.id===d.id)||(r("The discount is not applicable to the selected region"),u(void 0),g.setValue("discount_code",void 0),n(!0))},[m]),p.useEffect(()=>{y==="error"&&(r("The discount code is invalid"),u(void 0),g.setValue("discount_code",void 0),n(!0))},[y]);const s=()=>{g.setValue("discount_code",void 0),n(!1),u("")};return t("div",{className:"min-h-[705px]",children:[t(X,{title:"Items",editIndex:1,children:[t(_,{children:[e(_.Head,{children:t(_.HeadRow,{className:"inter-small-semibold border-t text-grey-50",children:[e(_.HeadCell,{children:"Details"}),e(_.HeadCell,{className:"text-right",children:"Quantity"}),e(_.HeadCell,{className:"text-right",children:"Price (excl. Taxes)"}),e(_.HeadCell,{})]})}),e(_.Body,{children:d&&v&&v.fields.map(N=>t(_.Row,{className:Z("border-b-grey-0 hover:bg-grey-0"),children:[e(_.Cell,{children:t("div",{className:"flex min-w-[240px] py-2",children:[e("div",{className:"h-[40px] w-[30px] ",children:N.thumbnail?e("img",{className:"h-full w-full rounded object-cover",src:N.thumbnail}):e(ce,{})}),t("div",{className:"inter-small-regular ml-4 flex flex-col text-grey-50",children:[e("span",{children:e("span",{className:"text-grey-90",children:N.product_title})}),e("span",{children:N.title})]})]})}),e(_.Cell,{className:"text-right",children:N.quantity}),e(_.Cell,{className:"text-right",children:W(d==null?void 0:d.currency_code,N.unit_price)})]},N.id))})]}),!c&&!(m!=null&&m.rule)&&e("div",{className:"flex w-full justify-end",children:t(M,{variant:"ghost",size:"small",className:"inter-small-semibold border border-grey-20",onClick:()=>n(!0),children:[e(U,{size:20}),"Add Discount"]})}),c&&!(m!=null&&m.rule)&&t(_e,{children:[e("div",{children:t("div",{className:"flex w-full items-center gap-x-base",children:[e(G,{type:"text",placeholder:"SUMMER10",onFocus:()=>r(void 0),value:a,onChange:N=>u(N.target.value)}),e(M,{variant:"ghost",className:"h-8 w-8 text-grey-40",size:"small",type:"button",onClick:()=>n(!1),children:e(de,{size:20})})]})}),t("div",{className:"space-between mt-4 flex w-full justify-between ",children:[e("div",{className:"pt-2",children:l&&e("span",{className:"text-rose-50",children:l})}),t(M,{className:"h-full border border-grey-20",variant:"ghost",size:"small",loading:b,onClick:()=>T(),children:[e(U,{size:20}),"Add Discount"]})]})]}),m&&d&&t("div",{className:"inter-small-regular mt-4 flex w-full flex-col border-b border-t border-grey-20 pt-4 last:border-b-0 ",children:[t("div",{className:"inter-base-semibold mb-4 flex w-full justify-between",children:[t("span",{children:["Discount",t("span",{className:"inter-base-regular ml-0.5 text-grey-50",children:["(Code: ",m.code,")"]})]}),e("span",{onClick:()=>s(),className:"inter-small-semibold cursor-pointer text-violet-60",children:e(de,{size:20})})]}),t("div",{className:"flex w-full",children:[t("div",{className:Z("flex flex-col border-grey-20 pr-6",{"border-r":m.rule.type!=="free_shipping"}),children:[e("span",{className:"text-grey-50",children:"Type"}),e("span",{children:m.rule.type!=="free_shipping"?`${m.rule.type.charAt(0).toUpperCase()}${m.rule.type.slice(1)}`:"Free Shipping"})]}),m.rule.type!=="free_shipping"&&t("div",{className:"flex flex-col pl-6",children:[e("span",{className:"text-grey-50",children:"Value"}),e("span",{children:m.rule.type==="fixed"?`${W(d.currency_code,m.rule.value)} ${d.currency_code.toUpperCase()}`:`${m.rule.value} %`})]})]})]})]}),e(X,{title:"Customer",editIndex:3,children:t("div",{className:"flex items-center",children:[e("div",{className:"mr-3 h-5 w-5",children:e(De,{color:"bg-fuschia-40",user:{email:P,first_name:o==null?void 0:o.first_name,last_name:o==null?void 0:o.last_name},font:"inter-small-regular"})}),P]})}),C&&e(X,{title:"Shipping details",editIndex:2,children:t("div",{className:"grid w-full grid-cols-2 gap-x-6",children:[!J(o)&&o&&t("div",{className:"flex flex-col border-r border-grey-20 pr-6",children:[e("span",{className:"text-grey-50",children:"Address"}),t("span",{children:[o.address_1,", ",o.address_2]}),e("span",{children:`${o.postal_code} ${o.city},
                ${(i=o.country_code)==null?void 0:i.label}`})]}),d&&t("div",{className:"flex flex-col",children:[e("span",{className:"text-grey-50",children:"Shipping method"}),t("span",{children:[C.name," -"," ",A&&d?t("p",{children:[e("span",{className:"mr-2 text-grey-40 line-through",children:ie(I,d)}),W(d.currency_code,A),d.currency_code.toUpperCase()]}):ie(C.amount,d)]})]})]})}),!J(w)&&w&&t(X,{title:"Billing details",editIndex:3,children:[e("span",{className:"text-grey-50",children:"Address"}),t("span",{children:[w.address_1,", ",w.address_2]}),e("span",{children:`${w.postal_code} ${w.city},
                ${w.country_code.label}`})]})]})},X=({title:c,editIndex:n,children:l})=>{const{setPage:r}=p.useContext(Y);return t("div",{className:"inter-small-regular mt-4 flex w-full flex-col border-b border-grey-20 pb-8 last:border-b-0 ",children:[t("div",{className:"inter-base-semibold mb-4 flex w-full justify-between",children:[c,e("span",{onClick:()=>r(n),className:"inter-small-semibold cursor-pointer text-violet-60",children:"Edit"})]}),l]})},js=({onDismiss:c})=>{const n=ee.useContext(Y),l=ee.useContext(ne),r=oe(),a=we(),{mutate:u}=Re(),{form:{handleSubmit:g,reset:v},context:{region:d}}=V(),C=g(o=>{var w,P,S,k,f,A,m,y,b,x,I,T,s,i,N,q,R,D,F,j,h,E,L;u({email:o.email,items:o.items.map($=>$.variant_id?{quantity:$.quantity,variant_id:$.variant_id}:{quantity:$.quantity,title:$.title,unit_price:$.unit_price}),region_id:o.region.value,shipping_methods:[{option_id:o.shipping_option.value,price:typeof o.custom_shipping_price=="number"?o.custom_shipping_price:void 0}],shipping_address:o.shipping_address_id?o.shipping_address_id:J(o.shipping_address)?void 0:{address_1:(w=o.shipping_address)==null?void 0:w.address_1,address_2:((P=o.shipping_address)==null?void 0:P.address_2)||void 0,city:(S=o.shipping_address)==null?void 0:S.city,country_code:(f=(k=o.shipping_address)==null?void 0:k.country_code)==null?void 0:f.value,company:((A=o.shipping_address)==null?void 0:A.company)||void 0,first_name:(m=o.shipping_address)==null?void 0:m.first_name,last_name:(y=o.shipping_address)==null?void 0:y.last_name,phone:((b=o.shipping_address)==null?void 0:b.phone)||void 0,postal_code:(x=o.shipping_address)==null?void 0:x.postal_code,province:((I=o.shipping_address)==null?void 0:I.province)||void 0},billing_address:o.billing_address_id?o.billing_address_id:o.billing_address?{address_1:(T=o.billing_address)==null?void 0:T.address_1,address_2:((s=o.billing_address)==null?void 0:s.address_2)||void 0,city:(i=o.billing_address)==null?void 0:i.city,country_code:(q=(N=o.billing_address)==null?void 0:N.country_code)==null?void 0:q.value,company:((R=o.billing_address)==null?void 0:R.company)||void 0,first_name:(D=o.billing_address)==null?void 0:D.first_name,last_name:(F=o.billing_address)==null?void 0:F.last_name,phone:((j=o.billing_address)==null?void 0:j.phone)||void 0,postal_code:(h=o.billing_address)==null?void 0:h.postal_code,province:((E=o.billing_address)==null?void 0:E.province)||void 0}:void 0,customer_id:(L=o.customer_id)==null?void 0:L.value,discounts:o.discount_code?[{code:o.discount_code}]:void 0},{onSuccess:({draft_order:$})=>{a("Success","Order created","success"),v(),c(),n.reset(),r(`/a/draft-orders/${$.id}`)},onError:$=>{a("Error",$.message,"error")}})});return e(ze,{layeredContext:l,context:n,onSubmit:C,steps:[e(Ts,{}),e(Is,{}),e(qs,{}),e(Es,{}),e(As,{}),e(Fs,{})],lastScreenIsSummary:!0,title:"Create Draft Order",handleClose:c})},$s=({heading:c,text:n,cancelText:l,confirmText:r,handleClose:a,onConfirm:u})=>{const[g,v]=p.useState(!1),d=C=>{C.preventDefault(),v(!0),u().finally(()=>{v(!1),a()})};return e(Q,{isLargeModal:!1,handleClose:a,children:t(Q.Body,{children:[e(Q.Content,{children:t("div",{className:"flex flex-col",children:[e("span",{className:"inter-large-semibold",children:c}),e("span",{className:"inter-base-regular mt-1 text-grey-50",children:n})]})}),e(Q.Footer,{children:t("div",{className:"flex w-full h-8 justify-end",children:[e(M,{variant:"ghost",className:"mr-2 w-24 text-small justify-center",size:"small",onClick:a,children:l}),e(M,{loading:g,size:"small",className:"w-24 text-small justify-center",variant:"primary",onClick:d,disabled:g,children:r})]})})]})})},Rs=()=>{var N,q,R,D,F,j;const{id:c}=Be(),n={resource:"",onDelete:()=>Promise.resolve(console.log("Delete resource")),show:!1},[l,r]=p.useState(n),[a,u]=p.useState(null),[g,v]=p.useState(!1),{draft_order:d,isLoading:C}=He(c),{store:o,isLoading:w}=Ve(),[P,S]=p.useState("");p.useEffect(()=>{o&&d&&o.payment_link_template&&S(o.payment_link_template.replace(/\{cart_id\}/,d.cart_id))},[C,w]);const k=Le(c),f=Qe(c),A=Ue(c),m=oe(),y=we(),b=()=>{switch(d==null?void 0:d.status){case"completed":return e(se,{title:"Completed",variant:"success"});case"open":return e(se,{title:"Open",variant:"default"});default:return null}},x=()=>e(M,{variant:"secondary",size:"small",onClick:()=>v(!0),children:"Mark as paid"}),I=async()=>{try{await k.mutateAsync(),y("Success","Successfully mark as paid","success")}catch(h){y("Error",ge(h),"error")}finally{v(!1)}},T=async()=>f.mutate(void 0,{onSuccess:()=>y("Success","Successfully canceled order","success"),onError:h=>y("Error",ge(h),"error")}),{cart:s}=d||{},{region:i}=s||{};return t("div",{children:[e(bs,{currentPage:"Draft Order Details",previousBreadcrumb:"Draft Orders",previousRoute:"/a/draft-orders"}),C||!d?e(B,{className:"w-full pt-2xlarge flex items-center justify-center",children:e(ae,{size:"large",variant:"secondary"})}):e("div",{className:"flex space-x-4",children:t("div",{className:"flex flex-col w-full h-full",children:[e(B,{className:"w-full mb-4 min-h-[200px]",title:`Order #${d.display_id}`,subtitle:ve(d.created_at).format("D MMMM YYYY hh:mm a"),status:e(b,{}),customActionable:(d==null?void 0:d.status)==="completed"&&e(M,{variant:"secondary",size:"small",onClick:()=>m(`/a/orders/${d.order_id}`),children:"Go to Order"}),forceDropdown:(d==null?void 0:d.status)!=="completed",actionables:(d==null?void 0:d.status)==="completed"?[{label:"Go to Order",icon:null,onClick:()=>console.log("Should not be here")}]:[{label:"Cancel Draft Order",icon:null,variant:"danger",onClick:()=>r({resource:"Draft Order",onDelete:()=>T(),show:!0})}],children:t("div",{className:"flex mt-6 space-x-6 divide-x",children:[t("div",{className:"flex flex-col",children:[e("div",{className:"inter-smaller-regular text-grey-50 mb-1",children:"Email"}),e("div",{children:s==null?void 0:s.email})]}),t("div",{className:"flex flex-col pl-6",children:[e("div",{className:"inter-smaller-regular text-grey-50 mb-1",children:"Phone"}),e("div",{children:((N=s==null?void 0:s.shipping_address)==null?void 0:N.phone)||"N/A"})]}),t("div",{className:"flex flex-col pl-6",children:[t("div",{className:"inter-smaller-regular text-grey-50 mb-1",children:["Amount (",i==null?void 0:i.currency_code.toUpperCase(),")"]}),e("div",{children:s!=null&&s.total&&(i!=null&&i.currency_code)?K({amount:s==null?void 0:s.total,currency:i==null?void 0:i.currency_code}):"N/A"})]})]})}),e(B,{className:"w-full mb-4 min-h-0 h-auto",title:"Summary",children:t("div",{className:"mt-6",children:[(q=s==null?void 0:s.items)==null?void 0:q.map((h,E)=>t("div",{className:"flex justify-between mb-1 h-[64px] py-2 mx-[-5px] px-[5px] hover:bg-grey-5 rounded-rounded",children:[t("div",{className:"flex space-x-4 justify-center",children:[e("div",{className:"flex h-[48px] w-[36px] rounded-rounded items-center justify-center",children:h!=null&&h.thumbnail?e("img",{src:h.thumbnail,className:"rounded-rounded object-cover"}):e(ce,{})}),t("div",{className:"flex flex-col justify-center",children:[e("span",{className:"inter-small-regular text-grey-90 max-w-[225px] truncate",children:h.title}),(h==null?void 0:h.variant)&&e("span",{className:"inter-small-regular text-grey-50",children:h.variant.sku})]})]}),t("div",{className:"flex  items-center",children:[t("div",{className:"flex small:space-x-2 medium:space-x-4 large:space-x-6 mr-3",children:[e("div",{className:"inter-small-regular text-grey-50",children:K({amount:((h==null?void 0:h.total)??0)/h.quantity,currency:(i==null?void 0:i.currency_code)??"",digits:2,tax:[]})}),t("div",{className:"inter-small-regular text-grey-50",children:["x ",h.quantity]}),e("div",{className:"inter-small-regular text-grey-90",children:K({amount:h.total??0,currency:(i==null?void 0:i.currency_code)??"",digits:2,tax:[]})})]}),e("div",{className:"inter-small-regular text-grey-50",children:i==null?void 0:i.currency_code.toUpperCase()})]})]},E)),e(z,{currency:i==null?void 0:i.currency_code,totalAmount:(R=d==null?void 0:d.cart)==null?void 0:R.subtotal,totalTitle:"Subtotal"}),(D=s==null?void 0:s.discounts)==null?void 0:D.map((h,E)=>t("div",{className:"flex justify-between mt-4 items-center",children:[t("div",{className:"flex inter-small-regular text-grey-90 items-center",children:["Discount:"," ",e(is,{className:"ml-3",variant:"default",children:h.code})]}),t("div",{className:"inter-small-regular text-grey-90",children:["-",K({amount:s==null?void 0:s.discount_total,currency:(i==null?void 0:i.currency_code)||"",digits:2,tax:i==null?void 0:i.tax_rate})]})]},E)),e(z,{currency:i==null?void 0:i.currency_code,totalAmount:s==null?void 0:s.shipping_total,totalTitle:"Shipping"}),e(z,{currency:i==null?void 0:i.currency_code,totalAmount:s==null?void 0:s.tax_total,totalTitle:"Tax"}),e(z,{currency:i==null?void 0:i.currency_code,variant:"large",totalAmount:s==null?void 0:s.total,totalTitle:"Total"})]})}),e(B,{className:"w-full mb-4 min-h-0 h-auto",title:"Payment",customActionable:(d==null?void 0:d.status)!=="completed"&&e(x,{}),children:t("div",{className:"mt-6",children:[e(z,{currency:i==null?void 0:i.currency_code,totalAmount:s==null?void 0:s.subtotal,totalTitle:"Subtotal"}),e(z,{currency:i==null?void 0:i.currency_code,totalAmount:s==null?void 0:s.shipping_total,totalTitle:"Shipping"}),e(z,{currency:i==null?void 0:i.currency_code,totalAmount:s==null?void 0:s.tax_total,totalTitle:"Tax"}),e(z,{variant:"bold",currency:i==null?void 0:i.currency_code,totalAmount:s==null?void 0:s.total,totalTitle:"Total to pay"}),(d==null?void 0:d.status)!=="completed"&&t("div",{className:"text-grey-50 inter-small-regular w-full flex items-center mt-5",children:[e("span",{className:"mr-2.5",children:"Payment link:"}),o!=null&&o.payment_link_template?e(os,{value:P,displayValue:d.cart_id,successDuration:1e3}):"Configure payment link in store settings"]})]})}),e(B,{className:"w-full mb-4 min-h-0 h-auto",title:"Shipping",children:e("div",{className:"mt-6",children:s==null?void 0:s.shipping_methods.map(h=>t("div",{className:"flex flex-col",children:[e("span",{className:"inter-small-regular text-grey-50",children:"Shipping Method"}),e("span",{className:"inter-small-regular text-grey-90 mt-2",children:(h==null?void 0:h.shipping_option.name)||""}),t("div",{className:"flex flex-col min-h-[100px] mt-8 bg-grey-5 px-3 py-2 h-full",children:[t("span",{className:"inter-base-semibold",children:["Data"," ",e("span",{className:"text-grey-50 inter-base-regular",children:"(1 item)"})]}),e("div",{className:"flex flex-grow items-center mt-4",children:e(fe,{data:h==null?void 0:h.data})})]})]},h.id))})}),e(B,{className:"w-full mb-4 min-h-0 h-auto",title:"Customer",actionables:[{label:"Edit Shipping Address",icon:e(ys,{size:"20"}),onClick:()=>u({address:s==null?void 0:s.shipping_address,type:te.SHIPPING})},{label:"Edit Billing Address",icon:e(gs,{size:"20"}),onClick:()=>{s!=null&&s.billing_address&&u({address:s==null?void 0:s.billing_address,type:te.BILLING})}},{label:"Go to Customer",icon:e(fs,{size:"20"}),onClick:()=>m(`/a/customers/${s==null?void 0:s.customer.id}`)}],children:t("div",{className:"mt-6",children:[t("div",{className:"flex w-full space-x-4 items-center",children:[e("div",{className:"flex w-[40px] h-[40px] ",children:e(De,{user:s==null?void 0:s.customer,font:"inter-large-semibold",color:"bg-fuschia-40"})}),t("div",{children:[e("h1",{className:"inter-large-semibold text-grey-90",children:cs(s)}),(s==null?void 0:s.shipping_address)&&t("span",{className:"inter-small-regular text-grey-50",children:[s.shipping_address.city,","," ",Ie[(F=s.shipping_address.country_code)==null?void 0:F.toUpperCase()]]})]})]}),t("div",{className:"flex mt-6 space-x-6 divide-x",children:[t("div",{className:"flex flex-col",children:[e("div",{className:"inter-small-regular text-grey-50 mb-1",children:"Contact"}),t("div",{className:"flex flex-col inter-small-regular",children:[e("span",{children:s==null?void 0:s.email}),e("span",{children:((j=s==null?void 0:s.shipping_address)==null?void 0:j.phone)||""})]})]}),e(pe,{title:"Shipping",addr:(s==null?void 0:s.shipping_address)||void 0}),e(pe,{title:"Billing",addr:(s==null?void 0:s.billing_address)||void 0})]})]})}),e(B,{className:"w-full mb-4 min-h-0 h-auto pt-[15px]",title:"Raw Draft Order",children:e(fe,{data:d})})]})}),a&&e(ds,{handleClose:()=>u(null),submit:A.mutate,address:a.address,type:a.type,allowedCountries:i==null?void 0:i.countries}),l.show&&e(xs,{text:"Are you sure?",heading:`Remove ${l==null?void 0:l.resource}`,successText:`${(l==null?void 0:l.resource)||"Resource"} has been removed`,onDelete:()=>l.onDelete(),handleClose:()=>r(n)}),g&&e($s,{heading:"Mark as paid",text:"This will create an order. Mark this as paid if you received the payment.",confirmText:"Mark paid",cancelText:"Cancel",handleClose:()=>v(!1),onConfirm:I})]})},zs=["orders","drafts"],Bs=()=>{const c=oe(),n="drafts",[l,r]=p.useState(!1),a=p.useMemo(()=>[{label:"Create draft order",onClick:()=>r(!0),icon:e(U,{size:20})}],[n]);return t("div",{className:"flex flex-col grow h-full",children:[e("div",{className:"w-full flex flex-col grow",children:e(B,{customHeader:e(We,{views:zs,setActiveView:u=>{u==="orders"&&c("/a/orders")},activeView:n}),actionables:a,className:"h-fit",children:e(Ss,{})})}),l&&e(Ps,{children:e(js,{onDismiss:()=>r(!1)})})]})},jt=()=>t(Ge,{children:[e(ue,{index:!0,element:e(Bs,{})}),e(ue,{path:"/:id",element:e(Rs,{})})]});export{jt as default};
