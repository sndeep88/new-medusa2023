import{bB as H,a as e,j as i,F as _,bF as y,r as p,G as F,u as j,B as v,C as B,d as M,R as L,b as N}from"./index-effbfb95.js";import{B as U}from"./body-card-d3fddb8c.js";import{T as z}from"./index-a6859a1b.js";import{u as V}from"./use-toggle-state-9e07c572.js";import{r as $,a as A,T as s}from"./index-0d9858ea.js";import{h as O}from"./moment-fbc5633a.js";import{S as q}from"./index-04f3341e.js";import{U as Y,P as J}from"./index-4a064b3c.js";import{u as G,F as K,a as Q,C as W}from"./index.esm-5a89640b.js";import{I as X}from"./index-dd9f9076.js";import{F as C}from"./focus-modal-d105ce27.js";import{u as Z}from"./use-notification-9f7c3c92.js";import{E as ee}from"./Editor-bf113ee3.js";import{c as te}from"./shared-f9889298.js";import{T as ae}from"./index-d74195ae.js";import"./lodash-72dfe3e0.js";import"./chevron-down-6a69fe38.js";import"./index-1ec19c89.js";import"./index-0f96226b.js";const re=[{Header:"Title",accessor:"title"},{Header:"Type",accessor:"type"},{Header:"Last Update",accessor:"updated_at",Cell:({cell:{value:t}})=>O(t).format("DD MMM YYYY HH:mm")},{Header:"Status",accessor:"enable",Cell:({cell:{value:t}})=>e(q,{title:t?"Enabled":"Disabled",variant:t?"success":"danger"})}];function ne({type:t}){const{data:a,isLoading:l}=H(`/templates?type=${t}`,["templates",t]),r=(a==null?void 0:a.count)||0,c={columns:re,data:(a==null?void 0:a.templates)||[],initialState:{pageSize:10,pageIndex:0},pageCount:Math.ceil(r/10),manualPagination:!0,autoResetPage:!1},n=$.useTable(c),{headerGroups:d,rows:u,prepareRow:f}=n,h=()=>{},b=()=>{};return e(A,{isLoading:l,numberOfRows:10,hasPagination:!0,pagingState:{count:r,offset:0,pageSize:10,title:"Pages",currentPage:n.state.pageIndex+1,pageCount:n.pageCount,nextPage:h,prevPage:b,hasNext:n.canNextPage,hasPrev:n.canPreviousPage},children:i(s,{...n.getTableProps(),filteringOptions:e(_,{}),children:[e(s.Head,{children:d==null?void 0:d.map(o=>e(s.HeadRow,{...o.getHeaderGroupProps(),children:o.headers.map(m=>e(s.HeadCell,{className:"min-w-[100px]",...m.getHeaderProps(),children:m.render("Header")}))}))}),e(s.Body,{...n.getTableBodyProps(),children:u.map(o=>(f(o),e(le,{row:o,...o.getRowProps()})))})]})})}function le({row:t,...a}){const l=y(`/templates/${t.original.id}`,["templates",t.original.id]),r=()=>{l.mutate({enable:!t.original.enable})};return e(s.Row,{color:"inherit",linkTo:`/a/templates/${t.original.id}`,actions:[{label:t.original.enable?"Disable":"Enable",onClick:r,icon:t.original.enable?e(Y,{}):e(J,{}),variant:t.original.enable?"danger":"normal"}],forceDropdown:!0,...a,children:t.cells.map((c,n)=>e(s.Cell,{...c.getCellProps(),children:c.render("Cell",{index:n})}))})}const E=p.createContext(null),se=({template:t,children:a})=>{const l=G({defaultValues:t}),r=c=>l.handleSubmit(n=>{c({...n})});return p.useEffect(()=>{t&&l.reset(t)},[t]),e(K,{...l,children:e(E.Provider,{value:{handleSubmit:r,template:t},children:a})})},D=()=>{const t=p.useContext(E),a=Q();if(t===null)throw new Error("useTemplateForm must be used within a TemplateFormProvider");return{...a,...t}};function ie(){const{id:t}=F(),a=j(),{handleSubmit:l,setValue:r,template:c}=D(),n=Z(),d=()=>{a(-1)},u=y(`/templates/${t}`,["templates",t]),f=y(`/templates/${t}/default`,["templates",t]);return i("div",{className:"flex w-full justify-between px-8 medium:w-8/12",children:[e(v,{size:"small",variant:"ghost",onClick:d,className:"h-8 w-8 rounded-rounded border",children:e(B,{size:20})}),i("div",{className:"flex gap-x-small",children:[e(v,{size:"small",variant:"secondary",onClick:async()=>{c&&(r("template",c.default_template),await f.mutateAsync({}))},className:"rounded-rounded",children:"Restore Default"}),e(v,{size:"small",variant:"primary",onClick:l(async o=>{u.mutate(o,{onSuccess:()=>{n("Success","Template updated","success")},onError:m=>{n("Error",m.message,"error")}}),d()}),className:"rounded-rounded",children:"Save"})]})]})}const R={"{{ discountCode }}":"Discount Code","{{ textDiscount }}":"Discount amount in text format (ex: 10%, $10...)","{{ first_name }}":"Customer first name","{{ last_name }}":"Customer last name","{{ shipping_method }}":"Shipping method","{{ country }}":"Customer country","{{ payment_method }}":"Payment method","{{ order.order_id }}":"Order ID","{{ order.total }}":"Order total","{{ order.shipping_address }}":"Shipping address","{{ order.billing_address }}":"Billing address","{{ company_address }}":"Company address","{{ company_name }}":"Company name"};function oe(){return i("div",{className:"w-full mt-small",children:[e("div",{className:"inter-small-semibold flex w-full items-center text-grey-50",children:e("label",{children:"Descriptions"})}),i(s,{children:[e(s.Head,{children:i(s.Row,{children:[e(s.HeadCell,{children:"Variable"}),e(s.HeadCell,{children:"Desciption"})]})}),e(s.Body,{children:Object.keys(R).map((t,a)=>i(s.Row,{children:[e(s.Cell,{children:t}),e(s.Cell,{children:R[t]})]},a))})]})]})}function ce(t){const{control:a,register:l,template:r,formState:c}=D(),n=p.useRef(null),d=p.useRef(null),{errors:u}=c;return i(C,{children:[e(C.Header,{children:e(ie,{...t})}),e(C.Main,{children:e("div",{className:"mb-[25%] flex justify-center",children:i("div",{className:"w-full pt-16 small:w-4/5 medium:w-7/12 large:w-6/12",children:[i("h1",{className:"inter-xlarge-semibold mb-[28px]",children:[r==null?void 0:r.type.toUpperCase()," -"," ",(r==null?void 0:r.title)??"Edit Template"]}),i("div",{className:"accordion-margin-transition flex flex-col gap-y-small group-radix-state-open:mt-5",children:[e(X,{label:"Subject",required:!0,tooltipContent:"The subject of the email",placeholder:"Email subject",...l("subject",{required:"Subject is required"}),className:"md:w-1/2",errors:u}),(r==null?void 0:r.type)===te.EMAIL?e(W,{name:"template",control:a,render:({field:{value:f,onChange:h,...b}})=>i("div",{className:"w-full",children:[e("div",{className:M("inter-small-semibold mb-xsmall flex w-full items-center text-grey-50"),children:e("label",{children:"Content"})}),i("div",{className:"w-full",children:[e(ee,{onInit:(o,m)=>n.current=m,value:f??"<p></p>",init:{height:750,menubar:!0,plugins:["advlist","autolink","lists","link","image","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","code","wordcount"],toolbar:"undo redo | styleselect | bold italic forecolor | link | image",color_cols:5,a11y_advanced_options:!0,automatic_uploads:!0,file_picker_types:"image",file_picker_callback(o,m,ue){d.current&&(d.current.addEventListener("change",T=>{var w;const g=(w=T.target)!=null&&w.files?T.target.files[0]:null;if(!g||!n.current)return;const x=new FileReader;x.addEventListener("load",()=>{const k="blobid"+new Date().getTime(),S=n.current.editorUpload.blobCache,I=x.result.split(",")[1],P=S.create(k,g,I);S.add(P),o(P.blobUri(),{title:g.name})}),x.readAsDataURL(g)}),d.current.click())},content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"},tinymceScriptSrc:"/tinymce/js/tinymce/tinymce.min.js",onEditorChange:o=>{h(o)}}),e("input",{hidden:!0,type:"file",accept:"image/*",ref:d})]})]})}):e(ae,{label:"Template",...l("template",{required:"Template is required"}),rows:10,placeholder:"SMS template",errors:u}),e(oe,{})]})]})})})]})}function de(){const{id:t}=F(),{data:a,isLoading:l}=H(`/templates/${t}`,["templates",t]);return!l&&a.template?e(se,{template:a.template,children:e(ce,{})}):null}function me(){const[t,a]=p.useState("email");return V(),e(_,{children:e("div",{className:"flex h-full flex-col",children:e("div",{className:"flex w-full grow flex-col",children:e(U,{customHeader:e(z,{views:["email".toString(),"sms".toString()],setActiveView:l=>{a(l)},activeView:t.toString()}),className:"h-fit",children:e(ne,{type:t.toString()})})})})})}function De(){return i(L,{children:[e(N,{index:!0,element:e(me,{})}),e(N,{path:"/:id",element:e(de,{})})]})}export{De as default};
