import{r as a,a as e,m as K,M as O,j as d,B as Q,L as le,F as W,G as re,I as oe,H as ne,J as ce,u as ie,S as de,R as ue,b as me}from"./index-effbfb95.js";import{B as he}from"./index-3da0109e.js";import{E as $}from"./edit-icon-8c1c10d1.js";import{T as X}from"./trash-icon-abcb5140.js";import{T as o,r as G,a as ee,A as pe}from"./index-0d9858ea.js";import{J as ge}from"./index-e0338379.js";import{D as te}from"./delete-prompt-37f35e36.js";import{S as fe}from"./index-561655b0.js";import{C as Pe}from"./index-45d42c5f.js";import{u as se}from"./use-debounce-438a4ce8.js";import{I as be}from"./index-d33be3e8.js";import{d as ae}from"./utils-d0ea9dd4.js";import{M as Y}from"./api-9aff074a.js";import{u as Se}from"./use-notification-9f7c3c92.js";import{g as xe}from"./error-messages-d2d0bb30.js";import"./chevron-down-6a69fe38.js";import"./index-dd9f9076.js";import"./index.esm-5a89640b.js";import"./index-e25e2e97.js";import"./toConsumableArray-6f61c395.js";import"./unsupportedIterableToArray-27301055.js";import"./index-0f96226b.js";import"./index-a4458bf1.js";import"./index-52359d87.js";import"./index-04f3341e.js";import"./axios-4a70c6fc.js";import"./index-1ec19c89.js";const Ce=()=>a.useMemo(()=>[{accessor:"thumbnail",Cell:({cell:{value:t}})=>e(o.Cell,{className:"w-[5%]",children:e("div",{className:"h-[40px] w-[30px] bg-grey-5 rounded-soft overflow-hidden my-xsmall",children:t?e("img",{src:t,alt:"Thumbnail",className:"h-full w-full object-cover"}):null})})},{accessor:"title",Cell:({cell:{value:t}})=>e(o.Cell,{className:"w-3/6",children:t})},{accessor:"status",Cell:({cell:{value:t}})=>e(o.Cell,{className:"w-[10%] pr-base",children:e("div",{className:"flex items-center justify-end",children:ae(t)})})}],[]),we=({existingRelations:c,onSubmit:t,onClose:P})=>{const[R,w]=a.useState(""),[u,m]=a.useState(0),[v,D]=a.useState(0),[N,b]=a.useState(0),[S,y]=a.useState([]),[h,j]=a.useState([]),A=se(R,500),{isLoading:E,count:x,products:r}=K({q:A,limit:10,offset:u}),p=Ce(),{rows:g,prepareRow:k,getTableBodyProps:B,getTableProps:T,canPreviousPage:f,canNextPage:M,pageCount:Z,nextPage:q,previousPage:F,state:{pageIndex:V,pageSize:L,selectedRowIds:C}}=G.useTable({data:r||[],columns:p,manualPagination:!0,initialState:{pageIndex:N,pageSize:10,selectedRowIds:c.reduce((s,{id:n})=>(s[n]=!0,s),{})},pageCount:v,autoResetSelectedRows:!1,autoResetPage:!1,getRowId:s=>s.id},G.usePagination,G.useRowSelect,s=>{s.visibleColumns.push(n=>[{id:"selection",Cell:({row:i})=>e(o.Cell,{className:"w-[5%] pl-base",children:e(be,{...i.getToggleRowSelectedProps()})})},...n])});a.useEffect(()=>{y(s=>[...s.filter(n=>Object.keys(C).findIndex(i=>i===n.id)>-1),...(r==null?void 0:r.filter(n=>s.findIndex(i=>i.id===n.id)<0&&Object.keys(C).findIndex(i=>i===n.id)>-1))||[]].filter(n=>c.findIndex(i=>i.id===n.id)<0)),j([...c.filter(s=>Object.keys(C).findIndex(n=>n===s.id)<0)])},[C]),a.useEffect(()=>{const s=Math.ceil(x/10);D(s)},[r,x,10]);const J=()=>{M&&(m(s=>s+L),b(s=>s+1),q())},U=()=>{f&&(m(s=>s-L),b(s=>s-1),F())},H=s=>{m(0),w(s)},[l,z]=a.useState(!0);a.useEffect(()=>{if(S.length>0||h.length>0){z(!1);return}z(!0)},[S,h]);const _=()=>{t(S.map(s=>s.id),h.map(s=>s.id))};return e(O,{handleClose:P,children:d(O.Body,{children:[e(O.Header,{handleClose:P,children:e("h3",{className:"inter-xlarge-semibold",children:"Add Products"})}),e(O.Content,{children:e(ee,{hasPagination:!0,numberOfRows:10,isLoading:E,pagingState:{count:x,offset:u,pageSize:u+g.length,title:"Products",currentPage:V+1,pageCount:Z,nextPage:J,prevPage:U,hasNext:M,hasPrev:f},children:e(o,{enableSearch:!0,handleSearch:H,searchValue:R,searchPlaceholder:"Search Products",...T(),className:"flex-grow",children:e(o.Body,{...B(),children:g.map(s=>(k(s),e(o.Row,{color:"inherit",...s.getRowProps(),className:"px-base",children:s.cells.map((n,i)=>n.render("Cell",{index:i}))})))})})})}),e(O.Footer,{children:d("div",{className:"flex items-center justify-end gap-x-xsmall w-full",children:[e(Q,{variant:"ghost",size:"small",className:"w-eventButton",onClick:P,children:"Cancel"}),e(Q,{variant:"primary",size:"small",className:"w-eventButton",onClick:_,disabled:l,children:"Save"})]})})]})})},ve=()=>a.useMemo(()=>[{id:"selection",Cell:({row:t})=>e(o.Cell,{className:"w-[0%] pl-base pr-large",children:e("div",{children:t.index+1})})},{accessor:"thumbnail",Cell:({cell:{value:t}})=>e(o.Cell,{className:"w-[0%] pr-base",children:e("div",{className:"h-[40px] w-[30px] bg-grey-5 rounded-soft overflow-hidden my-xsmall",children:t?e("img",{src:t,alt:"Thumbnail",className:"h-full w-full object-cover"}):null})})},{accessor:"title",Cell:({cell:{row:t,value:P}})=>e(o.Cell,{className:"w-[20%]",children:e(le,{to:`/a/products/${t.original.id}`,children:P})})},{accessor:"status",Cell:({cell:{value:t}})=>e(o.Cell,{className:"w-[50%] justify-start",children:ae(t)})}],[]),Ne=({collectionId:c,refetchCollection:t})=>{const[I,R]=a.useState(""),[w,u]=a.useState(0),[m,v]=a.useState(0),[D,N]=a.useState(0),b=se(I,500),[S,y]=a.useState(!1),[h,j]=a.useState(void 0),{isLoading:A,count:E,products:x,refetch:r}=K({q:b,collection_id:[c],limit:10,offset:w});a.useEffect(()=>{r()},[c]);const p=()=>{h&&Y.products.update(h,{collection_id:null}).then(()=>{r(),t()})},g=ve(),{rows:k,prepareRow:B,getTableBodyProps:T,getTableProps:f,canPreviousPage:M,canNextPage:Z,pageCount:q,nextPage:F,previousPage:V,state:{pageIndex:L,pageSize:C}}=G.useTable({data:x||[],columns:g,manualPagination:!0,initialState:{pageIndex:D,pageSize:10},pageCount:m,getRowId:l=>l.id},G.usePagination,l=>{l.visibleColumns.push(z=>[...z,{id:"actions",Cell:({row:_})=>e(o.Cell,{className:"w-[0%] pr-2xsmall",children:e(Q,{variant:"ghost",size:"small",className:"text-grey-40",onClick:()=>{j(_.original.id),y(!0)},children:e(X,{size:20})})})}])});a.useEffect(()=>{const l=Math.ceil(E/10);v(l)},[x,E,10]);const J=()=>{Z&&(u(l=>l+C),N(l=>l+1),F())},U=()=>{M&&(u(l=>l-C),N(l=>l-1),V())},H=l=>{u(0),R(l)};return d(W,{children:[e(ee,{isLoading:A,hasPagination:!0,numberOfRows:C,pagingState:{count:E,offset:w,pageSize:w+k.length,title:"Products",currentPage:L+1,pageCount:q,nextPage:J,prevPage:U,hasNext:Z,hasPrev:M},children:e(o,{enableSearch:!0,handleSearch:H,searchPlaceholder:"Search Products",...f(),className:"h-full",children:e(o.Body,{...T(),children:k.map(l=>(B(l),e(o.Row,{color:"inherit",...l.getRowProps(),className:"px-base",children:l.cells.map((z,_)=>z.render("Cell",{index:_}))})))})})}),S&&e(te,{onDelete:async()=>p(),handleClose:()=>y(!S),heading:"Remove product from collection",successText:"Product removed from collection"})]})},ye=()=>{const{id:c}=re(),{collection:t,isLoading:P,refetch:I}=oe(c),R=ne(c),w=ce(c),[u,m]=a.useState(!1),[v,D]=a.useState(!1),[N,b]=a.useState(!1),S=ie(),y=Se(),[h,j]=a.useState(0),A=()=>{R.mutate(void 0,{onSuccess:()=>S("/a/collections")})},E=(r,p)=>{const g={title:r.title,handle:r.handle};if(p){const k=Object.keys((t==null?void 0:t.metadata)??{}).reduce((T,f)=>({...T,[f]:null}),{}),B=p.reduce((T,f)=>({...T,[f.key]:f.value??null}),k);g.metadata=B}w.mutate(g,{onSuccess:()=>{m(!1),I()}})},x=async(r,p)=>{try{r.length>0&&await Y.collections.addProducts(t==null?void 0:t.id,{product_ids:r}),p.length>0&&await Y.collections.removeProducts(t==null?void 0:t.id,{product_ids:p}),b(!1),y("Success","Updated products in collection","success"),I()}catch(g){y("Error",xe(g),"error")}};return a.useEffect(()=>{var r;(r=t==null?void 0:t.products)!=null&&r.length&&j(h+1)},[t==null?void 0:t.products]),d(W,{children:[d("div",{className:"flex flex-col !pb-xlarge",children:[e(he,{className:"mb-xsmall",path:"/a/products?view=collections",label:"Back to Collections"}),e("div",{className:"rounded-rounded py-large px-xlarge border border-grey-20 bg-grey-0 mb-large",children:P||!t?e("div",{className:"flex items-center w-full h-12",children:e(de,{variant:"secondary",size:"large"})}):d("div",{children:[d("div",{children:[d("div",{className:"flex items-center justify-between",children:[e("h2",{className:"inter-xlarge-semibold mb-2xsmall",children:t.title}),e(pe,{forceDropdown:!0,actions:[{label:"Edit Collection",onClick:()=>m(!0),icon:e($,{size:"20"})},{label:"Delete",onClick:()=>D(!v),variant:"danger",icon:e(X,{size:"20"})}]})]}),d("p",{className:"inter-small-regular text-grey-50",children:["/",t.handle]})]}),t.metadata&&d("div",{className:"mt-large flex flex-col gap-y-base",children:[e("h3",{className:"inter-base-semibold",children:"Metadata"}),e("div",{children:e(ge,{data:t.metadata})})]})]})}),d(fe,{title:"Products",actions:[{label:"Edit Products",icon:e($,{size:"20"}),onClick:()=>b(!N)}],children:[e("p",{className:"text-grey-50 inter-base-regular mt-xsmall mb-base",children:"To start selling, all you need is a name, price, and image."}),t&&e(Ne,{collectionId:t.id,refetchCollection:I},h)]})]}),u&&e(Pe,{onClose:()=>m(!u),onSubmit:E,isEdit:!0,collection:t}),v&&e(te,{handleClose:()=>D(!v),heading:"Delete collection",successText:"Successfully deleted collection",onDelete:async()=>A(),confirmText:"Yes, delete"}),N&&e(we,{onClose:()=>b(!1),onSubmit:x,existingRelations:(t==null?void 0:t.products)??[]})]})},Xe=()=>e(ue,{children:e(me,{path:"/:id",element:e(ye,{})})});export{Xe as default};
