import{g as Cn,r as p,j as a,a as e,u as fe,bz as St,ai as st,am as kt,al as Nn,ak as wn,aj as Sn,M as k,B as _,F as X,bA as kn,a8 as Dn,a6 as Dt,bB as Ve,i as at,d as Q,Z as lt,af as _n,e as ot,a5 as Re,a9 as In,m as _t,bC as Pn,bD as Tn,bE as On,bF as It,S as Fe,G as Mn,H as En,ap as Pt,L as Vn,q as me,c as Tt,y as Rn,bG as Fn,be as Ot,x as jn,bv as An,A as zn,bh as Hn,C as Ln,bH as Un,R as qn,b as pt}from"./index-effbfb95.js";import{B as Bn}from"./index-3da0109e.js";import{C as $n,I as ft,M as Wn,g as Yn}from"./index-65b9620f.js";import{E as ce}from"./edit-icon-8c1c10d1.js";import{S as de}from"./index-561655b0.js";import{u as J}from"./use-toggle-state-9e07c572.js";import{C as K,u as ee,c as re,b as ge,a as Gn,F as Zn}from"./index.esm-5a89640b.js";import{a as ct}from"./countries-bbdb373c.js";import{n as H}from"./nested-form-c66382a0.js";import{I as $,T as Ie,a as he,P as Ce,b as Jn}from"./index-dd9f9076.js";import{C as Mt}from"./index-e417090c.js";import{S as Et}from"./index-dd953a8b.js";import{F as Z}from"./form-validator-a60b1f3b.js";import{u as je}from"./use-imperative-dialog-cb4e5fcf.js";import{u as ae,X as Qn}from"./use-notification-9f7c3c92.js";import{g as te}from"./error-messages-d2d0bb30.js";import{F as dt}from"./feature-toggle-9157e4de.js";import{C as Vt}from"./channels-icon-c5648122.js";import{T as le}from"./trash-icon-abcb5140.js";import{B as Rt}from"./index-84767cd7.js";import{S as Kn}from"./index-f2ff65ef.js";import{S as Ft}from"./index-3d3c6d2a.js";import{S as Pe}from"./index-523daaeb.js";import{T as jt}from"./index-d74195ae.js";import{T as At}from"./index-4192ae3e.js";import{P as ut,U as Xn}from"./index-4a064b3c.js";import{p as Te}from"./images-e8c4b691.js";import{F as zt}from"./index-a2e12c2a.js";import{A as we,M as mt,r as Oe,T as q,a as Ht}from"./index-0d9858ea.js";import{J as er}from"./index-e0338379.js";import{T as tr,a as nr,E as rr}from"./index-630f70f7.js";import{G as ir}from"./index-2674456d.js";import{A as Y}from"./index-bf34ad3b.js";import{c as sr}from"./react-select.esm-1ec1493a.js";import{P as yt}from"./price-form-input-b497b56c.js";import{i as oe,D as ar}from"./a-0eba6a7f.js";import{D as Lt}from"./duplicate-icon-dbea12ca.js";import{E as Ut}from"./Editor-bf113ee3.js";import{h as _e}from"./moment-fbc5633a.js";import{F as lr}from"./index-ec3b8ff9.js";import{U as or,a as cr}from"./index-40f3c453.js";import{B as dr}from"./body-card-d3fddb8c.js";import{T as ur}from"./index-a6859a1b.js";import{C as mr}from"./index-45d42c5f.js";import{u as qt}from"./use-debounce-438a4ce8.js";import{l as Ne}from"./lodash-72dfe3e0.js";import{u as hr}from"./analytics-1ab31609.js";import{P as gr}from"./filter-dropdown-10fffb0a.js";import{I as Bt}from"./image-placeholder-b3cbea02.js";import{S as ve}from"./index-04f3341e.js";import{P as et}from"./shared-f9889298.js";import{r as pr}from"./time-5c3c185e.js";import{P as $t}from"./polling-69bcbbd8.js";import{F as He}from"./focus-modal-d105ce27.js";import{v as tt}from"./v4-cf522c50.js";import"./react-select-creatable.esm-e43d0869.js";import"./toConsumableArray-6f61c395.js";import"./unsupportedIterableToArray-27301055.js";import"./_isIndex-6af6139d.js";import"./chevron-down-6a69fe38.js";import"./index-1ec19c89.js";import"./index-d33be3e8.js";import"./index-903c1727.js";import"./api-9aff074a.js";import"./axios-4a70c6fc.js";import"./index-e25e2e97.js";import"./index-0f96226b.js";import"./index-a4458bf1.js";import"./createSuper-ad9f6885.js";import"./index.esm-841d990e.js";import"./react-hotkeys-hook.esm-745ca041.js";import"./file-icon-3c84b281.js";import"./index-52359d87.js";import"./index-b17c211e.js";import"./index-202b6dd7.js";import"./arrow-down-icon-49435f5a.js";import"./chevron-up-ae6c75fe.js";var fr=function t(n,r){if(n===r)return!0;if(n&&r&&typeof n=="object"&&typeof r=="object"){if(n.constructor!==r.constructor)return!1;var i,s,l;if(Array.isArray(n)){if(i=n.length,i!=r.length)return!1;for(s=i;s--!==0;)if(!t(n[s],r[s]))return!1;return!0}if(n.constructor===RegExp)return n.source===r.source&&n.flags===r.flags;if(n.valueOf!==Object.prototype.valueOf)return n.valueOf()===r.valueOf();if(n.toString!==Object.prototype.toString)return n.toString()===r.toString();if(l=Object.keys(n),i=l.length,i!==Object.keys(r).length)return!1;for(s=i;s--!==0;)if(!Object.prototype.hasOwnProperty.call(r,l[s]))return!1;for(s=i;s--!==0;){var c=l[s];if(!t(n[c],r[c]))return!1}return!0}return n!==n&&r!==r};const yr=Cn(fr),pe=typeof window<"u"?p.useLayoutEffect:p.useEffect;function br(t,n,r){const[i,s]=p.useState(()=>n(t)),l=p.useCallback(()=>{const c=n(t);yr(i,c)||(s(c),r&&r())},[i,t,r]);return pe(l),[i,l]}function vr(t,n,r){const[i,s]=br(t,n,r);return pe(function(){const c=t.getHandlerId();if(c!=null)return t.subscribeToStateChange(s,{handlerIds:[c]})},[t,s]),i}function Wt(t,n,r){return vr(n,t||(()=>({})),()=>r.reconnect())}function Yt(t,n){const r=[...n||[]];return n==null&&typeof t!="function"&&r.push(t),p.useMemo(()=>typeof t=="function"?t():t,r)}function xr(t){return p.useMemo(()=>t.hooks.dragSource(),[t])}function Cr(t){return p.useMemo(()=>t.hooks.dragPreview(),[t])}let Le=!1,Ue=!1;class Nr{receiveHandlerId(n){this.sourceId=n}getHandlerId(){return this.sourceId}canDrag(){oe(!Le,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return Le=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{Le=!1}}isDragging(){if(!this.sourceId)return!1;oe(!Ue,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return Ue=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{Ue=!1}}subscribeToStateChange(n,r){return this.internalMonitor.subscribeToStateChange(n,r)}isDraggingSource(n){return this.internalMonitor.isDraggingSource(n)}isOverTarget(n,r){return this.internalMonitor.isOverTarget(n,r)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(n){return this.internalMonitor.subscribeToOffsetChange(n)}canDragSource(n){return this.internalMonitor.canDragSource(n)}canDropOnTarget(n){return this.internalMonitor.canDropOnTarget(n)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(n){this.sourceId=null,this.internalMonitor=n.getMonitor()}}let qe=!1;class wr{receiveHandlerId(n){this.targetId=n}getHandlerId(){return this.targetId}subscribeToStateChange(n,r){return this.internalMonitor.subscribeToStateChange(n,r)}canDrop(){if(!this.targetId)return!1;oe(!qe,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return qe=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{qe=!1}}isOver(n){return this.targetId?this.internalMonitor.isOverTarget(this.targetId,n):!1}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(n){this.targetId=null,this.internalMonitor=n.getMonitor()}}function Sr(t,n,r){const i=r.getRegistry(),s=i.addTarget(t,n);return[s,()=>i.removeTarget(s)]}function kr(t,n,r){const i=r.getRegistry(),s=i.addSource(t,n);return[s,()=>i.removeSource(s)]}function nt(t,n,r,i){let s=r?r.call(i,t,n):void 0;if(s!==void 0)return!!s;if(t===n)return!0;if(typeof t!="object"||!t||typeof n!="object"||!n)return!1;const l=Object.keys(t),c=Object.keys(n);if(l.length!==c.length)return!1;const u=Object.prototype.hasOwnProperty.bind(n);for(let o=0;o<l.length;o++){const d=l[o];if(!u(d))return!1;const m=t[d],g=n[d];if(s=r?r.call(i,m,g,d):void 0,s===!1||s===void 0&&m!==g)return!1}return!0}function rt(t){return t!==null&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function Dr(t){if(typeof t.type=="string")return;const n=t.type.displayName||t.type.name||"the component";throw new Error(`Only native element nodes can now be passed to React DnD connectors.You can either wrap ${n} into a <div>, or turn it into a drag source or a drop target itself.`)}function _r(t){return(n=null,r=null)=>{if(!p.isValidElement(n)){const l=n;return t(l,r),l}const i=n;return Dr(i),Ir(i,r?l=>t(l,r):t)}}function Gt(t){const n={};return Object.keys(t).forEach(r=>{const i=t[r];if(r.endsWith("Ref"))n[r]=t[r];else{const s=_r(i);n[r]=()=>s}}),n}function bt(t,n){typeof t=="function"?t(n):t.current=n}function Ir(t,n){const r=t.ref;return oe(typeof r!="string","Cannot connect React DnD to an element with an existing string ref. Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. Read more: https://reactjs.org/docs/refs-and-the-dom.html#callback-refs"),r?p.cloneElement(t,{ref:i=>{bt(r,i),bt(n,i)}}):p.cloneElement(t,{ref:n})}class Pr{receiveHandlerId(n){this.handlerId!==n&&(this.handlerId=n,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(n){this.dragSourceOptionsInternal=n}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(n){this.dragPreviewOptionsInternal=n}reconnect(){const n=this.reconnectDragSource();this.reconnectDragPreview(n)}reconnectDragSource(){const n=this.dragSource,r=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return r&&this.disconnectDragSource(),this.handlerId?n?(r&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=n,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,n,this.dragSourceOptions)),r):(this.lastConnectedDragSource=n,r):r}reconnectDragPreview(n=!1){const r=this.dragPreview,i=n||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();if(i&&this.disconnectDragPreview(),!!this.handlerId){if(!r){this.lastConnectedDragPreview=r;return}i&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=r,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,r,this.dragPreviewOptions))}}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!nt(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!nt(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(n){this.hooks=Gt({dragSource:(r,i)=>{this.clearDragSource(),this.dragSourceOptions=i||null,rt(r)?this.dragSourceRef=r:this.dragSourceNode=r,this.reconnectDragSource()},dragPreview:(r,i)=>{this.clearDragPreview(),this.dragPreviewOptions=i||null,rt(r)?this.dragPreviewRef=r:this.dragPreviewNode=r,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=n}}class Tr{get connectTarget(){return this.dropTarget}reconnect(){const n=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();n&&this.disconnectDropTarget();const r=this.dropTarget;if(this.handlerId){if(!r){this.lastConnectedDropTarget=r;return}n&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=r,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,r,this.dropTargetOptions))}}receiveHandlerId(n){n!==this.handlerId&&(this.handlerId=n,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(n){this.dropTargetOptionsInternal=n}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!nt(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(n){this.hooks=Gt({dropTarget:(r,i)=>{this.clearDropTarget(),this.dropTargetOptions=i,rt(r)?this.dropTargetRef=r:this.dropTargetNode=r,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=n}}function Se(){const{dragDropManager:t}=p.useContext(ar);return oe(t!=null,"Expected drag drop context"),t}function Or(t,n){const r=Se(),i=p.useMemo(()=>new Pr(r.getBackend()),[r]);return pe(()=>(i.dragSourceOptions=t||null,i.reconnect(),()=>i.disconnectDragSource()),[i,t]),pe(()=>(i.dragPreviewOptions=n||null,i.reconnect(),()=>i.disconnectDragPreview()),[i,n]),i}function Mr(){const t=Se();return p.useMemo(()=>new Nr(t),[t])}class Er{beginDrag(){const n=this.spec,r=this.monitor;let i=null;return typeof n.item=="object"?i=n.item:typeof n.item=="function"?i=n.item(r):i={},i??null}canDrag(){const n=this.spec,r=this.monitor;return typeof n.canDrag=="boolean"?n.canDrag:typeof n.canDrag=="function"?n.canDrag(r):!0}isDragging(n,r){const i=this.spec,s=this.monitor,{isDragging:l}=i;return l?l(s):r===n.getSourceId()}endDrag(){const n=this.spec,r=this.monitor,i=this.connector,{end:s}=n;s&&s(r.getItem(),r),i.reconnect()}constructor(n,r,i){this.spec=n,this.monitor=r,this.connector=i}}function Vr(t,n,r){const i=p.useMemo(()=>new Er(t,n,r),[n,r]);return p.useEffect(()=>{i.spec=t},[t]),i}function Rr(t){return p.useMemo(()=>{const n=t.type;return oe(n!=null,"spec.type must be defined"),n},[t])}function Fr(t,n,r){const i=Se(),s=Vr(t,n,r),l=Rr(t);pe(function(){if(l!=null){const[u,o]=kr(l,s,i);return n.receiveHandlerId(u),r.receiveHandlerId(u),o}},[i,n,r,s,l])}function Zt(t,n){const r=Yt(t,n);oe(!r.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const i=Mr(),s=Or(r.options,r.previewOptions);return Fr(r,i,s),[Wt(r.collect,i,s),xr(s),Cr(s)]}function jr(t){return p.useMemo(()=>t.hooks.dropTarget(),[t])}function Ar(t){const n=Se(),r=p.useMemo(()=>new Tr(n.getBackend()),[n]);return pe(()=>(r.dropTargetOptions=t||null,r.reconnect(),()=>r.disconnectDropTarget()),[t]),r}function zr(){const t=Se();return p.useMemo(()=>new wr(t),[t])}function Hr(t){const{accept:n}=t;return p.useMemo(()=>(oe(t.accept!=null,"accept must be defined"),Array.isArray(n)?n:[n]),[n])}class Lr{canDrop(){const n=this.spec,r=this.monitor;return n.canDrop?n.canDrop(r.getItem(),r):!0}hover(){const n=this.spec,r=this.monitor;n.hover&&n.hover(r.getItem(),r)}drop(){const n=this.spec,r=this.monitor;if(n.drop)return n.drop(r.getItem(),r)}constructor(n,r){this.spec=n,this.monitor=r}}function Ur(t,n){const r=p.useMemo(()=>new Lr(t,n),[n]);return p.useEffect(()=>{r.spec=t},[t]),r}function qr(t,n,r){const i=Se(),s=Ur(t,n),l=Hr(t);pe(function(){const[u,o]=Sr(l,s,i);return n.receiveHandlerId(u),r.receiveHandlerId(u),o},[i,n,s,r,l.map(c=>c.toString()).join("|")])}function Jt(t,n){const r=Yt(t,n),i=zr(),s=Ar(r.options);return qr(r,i,s),[Wt(r.collect,i,s),jr(s)]}const Ae=({form:t})=>{const{register:n,path:r,control:i,formState:{errors:s}}=t,l=ct.map(c=>({label:c.name,value:c.alpha2}));return a("div",{className:"grid grid-cols-2 gap-large pb-2xsmall",children:[e($,{label:"MID Code",placeholder:"XDSKLAD9999...",...n(r("mid_code"),{pattern:Z.whiteSpaceRule("MID Code")}),errors:s}),e($,{label:"HS Code",placeholder:"BDJSK39277W...",...n(r("hs_code"),{pattern:Z.whiteSpaceRule("HS Code")}),errors:s}),e(K,{name:r("origin_country"),control:i,render:({field:c})=>e(Et,{label:"Country of origin",placeholder:"Choose a country",options:l,isSearchable:!0,isClearable:!0,...c})})]})},ze=({form:t})=>{const{register:n,path:r,formState:{errors:i}}=t;return a("div",{className:"grid grid-cols-4 gap-x-large",children:[e($,{label:"Width",placeholder:"100...",type:"number",...n(r("width"),{min:Z.nonNegativeNumberRule("Width"),valueAsNumber:!0}),errors:i}),e($,{label:"Length",placeholder:"100...",type:"number",...n(r("length"),{min:Z.nonNegativeNumberRule("Length"),valueAsNumber:!0}),errors:i}),e($,{label:"Height",placeholder:"100...",type:"number",...n(r("height"),{min:Z.nonNegativeNumberRule("Height"),valueAsNumber:!0}),errors:i}),e($,{label:"Weight",placeholder:"100...",type:"number",...n(r("weight"),{min:Z.nonNegativeNumberRule("Weight"),valueAsNumber:!0}),errors:i})]})},ie=t=>{const n=je(),r=fe(),i=ae(),s=St(t),l=st(t),c=kt(t),u=Nn(t),o=wn(t),d=Sn(t);return{getProduct:s,onDelete:async()=>{await n({heading:"Delete Product",text:"Are you sure you want to delete this product"})&&c.mutate(void 0,{onSuccess:()=>{i("Success","Product deleted successfully","success"),r("/a/products/")},onError:f=>{i("Error",te(f),"error")}})},onStatusChange:y=>{const f=y==="published"?"draft":"published";l.mutate({status:f},{onSuccess:()=>{i("Success",`Product ${f==="published"?"published":"drafted"} successfully`,"success")},onError:b=>{i("Ooops",te(b),"error")}})},onUpdate:(y,f,b="Product was successfully updated")=>{l.mutate(y,{onSuccess:()=>{i("Success",b,"success"),f()},onError:x=>{i("Error",te(x),"error")}})},onAddVariant:(y,f,b="Variant was created successfully")=>{d.mutate(y,{onSuccess:()=>{i("Success",b,"success"),s.refetch(),f()},onError:x=>{i("Error",te(x),"error")}})},onUpdateVariant:(y,f,b,x="Variant was updated successfully")=>{u.mutate({variant_id:y,...f},{onSuccess:()=>{i("Success",x,"success"),s.refetch(),b()},onError:T=>{i("Error",te(T),"error")}})},onDeleteVariant:(y,f,b="Variant was succesfully deleted")=>{o.mutate(y,{onSuccess:()=>{i("Success",b,"success"),s.refetch(),f&&f()},onError:x=>{i("Error",te(x),"error")}})},updating:l.isLoading,deleting:c.isLoading,addingVariant:d.isLoading,updatingVariant:u.isLoading,deletingVariant:o.isLoading}},Br=({product:t,open:n,onClose:r})=>{const{onUpdate:i,updating:s}=ie(t.id),l=ee({defaultValues:Be(t)}),{formState:{isDirty:c},handleSubmit:u,reset:o}=l;p.useEffect(()=>{o(Be(t))},[t]);const d=()=>{o(Be(t)),r()},m=u(g=>{var h;i({weight:g.dimensions.weight,width:g.dimensions.width,height:g.dimensions.height,length:g.dimensions.length,mid_code:g.customs.mid_code,hs_code:g.customs.hs_code,origin_country:(h=g.customs.origin_country)==null?void 0:h.value},d)});return e(k,{open:n,handleClose:d,isLargeModal:!0,children:a(k.Body,{children:[e(k.Header,{handleClose:d,children:e("h1",{className:"inter-xlarge-semibold m-0",children:"Edit Attributes"})}),a("form",{onSubmit:m,children:[a(k.Content,{children:[a("div",{className:"mb-xlarge",children:[e("h2",{className:"inter-large-semibold mb-2xsmall",children:"Dimensions"}),e("p",{className:"inter-base-regular text-grey-50 mb-large",children:"Configure to calculate the most accurate shipping rates"}),e(ze,{form:H(l,"dimensions")})]}),a("div",{children:[e("h2",{className:"inter-large-semibold mb-2xsmall",children:"Customs"}),e("p",{className:"inter-base-regular text-grey-50 mb-large",children:"Configure to calculate the most accurate shipping rates"}),e(Ae,{form:H(l,"customs")})]})]}),e(k.Footer,{children:a("div",{className:"flex gap-x-2 justify-end w-full",children:[e(_,{size:"small",variant:"secondary",type:"button",onClick:d,children:"Cancel"}),e(_,{size:"small",variant:"primary",type:"submit",disabled:!c,loading:s,children:"Save"})]})})]})]})})},Be=t=>{const n=ct.find(i=>i.alpha2===t.origin_country),r=n?{label:n.name,value:n.alpha2}:null;return{dimensions:{weight:t.weight,width:t.width,height:t.height,length:t.length},customs:{mid_code:t.mid_code,hs_code:t.hs_code,origin_country:r}}},$r=({product:t})=>{const{state:n,toggle:r,close:i}=J();return a(X,{children:[a(de,{title:"Attributes",actions:[{label:"Edit Attributes",onClick:r,icon:e(ce,{size:20})}],forceDropdown:!0,children:[a("div",{className:"flex flex-col gap-y-xsmall mb-large mt-base",children:[e("h2",{className:"inter-base-semibold",children:"Dimensions"}),a("div",{className:"flex flex-col gap-y-xsmall",children:[e(ue,{attribute:"Height",value:t.height}),e(ue,{attribute:"Width",value:t.width}),e(ue,{attribute:"Length",value:t.length}),e(ue,{attribute:"Weight",value:t.weight})]})]}),a("div",{className:"flex flex-col gap-y-xsmall",children:[e("h2",{className:"inter-base-semibold",children:"Customs"}),a("div",{className:"flex flex-col gap-y-xsmall",children:[e(ue,{attribute:"MID Code",value:t.mid_code}),e(ue,{attribute:"HS Code",value:t.hs_code}),e(ue,{attribute:"Country of origin",value:t.origin_country})]})]})]}),e(Br,{onClose:i,open:n,product:t})]})},ue=({attribute:t,value:n})=>a("div",{className:"flex items-center justify-between w-full inter-base-regular text-grey-50",children:[e("p",{children:t}),e("p",{children:n||"–"})]}),Qt=({channels:t=[]})=>{const{count:n}=kn(),r=Math.max(t.length-3,0);return a("div",{className:"flex flex-col gap-y-small",children:[t.length>0&&a("div",{className:"flex gap-x-1",children:[e("div",{className:"flex gap-x-1 max-w-[600px] overflow-clip",children:t.slice(0,3).map(i=>e(Wr,{channel:i}))}),r>0&&e(Ie,{content:e("div",{className:"flex flex-col",children:t.slice(3).map(i=>e("span",{children:i.name},i.id))}),children:e(Rt,{variant:"ghost",className:"px-3 py-1.5",children:a("div",{className:"flex items-center h-full inter-small-regular text-grey-50",children:["+ ",r," more"]})})})]}),a("p",{className:"inter-base-regular text-grey-50",children:["Available in"," ",e("span",{className:"inter-base-semibold text-grey-90",children:t.length?t.length:0})," ","out of"," ",e("span",{className:"inter-base-semibold text-grey-90",children:n||0})," ","Sales Channels"]})]})},Wr=({channel:t})=>e(Rt,{variant:"ghost",className:"px-3 py-1.5",children:e("div",{className:"flex items-center",children:e("span",{className:"inter-small-regular text-grey-90",children:t.name})})}),Yr=({product:t,open:n,onClose:r})=>{const{mutate:i}=st(t.id),s=l=>{i({sales_channels:l.map(c=>({id:c.id}))})};return e(Ft,{onClose:r,open:n,source:t.sales_channels,onSave:s})},Kt=({form:t})=>{const{control:n,path:r}=t;return a("div",{children:[a("div",{className:"flex items-center justify-between mb-2xsmall",children:[e("h2",{className:"inter-base-semibold",children:"Discountable"}),e(K,{control:n,name:r("value"),render:({field:{value:i,onChange:s}})=>e(Pe,{checked:i,onCheckedChange:s})})]}),e("p",{className:"inter-base-regular text-grey-50",children:"When unchecked discounts will not be applied to this product."})]})},Xt=({form:t,requireHandle:n=!0})=>{const{register:r,path:i,formState:{errors:s}}=t;return a("div",{children:[a("div",{className:"grid grid-cols-2 gap-x-large mb-small",children:[e($,{label:"Title",placeholder:"Winter Jacket",required:!0,...r(i("title"),{required:"Title is required",minLength:{value:1,message:"Title must be at least 1 character"},pattern:Z.whiteSpaceRule("Title")}),errors:s}),e($,{label:"Subtitle",placeholder:"Warm and cozy...",...r(i("subtitle"),{pattern:Z.whiteSpaceRule("Subtitle")}),errors:s})]}),a("p",{className:"inter-base-regular text-grey-50 mb-large",children:["Give your product a short and clear title.",e("br",{}),"50-60 characters is the recommended length for search engines."]}),a("div",{className:"grid grid-cols-2 gap-x-large mb-large",children:[e($,{label:"Handle",tooltipContent:n?void 0:"The handle is the part of the URL that identifies the product. If not specified, it will be generated from the title.",placeholder:"winter-jacket",required:n,...r(i("handle"),{required:n?"Handle is required":void 0,minLength:Z.minOneCharRule("Handle"),pattern:Z.whiteSpaceRule("Handle")}),prefix:"/",errors:s}),e($,{label:"Material",placeholder:"100% cotton",...r(i("material"),{minLength:Z.minOneCharRule("Material"),pattern:Z.whiteSpaceRule("Material")}),errors:s})]}),e(jt,{label:"Description",placeholder:"A warm and cozy jacket...",rows:3,className:"mb-small",...r(i("description")),errors:s}),a("p",{className:"inter-base-regular text-grey-50",children:["Give your product a short and clear description.",e("br",{}),"120-160 characters is the recommended length for search engines."]}),e("div",{className:"mb-small"})]})},Gr=()=>{const{product_types:t}=Dn(void 0,{staleTime:0,refetchOnWindowFocus:!0}),{collections:n}=Dt(),r=p.useMemo(()=>(t==null?void 0:t.map(({id:s,value:l})=>({value:s,label:l})))||[],[t]),i=p.useMemo(()=>(n==null?void 0:n.map(({id:s,title:l})=>({value:s,label:l})))||[],[n]);return{productTypeOptions:r,collectionOptions:i}},en=({form:t})=>{const{control:n,path:r,setValue:i}=t,{productTypeOptions:s,collectionOptions:l}=Gr(),c=s,u=o=>{c.push({label:o,value:o}),i(r("type"),{label:o,value:o},{shouldDirty:!0})};return a("div",{children:[a("div",{className:"grid grid-cols-2 gap-x-large mb-large",children:[e(K,{name:r("type"),control:n,render:({field:{value:o,onChange:d}})=>e(Mt,{label:"Type",onChange:d,options:s,value:o||null,placeholder:"Choose a type",onCreateOption:u,isClearable:!0})}),e(K,{name:r("collection"),control:n,render:({field:{value:o,onChange:d}})=>e(Et,{label:"Collection",onChange:d,options:l,value:o,placeholder:"Choose a collection",isClearable:!0})})]}),e(K,{control:n,name:r("tags"),render:({field:{value:o,onChange:d}})=>e(At,{onChange:d,values:o||[]})})]})},Zr=({product:t,open:n,onClose:r})=>{const{onUpdate:i,updating:s}=ie(t.id),l=ee({defaultValues:$e(t)}),{formState:{isDirty:c},handleSubmit:u,reset:o}=l;p.useEffect(()=>{o($e(t))},[t]);const d=()=>{o($e(t)),r()},m=u(g=>{i({title:g.general.title,handle:g.general.handle,material:g.general.material,subtitle:g.general.subtitle,description:g.general.description,type:g.organize.type?{id:g.organize.type.value,value:g.organize.type.label}:null,collection_id:g.organize.collection?g.organize.collection.value:null,tags:g.organize.tags?g.organize.tags.map(h=>({value:h})):null,discountable:g.discountable.value},d)});return e(k,{open:n,handleClose:d,isLargeModal:!0,children:a(k.Body,{children:[e(k.Header,{handleClose:d,children:e("h1",{className:"inter-xlarge-semibold m-0",children:"Edit General Information"})}),a("form",{onSubmit:m,children:[a(k.Content,{children:[e(Xt,{form:H(l,"general")}),a("div",{className:"my-xlarge",children:[e("h2",{className:"inter-base-semibold mb-base",children:"Organize Product"}),e(en,{form:H(l,"organize")})]}),e(Kt,{form:H(l,"discountable")})]}),e(k.Footer,{children:a("div",{className:"flex gap-x-2 justify-end w-full",children:[e(_,{size:"small",variant:"secondary",type:"button",onClick:d,children:"Cancel"}),e(_,{size:"small",variant:"primary",type:"submit",disabled:!c,loading:s,children:"Save"})]})})]})]})})},$e=t=>({general:{title:t.title,subtitle:t.subtitle,material:t.material,handle:t.handle,description:t.description||null},organize:{collection:t.collection?{label:t.collection.title,value:t.collection.id}:null,type:t.type?{label:t.type.value,value:t.type.id}:null,tags:t.tags?t.tags.map(n=>n.value):null},discountable:{value:t.discountable}}),Jr=({product:t})=>{const{onDelete:n,onStatusChange:r}=ie(t.id),{data:i}=Ve("/extend-store",["extend-store"]),s=p.useMemo(()=>(i==null?void 0:i.extendStore.storeUrl)??"",[i]),{state:l,close:c,toggle:u}=J(),{state:o,close:d,toggle:m}=J(!1),{isFeatureEnabled:g}=at(),h=[{label:"Edit General Information",onClick:u,icon:e(ce,{size:20})},{label:"Delete",onClick:n,variant:"danger",icon:e(le,{size:20})}];return g("sales_channels")&&h.splice(1,0,{label:"Edit Sales Channels",onClick:m,icon:e(Vt,{size:20})}),a(X,{children:[a(de,{title:t.title,actions:h,forceDropdown:!0,status:a(X,{children:[e(Kn,{isDraft:(t==null?void 0:t.status)==="draft",activeState:"Published",draftState:"Draft",onChange:()=>r(t.status)}),e("a",{target:"_blank",href:`${s}/products/${t.handle}`,title:"Open product store",children:e(ut,{size:20})})]}),children:[e("p",{className:"inter-base-regular mt-2 whitespace-pre-wrap text-grey-50",children:t.description}),e(Kr,{product:t}),e(Qr,{product:t}),e(Xr,{product:t})]}),e(Zr,{product:t,open:l,onClose:c}),e(dt,{featureFlag:"sales_channels",children:e(Yr,{product:t,open:o,onClose:d})})]})},De=({title:t,value:n})=>a("div",{className:"inter-base-regular flex items-center justify-between text-grey-50",children:[e("p",{children:t}),e("p",{children:n||"–"})]}),Qr=({product:t})=>{var n,r;return a("div",{className:"mt-8 flex flex-col gap-y-3",children:[e("h2",{className:"inter-base-semibold",children:"Details"}),e(De,{title:"Subtitle",value:t.subtitle}),e(De,{title:"Handle",value:t.handle}),e(De,{title:"Type",value:(n=t.type)==null?void 0:n.value}),e(De,{title:"Collection",value:(r=t.collection)==null?void 0:r.title}),e(De,{title:"Discountable",value:t.discountable?"True":"False"})]})},Kr=({product:t})=>{var n;return((n=t.tags)==null?void 0:n.length)===0?null:e("ul",{className:"mt-4 flex flex-wrap items-center gap-1",children:t.tags.map(r=>e("li",{children:e("div",{className:"inter-small-semibold rounded-rounded bg-grey-10 px-3 py-[6px] text-grey-50",children:r.value})},r.id))})},Xr=({product:t})=>e(dt,{featureFlag:"sales_channels",children:a("div",{className:"mt-xlarge",children:[e("h2",{className:"inter-base-semibold mb-xsmall",children:"Sales channels"}),e(Qt,{channels:t.sales_channels})]})}),tn=({size:t="24",color:n="currentColor",...r})=>e("svg",{width:t,height:t,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r,children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18 10C18 14.4184 14.4184 18 10 18C5.5816 18 2 14.4184 2 10C2 5.5816 5.5816 2 10 2C14.4184 2 18 5.5816 18 10ZM13.9053 8.28033C14.1982 7.98744 14.1982 7.51256 13.9053 7.21967C13.6124 6.92678 13.1376 6.92678 12.8447 7.21967L8.875 11.1893L7.15533 9.46967C6.86244 9.17678 6.38756 9.17678 6.09467 9.46967C5.80178 9.76256 5.80178 10.2374 6.09467 10.5303L8.34467 12.7803C8.63756 13.0732 9.11244 13.0732 9.40533 12.7803L13.9053 8.28033Z",fill:n})}),nn=({form:t})=>{const{control:n,path:r,setValue:i}=t,{fields:s,append:l,remove:c}=re({control:n,name:r("images")}),u=h=>{if(h.length){const v=h.map(N=>({url:URL.createObjectURL(N),name:N.name,size:N.size,nativeFile:N,selected:!1}));l(v)}},o=ge({control:n,name:r("images"),defaultValue:[]}),d=p.useMemo(()=>{const h=[];return o.forEach((v,N)=>{v.selected&&h.push(N)}),h},[o]),m=()=>{c(d)},g=()=>{d.forEach(h=>{i(r(`images.${h}.selected`),!1)})};return a("div",{children:[e("div",{children:e("div",{children:e(zt,{onFileChosen:u,placeholder:"1200 x 1600 (3:4) recommended, up to 10MB each",multiple:!0,filetypes:["image/gif","image/jpeg","image/png","image/webp"],className:"py-large"})})}),s.length>0&&a("div",{className:"mt-large",children:[a("div",{className:"mb-small flex items-center justify-between",children:[e("h2",{className:"inter-large-semibold",children:"Uploads"}),e(ti,{number:d.length,onDeselect:g,onRemove:m})]}),e("div",{className:"flex flex-col gap-y-2xsmall",children:s.map((h,v)=>e(ei,{image:h,index:v,remove:c,form:t},h.id))})]})]})},ei=({image:t,index:n,form:r,remove:i})=>{const{control:s,path:l}=r,c=[{label:"Delete",onClick:()=>i(n),icon:e(le,{size:20}),variant:"danger"}];return e(K,{name:l(`images.${n}.selected`),control:s,render:({field:{value:u,onChange:o}})=>a("div",{className:"relative",children:[a("button",{className:Q("px-base py-xsmall group hover:bg-grey-5 rounded-rounded flex items-center justify-between",{"bg-grey-5":u}),type:"button",onClick:()=>o(!u),children:[a("div",{className:"flex items-center gap-x-large",children:[e("div",{className:"w-16 h-16 flex items-center justify-center",children:e("img",{src:t.url,alt:t.name||"Uploaded image",className:"max-w-[64px] max-h-[64px] rounded-rounded"})}),a("div",{className:"flex flex-col inter-small-regular text-left",children:[e("p",{children:t.name}),e("p",{className:"text-grey-50",children:t.size?`${(t.size/1024).toFixed(2)} KB`:""})]})]}),e("div",{className:"flex items-center gap-x-base",children:e("span",{className:Q("hidden",{"!block !text-violet-60":u}),children:e(tn,{size:24})})})]}),e("div",{className:"absolute top-0 right-base bottom-0 flex items-center",children:e(we,{actions:c,forceDropdown:!0})})]})})},ti=({number:t,onRemove:n,onDeselect:r})=>e("div",{className:"h-10 overflow-y-hidden flex items-center pr-1",children:a("div",{className:Q("flex items-center gap-x-small transition-all duration-200",{"translate-y-[-42px]":!t,"translate-y-[0px]":t}),children:[a("span",{children:[t," selected"]}),e("div",{className:"w-px h-5 bg-grey-20"}),a("div",{className:"flex items-center gap-x-xsmall",children:[e(_,{variant:"secondary",size:"small",type:"button",onClick:r,children:"Deselect"}),e(_,{variant:"danger",size:"small",type:"button",onClick:n,children:"Delete"})]})]})}),ni=({product:t,open:n,onClose:r})=>{const{onUpdate:i,updating:s}=ie(t.id),l=ee({defaultValues:We(t)}),{formState:{isDirty:c},handleSubmit:u,reset:o}=l,d=ae();p.useEffect(()=>{o(We(t))},[t]);const m=()=>{o(We(t)),r()},g=u(async h=>{let v=[];try{v=await Te(h.media.images)}catch(w){let y="Something went wrong while trying to upload images.";w.response.status===500&&(y=y+" You might not have a file service configured. Please contact your administrator"),d("Error",y,"error");return}const N=v.map(w=>w.url);i({images:N},m)});return e(k,{open:n,handleClose:m,isLargeModal:!0,children:a(k.Body,{children:[e(k.Header,{handleClose:m,children:e("h1",{className:"inter-xlarge-semibold m-0",children:"Edit Media"})}),a("form",{onSubmit:g,children:[e(k.Content,{children:a("div",{children:[e("h2",{className:"inter-large-semibold mb-2xsmall",children:"Media"}),e("p",{className:"inter-base-regular text-grey-50 mb-large",children:"Add images to your product."}),e("div",{children:e(nn,{form:H(l,"media")})})]})}),e(k.Footer,{children:a("div",{className:"flex gap-x-2 justify-end w-full",children:[e(_,{size:"small",variant:"secondary",type:"button",onClick:m,children:"Cancel"}),e(_,{size:"small",variant:"primary",type:"submit",disabled:!c,loading:s,children:"Save and close"})]})})]})]})})},We=t=>{var n;return{media:{images:((n=t.images)==null?void 0:n.map(r=>({url:r.url,selected:!1})))||[]}}},ri=({product:t})=>{const{state:n,close:r,toggle:i}=J();return a(X,{children:[e(de,{title:"Media",actions:[{label:"Edit Media",onClick:i}],children:t.images&&t.images.length>0&&e("div",{className:"grid grid-cols-3 gap-xsmall mt-base",children:t.images.map((l,c)=>e("div",{className:"aspect-square flex items-center justify-center",children:e("img",{src:l.url,alt:`Image ${c+1}`,className:"object-contain rounded-rounded max-w-full max-h-full"})},l.id))})}),e(ni,{product:t,open:n,onClose:r})]})},ii=({product:t})=>e(de,{title:"Raw Product",children:e("div",{className:"pt-base",children:e(er,{data:t})})}),rn=({form:t})=>{const{control:n,path:r}=t,{fields:i,remove:s,replace:l,append:c}=re({control:n,name:r("images")});return a("div",{children:[e("div",{children:e("div",{className:"mt-large",children:e(zt,{onFileChosen:o=>{const d=o.map(m=>({url:URL.createObjectURL(m),name:m.name,size:m.size,nativeFile:m,selected:!1}));o.length?l(d):c(d)},placeholder:"1200 x 1600 (3:4) recommended, up to 10MB each",filetypes:["image/gif","image/jpeg","image/png","image/webp"],className:"py-large"})})}),i.length>0&&a("div",{className:"mt-large",children:[e("h2",{className:"inter-large-semibold mb-small",children:"Upload"}),e("div",{className:"flex flex-col gap-y-2xsmall",children:i.map((o,d)=>e(si,{image:o,index:d,remove:s},o.id))})]})]})},si=({image:t,index:n,remove:r})=>{const i=[{label:"Delete",onClick:()=>r(n),icon:e(le,{size:20}),variant:"danger"}];return a("div",{className:"px-base py-xsmall group hover:bg-grey-5 rounded-rounded flex items-center justify-between",children:[a("div",{className:"flex items-center gap-x-large",children:[e("div",{className:"w-16 h-16 flex items-center justify-center",children:e("img",{src:t.url,alt:t.name||"Uploaded image",className:"max-w-[64px] max-h-[64px] rounded-rounded"})}),a("div",{className:"flex flex-col inter-small-regular text-left",children:[e("p",{children:t.name}),e("p",{className:"text-grey-50",children:t.size?`${(t.size/1024).toFixed(2)} KB`:""})]})]}),e(we,{actions:i,forceDropdown:!0})]})},ai=({product:t,open:n,onClose:r})=>{const{onUpdate:i,updating:s}=ie(t.id),l=ee({defaultValues:Ye(t)}),{formState:{isDirty:c},handleSubmit:u,reset:o}=l,d=ae();p.useEffect(()=>{o(Ye(t))},[t]);const m=()=>{o(Ye(t)),r()},g=u(async h=>{var w;let v=[];try{v=await Te(h.thumbnail.images)}catch(y){let f="Something went wrong while trying to upload the thumbnail.";y.response.status===500&&(f=f+" You might not have a file service configured. Please contact your administrator"),d("Error",f,"error");return}const N=(w=v==null?void 0:v[0])==null?void 0:w.url;i({thumbnail:N||null},m)});return e(k,{open:n,handleClose:m,isLargeModal:!0,children:a(k.Body,{children:[e(k.Header,{handleClose:m,children:e("h1",{className:"inter-xlarge-semibold m-0",children:"Upload Thumbnail"})}),a("form",{onSubmit:g,children:[a(k.Content,{children:[e("h2",{className:"inter-large-semibold mb-2xsmall",children:"Thumbnail"}),e("p",{className:"inter-base-regular text-grey-50 mb-large",children:"Used to represent your product during checkout, social sharing and more."}),e(rn,{form:H(l,"thumbnail")})]}),e(k.Footer,{children:a("div",{className:"flex gap-x-2 justify-end w-full",children:[e(_,{size:"small",variant:"secondary",type:"button",onClick:m,children:"Cancel"}),e(_,{size:"small",variant:"primary",type:"submit",disabled:!c,loading:s,children:"Save and close"})]})})]})]})})},Ye=t=>({thumbnail:{images:t.thumbnail?[{url:t.thumbnail}]:[]}}),li=({product:t})=>{const{onUpdate:n,updating:r}=ie(t.id),{state:i,toggle:s,close:l}=J(),c=ae(),u=()=>{n({thumbnail:null},{onSuccess:()=>{c("Success","Successfully deleted thumbnail","success")},onError:o=>{c("Error",te(o),"error")}})};return a(X,{children:[e(de,{title:"Thumbnail",customActions:a("div",{className:"flex items-center gap-x-xsmall",children:[e(_,{variant:"secondary",size:"small",type:"button",onClick:s,children:t.thumbnail?"Edit":"Upload"}),t.thumbnail&&e(tr,{onDelete:u,deleting:r})]}),children:e("div",{className:Q("grid grid-cols-3 gap-xsmall mt-base",{hidden:!t.thumbnail}),children:t.thumbnail&&e("div",{className:"aspect-square flex items-center justify-center",children:e("img",{src:t.thumbnail,alt:`Thumbnail for ${t.title}`,className:"object-contain rounded-rounded max-w-full max-h-full"})})})}),e(ai,{product:t,open:i,onClose:l})]})},sn=({form:t})=>{const{path:n,register:r,formState:{errors:i}}=t;return a("div",{children:[e("p",{className:"inter-base-regular text-grey-50",children:"Configure the general information for this variant."}),e("div",{className:"pt-large",children:a("div",{className:"grid grid-cols-2 gap-x-large",children:[e($,{label:"Custom title",placeholder:"Green / XL...",...r(n("title"),{pattern:Z.whiteSpaceRule("Title")}),errors:i}),e($,{label:"Material",placeholder:"80% wool, 20% cotton...",...t.register(n("material"),{pattern:Z.whiteSpaceRule("Material")}),errors:i})]})})]})},oi=({size:t="20",color:n="currentColor",...r})=>e("svg",{width:t,height:t,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r,children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.6469 8.76191L8.88455 6.00494C8.40459 5.65352 7.82341 5.68718 7.39745 5.97365C6.98931 6.24815 6.75 6.72509 6.75 7.24299V12.7572C6.75 13.275 6.98929 13.7521 7.39756 14.0265C7.8237 14.313 8.4047 14.3465 8.88451 13.9949M8.88451 13.9949L12.6469 11.2382C13.0771 10.9231 13.25 10.4291 13.25 10.0001C13.25 9.57108 13.0771 9.07707 12.6469 8.76191",fill:n})}),ci=({form:t,nestedPrice:n})=>{const{state:r,toggle:i}=J(),{control:s,path:l}=t,{currencyPrice:c,regionPrices:u}=n;return a("div",{className:"flex flex-col gap-y-2xsmall",children:[a("div",{className:"relative grid grid-cols-[1fr_223px] gap-x-base p-2xsmall pl-10 hover:bg-grey-5 focus-within:bg-grey-5 transition-colors rounded-rounded justify-between",children:[e("button",{className:Q("absolute top-1/2 -translate-y-1/2 left-xsmall text-grey-40 transition-all",{"rotate-90":r},{hidden:u.length===0}),type:"button",onClick:i,disabled:u.length===0,children:e(oi,{})}),a("div",{className:"flex items-center gap-x-small",children:[e("div",{className:"w-10 h-10 bg-grey-10 rounded-rounded text-grey-50 flex items-center justify-center",children:e($n,{size:20})}),a("div",{className:"flex items-center gap-x-xsmall",children:[e("span",{className:"inter-base-semibold",children:c.currency_code.toUpperCase()}),e("span",{className:"inter-base-regular text-grey-50",children:sr[c.currency_code.toUpperCase()].name}),e(ft,{includesTax:c==null?void 0:c.includes_tax})]})]}),e(K,{name:l(`prices.${c.index}.amount`),control:s,render:({field:{value:o,onChange:d},formState:{errors:m}})=>e(yt,{onChange:d,amount:o!==null?o:void 0,currencyCode:c.currency_code,errors:m})})]}),e("ul",{className:Q("flex flex-col gap-y-2xsmall my-2xsmall overflow-hidden",{"max-h-0":!r,"max-h-[9999px]":r}),children:u.map(o=>a("div",{className:"grid grid-cols-[1fr_223px] p-2xsmall pl-10 hover:bg-grey-5 focus-within:bg-grey-5 transition-colors rounded-rounded justify-between",children:[a("div",{className:"flex items-center gap-x-small",children:[e("div",{className:"w-10 h-10 bg-grey-10 rounded-rounded text-grey-50 flex items-center justify-center",children:e(Wn,{size:20})}),a("div",{className:"flex items-center gap-x-xsmall",children:[e("span",{className:"inter-base-regular text-grey-50",children:o.regionName}),e(ft,{includesTax:o.includes_tax})]})]}),e(K,{name:l(`prices.${o.index}.amount`),control:s,render:({field:{value:d,onChange:m},formState:{errors:g}})=>e(yt,{onChange:m,amount:d!==null?d:void 0,currencyCode:c.currency_code,errors:g})})]},o.id))})]},c.id)},di=({form:t})=>{const{store:n}=lt(),{regions:r}=_n(),{control:i,path:s}=t,{append:l,update:c,fields:u}=re({control:i,name:s("prices")});p.useEffect(()=>{!r||!n||!u||(r.forEach(d=>{u.some(m=>m.region_id===d.id)||l({id:null,region_id:d.id,amount:null,currency_code:d.currency_code,includes_tax:d.includes_tax})}),n.currencies.forEach(d=>{u.some(m=>m.currency_code===d.code)||l({id:null,currency_code:d.code,amount:null,region_id:null,includes_tax:d.includes_tax})}))},[r,n,u]),p.useEffect(()=>{!r||!u||!n||(r.forEach(d=>{const m=u.findIndex(g=>!!g&&g.region_id===d.id);m!==-1&&u[m].includes_tax!==d.includes_tax&&c(m,{...u[m],includes_tax:d.includes_tax})}),n.currencies.forEach(d=>{const m=u.findIndex(g=>!!g&&!g.region_id&&g.currency_code===d.code);m!==-1&&u[m].includes_tax!==d.includes_tax&&c(m,{...u[m],includes_tax:d.includes_tax})}))},[r,n]);const o=p.useMemo(()=>{const d={},m=u.filter(h=>h.region_id===null),g=u.filter(h=>h.region_id!==null);return m.forEach(h=>{d[h.currency_code]={currencyPrice:{...h,index:u.indexOf(h)},regionPrices:g.filter(v=>v.currency_code===h.currency_code).map(v=>{var N;return{...v,regionName:((N=r==null?void 0:r.find(w=>w.id===v.region_id))==null?void 0:N.name)||"",index:u.indexOf(v)}})}}),d},[u,r]);return e("div",{children:e("div",{children:Object.values(o).map(d=>e(ci,{form:t,nestedPrice:d},d.currencyPrice.id))})})},an=({form:t})=>a("div",{children:[e("p",{className:"inter-base-regular text-grey-50",children:"Configure the pricing for this variant."}),e("div",{className:"pt-large",children:e(di,{form:t})})]}),ln=({form:t})=>{const{path:n,control:r,register:i,formState:{errors:s}}=t;return a("div",{children:[e("p",{className:"inter-base-regular text-grey-50",children:"Configure the inventory and stock for this variant."}),a("div",{className:"pt-large flex flex-col gap-y-xlarge",children:[a("div",{className:"flex flex-col gap-y-2xsmall",children:[a("div",{className:"flex items-center justify-between",children:[e("h3",{className:"inter-base-semibold mb-2xsmall",children:"Manage inventory"}),e(K,{control:r,name:n("manage_inventory"),render:({field:{value:l,onChange:c}})=>e(Pe,{checked:l,onCheckedChange:c})})]}),e("p",{className:"inter-base-regular text-grey-50",children:"When checked Medusa will regulate the inventory when orders and returns are made."})]}),a("div",{className:"flex flex-col gap-y-2xsmall",children:[a("div",{className:"flex items-center justify-between",children:[e("h3",{className:"inter-base-semibold mb-2xsmall",children:"Allow backorders"}),e(K,{control:r,name:n("allow_backorder"),render:({field:{value:l,onChange:c}})=>e(Pe,{checked:l,onCheckedChange:c})})]}),e("p",{className:"inter-base-regular text-grey-50",children:"When checked the product will be available for purchase despite the product being sold out"})]}),a("div",{className:"grid grid-cols-2 gap-large",children:[e($,{label:"Stock keeping unit (SKU)",placeholder:"SUN-G, JK1234...",...i(n("sku"))}),e($,{label:"Quantity in stock",type:"number",placeholder:"100...",errors:s,...i(n("inventory_quantity"),{valueAsNumber:!0})}),e($,{label:"EAN (Barcode)",placeholder:"123456789102...",...i(n("ean"))}),e($,{label:"UPC (Barcode)",placeholder:"023456789104...",...i(n("upc"))}),e($,{label:"Barcode",placeholder:"123456789104...",...i(n("barcode"))})]})]})]})},ht=({form:t})=>{const{fields:n}=re({control:t.control,name:"options"});return a(Y,{type:"multiple",defaultValue:["general"],children:[e(Y.Item,{title:"General",value:"general",required:!0,children:a("div",{children:[e(sn,{form:H(t,"general")}),a("div",{className:"mt-xlarge",children:[a("div",{className:"flex items-center gap-x-2xsmall mb-base",children:[e("h3",{className:"inter-base-semibold",children:"Options"}),e(he,{type:"info",content:"Options are used to define the color, size, etc. of the variant."})]}),e("div",{className:"grid grid-cols-2 gap-large pb-2xsmall",children:n.map((r,i)=>e($,{required:!0,label:r.title,...t.register(`options.${i}.value`,{required:`Option value for ${r.title} is required`}),errors:t.formState.errors},r.id))})]})]})}),e(Y.Item,{title:"Pricing",value:"pricing",children:e(an,{form:H(t,"prices")})}),e(Y.Item,{title:"Stock & Inventory",value:"stock",children:e(ln,{form:H(t,"stock")})}),a(Y.Item,{title:"Shipping",value:"shipping",children:[e("p",{className:"inter-base-regular text-grey-50",children:"Shipping information can be required depending on your shipping provider, and whether or not you are shipping internationally."}),a("div",{className:"mt-large",children:[e("h3",{className:"inter-base-semibold mb-2xsmall",children:"Dimensions"}),e("p",{className:"inter-base-regular text-grey-50 mb-large",children:"Configure to calculate the most accurate shipping rates."}),e(ze,{form:H(t,"dimensions")})]}),a("div",{className:"mt-xlarge",children:[e("h3",{className:"inter-base-semibold mb-2xsmall",children:"Customs"}),e("p",{className:"inter-base-regular text-grey-50 mb-large",children:"Configure if you are shipping internationally."}),e(Ae,{form:H(t,"customs")})]})]})]})},ui=({open:t,onClose:n,product:r})=>{const i=ee({defaultValues:Ge(r)}),{onAddVariant:s,addingVariant:l}=ie(r.id),{handleSubmit:c,reset:u}=i;p.useEffect(()=>{u(Ge(r))},[r]);const o=()=>{u(Ge(r)),n()},d=c(m=>{s(on(m),o)});return e(k,{open:t,handleClose:o,children:a(k.Body,{children:[e(k.Header,{handleClose:o,children:e("h1",{className:"inter-xlarge-semibold",children:"Add Variant"})}),a("form",{onSubmit:d,children:[e(k.Content,{children:e(ht,{form:i})}),e(k.Footer,{children:a("div",{className:"flex items-center gap-x-xsmall justify-end w-full",children:[e(_,{variant:"secondary",size:"small",type:"button",onClick:o,children:"Cancel"}),e(_,{variant:"primary",size:"small",type:"submit",loading:l,children:"Save and close"})]})})]})]})})},Ge=t=>{const n=t.options.map(r=>({title:r.title,id:r.id,value:""}));return{general:{title:null,material:null},stock:{sku:null,ean:null,upc:null,barcode:null,inventory_quantity:null,manage_inventory:!1,allow_backorder:!1},options:n,prices:{prices:[]},dimensions:{weight:null,width:null,height:null,length:null},customs:{mid_code:null,hs_code:null,origin_country:null}}},on=t=>{const{general:n,stock:r,options:i,prices:s,dimensions:l,customs:c}=t,u=s.prices.filter(o=>typeof o.amount=="number").map(o=>({amount:o.amount,currency_code:o.region_id?void 0:o.currency_code,region_id:o.region_id}));return{...n,...c,...r,inventory_quantity:r.inventory_quantity||0,...l,...c,origin_country:c.origin_country?c.origin_country.value:null,prices:u,title:t.general.title||`${i==null?void 0:i.map(o=>o.value).join(" / ")}`,options:i.map(o=>({option_id:o.id,value:o.value}))}},cn=ot.createContext(null),mi=()=>{const t=p.useContext(cn);if(t===null)throw new Error("useEditVariantsModal must be used within a EditVariantsModalProvicer");return t},hi=({variant:t,product:n})=>{const{onClose:r}=mi(),i=ee({defaultValues:xe(t,n)}),{pop:s,reset:l}=p.useContext(Re),{updatingVariant:c,onUpdateVariant:u}=ie(n.id),o=()=>{i.reset(xe(t,n)),s()},d=()=>{i.reset(xe(t,n)),l(),r()};p.useEffect(()=>{i.reset(xe(t,n))},[t,n]);const m=i.handleSubmit(h=>{u(t.id,it(h),o)}),g=i.handleSubmit(h=>{u(t.id,it(h),d)});return e(X,{children:a("form",{noValidate:!0,children:[e(k.Content,{children:e(ht,{form:i})}),e(k.Footer,{children:a("div",{className:"flex items-center w-full justify-end gap-x-xsmall",children:[e(_,{variant:"secondary",size:"small",type:"button",children:"Cancel"}),e(_,{variant:"primary",size:"small",type:"button",disabled:c||!i.formState.isDirty,loading:c,onClick:m,children:"Save and go back"}),e(_,{variant:"primary",size:"small",type:"button",disabled:c||!i.formState.isDirty,loading:c,onClick:g,children:"Save and close"})]})})]})})},it=t=>{const{customs:n,dimensions:r,prices:i,options:s,general:l,stock:c}=t,u=i.prices.filter(o=>typeof o.amount=="number").map(o=>({amount:o.amount,currency_code:o.region_id?void 0:o.currency_code,region_id:o.region_id,id:o.id||void 0}));return{...l,...n,...c,...r,...n,origin_country:n.origin_country?n.origin_country.value:null,prices:u,options:s.map(o=>({option_id:o.id,value:o.value}))}},gi=t=>{const{pop:n}=ot.useContext(Re);return p.useMemo(()=>({title:"Edit Variant",subtitle:t.variant.title,onBack:n,view:e(hi,{...t})}),[t])},pi=({onClose:t,product:n,variant:r,isDuplicate:i=!1})=>{const s=ee({defaultValues:xe(r,n)}),{formState:{isDirty:l},handleSubmit:c,reset:u}=s,o=()=>{u(xe(r,n)),t()},{onUpdateVariant:d,onAddVariant:m,addingVariant:g,updatingVariant:h}=ie(n.id),v=c(N=>{i?m(on(N),o):d(r.id,it(N),o)});return a(k,{handleClose:o,children:[e(k.Header,{handleClose:o,children:a("h1",{className:"inter-xlarge-semibold",children:["Edit Variant",r.title&&a("span",{className:"text-grey-50 inter-xlarge-regular",children:[" ","(",r.title,")"]})]})}),a("form",{onSubmit:v,noValidate:!0,children:[e(k.Content,{children:e(ht,{form:s})}),e(k.Footer,{children:a("div",{className:"w-full flex items-center gap-x-xsmall justify-end",children:[e(_,{variant:"secondary",size:"small",type:"button",onClick:o,children:"Cancel"}),e(_,{variant:"primary",size:"small",type:"submit",disabled:!l&&!i,loading:g||h,children:"Save and close"})]})})]})]})},xe=(t,n)=>{const r=n.options.map(l=>{var c;return{title:l.title,id:l.id,value:((c=t.options.find(u=>u.option_id===l.id))==null?void 0:c.value)||""}}),i=ct.find(l=>{var c;return l.name.toLowerCase()===((c=t.origin_country)==null?void 0:c.toLowerCase())}),s=i?{label:i.name,value:i.alpha2}:null;return{general:{title:t.title,material:t.material},stock:{sku:t.sku,ean:t.ean,inventory_quantity:t.inventory_quantity,manage_inventory:t.manage_inventory,allow_backorder:t.allow_backorder,barcode:t.barcode,upc:t.upc},customs:{hs_code:t.hs_code,mid_code:t.mid_code,origin_country:s},dimensions:{weight:t.weight,width:t.width,height:t.height,length:t.length},prices:{prices:t.prices.map(l=>({id:l.id,amount:l.amount,currency_code:l.currency_code,region_id:l.region_id}))},options:r}},dn=({size:t="24px",color:n="currentColor",...r})=>a("svg",{width:t,height:t,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r,children:[e("path",{d:"M7.49935 10.8337C7.95959 10.8337 8.33268 10.4606 8.33268 10.0003C8.33268 9.54009 7.95959 9.16699 7.49935 9.16699C7.03911 9.16699 6.66602 9.54009 6.66602 10.0003C6.66602 10.4606 7.03911 10.8337 7.49935 10.8337Z",stroke:n,strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M7.49935 4.99967C7.95959 4.99967 8.33268 4.62658 8.33268 4.16634C8.33268 3.7061 7.95959 3.33301 7.49935 3.33301C7.03911 3.33301 6.66602 3.7061 6.66602 4.16634C6.66602 4.62658 7.03911 4.99967 7.49935 4.99967Z",stroke:n,strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M7.49935 16.6667C7.95959 16.6667 8.33268 16.2936 8.33268 15.8333C8.33268 15.3731 7.95959 15 7.49935 15C7.03911 15 6.66602 15.3731 6.66602 15.8333C6.66602 16.2936 7.03911 16.6667 7.49935 16.6667Z",stroke:n,strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M12.4993 10.8337C12.9596 10.8337 13.3327 10.4606 13.3327 10.0003C13.3327 9.54009 12.9596 9.16699 12.4993 9.16699C12.0391 9.16699 11.666 9.54009 11.666 10.0003C11.666 10.4606 12.0391 10.8337 12.4993 10.8337Z",stroke:n,strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M12.4993 4.99967C12.9596 4.99967 13.3327 4.62658 13.3327 4.16634C13.3327 3.7061 12.9596 3.33301 12.4993 3.33301C12.0391 3.33301 11.666 3.7061 11.666 4.16634C11.666 4.62658 12.0391 4.99967 12.4993 4.99967Z",stroke:n,strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M12.4993 16.6667C12.9596 16.6667 13.3327 16.2936 13.3327 15.8333C13.3327 15.3731 12.9596 15 12.4993 15C12.0391 15 11.666 15.3731 11.666 15.8333C11.666 16.2936 12.0391 16.6667 12.4993 16.6667Z",stroke:n,strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})]}),vt={CARD:"card"},fi=({id:t,index:n,ean:r,sku:i,title:s,moveCard:l,product:c})=>{const{register:u,formState:{errors:o}}=Gn(),d=gi({product:c,variant:c.variants.find(b=>b.id===t)}),{push:m}=p.useContext(Re),g=p.useMemo(()=>[{label:"Edit Variant",icon:e(ce,{size:20,className:"text-grey-50"}),onClick:()=>m(d)}],[d,m]),h=p.useRef(null),[{handlerId:v},N]=Jt({accept:vt.CARD,collect(b){return{handlerId:b.getHandlerId()}},hover(b,x){var I;if(!h.current)return;const T=b.index,V=n;if(T===V)return;const L=(I=h.current)==null?void 0:I.getBoundingClientRect(),F=(L.bottom-L.top)/2,O=x.getClientOffset().y-L.top;T<V&&O<F||T>V&&O>F||(l(T,V),b.index=V)}}),[{isDragging:w},y,f]=Zt({type:vt.CARD,item:()=>({id:t,index:n}),collect:b=>({isDragging:b.isDragging()})});return y(N(h)),a("div",{ref:f,"data-handler-id":v,className:Q("grid grid-cols-[32px_1fr_1fr_48px] transition-all rounded-rounded hover:bg-grey-5 focus-within:bg-grey-5 h-16 py-xsmall pl-xsmall pr-base translate-y-0 translate-x-0",{"bg-grey-5 opacity-50":w}),children:[e("div",{className:"text-grey-40 cursor-move flex items-center justify-center",ref:h,children:e(dn,{size:20})}),a("div",{className:"flex flex-col text-left ml-base justify-center",children:[a("p",{className:"inter-base-semibold",children:[s,i&&a("span",{className:"text-grey-50 inter-base-regular",children:["(",i,")"]})]}),r&&e("span",{className:"inter-base-regular text-grey-50",children:r})]}),e("div",{className:"text-right flex items-center justify-end",children:e($,{...u(`variants.${n}.inventory_quantity`,{min:Z.nonNegativeNumberRule("Inventory"),valueAsNumber:!0}),type:"number",placeholder:"100...",className:"max-w-[200px]",errors:o})}),e("div",{className:"ml-xlarge flex items-center justify-center pr-base",children:e(we,{forceDropdown:!0,actions:g,customTrigger:e(_,{variant:"ghost",className:"w-xlarge h-xlarge p-0 flex items-center justify-center text-grey-50",children:e(mt,{size:20})})})})]})},yi=({open:t,onClose:n,product:r})=>{const i=p.useContext(Re),{onUpdate:s,updating:l}=ie(r.id),c=ee({defaultValues:xt(r)}),{control:u,handleSubmit:o,reset:d,formState:{isDirty:m}}=c,{fields:g,move:h}=re({control:u,name:"variants",keyName:"fieldId"}),v=p.useCallback((b,x)=>{h(b,x)},[]),N=p.useCallback((b,x)=>e(fi,{index:x,id:b.id,title:b.title,ean:b.ean,sku:b.sku,inventory_quantity:b.inventory_quantity,moveCard:v,product:r},b.fieldId),[r]),w=()=>{d(xt(r))},y=()=>{w(),i.reset(),n()};p.useEffect(()=>{w()},[r]);const f=o(b=>{s({variants:b.variants.map(x=>({id:x.id,inventory_quantity:x.inventory_quantity}))},()=>{y()},"Variants were successfully updated")});return e(cn.Provider,{value:{onClose:n},children:e(In,{handleClose:y,open:t,context:i,children:a(k.Body,{children:[e(k.Header,{handleClose:y,children:e("h1",{className:"inter-xlarge-semibold",children:"Edit Variants"})}),e(Zn,{...c,children:a("form",{onSubmit:f,children:[a(k.Content,{children:[a("h2",{className:"inter-base-semibold mb-small",children:["Product variants"," ",a("span",{className:"inter-base-regular text-grey-50",children:["(",r.variants.length,")"]})]}),a("div",{className:"grid grid-cols-[1fr_1fr_48px] pr-base inter-small-semibold text-grey-50 mb-small",children:[e("p",{className:"col-start-1 col-end-1 text-left",children:"Variant"}),e("p",{className:"col-start-2 col-end-2 text-right",children:"Inventory"})]}),e("div",{children:g.map((b,x)=>N(b,x))})]}),e(k.Footer,{children:a("div",{className:"flex items-center gap-x-xsmall justify-end w-full",children:[e(_,{variant:"secondary",size:"small",type:"button",onClick:y,children:"Cancel"}),e(_,{variant:"primary",size:"small",type:"submit",loading:l,disabled:l||!m,children:"Save and close"})]})})]})})]})})})},xt=t=>({variants:(t.variants||[]).sort((i,s)=>i.variant_rank-s.variant_rank).map((i,s)=>({id:i.id,title:i.title,ean:i.ean,sku:i.sku,variant_rank:i.variant_rank||s+1,inventory_quantity:i.inventory_quantity}))}),un=p.createContext(null),bi=({product:t,children:n})=>{const{products:r,status:i,refetch:s}=_t({id:t.id,expand:"options,options.values"}),l=p.useMemo(()=>{if(r&&r.length>0&&i!=="loading")return r[0].options},[r,i]);return e(un.Provider,{value:{options:l,status:i,refetch:s},children:n})},mn=()=>{const t=p.useContext(un);if(!t)throw new Error("useOptionsContext must be used within a OptionsProvider");return t},vi=({product:t,open:n,onClose:r})=>{const{mutate:i,isLoading:s}=Pn(t.id),{mutate:l,isLoading:c}=Tn(t.id),{mutate:u,isLoading:o}=On(t.id),{refetch:d}=mn(),{control:m,register:g,reset:h,handleSubmit:v,formState:{isDirty:N,errors:w}}=ee({defaultValues:Ze(t)}),{fields:y,remove:f,append:b}=re({name:"options",control:m,shouldUnregister:!0}),x=ae();p.useEffect(()=>{h(Ze(t))},[t]);const T=()=>{h(Ze(t)),r()},V=()=>{b({title:"",id:null})},L=p.useMemo(()=>s||c||o,[s,c,o]),F=v(R=>{const O=[],I=[],j=[],B=t.options.filter(D=>R.options.find(C=>C.id===D.id)===void 0);if(R.options.forEach(D=>{D.id?j.push(D):I.push(D)}),I.forEach(D=>{l({title:D.title},{onError:()=>{O.push(`create ${D.title}`)},onSuccess:()=>{d()}})}),j.forEach(D=>{i({option_id:D.id,title:D.title},{onError:()=>{O.push(`update ${D.title}`)},onSuccess:()=>{d()}})}),B.forEach(D=>{u(D.id,{onError:()=>{O.push(`delete ${D.title}`)},onSuccess:()=>{d()}})}),O.length===I.length+j.length+B.length){x("Error","Failed to update product options","error");return}O.length>0&&x("Warning","Failed to; "+O.join(", ")+".","warning"),d(),x("Success","Successfully updated product options","success"),T()});return e(k,{open:n,handleClose:T,children:a(k.Body,{children:[e(k.Header,{handleClose:T,children:e("h1",{className:"inter-xlarge-semibold",children:"Edit Options"})}),a("form",{onSubmit:F,children:[a(k.Content,{children:[e("h2",{className:"inter-large-semibold mb-base",children:"Product options"}),a("div",{className:"flex flex-col gap-y-small",children:[e("p",{className:"inter-small-semibold text-grey-50",children:"Option title"}),e("div",{className:"flex flex-col gap-y-xsmall",children:y.map((R,O)=>a("div",{className:"grid grid-cols-[1fr,40px] gap-x-xsmall",children:[e($,{placeholder:"Color",...g(`options.${O}.title`,{required:"Option title is required",minLength:Z.minOneCharRule("Option title"),pattern:Z.whiteSpaceRule("Option title")}),errors:w},R.id),e(_,{variant:"secondary",className:"px-2.5 py-2.5 max-h-[40px]",type:"button",onClick:()=>f(O),children:e(le,{className:"text-grey-40",size:"20"})})]},R.id))})]}),a(_,{variant:"secondary",className:"w-full h-10 mt-base",type:"button",onClick:V,children:[e(Ce,{size:"20"})," Add an option"]})]}),e(k.Footer,{children:a("div",{className:"flex items-center justify-end gap-xsmall w-full",children:[e(_,{variant:"secondary",size:"small",type:"button",onClick:T,children:"Cancel"}),e(_,{variant:"primary",size:"small",type:"submit",disabled:!N,loading:L,children:"Save and close"})]})})]})]})})},Ze=t=>({options:t.options.map(n=>({title:n.title,id:n.id}))}),xi=()=>p.useMemo(()=>[{Header:"Title",id:"title",accessor:"title"},{Header:"SKU",id:"sku",accessor:"sku",maxWidth:264,Cell:({cell:n})=>n.value?n.value:e("span",{className:"text-grey-50",children:"-"})},{Header:"EAN",id:"ean",accessor:"ean",maxWidth:264,Cell:({cell:n})=>n.value?n.value:e("span",{className:"text-grey-50",children:"-"})},{Header:()=>e("div",{className:"text-right",children:e("span",{children:"Inventory"})}),id:"inventory",accessor:"inventory_quantity",maxWidth:56,Cell:({cell:n})=>e("div",{className:"text-right",children:e("span",{children:n.value})})}],[]),Ci=({variants:t,actions:n})=>{const r=xi(),{getTableProps:i,getTableBodyProps:s,headerGroups:l,rows:c,prepareRow:u}=Oe.useTable({columns:r,data:t,defaultColumn:{width:"auto"}}),{deleteVariant:o,updateVariant:d,duplicateVariant:m}=n;return a(q,{...i(),className:"table-fixed",children:[e(q.Head,{children:l==null?void 0:l.map(g=>e(q.HeadRow,{...g.getHeaderGroupProps(),children:g.headers.map(h=>e(q.HeadCell,{...h.getHeaderProps(),children:h.render("Header")}))}))}),e(q.Body,{...s(),children:c.map(g=>(u(g),a(q.Row,{color:"inherit",...g.getRowProps(),children:[g.cells.map(h=>e(q.Cell,{...h.getCellProps(),children:h.render("Cell")})),e(q.Cell,{children:e("div",{className:"float-right",children:e(we,{forceDropdown:!0,actions:[{label:"Edit Variant",icon:e(ce,{size:"20"}),onClick:()=>d(g.original)},{label:"Duplicate Variant",onClick:()=>m({...g.original,title:g.original.title+" Copy"}),icon:e(Lt,{size:"20"})},{label:"Delete Variant",onClick:()=>o(g.original.id),icon:e(le,{size:"20"}),variant:"danger"}]})})})]})))})]})},Ni=({product:t})=>{const[n,r]=p.useState(void 0),{state:i,close:s,toggle:l}=J(),{state:c,close:u,toggle:o}=J(),{state:d,close:m,toggle:g}=J(),h=[{label:"Add Variant",onClick:o,icon:e(Ce,{size:"20"})},{label:"Edit Variants",onClick:g,icon:e(ce,{size:"20"})},{label:"Edit Options",onClick:l,icon:e(ir,{size:"20"})}],{onDeleteVariant:v}=ie(t.id),N=f=>{v(f)},w=f=>{r({base:f,isDuplicate:!1})},y=f=>{r({base:{...f,options:[]},isDuplicate:!0})};return a(bi,{product:t,children:[a(de,{title:"Variants",actions:h,children:[e(wi,{}),a("div",{className:"mt-xlarge",children:[a("h2",{className:"inter-large-semibold mb-base",children:["Product variants"," ",a("span",{className:"inter-large-regular text-grey-50",children:["(",t.variants.length,")"]})]}),e(Ci,{variants:t.variants,actions:{deleteVariant:N,updateVariant:w,duplicateVariant:y}})]})]}),e(vi,{open:i,onClose:s,product:t}),e(ui,{open:c,onClose:u,product:t}),e(yi,{open:d,onClose:m,product:t}),n&&e(pi,{variant:n.base,isDuplicate:n.isDuplicate,product:t,onClose:()=>r(void 0)})]})},wi=()=>{const{options:t,status:n}=mn();return n==="error"?null:n==="loading"||!t?e("div",{className:"mt-base grid grid-cols-3 gap-x-8",children:Array.from(Array(2)).map((r,i)=>a("div",{children:[e("div",{className:"bg-grey-30 h-6 w-9 animate-pulse mb-xsmall"}),e("ul",{className:"flex flex-wrap items-center gap-1",children:Array.from(Array(3)).map((s,l)=>e("li",{children:e("div",{className:"text-grey-50 bg-grey-10 h-8 w-12 animate-pulse rounded-rounded",children:l})},l))})]},i))}):e("div",{className:"mt-base flex items-center flex-wrap gap-8",children:t.map(r=>{var i;return a("div",{children:[e("h3",{className:"inter-base-semibold mb-xsmall",children:r.title}),e("ul",{className:"flex flex-wrap items-center gap-1",children:(i=r.values)==null?void 0:i.map(s=>s.value).filter((s,l,c)=>c.indexOf(s)===l).map((s,l)=>e("li",{children:e("div",{className:"text-grey-50 bg-grey-10 inter-small-semibold px-3 py-[6px] rounded-rounded whitespace-nowrap",children:s})},l))})]},r.id)})})};new Date().getTime();function Si({product:t}){const{mutate:n}=It(`/product/description/${t.id}`,["product-description",t.id]),{data:r,isLoading:i}=Ve(`/product/description/${t==null?void 0:t.id}`,["product-description",t==null?void 0:t.id],void 0,{refetchOnMount:!0,cacheTime:0,enabled:!!t}),[s,l]=p.useState(!0),c=async()=>{if(!u.current)return;const d=u.current.getContent();console.log({content:d}),d&&n({content:d},{onSuccess(){l(!0)}})},u=p.useRef(null),o=p.useRef(null);return a(de,{children:[a("div",{className:"mb-3 flex items-center",children:[e("div",{children:e("h1",{className:"text-lg font-semibold",children:"Product Description"})}),e("div",{className:"ml-auto flex items-start gap-2",children:e(_,{variant:"primary",size:"small",onClick:c,disabled:s,children:i?e(Fe,{}):"Save"})})]}),e(Ut,{onInit:(d,m)=>u.current=m,initialValue:(r==null?void 0:r.content)??"<p>This is the initial content of the editor</p>",init:{height:500,menubar:!0,plugins:["advlist","autolink","lists","link","image","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","code","wordcount"],toolbar:"undo redo | styleselect | bold italic forecolor | link | image",color_cols:5,a11y_advanced_options:!0,automatic_uploads:!0,file_picker_types:"image",file_picker_callback(d,m,g){o.current&&(o.current.addEventListener("change",h=>{var w;const v=(w=h.target)!=null&&w.files?h.target.files[0]:null;if(!v||!u.current)return;const N=new FileReader;N.addEventListener("load",()=>{const y="blobid"+new Date().getTime(),f=u.current.editorUpload.blobCache,b=N.result.split(",")[1],x=f.create(y,v,b);f.add(x),d(x.blobUri(),{title:v.name})}),N.readAsDataURL(v)}),o.current.click())},content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"},tinymceScriptSrc:"/tinymce/js/tinymce/tinymce.min.js",onEditorChange:d=>{d!==(r==null?void 0:r.content)?l(!1):l(!0)}}),e("input",{type:"file",accept:"image/*",ref:o,hidden:!0})]})}function ki({review:t,open:n,onClose:r}){const{handleSubmit:i,reset:s,register:l,control:c,formState:u}=ee({defaultValues:Ct(t)}),{mutate:o,isLoading:d}=It(`/product-reviews/${t==null?void 0:t.id}/update`,["product-reviews",t==null?void 0:t.id]),m=async y=>{let f=[];try{f=await Te(y.images)}catch(x){console.log({error:x})}const b=f.map(x=>x.url);o({...y,images:b},{onSuccess:()=>{g()}})},g=()=>{s(Ct(t)),r()},{isDirty:h}=u,{fields:v,remove:N}=re({control:c,name:"images"}),w=y=>{N(y)};return e(k,{open:n,handleClose:r,isLargeModal:!0,children:e(k.Body,{children:a("form",{onSubmit:i(m),children:[e(k.Header,{handleClose:r,children:e("h1",{className:"inter-xlarge-semibold m-0",children:"Edit Review"})}),e(k.Content,{children:a("div",{children:[a("div",{className:"mb-3 flex w-full flex-col",children:[e("label",{htmlFor:"enabled ",className:"inter-small-semibold mb-xsmall items-center text-grey-50",children:"Enabled"}),e(K,{control:c,name:"enabled",render:({field:{value:y,onChange:f}})=>e(Pe,{checked:y,onCheckedChange:f})})]}),a("div",{className:"mb-3 flex w-full flex-col",children:[e("label",{htmlFor:"rating",className:"inter-small-semibold items-center text-grey-50",children:"Rating"}),e(K,{control:c,name:"rating",render:({field:{value:y,onChange:f}})=>e("span",{children:[...Array(5).keys()].map(b=>e("span",{className:Q(b<=y?"text-yellow-500":"text-grey-40","text-lg"),onClick:()=>f(b),children:"★"},b))})})]}),e("div",{className:"mb-3 w-full",children:e($,{label:"Title",...l("title",{required:"Title is required"})})}),e("div",{className:"mb-3 w-full",children:e($,{label:"Full Name",...l("full_name",{required:"Full name is required"})})}),e("div",{className:"mb-3 w-full",children:e(jt,{label:"Title",...l("content",{required:"Title is required"}),rows:5})}),a("div",{className:"mb-3 w-full",children:[e("label",{htmlFor:"images",className:"inter-small-semibold mb-xsmall items-center text-grey-50",children:"Images"}),e("div",{className:"flex flex-wrap gap-x-3",children:v.map((y,f)=>a("div",{className:"relative flex aspect-square max-w-[18%] items-center justify-center",children:[e("span",{className:"absolute -right-1 top-0",children:e("span",{className:"bg-grey-40 text-grey-50 hover:cursor-pointer",onClick:()=>w(f),children:e(Qn,{})})}),e("img",{src:y.url,alt:`Image ${y.id}`,className:"max-h-full max-w-full rounded-rounded object-contain"})]},y.id))})]})]})}),e(k.Footer,{children:a("div",{className:"flex w-full justify-end gap-x-2",children:[e(_,{size:"small",variant:"secondary",type:"button",onClick:g,children:"Cancel"}),e(_,{size:"small",variant:"primary",type:"submit",disabled:!h,loading:d,children:"Save and close"})]})})]})})})}function Ct(t){return{title:(t==null?void 0:t.title)??"",rating:(t==null?void 0:t.rating)??0,content:(t==null?void 0:t.content)??"",full_name:(t==null?void 0:t.full_name)??"",images:(t==null?void 0:t.images)??[],enabled:(t==null?void 0:t.enabled)??!1}}function Di({product:t}){const{data:n}=Ve(`/product-reviews/${t.id}`,["product-reviews",t.id]),{product_reviews:r=[]}=n??{},i=m=>()=>{o(m),c()},{state:s,close:l,toggle:c}=J(),[u,o]=p.useState(null),d=()=>{o(null),l()};return e(de,{title:"Reviews",children:a("div",{className:"mt-large flex flex-col gap-y-xsmall divide-y divide-gray-200",children:[r.length>0?r.map(m=>a("div",{className:"flex w-full items-start justify-between py-2",children:[a("div",{className:"md:w-1/2 w-full gap-y-0",children:[a("h3",{className:m.enabled?"inter-base-regular transition-all duration-200 hover:cursor-pointer hover:text-blue-40":"text-gray-500 inter-base-regular transition-all duration-200 hover:cursor-pointer hover:text-blue-40",onClick:i(m),children:[m.title," (",m.full_name,")"]}),e("span",{children:[...Array(5).keys()].map(g=>g<=m.rating?e("span",{className:m.enabled?"text-yellow-500":"text-yellow-100",children:"★"},g):e("span",{className:"text-gray-500",children:"★"},g))}),e("p",{className:"mt-2 text-grey-50",children:m.content}),e("span",{className:"leading-0 text-xsmall text-grey-50",children:_e(m.created_at).format("DD/MM/YYYY HH:mm")})]},m.id),e("div",{className:"md:w-1/2 flex h-full w-full items-end justify-end",children:e("div",{className:"flex w-full flex-row-reverse flex-wrap  gap-xsmall",children:m.images.map((g,h)=>e("div",{className:"flex aspect-square max-w-[18%] items-center justify-center",children:e("img",{src:g.url,alt:`Image ${h+1}`,className:"max-h-full max-w-full rounded-rounded object-contain"})},g.id))})})]})):e("div",{className:"w-full",children:"No reviews"}),u&&e(ki,{open:s,onClose:d,review:u})]})})}const _i=()=>{const{id:t}=Mn(),n=fe(),{product:r,status:i,error:s}=St(t||"");if(s){const l=Yn(s);if(l&&(l.message,l.status===404))return n("/404"),null;throw s}return i==="loading"||!r?e("div",{className:"flex h-[calc(100vh-64px)] w-full items-center justify-center",children:e(Fe,{variant:"secondary"})}):a("div",{className:"pb-5xlarge",children:[e(Bn,{path:"/a/products",label:"Back to Products",className:"mb-xsmall"}),a("div",{className:"grid grid-cols-12 gap-x-base",children:[a("div",{className:"col-span-8 flex flex-col gap-y-xsmall",children:[e(Jr,{product:r}),e(Si,{product:r}),e(Ni,{product:r}),e($r,{product:r}),e(ii,{product:r}),e(Di,{product:r})]}),a("div",{className:"col-span-4 flex flex-col gap-y-xsmall",children:[e(li,{product:r}),e(ri,{product:r})]})]})]})},Ii=t=>{const n=fe(),r=je(),i=En(t==null?void 0:t.id),s=async()=>{await r({heading:"Delete Collection",text:"Are you sure you want to delete this collection?"})&&i.mutate()};return{getActions:c=>[{label:"Edit",onClick:()=>n(`/a/collections/${c.id}`),icon:e(ce,{size:20})},{label:"Delete",variant:"danger",onClick:s,icon:e(le,{size:20})}]}},Pi=()=>[p.useMemo(()=>[{Header:"Title",accessor:"title",Cell:({row:{original:n}})=>e("div",{className:"flex items-center",children:n.title})},{Header:"Handle",accessor:"handle",Cell:({cell:{value:n}})=>a("div",{children:["/",n]})},{Header:"Created At",accessor:"created_at",Cell:({cell:{value:n}})=>e(Ie,{content:_e(n).format("DD MMM YYYY hh:mm A"),children:_e(n).format("DD MMM YYYY")})},{Header:"Updated At",accessor:"updated_at",Cell:({cell:{value:n}})=>e(Ie,{content:_e(n).format("DD MMM YYYY hh:mm A"),children:_e(n).format("DD MMM YYYY")})},{Header:"Products",accessor:"products",Cell:({cell:{value:n}})=>e("div",{children:(n==null?void 0:n.length)||"-"})}],[])],Ti=15,Oi=()=>{const[t,n]=p.useState([]),[r,i]=p.useState(0),s=Ti,[l,c]=p.useState(""),[u,o]=p.useState(0),d=qt(l,300),{collections:m,isLoading:g,isRefetching:h,count:v}=Dt({q:d,offset:r,limit:s},{keepPreviousData:!0});p.useEffect(()=>{if(typeof v<"u"){const D=Math.ceil(v/s);o(D)}},[v]);const[N]=Pi(),{getTableProps:w,getTableBodyProps:y,headerGroups:f,rows:b,prepareRow:x,canPreviousPage:T,canNextPage:V,pageCount:L,nextPage:F,previousPage:R,state:{pageIndex:O}}=Oe.useTable({columns:N,data:m||[],manualPagination:!0,initialState:{pageIndex:Math.floor(r/s),pageSize:s},pageCount:u,autoResetPage:!1},Oe.usePagination),I=()=>{V&&(i(r+s),F())},j=D=>{i(0),c(D)},B=()=>{T&&(i(r-s),R())};return p.useEffect(()=>{n([{title:"Sort",options:[{title:"All",count:(m==null?void 0:m.length)||0,onClick:()=>console.log("Not implemented yet")}]}])},[m]),e(Ht,{isLoading:g||h,hasPagination:!0,numberOfRows:s,pagingState:{count:v,offset:r,pageSize:r+b.length,title:"Collections",currentPage:O+1,pageCount:L,nextPage:I,prevPage:B,hasNext:V,hasPrev:T},children:a(q,{enableSearch:!0,handleSearch:j,searchValue:l,searchPlaceholder:"Search Collections",filteringOptions:t,...w(),children:[e(q.Head,{children:f==null?void 0:f.map(D=>e(q.HeadRow,{...D.getHeaderGroupProps(),children:D.headers.map(C=>e(q.HeadCell,{className:"min-w-[100px]",...C.getHeaderProps(),children:C.render("Header")}))}))}),g||h||!m?e(q.Body,{...y(),children:e(q.Row,{children:e(q.Cell,{colSpan:N.length,children:e("div",{className:"w-full pt-2xlarge flex items-center justify-center",children:e(Fe,{size:"large",variant:"secondary"})})})})}):e(q.Body,{...y(),children:b.map(D=>(x(D),e(Mi,{row:D})))})]})})},Mi=({row:t})=>{const n=t.original,{getActions:r}=Ii(n);return e(q.Row,{color:"inherit",linkTo:`/a/collections/${n.id}`,actions:r(n),...t.getRowProps(),children:t.cells.map((i,s)=>e(q.Cell,{...i.getCellProps(),children:i.render("Cell",{index:s})}))})},Ei=t=>{switch(t){case"proposed":return"warning";case"published":return"success";case"rejected":return"danger";case"draft":default:return"default"}},hn=({size:t="20px",color:n="currentColor",...r})=>a("svg",{width:t,height:t,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r,children:[e("path",{d:"M6.66669 5H17.5",stroke:n,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M6.66669 10H17.5",stroke:n,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M6.66669 15H17.5",stroke:n,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M2.5 5H2.50875",stroke:n,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M2.5 10H2.50875",stroke:n,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M2.5 15H2.50875",stroke:n,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),gn=({size:t="20px",color:n="currentColor",...r})=>a("svg",{width:t,height:t,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r,children:[e("path",{d:"M8.5 3.5H3.5V8.5H8.5V3.5Z",stroke:n,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M16.5 3.5H11.5V8.5H16.5V3.5Z",stroke:n,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M16.5 11.5H11.5V16.5H16.5V11.5Z",stroke:n,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M8.5 11.5H3.5V16.5H8.5V11.5Z",stroke:n,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),Vi=(t,n)=>{const r=new Date().toLocaleTimeString(void 0,{hour:"numeric",minute:"numeric",second:"numeric"}),i=`${t.replace(/ \(\d{1,}:\d{1,}:\d{1,}\)$/,"")} (${r})`,s=`${n.replace(/-copy(-\d{1,}){3}(-am|pm])*/g,"")}-copy-${r.replace(/:/g,"-").toLowerCase()}`;return{newTitle:i,newHandle:s}},Ri=()=>{const t=fe(),n=ae(),{mutate:r}=Pt();return s=>{const{variants:l,options:c,type:u,tags:o,images:d,collection_id:m,collection:g,sales_channels:h,title:v,handle:N,...w}=Ne.omit(s,["id","created_at","updated_at","deleted_at","external_id","profile_id","profile","type_id","status"]),y=Object.entries(w).reduce((x,[T,V])=>(V&&(x[T]=V),x),{});if(l&&l.length){const x=[];l.forEach(T=>{const{prices:V,options:L,...F}=Ne.omit(T,["id","sku","created_at","updated_at","deleted_at","product","product_id","variant_rank"]),R=Object.entries(F).reduce((O,[I,j])=>(j&&(O[I]=j),O),{});V&&V.length&&(R.prices=V.map(O=>({amount:O.amount,currency_code:O.region_id?void 0:O.currency_code,region_id:O.region_id}))),L&&L.length&&(R.options=L.map(O=>({value:O.value}))),x.push(R)}),y.variants=x}c&&c.length&&(y.options=c.map(x=>({title:x.title}))),d&&d.length&&(y.images=d.map(x=>x.url)),g?y.collection_id=g.id:m&&(y.collection_id=m),h&&h.length&&(y.sales_channels=h.map(x=>({id:x.id}))),o&&o.length&&(y.tags=o.map(({id:x,value:T})=>({id:x,value:T}))),u&&(y.type={id:s.type.id,value:s.type.value}),y.status=et.DRAFT;const{newTitle:f,newHandle:b}=Vi(v,N||"");y.title=f,y.handle=b,r(y,{onSuccess:({product:x})=>{t(`/a/products/${x.id}`),n("Success","Created a new product","success")},onError:x=>{n("Error",te(x),"error")}})}},pn=t=>{const n=fe(),r=ae(),i=je(),s=Ri(),l=kt(t==null?void 0:t.id),c=st(t==null?void 0:t.id),u=async()=>{await i({heading:"Delete Product",text:"Are you sure you want to delete this product?"})&&l.mutate()};return{getActions:()=>[{label:"Edit",onClick:()=>n(`/a/products/${t.id}`),icon:e(ce,{size:20})},{label:t.status==="published"?"Unpublish":"Publish",onClick:()=>{const d=t.status==="published"?"draft":"published";c.mutate({status:d},{onSuccess:()=>{r("Success",`Successfully ${t.status==="published"?"unpublished":"published"} product`,"success")},onError:m=>r("Error",te(m),"error")})},icon:t.status==="published"?e(Xn,{size:20}):e(ut,{size:20})},{label:"Duplicate",onClick:()=>s(t),icon:e(Lt,{size:20})},{label:"Delete",variant:"danger",onClick:u,icon:e(le,{size:20})}]}},Fi=({products:t,toggleListView:n})=>a(X,{children:[e("div",{className:"flex justify-end border-t border-b border-grey-20 py-2.5 pr-xlarge",children:a("div",{className:"inter-small-semibold text-grey-50 flex justify-self-end",children:[e("span",{onClick:n,className:Q("hover:bg-grey-5 cursor-pointer rounded p-0.5 text-grey-40"),children:e(hn,{size:20})}),e("span",{className:Q("hover:bg-grey-5 cursor-pointer rounded p-0.5 text-grey-90"),children:e(gn,{size:20})})]})}),e("div",{className:"grid grid-cols-6",children:t==null?void 0:t.map(r=>e(ji,{product:r}))})]}),ji=({product:t})=>{var r;const{getActions:n}=pn(t);return e("div",{className:"p-base group rounded-rounded hover:bg-grey-5 flex-col",children:a("div",{className:"relative",children:[e("div",{className:Q("rounded-base inline-block absolute top-2 right-2"),children:e(we,{actions:n(),customTrigger:e(_,{variant:"ghost",size:"small",className:"w-xlarge h-xlarge hidden-actions group-hover:opacity-100 focus-within:opacity-100 opacity-0 bg-grey-0",children:e(mt,{size:20})})})}),a(Vn,{to:`${t.id}`,children:[t.thumbnail?e("img",{className:"min-h-[230px] block object-cover rounded-rounded",src:t.thumbnail}):e("div",{className:"min-h-[230px] flex items-center justify-center bg-grey-5 rounded-rounded",children:e(Bt,{})}),a("div",{children:[a("div",{className:"mt-base flex items-center justify-between",children:[e("p",{className:"inter-small-regular text-grey-90 line-clamp-1 mr-3",children:t.title}),e(ve,{variant:Ei(t.status),className:"shrink-0"})]}),e("span",{className:"inter-small-regular text-grey-50 line-clamp-1",children:(r=t.collection)==null?void 0:r.title})]})]})]})})},Ai=t=>(n,r)=>n.id===t?-1:r.id===t?1:n.name.localeCompare(r.name),zi=({setTileView:t,setListView:n,showList:r,storeUrl:i})=>{const s=o=>{switch(o){case"proposed":return e(ve,{title:"Proposed",variant:"warning"});case"published":return e(ve,{title:"Published",variant:"success"});case"rejected":return e(ve,{title:"Rejected",variant:"danger"});case"draft":return e(ve,{title:"Draft",variant:"default"});default:return e(ve,{title:o,variant:"default"})}},{store:l}=lt(),c=o=>o!=null&&o.length?(o.sort(Ai((l==null?void 0:l.default_sales_channel_id)||"")),a("span",{className:"inter-small-regular",children:[o[0].name,o.length>1&&e(Ie,{content:e("div",{className:"flex flex-col",children:o.slice(1).map(d=>e("span",{children:d.name}))}),children:a("span",{className:"text-grey-40",children:[" ","+ ",o.length-1," more"]})})]})):e(X,{});return[p.useMemo(()=>[{Header:"Name",accessor:"title",Cell:({row:{original:o}})=>a("div",{className:"flex items-center",children:[e("div",{className:"my-1.5 mr-4 flex h-[40px] w-[30px] items-center",children:o.thumbnail?e("img",{src:o.thumbnail,className:"h-full rounded-soft object-cover"}):e(Bt,{})}),o.title]})},{Header:"Collection",accessor:"collection",Cell:({cell:{value:o}})=>e("div",{children:(o==null?void 0:o.title)||"-"})},{Header:"Status",accessor:"status",Cell:({cell:{value:o}})=>s(o)},{Header:"Availability",accessor:"sales_channels",Cell:({cell:{value:o}})=>c(o)},{Header:"Inventory",accessor:"variants",Cell:({cell:{value:o}})=>a("div",{children:[o.reduce((d,m)=>d+m.inventory_quantity,0)," in stock for ",o.length," variant(s)"]})},{accessor:"col-3",Header:a("div",{className:"flex justify-end text-right",children:[e("span",{onClick:n,className:Q("cursor-pointer rounded p-0.5 hover:bg-grey-5",{"text-grey-90":r,"text-grey-40":!r}),children:e(hn,{size:20})}),e("span",{onClick:t,className:Q("cursor-pointer rounded p-0.5 hover:bg-grey-5",{"text-grey-90":!r,"text-grey-40":r}),children:e(gn,{size:20})})]}),Cell:({row:{original:{handle:o}}})=>e("a",{target:"_blank",href:`${i}/products/${o}`,className:"flex justify-end",onClick:d=>{d.stopPropagation()},children:e(ut,{size:20})})}],[r])]},Hi=["status","collection_id","payment_status","created_at","q","offset","limit"],Je={drafts:{status:["draft"]},proposed:{status:["proposed"]}},Li=t=>t===null?t:Object.entries(t).reduce((r,[i,s])=>(s.includes("|")?r[i]=pr(s):r[i]=s,r),{}),Ui=(t,n)=>{var r;switch(n.type){case"setFilters":return{...t,status:n.payload.status,collection:n.payload.collection,tags:n.payload.tags,date:n.payload.date,query:(r=n==null?void 0:n.payload)==null?void 0:r.query};case"setQuery":return{...t,offset:0,query:n.payload};case"setDate":{const i=t.date;return{...t,date:i}}case"setLimit":return{...t,limit:n.payload};case"setOffset":return{...t,offset:n.payload};case"reset":return n.payload;default:return t}},qi=(t,n)=>{if(t.size!==n.size)return!1;for(const r of t)if(!n.has(r))return!1;return!0},Bi=(t,n=null)=>{t&&t[0]==="?"&&(t=t.substring(1));const r=p.useMemo(()=>Wi(t,n),[t,n]),i=p.useMemo(()=>{const C=localStorage.getItem("products::filters");if(C){const M=JSON.parse(C);if(M)return Object.entries(M).map(([E,S])=>({label:E,value:E,removable:!0,representationString:S}))}return[]},[]),[s,l]=p.useReducer(Ui,r),[c,u]=p.useState(i),o=C=>{l({type:"setDate",payload:C})},d=C=>{l({type:"setFulfillment",payload:C})},m=C=>{l({type:"setPayment",payload:C})},g=C=>{l({type:"setStatus",payload:C})},h=C=>{l({type:"setDefaults",payload:C})},v=C=>{l({type:"setLimit",payload:C})},N=C=>{if(C>0){const M=s.offset+s.limit;l({type:"setOffset",payload:M})}else{const M=Math.max(s.offset-s.limit,0);l({type:"setOffset",payload:M})}},w=()=>{l({type:"setFilters",payload:{...s,offset:0,status:{open:!1,filter:null},collection:{open:!1,filter:null},tags:{open:!1,filter:null},date:{open:!1,filter:null},query:null}})},y=C=>{l({type:"setFilters",payload:C})},f=C=>{l({type:"setQuery",payload:C})},b=()=>{const C={...s.additionalFilters};for(const[M,E]of Object.entries(s))M==="query"?E&&typeof E=="string"&&(C.q=E):M==="offset"||M==="limit"?C[M]=E:E.open&&(M==="date"?C[Qe[M]]=Li(E.filter):C[Qe[M]]=E.filter);return C},x=()=>{const C=b();return me.stringify(C,{skipNulls:!0})},T=C=>{const M=C??s,E={};for(const[S,P]of Object.entries(M))S==="query"?P&&typeof P=="string"&&(E.q=P):S==="offset"||S==="limit"?E[S]=P:P.open&&(E[Qe[S]]=P.filter);return E},V=()=>{const C=T();return me.stringify(C,{skipNulls:!0})},L=p.useMemo(()=>b(),[s]),F=p.useMemo(()=>T(),[s]),R=p.useMemo(()=>V(),[s]),O=p.useMemo(()=>{const C=Ne.omit(F,["limit","offset"]),M=me.stringify(C),E=c.find(S=>S.representationString===M);if(E)return E.value;for(const[S,P]of Object.entries(Je)){let A=!0;if(Object.keys(C).length===Object.keys(P).length){for(const[z,U]of Object.entries(P))if(z in C?Array.isArray(U)?A=Array.isArray(C[z])&&qi(new Set(C[z]),new Set(U)):A=C[z]===U:A=!1,!A)break;if(A)return S}}return null},[F,c]),I=p.useMemo(()=>[{label:"Unpublished",value:"drafts"},...c],[c]),j=C=>{let M=null;if(C in Je)M=Je[C];else{const E=c.find(S=>S.value===C);E&&(M=me.parse(E.representationString))}if(M){const E={...s,date:{open:!1,filter:null},status:{open:!1,filter:null},tags:{open:!1,filter:null},collection:{open:!1,filter:null}};for(const[S,P]of Object.entries(M))E[$i[S]]={open:!0,filter:P};l({type:"setFilters",payload:E})}},B=(C,M)=>{const E=T({...M}),S=Ne.omit(E,["limit","offset"]),P=me.stringify(S,{skipNulls:!0}),A=localStorage.getItem("products::filters");let z=null;if(A&&(z=JSON.parse(A)),z)z[C]=P,localStorage.setItem("products::filters",JSON.stringify(z));else{const U={};U[C]=P,localStorage.setItem("products::filters",JSON.stringify(U))}u(U=>{const se=U.findIndex(ne=>{var ye;return((ye=ne.label)==null?void 0:ye.toLowerCase())===C.toLowerCase()});return se!==-1&&U.splice(se,1),[...U,{label:C,value:C,representationString:P,removable:!0}]}),l({type:"setFilters",payload:M})},D=C=>{const M=localStorage.getItem("products::filters");let E=null;M&&(E=JSON.parse(M)),E&&(delete E[C],localStorage.setItem("products::filters",JSON.stringify(E))),u(S=>S.filter(A=>A.value!==C))};return{...s,filters:{...s},removeTab:D,saveTab:B,setTab:j,availableTabs:I,activeFilterTab:O,representationObject:F,representationString:R,queryObject:L,paginate:N,getQueryObject:b,getQueryString:x,setQuery:f,setFilters:y,setDefaultFilters:h,setDateFilter:o,setLimit:v,setFulfillmentFilter:d,setPaymentFilter:m,setStatusFilter:g,reset:w}},$i={status:"status",collection_id:"collection",tags:"tags",created_at:"date"},Qe={status:"status",collection:"collection_id",tags:"tags",date:"created_at"},Wi=(t,n=null)=>{const r={status:{open:!1,filter:null},collection:{open:!1,filter:null},tags:{open:!1,filter:null},date:{open:!1,filter:null},offset:0,limit:15,additionalFilters:n};if(t){const i=me.parse(t);for(const[s,l]of Object.entries(i))if(Hi.includes(s))switch(s){case"offset":{typeof l=="string"&&(r.offset=parseInt(l));break}case"limit":{typeof l=="string"&&(r.limit=parseInt(l));break}case"q":{typeof l=="string"&&(r.query=l);break}case"status":{(typeof l=="string"||Array.isArray(l))&&(r.status={open:!0,filter:l});break}case"collection_id":{(typeof l=="string"||Array.isArray(l))&&(r.collection={open:!0,filter:l});break}case"payment_status":{(typeof l=="string"||Array.isArray(l))&&(r.payment={open:!0,filter:l});break}case"created_at":{r.date={open:!0,filter:l};break}}}return r},Ke=15,Yi=18,Nt={fields:"id,title,thumbnail,status,handle,collection_id",expand:"variants,options,variants.prices,variants.options,collection,tags,type,images",is_giftcard:!1},Gi=()=>{const t=Tt(),{isFeatureEnabled:n}=at(),{trackNumberOfProducts:r}=hr();let i=["sales_channel"];n("sales_channels")&&(Nt.expand="variants,options,variants.prices,variants.options,collection,tags,type,images,sales_channels",i=[]);const{removeTab:s,setTab:l,saveTab:c,availableTabs:u,activeFilterTab:o,reset:d,paginate:m,setFilters:g,setLimit:h,filters:v,setQuery:N,queryObject:w,representationObject:y}=Bi(t.search,Nt),{data:f}=Ve("/extend-store",["extend-store"]),b=p.useMemo(()=>(f==null?void 0:f.extendStore.storeUrl)??"",[f]),x=parseInt(w.offset)||0,T=parseInt(w.limit),[V,L]=p.useState(w.query),[F,R]=p.useState(0),O=()=>{d(),L("")},{products:I,isLoading:j,count:B}=_t({...w},{keepPreviousData:!0,onSuccess:({count:G})=>r({count:G})});p.useEffect(()=>{if(typeof B<"u"){const G=Math.ceil(B/T);R(G)}},[B]);const D=(G={})=>{const Ee=me.stringify(G);window.history.replaceState("/a/products","",`${`?${Ee}`}`)},C=()=>{const G=y;Ne.isEmpty(G)?D({offset:0,limit:Ke}):D(G)};p.useEffect(()=>{C()},[y]);const M=()=>{h(Yi),P(!1)},E=()=>{h(Ke),P(!0)},[S,P]=ot.useState(!0),[A]=zi({setTileView:M,setListView:E,showList:S,storeUrl:b}),{getTableProps:z,getTableBodyProps:U,headerGroups:se,rows:ne,prepareRow:ye,gotoPage:gt,canPreviousPage:W,canNextPage:be,pageCount:ke,nextPage:Me,previousPage:yn,state:{pageIndex:bn}}=Oe.useTable({columns:A,data:I||[],manualPagination:!0,initialState:{pageIndex:Math.floor(x/T),pageSize:T,hiddenColumns:i},pageCount:F,autoResetPage:!1},Oe.usePagination);p.useEffect(()=>{const G=setTimeout(()=>{V?(N(V),gt(0)):typeof V<"u"&&d()},400);return()=>clearTimeout(G)},[V]);const vn=()=>{be&&(m(1),Me())},xn=()=>{W&&(m(-1),yn())};return e(Ht,{numberOfRows:Ke,hasPagination:!0,pagingState:{count:B,offset:x,pageSize:x+ne.length,title:"Products",currentPage:bn+1,pageCount:ke,nextPage:vn,prevPage:xn,hasNext:be,hasPrev:W},isLoading:j,children:e(q,{filteringOptions:e(gr,{filters:v,submitFilters:g,clearFilters:O,tabs:u,onTabClick:l,activeTab:o,onRemoveTab:s,onSaveTab:c}),enableSearch:!0,searchValue:V,handleSearch:L,...z(),children:S?a(X,{children:[e(q.Head,{children:se==null?void 0:se.map(G=>e(q.HeadRow,{...G.getHeaderGroupProps(),children:G.headers.map(Ee=>e(q.HeadCell,{className:"min-w-[100px]",...Ee.getHeaderProps(),children:Ee.render("Header")}))}))}),e(q.Body,{...U(),children:ne.map(G=>(ye(G),e(Zi,{row:G,...G.getRowProps()})))})]}):e(Fi,{products:I,toggleListView:E})})})},Zi=({row:t,...n})=>{const r=t.original,{getActions:i}=pn(r);return e(q.Row,{color:"inherit",linkTo:`/a/products/${r.id}`,actions:i(),...n,children:t.cells.map((s,l)=>e(q.Cell,{...s.getCellProps(),children:s.render("Cell",{index:l})}))})};function Ji(t){const[n,r]=p.useState(),i=(n==null?void 0:n.status)==="created"||(n==null?void 0:n.status)==="confirmed",{batch_job:s}=zn(t,{enabled:!!t,refetchInterval:i?2e3:!1});return p.useEffect(()=>{r(s)},[s]),n}function Qi(t){const[n,r]=p.useState(),[i,s]=p.useState(),l=ae(),{resetInterval:c}=p.useContext($t),{mutateAsync:u}=Rn(),{mutateAsync:o}=Fn(),{mutateAsync:d}=Ot(),{mutateAsync:m}=jn(i),{mutateAsync:g}=An(i),h=Ji(i),v=!!n,N=!!(h!=null&&h.result),w=(h==null?void 0:h.status)==="failed",y=N?h.result.advancement_count/h.result.count:void 0,f=w?"Error occurred while processing":N?void 0:v?"Preprocessing...":"Uploading...",b=async()=>{await g(),l("Success","Import confirmed for processing. Progress info is available in the activity drawer.","success"),t.handleClose()},x=async F=>{try{const O=(await o(F)).uploads[0].key;r(O);const I=await d({dry_run:!0,context:{fileKey:O},type:"product-import"});c(),s(I.batch_job.id)}catch{l("Error","Import failed.","error"),n&&await u({file_key:n})}},T=()=>{var R;if(!h)return;const F=(R=h.result)==null?void 0:R.stat_descriptors[0].message.match(/\d+/g);if(F)return{toCreate:Number(F[0]),toUpdate:Number(F[1])}},V=async()=>{if(n)try{u({file_key:n})}catch{l("Error","Failed to delete the CSV file","error")}try{m()}catch{l("Error","Failed to cancel the batch job","error")}s(void 0)};return e(or,{type:"products",status:f,progress:y,canImport:N,onSubmit:b,onClose:()=>{t.handleClose(),["confirmed","completed","canceled","failed"].includes(h==null?void 0:h.status)||(n&&u({file_key:n}),i&&m())},summary:T(),onFileRemove:V,processUpload:x,fileTitle:"products list",templateLink:"/temp/product-import-template.csv",description2Title:"Unsure about how to arrange your list?",description2Text:"Download the template below to ensure you are following the correct format.",description1Text:"Through imports you can add or update products. To update existing products/variants you must set an existing id in the Product/Variant id columns. If the value is unset a new record will be created. You will be asked for confirmation before we import products."})}const Ki=({form:t})=>{const{control:n,path:r}=t,[i,s]=p.useState(!1),{fields:l,replace:c,append:u}=re({control:n,name:r("channels"),keyName:"fieldId"}),{state:o,toggle:d}=J(),{state:m,toggle:g,close:h}=J(),{store:v}=lt(),N=w=>{v!=null&&v.default_sales_channel&&(w.find(({id:y})=>y===v.default_sales_channel.id)||s(!0)),c(w)};return p.useEffect(()=>{if(v!=null&&v.default_sales_channel&&l){!l.find(({id:f})=>f===v.default_sales_channel.id)&&!i&&u(v.default_sales_channel);const y=l.filter((f,b)=>l.findIndex(x=>x.id===f.id)!==b);y.length>0&&c(l.filter(f=>!y.includes(f)))}},[v,u,l,c,i]),a(X,{children:[a("div",{children:[a("div",{children:[a("div",{className:"flex items-center justify-between",children:[e("h2",{className:"inter-base-semibold",children:"Sales channels"}),e(Pe,{checked:o,onCheckedChange:d})]}),e("p",{className:"inter-base-regular text-grey-50 mt-2xsmall",children:"This product will only be available in the default sales channel if left untouched."})]}),a("div",{className:Q({hidden:!o}),children:[e("div",{className:"mt-base",children:e(Qt,{channels:l})}),a(_,{variant:"secondary",className:"w-full h-[40px] mt-large",type:"button",onClick:g,children:[e(Vt,{size:20}),e("span",{children:"Change availablity"})]})]})]}),e(Ft,{source:l,open:m,onClose:h,onSave:N})]})},Xi=({form:t,options:n,onCreateOption:r})=>{const{control:i,path:s}=t,{fields:l}=re({control:t.control,name:s(),keyName:"fieldId"});return e("div",{className:"grid grid-cols-2 gap-large pb-2xsmall",children:l.map((c,u)=>e(K,{control:i,name:s(`${u}.option`),render:({field:{value:o,onChange:d,onBlur:m,ref:g}})=>e(Mt,{ref:g,value:o,onChange:d,onBlur:m,label:c.title,placeholder:"Choose an option",required:!0,options:n.filter(h=>h.option_id===c.option_id)||[],onCreateOption:h=>{const v={option_id:c.option_id,value:h,label:h};r(c.option_id,h),d(v)}})},c.fieldId))})},fn=({form:t,options:n,onCreateOption:r})=>a(Y,{type:"multiple",defaultValue:["general"],children:[e(Y.Item,{title:"General",value:"general",required:!0,children:a("div",{children:[e(sn,{form:H(t,"general")}),a("div",{className:"mt-xlarge",children:[a("div",{className:"flex items-center gap-x-2xsmall mb-base",children:[e("h3",{className:"inter-base-semibold",children:"Options"}),e(he,{type:"info",content:"Options are used to define the color, size, etc. of the variant."})]}),e(Xi,{form:H(t,"options"),options:n,onCreateOption:r}),e(Jn,{errors:t.formState.errors,name:"options"})]})]})}),e(Y.Item,{title:"Pricing",value:"pricing",children:e(an,{form:H(t,"prices")})}),e(Y.Item,{title:"Stock & Inventory",value:"stock",children:e(ln,{form:H(t,"stock")})}),a(Y.Item,{title:"Shipping",value:"shipping",children:[e("p",{className:"inter-base-regular text-grey-50",children:"Shipping information can be required depending on your shipping provider, and whether or not you are shipping internationally."}),a("div",{className:"mt-large",children:[e("h3",{className:"inter-base-semibold mb-2xsmall",children:"Dimensions"}),e("p",{className:"inter-base-regular text-grey-50 mb-large",children:"Configure to calculate the most accurate shipping rates."}),e(ze,{form:H(t,"dimensions")})]}),a("div",{className:"mt-xlarge",children:[e("h3",{className:"inter-base-semibold mb-2xsmall",children:"Customs"}),e("p",{className:"inter-base-regular text-grey-50 mb-large",children:"Configure if you are shipping internationally."}),e(Ae,{form:H(t,"customs")})]})]})]}),es=t=>{const{control:n,path:r}=t,i=ge({control:n,name:r("entries")}),s=ge({control:n,name:r("options")}),l=p.useMemo(()=>{const o=i==null?void 0:i.filter(m=>m.options.every(g=>g.option!==null));return o==null?void 0:o.map(m=>({id:m._internal_id,value_combo:m.options.map(g=>g.option)}))},[i]);return{checkForDuplicate:({id:o,options:d})=>l!=null&&l.length?l.filter(g=>g.id!==o).some(g=>Ne.isEqual(g.value_combo.map(h=>h==null?void 0:h.value),d.map(h=>h==null?void 0:h.value))):!1,getOptions:()=>s==null?void 0:s.map(d=>d.values.map(m=>({option_id:d.id,value:m,label:m}))).flat()}},wt={CARD:"card"},ts=({id:t,source:n,index:r,save:i,remove:s,move:l,options:c,onCreateOption:u,productDimensions:o,productCustoms:d})=>{const{state:m,toggle:g,close:h}=J(),v=ee({defaultValues:n}),{handleSubmit:N,reset:w}=v;p.useEffect(()=>{w(n)},[n]);const y=()=>{w(n),h()},f=N(I=>{const j={...I,title:I.general.title?I.general.title:I.options.map(D=>{var C;return(C=D.option)==null?void 0:C.value}).join(" / ")};if(!i(r,j)){v.setError("options",{type:"deps",message:"A variant with these options already exists."});return}y()}),b=je(),x=async()=>{await b({text:"Are you sure you want to delete this variant?",heading:"Delete Variant"})&&s(r)},T=p.useRef(null),[{handlerId:V},L]=Jt({accept:wt.CARD,collect(I){return{handlerId:I.getHandlerId()}},hover(I,j){var P;if(!T.current)return;const B=I.index,D=r;if(B===D)return;const C=(P=T.current)==null?void 0:P.getBoundingClientRect(),M=(C.bottom-C.top)/2,S=j.getClientOffset().y-C.top;B<D&&S<M||B>D&&S>M||(l(B,D),I.index=D)}}),[{isDragging:F},R,O]=Zt({type:wt.CARD,item:()=>({id:t,index:r}),collect:I=>({isDragging:I.isDragging()})});return R(L(T)),a(X,{children:[a("div",{ref:O,"data-handler-id":V,className:Q("grid grid-cols-[32px_1fr_90px_100px_48px] transition-all rounded-rounded hover:bg-grey-5 focus-within:bg-grey-5 h-16 py-xsmall pl-xsmall pr-base translate-y-0 translate-x-0",{"opacity-50":F}),children:[e("div",{ref:T,className:"text-grey-40 cursor-move flex items-center justify-center",children:e(dn,{size:20})}),a("div",{className:"flex justify-center flex-col ml-base",children:[a("p",{className:"inter-base-semibold",children:[n.general.title,n.stock.sku&&a("span",{className:"inter-base-regular text-grey-50 ml-2xsmall",children:["(",n.stock.sku,")"]})]}),n.stock.ean&&e("span",{className:"inter-base-regular text-grey-50",children:n.stock.ean})]}),e("div",{className:"flex items-center justify-end mr-xlarge",children:e("p",{children:n.stock.inventory_quantity||"-"})}),e("div",{className:"flex items-center justify-center",children:e(ns,{source:n,productCustoms:d,productDimensions:o})}),e("div",{className:"ml-xlarge flex items-center justify-center pr-base",children:e(we,{forceDropdown:!0,actions:[{label:"Edit",icon:e(ce,{size:20}),onClick:g},{label:"Delete",icon:e(le,{size:20}),onClick:x,variant:"danger"}],customTrigger:e(_,{variant:"ghost",className:"w-xlarge h-xlarge p-0 flex items-center justify-center text-grey-50",children:e(mt,{size:20})})})})]}),e(k,{open:m,handleClose:y,children:a(k.Body,{children:[e(k.Header,{handleClose:y,children:a("h1",{className:"inter-xlarge-semibold",children:["Edit Variant",n.general.title&&a("span",{className:"ml-xsmall inter-xlarge-regular text-grey-50",children:["(",n.general.title,")"]})]})}),e(k.Content,{children:e(fn,{form:v,options:c,onCreateOption:u})}),e(k.Footer,{children:a("div",{className:"flex items-center gap-x-xsmall justify-end w-full",children:[e(_,{variant:"secondary",size:"small",type:"button",onClick:y,children:"Cancel"}),e(_,{variant:"primary",size:"small",type:"button",onClick:f,children:"Save and close"})]})})]})})]})},ns=({source:t,productCustoms:n,productDimensions:r})=>{const{prices:i,options:s,dimensions:l,customs:c,stock:{barcode:u,upc:o,ean:d,sku:m,inventory_quantity:g},general:{title:h}}=t;if(!s||!s.length)return e(he,{type:"error",content:e("div",{className:"text-rose-50 flex flex-col gap-y-2xsmall",children:e("p",{children:"This variant has no options."})})});const v=s.filter(b=>{var x;return!((x=b.option)!=null&&x.value)});if(v!=null&&v.length)return e(he,{type:"error",content:a("div",{className:"text-rose-50 flex flex-col gap-y-2xsmall",children:[e("p",{children:"You are missing options values for the following options:"}),e("ul",{className:"list-disc list-inside",children:v.map((b,x)=>e("li",{children:b.title||`Option ${x+1}`},x))})]})});const N=i==null?void 0:i.prices.some(b=>b.amount!==null),w=Object.values(r).every(b=>!!b)||Object.values(l).every(b=>!!b),y=Object.values(n).every(b=>!!b)||Object.values(c).every(b=>!!b),f=!!u||!!o||!!d;return!m||!y||!w||!f||!N?e(he,{type:"warning",side:"right",content:a("div",{className:"text-orange-50 flex flex-col gap-y-2xsmall",children:[e("p",{children:"Your variant is createable, but it's missing some important fields:"}),a("ul",{className:"list-disc list-inside",children:[!N&&e("li",{children:"Pricing"}),!w&&e("li",{children:"Dimensions"}),!y&&e("li",{children:"Customs"}),!g&&e("li",{children:"Inventory quantity"}),!m&&e("li",{children:"SKU"}),!f&&e("li",{children:"Barcode"})]})]})}):e(Ie,{content:h?`${h} is valid`:"Variant is valid",side:"top",children:e(tn,{size:20,className:"text-emerald-40"})})},rs=({form:t,productCustoms:n,productDimensions:r})=>{const{control:i,path:s,register:l}=t,{checkForDuplicate:c,getOptions:u}=es(t),{fields:o,append:d,remove:m,update:g}=re({control:i,name:s("options"),keyName:"fieldId",shouldUnregister:!0}),{fields:h,append:v,remove:N,update:w,move:y}=re({control:i,name:s("entries"),shouldUnregister:!0}),f=ge({control:i,name:s("options")}),b=ge({control:i,name:s("entries")}),x=qt(f,500);p.useEffect(()=>{if(x!=null&&x.length){const S=x.reduce((A,z)=>(A[z.id]=z,A),{}),P=b==null?void 0:b.map((A,z)=>({variant:A,index:z}));P&&P.forEach(A=>{const{variant:z,index:U}=A,se=z.options,ne=[];se.forEach(W=>{var Me;const{option_id:be}=W,ke=S[be];ke&&(W.title=ke.title,(!((Me=W.option)!=null&&Me.value)||!ke.values.includes(W.option.value))&&(W.option=null),ne.push(W))});const ye=ne.map(W=>W.option_id);Object.keys(S).filter(W=>!ye.includes(W)).forEach(W=>{const be=S[W];ne.push({option_id:W,title:be.title,option:null})}),w(U,{...z,options:ne.map(W=>({id:tt(),option_id:W.option_id,title:W.title,value:W,option:W.option}))})})}},[x]);const T=S=>{const P=f[S];m(S),P&&(b==null||b.forEach((A,z)=>{const se=A.options.filter(ne=>ne.option_id!==P.id);w(z,{...A,options:se})}))},V=(S,P)=>{const A={id:P._internal_id,options:P.options.map(U=>U.option)};return c(A)?!1:(w(S,P),!0)},L=p.useMemo(()=>(f==null?void 0:f.length)>0?f.some(S=>S.values.length>0):!1,[f]),F=()=>{d({id:tt(),title:"",values:[]})},R=ee(),{reset:O,handleSubmit:I}=R,{state:j,toggle:B}=J(),D=()=>{O(is(f)),B()},C=I(S=>{const P={id:S._internal_id,options:S.options.map(z=>z.option).filter(z=>!!z)};if(c(P)){R.setError("options",{type:"deps",message:"A variant with these options already exists."});return}v({...S,options:S.options,general:{...S.general,title:S.general.title?S.general.title:S.options.map(z=>{var U;return(U=z.option)==null?void 0:U.value}).join(" / ")}}),D()}),M=p.useCallback((S,P)=>{y(S,P)},[]),E=(S,P)=>{const A=f==null?void 0:f.find(U=>U.id===S);if(!A)return;const z=f==null?void 0:f.findIndex(U=>U.id===S);g(z,{...A,values:[...A.values,P]})};return a(X,{children:[a("div",{children:[a("div",{className:"flex items-center gap-x-2xsmall",children:[e("h3",{className:"inter-base-semibold",children:"Product options"}),e(he,{type:"info",content:"Options are used to define the color, size, etc. of the product."})]}),a("div",{children:[o.length>0&&a("div",{className:"mt-small",children:[a("div",{className:"grid grid-cols-[230px_1fr_40px] gap-x-xsmall inter-small-semibold text-grey-50 mb-small",children:[e("span",{children:"Option title"}),e("span",{children:"Variations (comma separated)"})]}),e("div",{className:"grid grid-cols-1 gap-y-xsmall",children:o.map((S,P)=>a("div",{className:"grid grid-cols-[230px_1fr_40px] gap-x-xsmall",children:[e($,{placeholder:"Color...",...l(s(`options.${P}.title`))}),e(K,{control:i,name:s(`options.${P}.values`),render:({field:{value:A,onChange:z}})=>e(At,{onValidate:U=>A.includes(U)?null:U,invalidMessage:"already exists",showLabel:!1,values:A,onChange:z,placeholder:"Blue, Red, Black..."})}),e(_,{variant:"secondary",size:"small",type:"button",className:"h-10",onClick:()=>T(P),children:e(le,{size:20,className:"text-grey-40"})})]},S.fieldId))})]}),a(_,{variant:"secondary",size:"small",className:"h-10 w-full mt-base",type:"button",onClick:F,children:[e(Ce,{size:20}),e("span",{children:"Add an option"})]}),a("div",{className:"mt-xlarge",children:[a("div",{className:"flex items-center gap-x-2xsmall",children:[a("h3",{className:Q("inter-base-semibold",{"opacity-50":!o.length}),children:["Product variants"," ",a("span",{className:"inter-base-regular text-grey-50",children:["(",(h==null?void 0:h.length)||0,")"]})]}),!L&&e(he,{type:"info",content:"You must add at least one product option before you can begin adding product variants."})]}),(h==null?void 0:h.length)>0&&a("div",{className:"mt-small",children:[a("div",{className:"grid grid-cols-[1fr_90px_100px_48px] inter-small-semibold text-grey-50 pr-base",children:[e("p",{children:"Variant"}),e("div",{className:"flex justify-end mr-xlarge",children:e("p",{children:"Inventory"})})]}),e("div",{children:h==null?void 0:h.map((S,P)=>e(ts,{id:S.id,source:S,index:P,save:V,remove:N,move:M,options:u(),onCreateOption:E,productDimensions:r,productCustoms:n},S.id))})]}),a(_,{variant:"secondary",size:"small",className:"h-10 w-full mt-base",type:"button",disabled:!L,onClick:D,children:[e(Ce,{size:20}),e("span",{children:"Add a variant"})]})]})]})]}),e(k,{open:j,handleClose:D,children:a(k.Body,{children:[e(k.Header,{handleClose:D,children:e("h1",{className:"inter-xlarge-semibold",children:"Create Variant"})}),e(k.Content,{children:e(fn,{form:R,options:u(),onCreateOption:E})}),e(k.Footer,{children:a("div",{className:"flex items-center gap-x-xsmall justify-end w-full",children:[e(_,{variant:"secondary",size:"small",type:"button",onClick:D,children:"Cancel"}),e(_,{variant:"primary",size:"small",type:"button",onClick:C,children:"Save and close"})]})})]})})]})},is=t=>({_internal_id:tt(),general:{title:null,material:null},prices:{prices:[]},stock:{manage_inventory:!0,allow_backorder:!1,sku:null,barcode:null,ean:null,upc:null,inventory_quantity:null},dimensions:{weight:null,length:null,width:null,height:null},customs:{hs_code:null,mid_code:null,origin_country:null},options:(t==null?void 0:t.map(n=>({title:n.title,option_id:n.id,option:null})))||[]});function ss({form:t,setEditorRef:n,editorRef:r}){const i=p.useRef(null),{control:s}=t;return a(X,{children:[e(K,{control:s,name:"__nested__.content",render:({field:{value:l,onChange:c}})=>e(Ut,{onInit:(u,o)=>n(o),value:l??"<p>This is the initial content of the editor</p>",init:{height:500,menubar:!0,plugins:["advlist","autolink","lists","link","image","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","code","wordcount"],toolbar:"undo redo | styleselect | bold italic forecolor | link | image",color_cols:5,a11y_advanced_options:!0,automatic_uploads:!0,file_picker_types:"image",file_picker_callback(u,o,d){i.current&&(i.current.addEventListener("change",m=>{var v;const g=(v=m.target)!=null&&v.files?m.target.files[0]:null;if(!g||!r.current)return;const h=new FileReader;h.addEventListener("load",()=>{const N="blobid"+new Date().getTime(),w=r.current.editorUpload.blobCache,y=h.result.split(",")[1],f=w.create(N,g,y);w.add(f),u(f.blobUri(),{title:g.name})}),h.readAsDataURL(g)}),i.current.click())},content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"},tinymceScriptSrc:"/tinymce/js/tinymce/tinymce.min.js",onEditorChange:u=>{c(u)}})}),e("input",{type:"file",accept:"image/*",ref:i,hidden:!0})]})}const as=({onClose:t})=>{const n=ee({defaultValues:Xe()}),{mutate:r,mutateAsync:i}=Pt(),s=fe(),l=ae(),c=ge({control:n.control,name:"customs"}),u=p.useRef(!1),o=ge({control:n.control,name:"dimensions"}),{handleSubmit:d,formState:{isDirty:m},reset:g}=n,h=()=>{g(Xe()),t()};p.useEffect(()=>{g(Xe())},[]);const{isFeatureEnabled:v}=at(),{client:N}=Hn(),w=(f=!0)=>d(async({description:b,...x})=>{var L,F,R,O,I;u.current=!0;const T=ls(x,f,v("sales_channels"));if((F=(L=x.media)==null?void 0:L.images)!=null&&F.length){let j=[];try{j=await Te(x.media.images)}catch(D){let C="Something went wrong while trying to upload images.";D.response.status===500&&(C=C+" You might not have a file service configured. Please contact your administrator"),l("Error",C,"error");return}const B=j.map(D=>D.url);T.images=B}if((O=(R=x.thumbnail)==null?void 0:R.images)!=null&&O.length){let j=[];try{j=await Te(x.thumbnail.images)}catch(D){let C="Something went wrong while trying to upload the thumbnail.";D.response.status===500&&(C=C+" You might not have a file service configured. Please contact your administrator"),l("Error",C,"error");return}const B=j.map(D=>D.url);T.thumbnail=B[0]}const V=(I=y.current)==null?void 0:I.getContent();r(T,{onSuccess:({product:j})=>{u.current=!1,h(),s(`/a/products/${j.id}`),N.admin.client.request("POST",`/admin/product/description/${j.id}`,{content:V})},onError:j=>{u.current=!1,l("Error",te(j),"error")}})}),y=p.useRef(null);return e("form",{className:"w-full",children:a(He,{children:[e(He.Header,{children:a("div",{className:"flex w-full justify-between px-8 medium:w-8/12",children:[e(_,{size:"small",variant:"ghost",type:"button",onClick:h,children:e(Ln,{size:20})}),a("div",{className:"flex gap-x-small",children:[e(_,{size:"small",variant:"secondary",type:"button",disabled:!m,onClick:w(!1),children:"Save as draft"}),e(_,{size:"small",variant:"primary",type:"button",disabled:!m,onClick:w(!0),children:u.current?e(Fe,{}):"Publish product"})]})]})}),e(He.Main,{className:"no-scrollbar flex w-full justify-center",children:e("div",{className:"my-16 max-w-[700px] small:w-4/5 medium:w-7/12 large:w-6/12",children:a(Y,{defaultValue:["general"],type:"multiple",children:[a(Y.Item,{value:"general",title:"General information",required:!0,children:[e("p",{className:"inter-base-regular text-grey-50",children:"To start selling, all you need is a name and a price."}),a("div",{className:"mt-xlarge flex flex-col gap-y-xlarge",children:[e(Xt,{form:H(n,"general"),requireHandle:!1}),e(Kt,{form:H(n,"discounted")})]})]}),e(Y.Item,{title:"Description",value:"description",children:e(ss,{form:H(n,"description"),editorRef:y,setEditorRef:f=>y.current=f})}),a(Y.Item,{title:"Organize",value:"organize",children:[e("p",{className:"inter-base-regular text-grey-50",children:"To start selling, all you need is a name and a price."}),e("div",{className:"mt-xlarge flex flex-col gap-y-xlarge pb-xsmall",children:a("div",{children:[e("h3",{className:"inter-base-semibold mb-base",children:"Organize Product"}),e(en,{form:H(n,"organize")}),e(dt,{featureFlag:"sales_channels",children:e("div",{className:"mt-xlarge",children:e(Ki,{form:H(n,"salesChannels")})})})]})})]}),a(Y.Item,{title:"Variants",value:"variants",children:[a("p",{className:"inter-base-regular text-grey-50",children:["Add variations of this product.",e("br",{}),"Offer your customers different options for color, format, size, shape, etc."]}),e("div",{className:"mt-large",children:e(rs,{form:H(n,"variants"),productCustoms:c,productDimensions:o})})]}),a(Y.Item,{title:"Attributes",value:"attributes",children:[e("p",{className:"inter-base-regular text-grey-50",children:"Used for shipping and customs purposes."}),a("div",{className:"my-xlarge",children:[e("h3",{className:"inter-base-semibold mb-base",children:"Dimensions"}),e(ze,{form:H(n,"dimensions")})]}),a("div",{children:[e("h3",{className:"inter-base-semibold mb-base",children:"Customs"}),e(Ae,{form:H(n,"customs")})]})]}),a(Y.Item,{title:"Thumbnail",value:"thumbnail",children:[e("p",{className:"inter-base-regular mb-large text-grey-50",children:"Used to represent your product during checkout, social sharing and more."}),e(rn,{form:H(n,"thumbnail")})]}),a(Y.Item,{title:"Media",value:"media",children:[e("p",{className:"inter-base-regular mb-large text-grey-50",children:"Add images to your product."}),e(nn,{form:H(n,"media")})]})]})})})]})})},ls=(t,n=!0,r=!1)=>{var s,l;const i={title:t.general.title,subtitle:t.general.subtitle||void 0,material:t.general.material||void 0,handle:t.general.handle,discountable:t.discounted.value,is_giftcard:!1,collection_id:(s=t.organize.collection)==null?void 0:s.value,description:t.general.description||void 0,height:t.dimensions.height||void 0,length:t.dimensions.length||void 0,weight:t.dimensions.weight||void 0,width:t.dimensions.width||void 0,hs_code:t.customs.hs_code||void 0,mid_code:t.customs.mid_code||void 0,type:t.organize.type?{value:t.organize.type.label,id:t.organize.type.value}:void 0,tags:t.organize.tags?t.organize.tags.map(c=>({value:c})):void 0,origin_country:((l=t.customs.origin_country)==null?void 0:l.value)||void 0,options:t.variants.options.map(c=>({title:c.title})),variants:t.variants.entries.map(c=>{var u;return{title:c.general.title,material:c.general.material||void 0,inventory_quantity:c.stock.inventory_quantity||0,prices:os(c.prices),allow_backorder:c.stock.allow_backorder,sku:c.stock.sku||void 0,barcode:c.stock.barcode||void 0,options:c.options.map(o=>{var d;return{value:(d=o.option)==null?void 0:d.value}}),ean:c.stock.ean||void 0,upc:c.stock.upc||void 0,height:c.dimensions.height||void 0,length:c.dimensions.length||void 0,weight:c.dimensions.weight||void 0,width:c.dimensions.width||void 0,hs_code:c.customs.hs_code||void 0,mid_code:c.customs.mid_code||void 0,origin_country:((u=c.customs.origin_country)==null?void 0:u.value)||void 0,manage_inventory:c.stock.manage_inventory}}),status:n?et.PUBLISHED:et.DRAFT};return r&&(i.sales_channels=t.salesChannels.channels.map(c=>({id:c.id}))),i},Xe=()=>({general:{title:"",material:null,subtitle:null,description:null,handle:""},customs:{hs_code:null,mid_code:null,origin_country:null},dimensions:{height:null,length:null,weight:null,width:null},discounted:{value:!0},media:{images:[]},organize:{collection:null,tags:null,type:null},salesChannels:{channels:[]},thumbnail:{images:[]},variants:{entries:[],options:[]},description:{content:""}}),os=t=>t.prices.filter(r=>typeof r.amount=="number").map(r=>({amount:r.amount,currency_code:r.region_id?void 0:r.currency_code,region_id:r.region_id||void 0})),cs=["products","collections"],ds=()=>{const t=fe(),n=Tt(),[r,i]=p.useState("products"),{state:s,close:l,open:c}=J(),{resetInterval:u}=p.useContext($t),o=Ot(),d=ae(),m=Un();p.useEffect(()=>{n.search.includes("?view=collections")&&i("collections")},[n]),p.useEffect(()=>{n.search=""},[r]);const g=()=>{switch(r){case"products":return e(Gi,{});default:return e(Oi,{})}},h=()=>{switch(r){case"products":return a("div",{className:"flex space-x-2",children:[a(_,{variant:"secondary",size:"small",onClick:()=>b(),children:[e(cr,{size:20}),"Import Products"]}),a(_,{variant:"secondary",size:"small",onClick:()=>w(),children:[e(rr,{size:20}),"Export Products"]}),a(_,{variant:"secondary",size:"small",onClick:c,children:[e(Ce,{size:20}),"New Product"]})]});default:return e("div",{className:"flex space-x-2",children:a(_,{variant:"secondary",size:"small",onClick:()=>N(!v),children:[e(Ce,{size:20}),"New Collection"]})})}},[v,N]=p.useState(!1),{open:w,close:y,state:f}=J(!1),{open:b,close:x,state:T}=J(!1),V=async(F,R)=>{const O=R.filter(I=>I.key&&I.value).reduce((I,j)=>({...I,[j.key]:j.value}),{});await m.mutateAsync({...F,metadata:O},{onSuccess:({collection:I})=>{d("Success","Successfully created collection","success"),t(`/a/collections/${I.id}`),N(!1)},onError:I=>d("Error",te(I),"error")})},L=()=>{const F={type:"product-export",context:{},dry_run:!1};o.mutate(F,{onSuccess:()=>{u(),d("Success","Successfully initiated export","success")},onError:R=>{d("Error",te(R),"error")}}),y()};return a(X,{children:[e("div",{className:"flex flex-col grow h-full",children:e("div",{className:"w-full flex flex-col grow",children:e(dr,{forceDropdown:!1,customActionable:h(),customHeader:e(ur,{views:cs,setActiveView:i,activeView:r}),className:"h-fit",children:e(g,{})})})}),v&&e(mr,{onClose:()=>N(!v),onSubmit:V}),f&&e(nr,{title:"Export Products",handleClose:()=>y(),onSubmit:L,loading:o.isLoading}),T&&e(Qi,{handleClose:()=>x()}),e(lr,{isVisible:s,isFullScreen:!0,children:e(as,{onClose:l})})]})},Va=()=>a(qn,{children:[e(pt,{index:!0,element:e(ds,{})}),e(pt,{path:"/:id",element:e(_i,{})})]});export{Va as default};
