import{j as i,a as e,r,bJ as Y,bK as G,bL as U,F as L,bM as $,B as x,C as N,d as Z,bA as B,bN as K,bO as J,bP as Q,bQ as X,R as ee,b as se}from"./index-effbfb95.js";import{B as ae}from"./index-d895e52c.js";import{B as te}from"./body-card-d3fddb8c.js";import{F as j}from"./focus-modal-d105ce27.js";import{F as le}from"./index-ec3b8ff9.js";import{u as V}from"./use-toggle-state-9e07c572.js";import{T as ne,I as P}from"./index-dd9f9076.js";import{u as A}from"./use-notification-9f7c3c92.js";import{h as ie}from"./moment-fbc5633a.js";import{l as F}from"./lodash-72dfe3e0.js";import{r as S,a as q,T as w,C as ce,c as oe}from"./index-0d9858ea.js";import{T as re}from"./trash-icon-abcb5140.js";import{C as de}from"./index-a4458bf1.js";import{E as O}from"./edit-icon-8c1c10d1.js";import{S as _}from"./index-04f3341e.js";import{D}from"./delete-prompt-37f35e36.js";import{S as T,m as M}from"./side-modal-a48a422d.js";import{S as z}from"./chevron-down-6a69fe38.js";import{I as H}from"./index-d33be3e8.js";import{C as he}from"./channels-icon-c5648122.js";import"./index.esm-5a89640b.js";import"./index-1ec19c89.js";import"./error-messages-d2d0bb30.js";const ue=({size:s="20px",color:t="currentColor",...a})=>i("svg",{width:s,height:s,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a,children:[e("path",{d:"M10 17.5C14.1421 17.5 17.5 14.1421 17.5 10C17.5 5.85786 14.1421 2.5 10 2.5C5.85786 2.5 2.5 5.85786 2.5 10C2.5 14.1421 5.85786 17.5 10 17.5Z",stroke:"#6B7280",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M5 5L15 15",stroke:"#6B7280",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),R=12,me=[{accessor:"title",Header:e("div",{className:"text-gray-500 text-small font-semibold",children:"Name"}),Cell:({row:{original:s}})=>e("span",{className:"text-gray-900",children:s.title})},{accessor:"id",Header:e("div",{className:"text-gray-500 text-small font-semibold",children:"Token"}),Cell:({row:{original:s}})=>{const[t,a]=r.useState(!1),n=()=>{a(!0),navigator.clipboard.writeText(s.id)};return e(ne,{delayDuration:300,onMouseLeave:F.debounce(()=>a(!1),1e3),content:t?i("span",{className:"flex flex-row gap-1 justify-between items-center",children:[e(ce,{size:16,className:"text-green-700"})," done"]}):e("span",{onClick:n,className:"cursor-pointer",children:"Copy to clipboard"}),children:e("span",{className:"text-gray-500",children:s.id})})}},{accessor:"created_at",Header:e("div",{className:"text-gray-500 text-small font-semibold",children:"Created"}),Cell:({row:{original:s}})=>e("span",{className:"text-gray-900",children:ie(s.created_at).format("MMM Do YYYY, h:mm:ss")})},{accessor:"revoked_at",Header:e("div",{className:"text-gray-500 text-small font-semibold",children:"Status"}),Cell:({row:{original:s}})=>e("span",{className:"text-gray-900 min-w-[50px]",children:s.revoked_at?e(_,{title:"Revoked",variant:"danger"}):e(_,{title:"Live",variant:"success"})})}];function ge(s){const{row:t,isRevoked:a,showChannelsModal:n,showDetails:l}=s,o=t.original.id,[m,u]=r.useState(!1),[g,f]=r.useState(!1),{mutateAsync:d}=G(o),{mutateAsync:c}=U(o),C=[{label:"Edit API key details",onClick:l,icon:e(O,{size:16})},{label:"Edit sales channels",onClick:n,icon:e(O,{size:16})},{label:"Copy token",onClick:()=>navigator.clipboard.writeText(o),icon:e(de,{size:16})},{label:"Revoke token",onClick:()=>f(!0),icon:e(ue,{size:16}),disabled:a},{label:"Delete API key",onClick:()=>u(!0),icon:e(re,{size:16}),variant:"danger"}];return i(L,{children:[e(w.Row,{...s.row.getRowProps(),actions:C,children:s.row.cells.map(h=>e(w.Cell,{...h.getCellProps(),children:h.render("Cell")}))}),m&&e(D,{handleClose:()=>u(!1),onDelete:async()=>c(),confirmText:"Yes, delete",successText:"API key deleted",text:"Are you sure you want to delete this public key?",heading:"Delete key"}),g&&e(D,{handleClose:()=>f(!1),onDelete:async()=>d(),confirmText:"Yes, revoke",successText:"API key revoked",text:"Are you sure you want to revoke this public key?",heading:"Revoke key"})]})}function fe(s){const[t,a]=r.useState(0),[n,l]=r.useState(0),[o,m]=r.useState(0),{publishable_api_keys:u,count:g,isLoading:f}=Y({offset:t,limit:R}),d=S.useTable({columns:me,data:u||[],manualPagination:!0,initialState:{pageIndex:o,pageSize:R,selectedRowIds:{}},pageCount:n,autoResetSelectedRows:!1,autoResetPage:!1,getRowId:h=>h.id},S.usePagination);r.useEffect(()=>{typeof g<"u"&&l(Math.ceil(g/R))},[g]);const c=()=>{d.canNextPage&&(a(h=>h+d.state.pageSize),m(h=>h+1),d.nextPage())},C=()=>{d.canPreviousPage&&(a(h=>Math.max(h-d.state.pageSize,0)),m(h=>h-1),d.previousPage())};return i(q,{hasPagination:!0,isLoading:f,numberOfRows:R,pagingState:{count:g,offset:t,title:"API Keys",pageCount:d.pageCount,pageSize:t+d.rows.length,currentPage:d.state.pageIndex+1,nextPage:c,prevPage:C,hasNext:d.canNextPage,hasPrev:d.canPreviousPage},children:[i(w,{...d.getTableProps(),children:[d.headerGroups.map(h=>e(w.HeadRow,{...h.getHeaderGroupProps(),children:h.headers.map(v=>e(w.HeadCell,{...v.getHeaderProps(),children:v.render("Header")}))})),e(w.Body,{...d.getTableBodyProps(),children:d.rows.map(h=>(d.prepareRow(h),e(ge,{row:h,showDetails:()=>s.showDetailsModal(h.original),showChannelsModal:()=>s.showChannelsModal(h.original),isRevoked:!!h.original.revoked_at},h.id)))})]}),!(u!=null&&u.length)&&!f&&e("div",{className:"flex justify-center items-center h-[480px] w-[100%]",children:e("span",{className:"text-gray-400",children:"No keys yet, use the above button to create your first publishable key"})})]})}function pe(s){var g;const{close:t,selectedKey:a}=s,n=A(),[l,o]=r.useState(a==null?void 0:a.title),{mutateAsync:m}=$(a==null?void 0:a.id);return r.useEffect(()=>{a&&o(a.title)},[a]),e(T,{close:t,isVisible:!!a,children:i("div",{className:"flex flex-col justify-between h-full p-6",children:[i("div",{className:"flex items-center justify-between",children:[e("h3",{className:"inter-large-semibold text-xl text-gray-900",children:"Edit API key details"}),e(x,{variant:"ghost",onClick:t,children:e(N,{size:20,className:"text-grey-40"})})]}),e("div",{className:"h-[1px] bg-gray-200 block",style:{margin:"24px -24px"}}),e("div",{className:"flex-grow",children:e(P,{label:"Title",type:"string",name:"name",value:l,placeholder:"Name your key",onChange:({target:{value:f}})=>o(f)})}),e("div",{className:"h-[1px] bg-gray-200 block",style:{margin:"24px -24px"}}),i("div",{className:"flex justify-end gap-2",children:[e(x,{size:"small",variant:"ghost",onClick:t,children:"Cancel"}),e(x,{size:"small",variant:"primary",onClick:async()=>{try{await m({title:l}),t(),n("Success","Updated the API key","success")}catch{n("Error","Failed to update the API key","error")}},disabled:l===((g=s.selectedKey)==null?void 0:g.title),children:"Save and close"})]})]})})}const k=12,ye=[{width:30,id:"selection",Header:({getToggleAllPageRowsSelectedProps:s})=>e("span",{className:"flex justify-center w-[30px]",children:e(H,{...s()})}),Cell:({row:s})=>e("span",{onClick:t=>t.stopPropagation(),className:"flex justify-center w-[30px]",children:e(H,{...s.getToggleRowSelectedProps()})})},{Header:"Title",accessor:"name",maxWidth:160,width:160,Cell:({row:s})=>e("span",{title:s.original.name,className:"truncate block max-w-[160px]",children:s.original.name})},{Header:"Description",accessor:"description",Cell:({row:s})=>e("span",{title:s.original.description,className:"truncate block max-w-[200px]",children:s.original.description})}],E=r.forwardRef((s,t)=>{var v;const{query:a,offset:n,data:l,isLoading:o,count:m,setOffset:u,selectedChannels:g,setSelectedChannels:f}=s,d={data:l,columns:ye,autoResetPage:!1,manualPagination:!0,autoResetSelectedRows:!1,initialState:{pageIndex:Math.floor(n/k),pageSize:k,selectedRowIds:Object.keys(g).reduce((p,b)=>(p[b]=!0,p),{})},pageCount:Math.ceil(m/k),getRowId:p=>p.id},c=S.useTable(d,S.usePagination,S.useRowSelect);r.useEffect(()=>{f(p=>{const b={};return Object.keys(c.state.selectedRowIds).forEach(y=>{b[y]=p[y]||l.find(I=>I.id===y)}),b})},[c.state.selectedRowIds,l]),r.useEffect(()=>{u(0),c.gotoPage(0)},[a]);const C=()=>{c.canNextPage&&(u(n+k),c.nextPage())},h=()=>{c.canPreviousPage&&(u(Math.max(n-k,0)),c.previousPage())};return r.useImperativeHandle(t,()=>({toggleAllRowsSelected:c.toggleAllRowsSelected,toggleRowSelected:c.toggleRowSelected})),i(L,{children:[i(q,{hasPagination:!0,numberOfRows:k,isLoading:o,children:[i(w,{...c.getTableProps(),children:[e(w.Head,{children:(v=c.headerGroups)==null?void 0:v.map(p=>e(w.HeadRow,{...p.getHeaderGroupProps(),children:p.headers.map(b=>e(w.HeadCell,{...b.getHeaderProps({style:{width:b.width,maxWidth:b.maxWidth}}),children:b.render("Header")}))}))}),e(w.Body,{...c.getTableBodyProps(),children:c.rows.map(p=>(c.prepareRow(p),e(w.Row,{color:"inherit",onClick:()=>c.toggleRowSelected(p.id),className:Z("cursor-pointer",{"bg-grey-5":p.isSelected}),...p.getRowProps(),children:p.cells.map(b=>e(w.Cell,{...b.getCellProps({style:{width:b.column.width,maxWidth:b.column.maxWidth}}),children:b.render("Cell")}))})))})]}),!o&&!(l!=null&&l.length)&&e("div",{className:"absolute w-full h-full flex justify-center items-center",children:e("span",{className:"text-sma text-grey-40",children:"No added sales channels"})})]}),e("div",{className:"absolute w-[506px]",style:{bottom:100},children:e(oe,{pagingState:{count:m,offset:n,title:"Sales Channels",pageSize:n+c.rows.length,currentPage:c.state.pageIndex+1,pageCount:c.pageCount,nextPage:C,prevPage:h,hasNext:c.canNextPage,hasPrev:c.canPreviousPage},isLoading:o})})]})}),xe=({size:s="20px",color:t="currentColor",...a})=>e("svg",{width:s,height:s,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a,children:e("path",{d:"M7.66703 12.3321L3.00098 7.66605M3.00098 7.66605L7.66703 3M3.00098 7.66605H12.3331C13.5706 7.66605 14.7574 8.15765 15.6325 9.03271C16.5075 9.90776 16.9991 11.0946 16.9991 12.3321C16.9991 13.5696 16.5075 14.7564 15.6325 15.6315C14.7574 16.5066 13.5706 16.9982 12.3331 16.9982H10.0001",stroke:t,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),W=12;function be(s){const t=r.useRef(),[a,n]=r.useState({}),l=A(),[o,m]=r.useState(0),[u,g]=r.useState(""),{sales_channels:f=[],isLoading:d,count:c}=B({q:u,limit:W,offset:o},{keepPreviousData:!0,enabled:!!s.keyId}),{mutateAsync:C}=K(s.keyId);r.useEffect(()=>{var v;s.isVisible||(m(0),g(""),n({}),(v=t.current)==null||v.toggleAllRowsSelected(!1))},[s.isVisible]);const h=v=>()=>{C({sales_channel_ids:Object.keys(a).map(p=>({id:p}))}).then(()=>{l("Success","Sales channels added to the scope","success")}).catch(()=>{l("Error","Error occurred while adding sales channels to the scope of the key","success")}).finally(v)};return i("div",{className:"flex flex-col justify-between h-full p-6",children:[i("div",{className:"flex items-center justify-between",children:[i("h3",{className:"inter-large-semibold text-xl text-gray-900 flex items-center gap-2",children:[e(x,{variant:"secondary",className:"w-8 h-8 p-2 text-grey-50",onClick:s.goBack,children:e(xe,{size:18})}),"Add sales channels"]}),e(x,{variant:"secondary",className:"w-8 h-8 p-2",onClick:s.close,children:e(N,{size:20,className:"text-grey-50"})})]}),i("div",{className:"flex-grow",children:[e("div",{className:"my-6",children:e(P,{small:!0,name:"name",type:"string",value:u,className:"h-[32px]",placeholder:"Find channels",prefix:e(z,{size:16}),onChange:v=>g(v.target.value)})}),e(E,{ref:t,query:u,data:f,offset:o,count:c||0,setOffset:m,isLoading:d,selectedChannels:a,setSelectedChannels:n})]}),e("div",{className:"h-[1px] bg-gray-200 block",style:{margin:"24px -24px"}}),i("div",{className:"flex justify-end gap-2",children:[e(x,{size:"small",variant:"ghost",onClick:s.close,children:"Cancel"}),e(x,{size:"small",variant:"primary",onClick:h(s.goBack),disabled:!Object.keys(a).length,children:"Add and go back"}),e(x,{size:"small",variant:"primary",onClick:h(s.close),disabled:!Object.keys(a).length,children:"Add and close"})]})]})}function Ce(s){const{close:t}=s,a=r.useRef(),[n,l]=r.useState({}),o=Object.keys(n).length,m=A(),[u,g]=r.useState(0),[f,d]=r.useState(""),{sales_channels:c=[],isLoading:C}=J(s.keyId,{q:f},{keepPreviousData:!0,enabled:!!s.keyId}),{mutateAsync:h}=Q(s.keyId),v=()=>{var y;l({}),(y=a.current)==null||y.toggleAllRowsSelected(!1)},p=()=>{h({sales_channel_ids:Object.keys(n).map(y=>({id:y}))}).then(()=>{var y;m("Success","Sales channels removed from the scope","success"),l({}),(y=a.current)==null||y.toggleAllRowsSelected(!1)}).catch(()=>{m("Error","Error occurred while removing sales channels from the scope of the key","success")})};r.useEffect(()=>{var y;s.isVisible||(g(0),d(""),l({}),(y=a.current)==null||y.toggleAllRowsSelected(!1))},[s.isVisible]);const b=r.useMemo(()=>c==null?void 0:c.slice(u,u+W),[c,u]);return i("div",{className:"flex flex-col justify-between h-full p-6",children:[i("div",{className:"flex items-center justify-between",children:[e("h3",{className:"inter-large-semibold text-xl text-gray-900 flex items-center gap-2",children:"Edit sales channels"}),e(x,{variant:"secondary",className:"w-8 h-8 p-2",onClick:s.close,children:e(N,{size:20,className:"text-grey-50"})})]}),i("div",{className:"flex-grow",children:[i("div",{className:"flex justify-between items-center gap-2 my-6",children:[e(P,{small:!0,name:"name",type:"string",value:f,className:"h-[32px]",placeholder:"Find channels",prefix:e(z,{size:14}),onChange:y=>d(y.target.value)}),o?i("div",{className:"flex gap-2 justify-between items-center h-[32px]",children:[i("span",{className:"whitespace-nowrap text-small text-grey-50 px-2",children:[o," selected"]}),e(x,{size:"small",className:"flex-shrink-0 h-[32px]",variant:"secondary",onClick:v,children:"Deselect"}),e(x,{size:"small",className:"flex-shrink-0 h-[32px] text-rose-500",variant:"secondary",onClick:p,children:"Remove"})]}):e(x,{size:"small",className:"flex-shrink-0 h-[32px]",variant:"secondary",onClick:s.goAdd,children:"Add channels"})]}),e(E,{ref:a,query:f,data:b,offset:u,count:c.length||0,setOffset:g,isLoading:C,selectedChannels:n,setSelectedChannels:l})]}),e("div",{className:"h-[1px] bg-gray-200 block",style:{margin:"24px -24px"}}),e("div",{className:"flex justify-end gap-2",children:e(x,{size:"small",variant:"secondary",onClick:t,children:"Close"})})]})}function ve(s){const{keyId:t,close:a}=s,n=!!t,[l,o]=r.useState(!1);return r.useEffect(()=>{n||o(!1)},[n]),e(T,{close:a,isVisible:!!n,children:i(M.div,{style:{width:560*2,display:"flex",height:"100%"},animate:{x:l?-560:0},transition:{ease:"easeInOut"},children:[e(M.div,{style:{height:"100%",width:560},animate:{opacity:l?0:1},children:e(Ce,{close:a,keyId:t,isVisible:n&&!l,goAdd:()=>o(!0)})}),e(M.div,{style:{height:"100%",width:560},animate:{opacity:l?1:0},children:e(be,{close:a,keyId:t,isVisible:n&&l,goBack:()=>o(!1)})})]})})}function we(s){const t=F.sortBy(s.channels,"name");if(!t.length)return null;const a=t.map(o=>o.name).join(", "),n=t.slice(0,s.showCount).map(o=>o.name).join(", "),l=t.length-s.showCount;return i("div",{title:a,className:"text-small",children:[e("span",{children:n}),l>0&&i("span",{className:"text-grey-50",children:[" + ",l," more"]})]})}const ke=12,Se=(s,t)=>(s=Object.keys(s),t=Object.keys(t),s.length===t.length&&s.every(a=>t.includes(a)));function Ne(s){const t=r.useRef(),{isVisible:a,close:n,selectedChannels:l,setSelectedChannels:o}=s,[m,u]=r.useState({}),[g,f]=r.useState(0),[d,c]=r.useState(""),{sales_channels:C=[],isLoading:h,count:v}=B({q:d,limit:ke,offset:g},{keepPreviousData:!0}),p=()=>{o(m),f(0),c(""),n()},b=()=>{f(0),c(""),u(l),Object.values(l).map(y=>{var I;return(I=t.current)==null?void 0:I.toggleRowSelected(y.id,!0)}),n()};return e(T,{close:b,isVisible:!!a,children:i("div",{className:"flex flex-col justify-between h-full p-6",children:[i("div",{className:"flex items-center justify-between",children:[e("h3",{className:"inter-large-semibold text-xl text-gray-900 flex items-center gap-2",children:"Add sales channels"}),e(x,{variant:"secondary",className:"w-8 h-8 p-2",onClick:s.close,children:e(N,{size:20,className:"text-grey-50"})})]}),i("div",{className:"flex-grow",children:[e("div",{className:"my-6",children:e(P,{small:!0,name:"name",type:"string",value:d,className:"h-[32px]",placeholder:"Find channels",prefix:e(z,{size:16}),onChange:y=>c(y.target.value)})}),e(E,{ref:t,query:d,data:C,offset:g,count:v||0,setOffset:f,isLoading:h,selectedChannels:m,setSelectedChannels:u})]}),e("div",{className:"h-[1px] bg-gray-200 block",style:{margin:"24px -24px"}}),i("div",{className:"flex justify-end gap-2",children:[e(x,{size:"small",variant:"ghost",onClick:b,children:"Cancel"}),e(x,{size:"small",variant:"primary",onClick:p,disabled:Se(m,l),children:"Save and close"})]})]})})}function Pe(s){const{setSelectedChannels:t,selectedChannels:a}=s,[n,l,o]=V(!1),m=!!Object.keys(a).length;return i("div",{children:[i("div",{className:"flex justify-between items-center",children:[i("div",{children:[e("h5",{className:"inter-base-semibold text-grey-90 pb-1",children:"Sales channels"}),e("p",{className:"text-grey-50",children:"Connect as many sales channels to your API key as you need."})]}),!m&&e(x,{size:"small",variant:"secondary",className:"h-[40px]",onClick:l,children:"Add sales channels"})]}),m&&i("div",{className:"mt-10 flex items-center justify-between",children:[i("div",{className:"flex items-center gap-4",children:[e("div",{className:"rounded p-1 border",children:e("div",{className:"bg-gray-100 p-2 rounded",children:e(he,{})})}),e(we,{channels:Object.values(a),showCount:2})]}),e(x,{size:"small",variant:"secondary",className:"h-[40px]",onClick:l,children:"Edit sales channels"})]}),e(Ne,{close:o,isVisible:n,selectedChannels:a,setSelectedChannels:t})]})}function Ie(s){const{closeModal:t}=s,a=A(),[n,l]=r.useState(""),[o,m]=r.useState(""),[u,g]=r.useState({}),{mutateAsync:f}=X(),{mutateAsync:d}=K(o),c=async()=>{try{const C=await f({title:n});m(C.publishable_api_key.id),a("Success","Created a new API key","success")}catch{a("Error","Failed to create a new API key","error")}};return r.useEffect(()=>{o&&d({sales_channel_ids:Object.keys(u).map(C=>({id:C}))}).then(()=>{a("Success","Sales channels added to the scope","success")}).catch(()=>{a("Error","Error occurred while adding sales channels to the scope of the key","success")}).finally(t)},[o,u]),i(j,{children:[e(j.Header,{children:i("div",{className:"medium:w-8/12 w-full px-8 flex justify-between",children:[e(x,{size:"small",variant:"ghost",onClick:t,children:e(N,{size:20})}),e("div",{className:"gap-x-small flex",children:e(x,{size:"small",variant:"primary",onClick:c,disabled:!n,className:"rounded-rounded",children:"Publish API key"})})]})}),e(j.Main,{className:"w-full no-scrollbar flex justify-center",children:i("div",{className:"medium:w-7/12 large:w-6/12 small:w-4/5 max-w-[700px] my-16",children:[e("h1",{className:"inter-xlarge-semibold text-grey-90 pb-8",children:"Create API Key"}),e("h5",{className:"inter-base-semibold text-grey-90 pb-1",children:"General Information"}),e("p",{className:"text-grey-50 pb-8",children:"Create and manage API keys. Right now this is only related to sales channels."}),e(P,{label:"Title",type:"string",name:"name",value:n,className:"w-[338px]",placeholder:"Name your key",onChange:C=>l(C.target.value)}),e("div",{className:"w-[100%] h-[1px] bg-gray-200 mt-16 mb-8"}),e(Pe,{selectedChannels:u,setSelectedChannels:g})]})})]})}function Re(){const[s,t]=r.useState(),[a,n]=r.useState(),[l,o,m]=V(!1),u=[{label:"Create API key",onClick:o}],g=d=>{n(d)},f=()=>{n(null)};return i("div",{children:[e(ae,{currentPage:"Publishable API Keys",previousBreadcrumb:"Settings",previousRoute:"/a/settings"}),i(te,{title:"Publishable API keys",subtitle:"These publishable keys will allow you to authenticate API requests.",actionables:u,children:[e(fe,{showDetailsModal:t,showChannelsModal:g}),e(pe,{selectedKey:s,close:()=>t(void 0)}),e(le,{isVisible:l,isFullScreen:!0,children:e(Ie,{closeModal:m})}),e(ve,{keyId:a==null?void 0:a.id,close:f})]})]})}const Qe=()=>e(ee,{children:e(se,{index:!0,element:e(Re,{})})});export{Qe as default};
