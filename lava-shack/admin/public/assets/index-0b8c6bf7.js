import{a as e,L as Bt,j as l,cd as Ut,ce as Ht,r as b,cf as Vt,cg as Te,a5 as re,ch as $t,e as gt,F as D,M as x,B as N,d as Qe,a9 as Ye,u as oe,Z as Me,S as le,bB as Ke,bF as Ie,ci as ft,X as bt,i as Je,cj as Xe,ck as Gt,cl as Wt,cm as Zt,cn as Qt,co as Yt,cp as yt,aF as et,aE as xt,cq as Kt,C as tt,af as vt,G as Jt,cr as Xt,cs as ea,ct as ta,aB as aa,m as ra,a8 as la,cu as sa,cv as na,cw as ia,cx as ca,cy as oa,cz as da,cA as ua,cB as ma,cC as pa,R as ha,b as H}from"./index-effbfb95.js";import{C as ga,B as de}from"./index-d895e52c.js";import{F as we}from"./feature-toggle-9157e4de.js";import{C as fa}from"./channels-icon-c5648122.js";import{C as St,g as ba,I as ze,M as ya,T as xa}from"./index-65b9620f.js";import{D as va}from"./index-714f5540.js";import{T as Sa,H as Na}from"./index-d74195ae.js";import{F as Ca,M as _a}from"./index-d34652be.js";import{T as wa}from"./index-7544f455.js";import{U as ka}from"./index-1f7241c0.js";import{P as Pa}from"./index-99af6790.js";import{B as De}from"./index-3da0109e.js";import{P as Y,T as _e,I,c as je,a as nt}from"./index-dd9f9076.js";import{J as Ea,c as Ra}from"./index-e0338379.js";import{S as V}from"./index-561655b0.js";import{u as Nt,a as Ta,A as Ma,b as Ia}from"./analytics-1ab31609.js";import{u as z,C as L,c as Da}from"./index.esm-5a89640b.js";import{S as ue}from"./index-523daaeb.js";import{u as R}from"./use-notification-9f7c3c92.js";import{g as A}from"./error-messages-d2d0bb30.js";import"./index-e417090c.js";import{S as $}from"./index-dd953a8b.js";import{u as B}from"./use-toggle-state-9e07c572.js";import{a as at,T as w,S as Aa,r as O,A as Ct}from"./index-0d9858ea.js";import{I as ke}from"./index-d33be3e8.js";import{B as K}from"./body-card-d3fddb8c.js";import{F as qe}from"./index-a2e12c2a.js";import{p as Fe}from"./images-e8c4b691.js";import{T as G}from"./trash-icon-abcb5140.js";import{E as W}from"./edit-icon-8c1c10d1.js";import{A as _t}from"./index-5ca1a7bd.js";import{B as Pe,s as Oe}from"./index-84767cd7.js";import{n as Z}from"./nested-form-c66382a0.js";import{u as wt}from"./use-imperative-dialog-cb4e5fcf.js";import{c as kt}from"./react-select.esm-1ec1493a.js";import{F as T}from"./form-validator-a60b1f3b.js";import{a as La}from"./countries-bbdb373c.js";import{P as Be}from"./price-form-input-b497b56c.js";import{F as Pt}from"./index-ec3b8ff9.js";import{R as U,S as Et}from"./index-b6a697c3.js";import{F as ee}from"./focus-modal-d105ce27.js";import{A as Ue}from"./index-bf34ad3b.js";import{T as Rt}from"./two-split-pane-2374ac88.js";import{D as za}from"./duplicate-icon-dbea12ca.js";import{D as Ee}from"./delete-prompt-37f35e36.js";import{G as ja}from"./index-2674456d.js";import{T as Re,a as be}from"./shared-f9889298.js";import{L as Tt}from"./index-740955bd.js";import{I as qa}from"./image-placeholder-b3cbea02.js";import{u as Fa}from"./use-debounce-438a4ce8.js";import{C as it}from"./index-b6704001.js";import{M as ie}from"./api-9aff074a.js";import{C as Oa}from"./index-a4458bf1.js";import{R as Ba}from"./refresh-icon-ede960a5.js";import{S as ct}from"./index-04f3341e.js";import{_ as Q}from"./lodash-72dfe3e0.js";import{S as Ua}from"./side-modal-a48a422d.js";import"./chevron-down-6a69fe38.js";import"./index-e25e2e97.js";import"./toConsumableArray-6f61c395.js";import"./unsupportedIterableToArray-27301055.js";import"./index-0f96226b.js";import"./axios-4a70c6fc.js";import"./a-0eba6a7f.js";import"./react-hotkeys-hook.esm-745ca041.js";import"./index-903c1727.js";import"./index-1ec19c89.js";import"./react-select-creatable.esm-e43d0869.js";import"./_isIndex-6af6139d.js";import"./createSuper-ad9f6885.js";import"./index.esm-841d990e.js";const F=({icon:t,heading:a,description:r,to:s=null,externalLink:i=null,disabled:n=!1})=>(n&&(s=null),e(Bt,{to:s??"",className:"flex items-center flex-1",children:l("button",{className:"flex items-center flex-1 group bg-grey-0 rounded-rounded p-large border border-grey-20 h-full",disabled:n,onClick:()=>{i&&(window.location.href=i)},children:[e("div",{className:"h-2xlarge w-2xlarge bg-violet-20 rounded-circle flex justify-center items-center text-violet-60 group-disabled:bg-grey-10 group-disabled:text-grey-40",children:t}),l("div",{className:"text-left flex-1 mx-large",children:[e("h3",{className:"inter-large-semibold text-grey-90 group-disabled:text-grey-40 m-0",children:a}),e("p",{className:"inter-base-regular text-grey-50 group-disabled:text-grey-40 m-0",children:r})]}),e("div",{className:"text-grey-40 group-disabled:text-grey-30",children:e(ga,{})})]})})),ot=({size:t="24",color:a="currentColor",...r})=>l("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r,children:[e("path",{d:"M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z",stroke:a,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M21 12H17",stroke:a,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M7 12H3",stroke:a,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M12 7V3",stroke:a,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M12 21V17",stroke:a,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),Ha=({children:t})=>l("div",{children:[e(Pa,{title:"Settings",subtitle:"Manage the settings for your Medusa store"}),e("div",{className:"grid medium:grid-cols-2 auto-cols-fr grid-cols-1 gap-x-base gap-y-xsmall",children:t})]}),Va=({currency:t,isDefault:a})=>{const r=Ut(),{mutate:s}=Ht(t.code),{handleSubmit:i,control:n,reset:c}=z({defaultValues:{includes_tax:t.includes_tax}}),u=R();b.useEffect(()=>{c({includes_tax:t.includes_tax})},[t]);const o=i(d=>{s(d,{onSuccess:()=>{u("Success","Successfully updated currency","success"),r.invalidateQueries(Vt.all)},onError:m=>{u("Error",A(m),"error"),c({includes_tax:t.includes_tax})}})});return e("form",{children:l("div",{className:"flex items-center justify-between inter-base-regular",children:[l("div",{className:"flex items-center gap-x-base",children:[e("div",{className:"flex items-center justify-center bg-grey-10 rounded-rounded w-xlarge h-xlarge",children:e(St,{size:20,className:"text-grey-50"})}),l("div",{className:"flex items-center gap-x-xsmall",children:[e("p",{className:"inter-base-semibold text-grey-90",children:t.code.toUpperCase()}),e("p",{className:"text-grey-50 inter-small-regular",children:t.name})]}),a&&e("div",{className:"bg-grey-10 rounded-rounded py-[2px] px-xsmall",children:e("p",{className:"inter-small-semibold text-grey-50",children:"Default"})})]}),e(L,{control:n,name:"includes_tax",render:({field:{value:d,onChange:m}})=>e(ue,{checked:d,onCheckedChange:p=>{m(p),o()}})})]})})},$a=({store:t})=>{const{reset:a,control:r,handleSubmit:s}=z({defaultValues:dt(t)}),{mutate:i}=Te(),n=R();b.useEffect(()=>{a(dt(t))},[t]);const c=s(o=>{i({default_currency_code:o.default_currency_code.value},{onSuccess:()=>{n("Success","Successfully updated default currency","success")},onError:d=>{n("Error",A(d),"error")}})}),u=b.useMemo(()=>t.currencies.map(o=>({value:o.code,label:o.name,prefix:o.code.toUpperCase()})),[t]);return e("div",{children:e(L,{control:r,name:"default_currency_code",render:({field:{value:o,onChange:d,onBlur:m}})=>e($,{placeholder:"Choose default currency",options:u,value:o,onChange:p=>{d(p),c()},onBlur:m})})})},dt=t=>({default_currency_code:{value:t.default_currency_code,label:t.default_currency.name,prefix:t.default_currency.code.toUpperCase()}}),Ga=({store:t})=>l("div",{className:"flex flex-col gap-y-large",children:[l("div",{children:[e("h3",{className:"inter-large-semibold mb-2xsmall",children:"Default store currency"}),e("p",{className:"inter-base-regular text-grey-50",children:"This is the currency your prices are shown in."})]}),e($a,{store:t})]}),Mt=({isLoading:t,offset:a,setOffset:r,setSelectedRowIds:s,tableState:i,tableAction:n,count:c})=>{const{rows:u,headerGroups:o,getTableProps:d,getTableBodyProps:m,canNextPage:p,canPreviousPage:g,previousPage:h,nextPage:f,prepareRow:v,state:{pageSize:S,pageIndex:_,selectedRowIds:k},pageCount:C}=i,M=()=>{p&&(r(a+S),f())},y=()=>{g&&(r(a-S),h())};return b.useEffect(()=>{s&&s(Object.keys(k))},[k]),e(at,{isLoading:t,hasPagination:!0,numberOfRows:S,pagingState:{count:c,offset:a,pageSize:a+u.length,title:"Currencies",currentPage:_+1,pageCount:C,nextPage:M,prevPage:y,hasNext:p,hasPrev:g},children:l(w,{...d(),className:"table-fixed",tableActions:n,children:[e(w.Head,{children:o==null?void 0:o.map(P=>e(w.HeadRow,{...P.getHeaderGroupProps(),children:P.headers.map(E=>e(w.HeadCell,{...E.getHeaderProps(E.getSortByToggleProps()),className:Wa(E)?E.className:void 0,children:E.render("Header")}))}))}),e(w.Body,{...m(),children:u.map(P=>(v(P),e(w.Row,{...P.getRowProps(),children:P.cells.map(E=>e(w.Cell,{...E.getCellProps(),children:E.render("Cell")}))})))})]})})},Wa=t=>t.className!==void 0,It=()=>b.useMemo(()=>[{id:"selection",className:"w-[52px] px-base",disableSortBy:!0,Header:({getToggleAllPageRowsSelectedProps:a})=>e("span",{className:"flex justify-center",children:e(ke,{...a()})}),Cell:({row:a})=>e("span",{onClick:r=>r.stopPropagation(),className:"flex justify-center",children:e(ke,{...a.getToggleRowSelectedProps()})})},{Header:({column:{isSorted:a,isSortedDesc:r}})=>l("div",{className:"flex items-center gap-x-2xsmall",children:[e("span",{children:"Name"}),e(Aa,{className:"text-grey-40",ascendingColor:a&&!r?"#111827":void 0,descendingColor:r?"#111827":void 0,size:16})]}),accessor:"name",Cell:({row:a,value:r})=>l("div",{className:"flex items-center gap-x-xsmall inter-small-regular",children:[e("span",{className:"inter-small-semibold",children:a.original.code.toUpperCase()}),e("p",{children:r})]})}],[]),ye=15,Za=()=>{const[t,a]=b.useState(0),[r,s]=b.useState([]),{onClose:i,store:n}=At(),{reset:c,pop:u}=b.useContext(re),{currencies:o,count:d,isLoading:m}=$t({limit:ye,offset:t},{keepPreviousData:!0}),{mutate:p,isLoading:g}=Te(),h=R(),f=k=>{p({currencies:[...n.currencies.map(C=>C.code),...r]},{onSuccess:()=>{h("Success","Successfully updated currencies","success"),k()},onError:C=>{h("Error",A(C),"error")}})},v=gt.useMemo(()=>o||[],[o]),S=It(),_=O.useTable({data:v,columns:S,manualPagination:!0,initialState:{pageIndex:Math.floor(t/ye),pageSize:ye},autoResetPage:!1,autoResetSelectedRows:!1,getRowId:k=>k.code,pageCount:Math.ceil((d||0)/ye),defaultColumn:{width:"auto"}},O.useSortBy,O.usePagination,O.useRowSelect);return l(D,{children:[e(x.Content,{children:e(Mt,{isLoading:m,setQuery:()=>{},setSelectedRowIds:s,count:d||0,tableState:_,setOffset:a,offset:t})}),e(x.Footer,{children:l("div",{className:"w-full gap-x-xsmall flex items-center justify-end",children:[e(N,{variant:"secondary",size:"small",onClick:u,children:"Cancel"}),e(N,{variant:"primary",size:"small",onClick:()=>f(()=>{u()}),children:"Save and go back"}),e(N,{variant:"primary",size:"small",loading:g,disabled:g,onClick:()=>f(()=>{c(),i()}),children:"Save and close"})]})})]})},Qa=()=>{const{pop:t,push:a}=b.useContext(re);return{screen:{title:"Add Store Currencies",onBack:t,view:e(Za,{})},push:a}},xe=15,Ya=()=>{var f;const[t,a]=b.useState(0),[r,s]=b.useState([]),{onClose:i,store:n}=At(),{mutate:c}=Te(),u=R(),o=v=>{c({currencies:v},{onSuccess:()=>{u("Success","Successfully updated currencies","success")},onError:S=>{u("Error",A(S),"error")}})},d=It(),m=b.useMemo(()=>n.currencies.slice(t,t+xe),[n,t]),p=O.useTable({data:m||[],columns:d,manualPagination:!0,initialState:{pageIndex:Math.floor(t/xe),pageSize:xe},autoResetPage:!1,autoResetSelectedRows:!1,getRowId:v=>v.code,pageCount:Math.ceil((n.currencies.length||0)/xe)},O.useSortBy,O.usePagination,O.useRowSelect),g=()=>{s([]),p.toggleAllRowsSelected(!1)},h=()=>{const v=n.currencies.filter(S=>!r.includes(S.code)).map(S=>S.code);o(v),g()};return l(D,{children:[e(x.Header,{handleClose:i,children:e("h1",{className:"inter-xlarge-semibold",children:"Current Store Currencies"})}),e(x.Content,{children:e(Mt,{isLoading:!1,setQuery:()=>{},setSelectedRowIds:s,count:((f=n.currencies)==null?void 0:f.length)||0,tableState:p,setOffset:a,offset:t,tableAction:e(Ka,{numberOfSelectedRows:r.length,onDeselect:g,onRemove:h})})}),e(x.Footer,{children:e("div",{className:"w-full justify-end flex items-center",children:e(N,{variant:"primary",size:"small",onClick:i,children:"Close"})})})]})},Ka=({numberOfSelectedRows:t,onDeselect:a,onRemove:r})=>{const s=!!t,{screen:i,push:n}=Qa();return e("div",{className:"flex space-x-xsmall h-[34px] overflow-hidden",children:l("div",{className:Qe("transition-all duration-200",{"translate-y-[-42px]":!s,"translate-y-[0px]":s}),children:[l("div",{className:"divide-x flex items-center h-[34px] mb-2",children:[l("span",{className:"mr-3 inter-small-regular text-grey-50",children:[t," selected"]}),l("div",{className:"flex space-x-xsmall pl-3",children:[e(N,{onClick:a,size:"small",variant:"ghost",className:"border border-grey-20",children:"Deselect"}),e(N,{onClick:r,size:"small",variant:"ghost",className:"border border-grey-20 text-rose-50",children:"Remove"})]})]}),e("div",{className:"flex justify-end h-[34px]",children:l(N,{size:"small",variant:"ghost",className:"border border-grey-20",onClick:()=>n(i),children:[e(Y,{size:20})," Add Currencies"]})})]})})},Dt=b.createContext(null),Ja=({store:t,open:a,onClose:r})=>{const s=b.useContext(re);return e(Dt.Provider,{value:{onClose:r,store:t},children:e(Ye,{context:s,open:a,handleClose:r,children:e(Ya,{})})})},At=()=>{const t=b.useContext(Dt);if(!t)throw new Error("useEditCurrenciesModal must be used within EditCurrenciesModal");return t},Xa=({store:t})=>{const{state:a,close:r,toggle:s}=B();return l(D,{children:[l("div",{className:"flex items-start justify-between",children:[l("div",{children:[e("h3",{className:"inter-large-semibold mb-2xsmall",children:"Store currencies"}),e("p",{className:"inter-base-regular text-grey-50",children:"All the currencies available in your store."})]}),e(N,{variant:"secondary",size:"small",onClick:s,children:"Edit currencies"})]}),e(Ja,{store:t,open:a,onClose:r})]})},er=()=>{const t=oe(),{trackCurrencies:a}=Nt(),{store:r,status:s,error:i}=Me({onSuccess:n=>{a({used_currencies:n.store.currencies.map(c=>c.code)})}});if(i){let n="An unknown error occurred";const c=ba(i);return c&&(n=c.message,c.status===404)?(t("/404"),null):l(V,{title:"Error",children:[e("p",{className:"inter-base-regular",children:n}),e("div",{className:"mt-base px-base py-xsmall",children:e(Ea,{data:JSON.parse(JSON.stringify(i))})})]})}return s==="loading"||!r?e("div",{className:"w-full h-[calc(100vh-64px)] flex items-center justify-center",children:e(le,{variant:"secondary"})}):l("div",{className:"pb-xlarge",children:[e(De,{label:"Back to Settings",path:"/a/settings",className:"mb-xsmall"}),l("div",{className:"grid grid-cols-3 gap-base",children:[l("div",{className:"col-span-2 flex flex-col gap-y-xsmall ",children:[e(V,{title:"Currencies",children:e("p",{className:"text-grey-50 inter-base-regular mt-2xsmall",children:"Manage the markets that you will operate within."})}),l(V,{children:[e("div",{className:"mb-large",children:e(Xa,{store:r})}),e(we,{featureFlag:"tax_inclusive_pricing",children:l("div",{className:"cursor-default",children:[l("div",{className:"inter-small-semibold text-grey-50 flex items-center justify-between mb-base",children:[e("p",{children:"Currency"}),e(_e,{side:"top",content:"Decide if you want to include or exclude taxes whenever you define a price in this currency",children:e("p",{children:"Tax Incl. Prices"})})]}),e("div",{className:"grid grid-cols-1 gap-base",children:r.currencies.sort((n,c)=>n.code>c.code?1:-1).map((n,c)=>e(Va,{currency:n,isDefault:r.default_currency_code===n.code},c))})]})})]})]}),e("div",{children:e(V,{children:e(Ga,{store:r})})})]})]})},tr=()=>{const{register:t,reset:a,handleSubmit:r,setValue:s,control:i}=z(),{store:n}=Me(),{mutate:c}=Te(),u=R(),{data:{extendStore:o}={extendStore:{}}}=Ke("/extend-store",["extend-store"]),{mutate:d}=Ie("extend-store",["extend-store"]),m=()=>{n&&a(ar({...n,...o}))};b.useEffect(()=>{m()},[n,o]);const p=async({bannerImage:h,siteIcon:f,storeUrl:v,logo:S,..._})=>{const k=He(_.swap_link_template),C=He(_.payment_link_template),M=He(_.invite_link_template);if(!k){u("Error","Malformed swap url","error");return}if(!C){u("Error","Malformed payment url","error");return}if(!M){u("Error","Malformed invite url","error");return}let y={...o};if(h.nativeFile){const E=await Fe([h]);y.bannerImage=E[0].url}if(f.nativeFile){const E=await Fe([f]);y.siteIcon=E[0].url}if(v&&(y.storeUrl=v),S.nativeFile){const E=await Fe([S]);y.logo=E[0].url}d(y);const P={..._};c(P,{onSuccess:()=>{u("Success","Successfully updated store","success")},onError:E=>{u("Error",A(E),"error")}})},g=h=>f=>{if(!f.length)return;const v={url:URL.createObjectURL(f[0]),name:f[0].name,size:f[0].size,nativeFile:f[0]};s(h,v)};return l("form",{className:"flex-col py-5",children:[e(de,{previousRoute:"/a/settings/",previousBreadcrumb:"Settings",currentPage:"Store Details"}),e("div",{className:"flex w-full max-w-[632px] flex-row gap-x-3",children:l(K,{events:[{label:"Save",type:"button",onClick:r(p)},{label:"Cancel changes",type:"button",onClick:m}],title:"Store Details",subtitle:"Manage your business details",children:[e("h6",{className:"inter-base-semibold mt-large",children:"General"}),e(I,{className:"mt-base",label:"Store name",...t("name"),placeholder:"Medusa Store"}),e(I,{className:"mt-base",label:"Store URL",...t("storeUrl"),placeholder:"https://medusa.com"}),l("div",{className:"mt-base flex w-full items-center",children:[e(L,{name:"logo",control:i,render:({field:{value:h}})=>l(D,{children:[e("label",{className:"mb-xsmall text-sm text-gray-600",children:"Logo"}),h&&h.url?l("div",{className:"relative ml-auto aspect-square w-[100px]",children:[e("div",{className:"flex h-full w-full items-center justify-center",children:e("img",{src:h.url,alt:h.name||"Uploaded image",className:"aspect-square h-full min-w-full rounded-rounded"})}),e("span",{className:"absolute -top-1 -right-1",children:e(N,{onClick:()=>{s("logo",{url:""})},variant:"secondary",className:"rounded-full bg-gray-300 p-1",type:"button",children:e(W,{size:16})})})]}):e(qe,{onFileChosen:g("logo"),filetypes:["image/*"],className:"ml-auto flex aspect-square w-[100px] items-center justify-center py-large",text:"Upload image"})]})})," "]}),l("div",{className:"mt-base flex w-full items-center",children:[e(L,{name:"siteIcon",control:i,render:({field:{value:h}})=>l(D,{children:[e("label",{className:"mb-xsmall text-sm text-gray-600",children:"Site icon"}),h&&h.url?l("div",{className:"relative ml-auto aspect-square w-[100px]",children:[e("div",{className:"flex h-full w-full items-center justify-center",children:e("img",{src:h.url,alt:h.name||"Uploaded image",className:"aspect-square h-full min-w-full rounded-rounded"})}),e("span",{className:"absolute -top-1 -right-1",children:e(N,{onClick:()=>{s("siteIcon",{url:""})},variant:"secondary",className:"rounded-full bg-gray-300 p-1",type:"button",children:e(W,{size:16})})})]}):e(qe,{onFileChosen:g("siteIcon"),filetypes:["image/*"],className:"ml-auto flex aspect-square w-[100px] items-center justify-center py-large",text:"Upload icon"})]})})," "]}),l("div",{className:"mt-base",children:[e("label",{className:"mb-xsmall text-sm text-gray-600",children:"Banner Image"}),e(L,{control:i,name:"bannerImage",render:({field:{value:h}})=>h&&h.url?e(rr,{image:h,remove:()=>s("bannerImage",{url:""})}):e(qe,{onFileChosen:g("bannerImage"),filetypes:["image/*"],className:"py-large"})})]}),e("h6",{className:"inter-base-semibold mt-2xlarge",children:"Advanced settings"}),e(I,{className:"mt-base",label:"Swap link template",...t("swap_link_template"),placeholder:"https://acme.inc/swap={swap_id}"}),e(I,{className:"mt-base",label:"Draft order link template",...t("payment_link_template"),placeholder:"https://acme.inc/payment={payment_id}"}),e(I,{className:"mt-base",label:"Invite link template",...t("invite_link_template"),placeholder:"https://acme-admin.inc/invite?token={invite_token}"})]})})]})},He=t=>{if(!t||t==="")return!0;try{const a=new URL(t);return a.protocol==="http:"||a.protocol==="https:"}catch{return!1}},ar=t=>({name:t.name,swap_link_template:t.swap_link_template,payment_link_template:t.payment_link_template,invite_link_template:t.invite_link_template,bannerImage:{url:t.bannerImage??""},siteIcon:{url:t.siteIcon??""},storeUrl:t.storeUrl??"",logo:{url:t.logo??""}}),rr=({image:t,remove:a})=>l("div",{className:"group relative flex items-center justify-between rounded-rounded px-base py-xsmall hover:bg-grey-5",children:[e("div",{className:"flex aspect-video w-full items-center justify-center",children:e("img",{src:t.url,alt:t.name||"Uploaded image",className:"aspect-video h-full rounded-rounded object-cover"})}),e("span",{className:"absolute -top-1 -right-1",children:e(N,{type:"button",onClick:a,variant:"nuclear",className:"rounded-full p-1.5",children:e(G,{size:20})})})]}),lr=({user:t,open:a,onClose:r})=>{const{mutate:s,isLoading:i}=ft(t.id),{refetch:n}=bt(),{register:c,handleSubmit:u,formState:{errors:o},reset:d}=z({defaultValues:ut(t)});b.useEffect(()=>{d(ut(t))},[a,t]);const m=R(),p=u(g=>{s(g,{onSuccess:()=>{m("Success","Your information was successfully updated","success"),n(),r()},onError:()=>{}})});return l(x,{handleClose:r,open:a,isLargeModal:!1,children:[e(x.Header,{handleClose:r,children:e("h1",{className:"inter-xlarge-semibold",children:"Edit information"})}),l(x.Body,{children:[e(x.Content,{children:e("div",{className:"flex flex-col gap-y-base",children:l("div",{className:"grid grid-cols-2 gap-x-base",children:[e(I,{...c("first_name"),errors:o,label:"First name"}),e(I,{...c("last_name"),errors:o,label:"Last name"})]})})}),e(x.Footer,{className:"border-t border-grey-20 pt-base",children:l("div",{className:"flex items-center justify-end gap-x-xsmall w-full",children:[e(N,{variant:"secondary",size:"small",onClick:r,children:"Cancel"}),e(N,{variant:"primary",size:"small",loading:i,disabled:i,onClick:p,children:"Submit and close"})]})})]})]})},ut=t=>({first_name:t.first_name,last_name:t.last_name}),sr=({user:t})=>{const{state:a,toggle:r,close:s}=B(),i=b.useMemo(()=>[t==null?void 0:t.first_name,t==null?void 0:t.last_name].filter(c=>c).join(" "),[t]);return l(D,{children:[l("div",{className:"flex items-center justify-between",children:[l("div",{className:"flex items-center gap-x-base",children:[e("div",{className:"w-18 aspect-square rounded-full border border-grey-20 flex items-center justify-center box-border",children:t?e("div",{className:"w-16 aspect-square",children:e(_t,{user:{...t},color:"bg-teal-40",font:"inter-2xlarge-semibold"})}):e("div",{className:"w-16 aspect-square animate-pulse bg-teal-40 rounded-full"})}),e("div",{className:"flex flex-col",children:i?l(D,{children:[e("p",{className:"inter-base-semibold",children:i}),e("p",{className:"inter-base-regular text-grey-50",children:t==null?void 0:t.email})]}):e("p",{className:"inter-base-semibold",children:t==null?void 0:t.email})})]}),e(N,{variant:"secondary",size:"small",disabled:!t,onClick:r,children:"Edit information"})]}),t&&e(lr,{open:a,onClose:s,user:t})]})},nr=({config:t,open:a,onClose:r})=>{const{mutate:s,isLoading:i}=Ta(),n=z({defaultValues:{opt_out:t.opt_out,anonymize:t.anonymize}}),{handleSubmit:c,reset:u}=n;b.useEffect(()=>{u({opt_out:t.opt_out,anonymize:t.anonymize})},[a,t]);const o=R(),d=c(m=>{s(m,{onSuccess:()=>{o("Success","Your information was successfully updated","success"),r()},onError:p=>{o("Error",A(p),"error")}})});return l(x,{handleClose:r,open:a,isLargeModal:!0,children:[e(x.Header,{handleClose:r,children:e("h1",{className:"inter-xlarge-semibold",children:"Edit preferences"})}),l(x.Body,{children:[e(x.Content,{children:e(Ma,{form:Z(n)})}),e(x.Footer,{className:"border-t border-grey-20 pt-base",children:l("div",{className:"flex items-center justify-end gap-x-xsmall w-full",children:[e(N,{variant:"secondary",size:"small",onClick:r,children:"Cancel"}),e(N,{variant:"primary",size:"small",loading:i,disabled:i,onClick:d,children:"Submit and close"})]})})]})]})},ir=({user:t})=>{const{analytics_config:a,isLoading:r}=Ia(),{state:s,toggle:i,close:n}=B();return l(D,{children:[l("div",{className:"flex items-center justify-between",children:[l("div",{className:"flex flex-col gap-y-2xsmall",children:[l("div",{className:"flex items-center gap-x-xsmall",children:[e("h2",{className:"inter-base-semibold",children:"Usage insights"}),r?e("div",{className:"badge bg-grey-10 animate-pulse w-16 h-large"}):!a||a!=null&&a.opt_out?e(Pe,{variant:"disabled",children:"Disabled"}):e(Pe,{variant:"success",children:"Active"})]}),e("p",{className:"inter-base-regular text-grey-50",children:"Share usage insights and help us improve Medusa"})]}),e(N,{variant:"secondary",size:"small",onClick:i,disabled:!a,children:"Edit preferences"})]}),a&&t&&e(nr,{open:s,onClose:n,config:a})]})},cr=()=>{const{isFeatureEnabled:t}=Je(),{user:a}=bt();return l("div",{children:[e(De,{label:"Back to Settings",path:"/a/settings",className:"mb-xsmall"}),l("div",{className:"bg-white flex flex-col rounded-rounded border border-grey-20 pt-large pb-xlarge px-xlarge gap-y-xlarge large:max-w-[50%]",children:[l("div",{className:"flex flex-col gap-y-2xsmall",children:[e("h1",{className:"inter-xlarge-semibold",children:"Personal information"}),e("p",{className:"inter-base-regular text-grey-50",children:"Manage your Medusa profile"})]}),l("div",{className:"flex flex-col",children:[e("div",{className:"border-t border-grey-20 py-xlarge",children:e(sr,{user:a})}),t("analytics")&&e("div",{className:"border-t border-grey-20 py-xlarge",children:e(ir,{user:a})})]})]})]})};function ae(t){switch(t){case"primecargo":return{label:"Prime Cargo",value:"primecargo"};case"manual":return{label:"Manual",value:"manual"};case"webshipper":return{label:"Webshipper",value:"webshipper"};default:return{label:t,value:t}}}const or={stripe:{label:"Stripe",value:"stripe"},"stripe-ideal":{label:"Stripe Ideal",value:"stripe-ideal"},"stripe-giropay":{label:"Stripe Giropay",value:"stripe-giropay"},"stripe-bancontact":{label:"Stripe Bancontact",value:"stripe-bancontact"},"stripe-przelewy24":{label:"Stripe Przelewy24",value:"stripe-przelewy24"},"stripe-blik":{label:"Stripe Blik",value:"stripe-blik"},"mobilepay-adyen":{label:"MobilePay via Adyen",value:"mobilepay-adyen"},"scheme-adyen":{label:"Cards via Adyen",value:"scheme-adyen"},"klarna-adyen":{label:"Klarna via Adyen",value:"klarna-adyen"},klarna:{label:"Klarna",value:"klarna"},"paywithgoogle-adyen":{label:"GooglePay via Adyen",value:"paywithgoogle-adyen"},"applepay-adyen":{label:"ApplePay via Adyen",value:"applepay-adyen"},"paypal-adyen":{label:"PayPal via Adyen",value:"paypal-adyen"},"ideal-adyen":{label:"iDEAL via Adyen",value:"ideal-adyen"},manual:{label:"Manual",value:"manual"}};function ce(t){return or[t]??{label:t,value:t}}const Lt=()=>{const{store:t,isLoading:a}=Me(),{fulfillment_providers:r,payment_providers:s}=t,i=b.useMemo(()=>a?[]:(s==null?void 0:s.map(o=>ce(o.id)))||[],[s,a]),n=b.useMemo(()=>a?[]:(r==null?void 0:r.map(o=>ae(o.id)))||[],[r,a]),c=b.useMemo(()=>a?[]:(t==null?void 0:t.currencies.map(o=>({label:o.name,value:o.code})))||[],[t,a]),u=La.map(o=>({label:o.name,value:o.alpha2.toLowerCase()}));return{paymentProviderOptions:i,fulfillmentProviderOptions:n,currencyOptions:c,countryOptions:u}},zt=({form:t,isCreate:a=!1})=>{const{control:r,register:s,path:i,formState:{errors:n}}=t,{currencyOptions:c,countryOptions:u}=Lt();return l("div",{children:[l("div",{className:"grid grid-cols-2 gap-large",children:[e(I,{label:"Title",placeholder:"Europe",required:!0,...s(i("name"),{required:"Title is required",minLength:T.minOneCharRule("Title"),pattern:T.whiteSpaceRule("Title")}),errors:n}),e(L,{control:r,name:i("currency_code"),rules:{required:"Currency code is required"},render:({field:o})=>e($,{label:"Currency",placeholder:"Choose currency",required:!0,...o,options:c,name:i("currency_code"),errors:n})}),a&&l(D,{children:[e(I,{label:"Default Tax Rate",required:!0,placeholder:"25",prefix:"%",step:1,type:"number",...s(i("tax_rate"),{required:a?"Tax rate is required":void 0,max:{value:100,message:"Tax rate must be equal to or less than 100"},min:T.nonNegativeNumberRule("Tax rate"),valueAsNumber:!0}),errors:n}),e(I,{label:"Default Tax Code",placeholder:"1000",...s(i("tax_code")),errors:n})]}),e(L,{control:r,name:i("countries"),render:({field:o})=>e($,{label:"Countries",placeholder:"Choose countries",isMulti:!0,selectAll:!0,...o,name:i("countries"),errors:n,options:u})})]}),e(we,{featureFlag:"tax_inclusive_pricing",children:l("div",{className:"mt-xlarge flex items-start justify-between",children:[l("div",{className:"flex flex-col gap-y-2xsmall",children:[e("h3",{className:"inter-base-semibold",children:"Tax inclusive prices"}),e("p",{className:"inter-base-regular text-grey-50",children:"When enabled region prices will be tax inclusive."})]}),e(L,{control:r,name:i("includes_tax"),render:({field:{value:o,onChange:d}})=>e(ue,{checked:o,onCheckedChange:d})})]})})]})},jt=({form:t})=>{const{control:a,path:r,formState:{errors:s}}=t,{fulfillmentProviderOptions:i,paymentProviderOptions:n}=Lt();return l("div",{className:"grid grid-cols-2 gap-large",children:[e(L,{control:a,name:r("payment_providers"),rules:{required:"Payment providers are required",minLength:{value:1,message:"Payment providers are required"}},render:({field:{value:c,onBlur:u,onChange:o}})=>e($,{label:"Payment Providers",placeholder:"Choose payment providers...",options:n,isMulti:!0,isClearable:!0,required:!0,selectAll:!0,value:c,onChange:o,onBlur:u,name:r("payment_providers"),errors:s})}),e(L,{control:a,name:r("fulfillment_providers"),rules:{required:"Fulfillment providers are required",minLength:{value:1,message:"Fulfillment providers are required"}},render:({field:{onBlur:c,onChange:u,value:o}})=>e($,{label:"Fulfillment Providers",placeholder:"Choose fulfillment providers...",options:i,required:!0,isMulti:!0,isClearable:!0,selectAll:!0,value:o,onChange:u,onBlur:c,name:r("fulfillment_providers"),errors:s})})]})},dr=({region:t,onClose:a,open:r})=>{const s=z({defaultValues:Ve(t)}),{isFeatureEnabled:i}=Je(),{reset:n,handleSubmit:c,formState:{isDirty:u}}=s,o=()=>{n(Ve(t)),a()};b.useEffect(()=>{n(Ve(t))},[t]);const{mutate:d,isLoading:m}=Xe(t.id),p=R(),g=c(h=>{var v;const f={name:h.details.name,currency_code:(v=h.details.currency_code)==null?void 0:v.value,payment_providers:h.providers.payment_providers.map(S=>S.value),fulfillment_providers:h.providers.fulfillment_providers.map(S=>S.value),countries:h.details.countries.map(S=>S.value)};i("tax_inclusive_pricing")&&(f.includes_tax=h.details.includes_tax),d(f,{onSuccess:()=>{p("Success","Region was successfully updated","success"),o()},onError:S=>{p("Error",A(S),"error")}})});return e(x,{handleClose:o,open:r,children:l(x.Body,{children:[e(x.Header,{handleClose:o,children:e("h1",{className:"inter-xlarge-semibold",children:"Edit Region Details"})}),l("form",{onSubmit:g,children:[l(x.Content,{children:[l("div",{children:[e("h3",{className:"inter-base-semibold mb-base",children:"Details"}),e(zt,{form:Z(s,"details")})]}),e("div",{className:"w-full h-px bg-grey-20 my-xlarge"}),l("div",{children:[e("h3",{className:"inter-base-semibold mb-base",children:"Providers"}),e(jt,{form:Z(s,"providers")})]})]}),e(x.Footer,{children:l("div",{className:"w-full flex items-center justify-end gap-x-xsmall",children:[e(N,{variant:"secondary",size:"small",type:"button",onClick:o,children:"Cancel"}),e(N,{variant:"primary",size:"small",type:"submit",loading:m,disabled:m||!u,children:"Save and close"})]})})]})]})})},Ve=t=>({details:{countries:t.countries?t.countries.map(a=>({value:a.iso_2,label:a.display_name})):[],currency_code:{value:t.currency_code,label:kt[t.currency_code.toUpperCase()].name},name:t.name,tax_code:null,tax_rate:null,includes_tax:t.includes_tax},providers:{fulfillment_providers:t.fulfillment_providers?t.fulfillment_providers.map(a=>ae(a.id)):[],payment_providers:t.payment_providers?t.payment_providers.map(a=>ce(a.id)):[]}}),ur=({region:t})=>{const{state:a,toggle:r,close:s}=B(),{mutate:i}=Gt(t.id),n=oe(),c=R(),u=wt(),o=async()=>{await u({heading:"Delete Region",text:"Are you sure you want to delete this region?",extraConfirmation:!0,entityName:t.name})&&i(void 0,{onSuccess:()=>{n("/a/settings/regions",{replace:!0}),c("Success","Region has been deleted","success"),n("/a/settings/regions",{replace:!0})},onError:m=>{c("Error",A(m),"error")}})};return l(D,{children:[e(V,{title:t.name,actions:[{label:"Edit Region Details",onClick:r,icon:e(W,{size:20,className:"text-grey-50"})},{label:"Delete Region",onClick:o,icon:e(G,{size:20}),variant:"danger"}],children:l("div",{className:"flex flex-col gap-y-xsmall mt-large",children:[e("h2",{className:"inter-large-semibold",children:"Details"}),l("div",{className:"flex flex-col gap-y-xsmall",children:[e(ve,{title:"Currency",children:l("div",{className:"flex items-center gap-x-xsmall",children:[e("span",{className:"inter-base-semibold text-grey-90",children:t.currency_code.toUpperCase()}),e("span",{children:kt[t.currency_code.toUpperCase()].name})]})}),e(ve,{title:"Countries",children:e("div",{children:t.countries&&t.countries.length?l("div",{className:"flex items-center gap-x-xsmall",children:[e("p",{children:t.countries.slice(0,4).map(d=>d.display_name).join(", ")}),t.countries.length>4&&e(_e,{side:"right",content:e("ul",{children:t.countries.slice(4).map(d=>e("li",{children:d.display_name},d.id))}),children:l("span",{className:"cursor-default",children:["+ ",t.countries.length-4," more"]})})]}):e("p",{children:"No countries configured"})})}),e(ve,{title:"Payment providers",children:e("div",{children:t.payment_providers&&t.payment_providers.length?l("div",{className:"flex items-center gap-x-xsmall",children:[e("p",{children:t.payment_providers.slice(0,4).map(d=>ce(d.id).label).join(", ")}),t.payment_providers.length>4&&e(_e,{side:"right",content:e("ul",{children:t.payment_providers.slice(4).map(d=>e("li",{children:ce(d.id)},d.id))}),children:l("span",{className:"cursor-default",children:["+ ",t.payment_providers.length-4," more"]})})]}):e("p",{children:"No payment providers configured"})})}),e(ve,{title:"Fulfillment providers",children:e("div",{children:t.payment_providers&&t.payment_providers.length?l("div",{className:"flex items-center gap-x-xsmall",children:[e("p",{children:t.fulfillment_providers.slice(0,4).map(d=>ae(d.id).label).join(", ")}),t.fulfillment_providers.length>4&&e(_e,{side:"right",content:e("ul",{children:t.fulfillment_providers.slice(4).map(d=>e("li",{children:ae(d.id)},d.id))}),children:l("span",{className:"cursor-default",children:["+ ",t.fulfillment_providers.length-4," more"]})})]}):e("p",{children:"No fulfillment providers configured"})})})]})]})}),e(dr,{region:t,onClose:s,open:a})]})},ve=({title:t,children:a})=>l("div",{className:"flex items-center justify-between inter-base-regular text-grey-50",children:[e("p",{children:t}),a]}),Ae=(t,a=!1)=>{const{shipping_profiles:r}=Wt(),{fulfillment_options:s}=Zt(t),i=b.useMemo(()=>s?s.reduce((d,m,p)=>{const h=m.options.filter(f=>!!f.is_return==!!a);return d.concat(h.map((f,v)=>({label:`${f.name||f.id} via ${ae(m.provider_id).label}`,value:`${p}.${v}`})))},[]):[],[s]);return{shippingProfileOptions:b.useMemo(()=>(r==null?void 0:r.map(o=>({value:o.id,label:o.name})))||[],[r]),fulfillmentOptions:i,getFulfillmentData:o=>{const d=s==null?void 0:s.map(f=>{const S=f.options.filter(_=>!!_.is_return==!!a);return{...f,options:S}}),[m,p]=o.split("."),{provider_id:g,options:h}=(d==null?void 0:d[m])||{};return{provider_id:g,data:(h==null?void 0:h[p])||{}}},getRequirementsData:o=>Object.entries(o.requirements).reduce((m,[p,g])=>(typeof(g==null?void 0:g.amount)=="number"&&g.amount>=0&&m.push({type:p,amount:g.amount,id:g.id||void 0}),m),[])}},rt=({form:t,region:a,isEdit:r=!1})=>{var d;const{register:s,watch:i,control:n,formState:{errors:c}}=t,{shippingProfileOptions:u,fulfillmentOptions:o}=Ae(a.id);return l("div",{children:[e("div",{children:l("div",{className:"flex flex-col gap-y-2xsmall",children:[l("div",{className:"flex items-center justify-between",children:[e("h3",{className:"inter-base-semibold mb-2xsmall",children:"Visible in store"}),e(L,{control:n,name:"store_option",render:({field:{value:m,onChange:p}})=>e(ue,{checked:m,onCheckedChange:p})})]}),e("p",{className:"inter-base-regular text-grey-50",children:"Enable or disable the shipping option visiblity in store."})]})}),e("div",{className:"h-px w-full bg-grey-20 my-xlarge"}),l("div",{children:[e("h3",{className:"inter-base-semibold mb-base",children:"Details"}),l("div",{className:"grid grid-cols-2 gap-large",children:[e(I,{label:"Title",required:!0,...s("name",{required:"Title is required",pattern:T.whiteSpaceRule("Title"),minLength:T.minOneCharRule("Title")}),errors:c}),l("div",{className:"flex items-center gap-large",children:[e(L,{control:n,name:"price_type",render:({field:{onChange:m,value:p,onBlur:g}})=>e($,{label:"Price Type",required:!0,value:p,onChange:m,onBlur:g,options:[{label:"Flat Rate",value:"flat_rate"},{label:"Calculated",value:"calculated"}],placeholder:"Choose a price type",errors:c})}),((d=i("price_type"))==null?void 0:d.value)==="flat_rate"&&e(L,{control:n,name:"amount",rules:{min:T.nonNegativeNumberRule("Price"),max:T.maxInteger("Price",a.currency_code)},render:({field:{value:m,onChange:p}})=>l("div",{children:[e(je,{label:"Price",className:"mb-2xsmall",tooltip:e(ze,{includesTax:a.includes_tax})}),e(Be,{amount:m||void 0,onChange:p,name:"amount",currencyCode:a.currency_code,errors:c})]})})]}),!r&&l(D,{children:[e(L,{control:n,name:"shipping_profile",render:({field:m})=>e($,{label:"Shipping Profile",required:!0,options:u,placeholder:"Choose a shipping profile",...m,errors:c})}),e(L,{control:n,name:"fulfillment_provider",render:({field:m})=>e($,{label:"Fulfillment Method",required:!0,placeholder:"Choose a fulfillment method",options:o,...m,errors:c})})]})]})]}),e("div",{className:"h-px w-full bg-grey-20 my-xlarge"}),l("div",{children:[e("h3",{className:"inter-base-semibold mb-base",children:"Requirements"}),l("div",{className:"grid grid-cols-2 gap-large",children:[e(L,{control:n,name:"requirements.min_subtotal.amount",rules:{min:T.nonNegativeNumberRule("Min. subtotal"),max:T.maxInteger("Min. subtotal",a.currency_code),validate:m=>{if(m===null)return!0;const p=t.getValues("requirements.max_subtotal.amount");return p&&m>p?"Min. subtotal must be less than max. subtotal":!0}},render:({field:{value:m,onChange:p}})=>l("div",{children:[e(je,{label:"Min. subtotal",className:"mb-xsmall",tooltip:e(ze,{includesTax:a.includes_tax})}),e(Be,{amount:typeof m=="number"?m:void 0,onChange:p,name:"requirements.min_subtotal.amount",currencyCode:a.currency_code,errors:c})]})}),e(L,{control:n,name:"requirements.max_subtotal.amount",rules:{min:T.nonNegativeNumberRule("Max. subtotal"),max:T.maxInteger("Max. subtotal",a.currency_code),validate:m=>{if(m===null)return!0;const p=t.getValues("requirements.min_subtotal.amount");return p&&m<p?"Max. subtotal must be greater than min. subtotal":!0}},render:({field:{value:m,onChange:p,ref:g}})=>l("div",{ref:g,children:[e(je,{label:"Max. subtotal",className:"mb-xsmall",tooltip:e(ze,{includesTax:a.includes_tax})}),e(Be,{amount:typeof m=="number"?m:void 0,onChange:p,name:"requirements.max_subtotal.amount",currencyCode:a.currency_code,errors:c})]})})]})]})]})},mr=({open:t,onClose:a,option:r})=>{const s=z({defaultValues:$e(r)}),{mutate:i,isLoading:n}=Qt(r.id),{getRequirementsData:c}=Ae(r.region_id),u=R(),{reset:o,handleSubmit:d,formState:{isDirty:m}}=s;b.useEffect(()=>{o($e(r))},[r]);const p=()=>{o($e(r)),a()},g=d(h=>{i({name:h.name,requirements:c(h),admin_only:!h.store_option,amount:h.amount},{onSuccess:()=>{u("Success","Shipping option updated","success"),p()},onError:f=>{u("Error",A(f),"error")}})});return e(x,{open:t,handleClose:p,children:l(x.Body,{children:[e(x.Header,{handleClose:p,children:e("h1",{className:"inter-xlarge-semibold",children:"Edit Shipping Option"})}),l("form",{onSubmit:g,children:[l(x.Content,{children:[l("div",{children:[e("p",{className:"inter-base-semibold",children:"Fulfillment Method"}),l("p",{className:"inter-base-regular text-grey-50",children:[r.data.id," via ",r.provider_id]})]}),e("div",{className:"w-full h-px bg-grey-20 my-xlarge"}),e(rt,{form:s,region:r.region,isEdit:!0})]}),e(x.Footer,{children:l("div",{className:"flex items-center gap-x-xsmall justify-end w-full",children:[e(N,{variant:"secondary",size:"small",onClick:p,children:"Cancel"}),e(N,{variant:"primary",size:"small",type:"submit",loading:n,disabled:n||!m,children:"Save and close"})]})})]})]})})},$e=t=>{const a=t.requirements.find(s=>s.type==="min_subtotal"),r=t.requirements.find(s=>s.type==="max_subtotal");return{store_option:!t.admin_only,name:t.name,price_type:{label:t.price_type==="flat_rate"?"Flat rate":"Calculated Price",value:t.price_type},fulfillment_provider:null,shipping_profile:null,requirements:{min_subtotal:a?{amount:a.amount,id:a.id}:null,max_subtotal:r?{amount:r.amount,id:r.id}:null},amount:t.amount}},qt=({option:t})=>{var u,o,d,m;const{state:a,toggle:r,close:s}=B(),{mutate:i}=Yt(t.id),n=R(),c=()=>{i(void 0,{onSuccess:()=>{n("Success","Shipping option has been deleted","success")},onError:p=>{n("Error",A(p),"error")}})};return l(D,{children:[l("div",{className:"bg-grey-0 rounded-rounded border border-grey-20 p-base flex items-center justify-between",children:[l("div",{className:"flex items-center gap-x-base",children:[e("div",{className:"bg-grey-10 p-2.5 rounded-rounded flex items-center justify-center h-10 w-10",children:e(Ca,{size:20,className:"text-grey-50"})}),l("div",{children:[e("p",{className:"inter-base-semibold",children:t.name}),e("div",{children:l("p",{className:"inter-small-regular text-grey-50",children:[t.price_type==="flat_rate"?"Flat Rate":"Calcualted",":"," ",Oe({amount:t.amount,currencyCode:t.region.currency_code})," ","- Min. subtotal:"," ",Oe({amount:(o=(u=t.requirements)==null?void 0:u.find(p=>p.type==="min_subtotal"))==null?void 0:o.amount,currencyCode:t.region.currency_code})," ","- Max. subtotal:"," ",Oe({amount:(m=(d=t.requirements)==null?void 0:d.find(p=>p.type==="max_subtotal"))==null?void 0:m.amount,currencyCode:t.region.currency_code})]})})]})]}),l("div",{className:"flex items-center gap-x-base",children:[e("div",{className:Qe("py-0.5 px-xsmall rounded-rounded",{"bg-grey-10 text-grey-50":t.admin_only,"bg-emerald-10 text-emerald-50":!t.admin_only}),children:e("span",{className:"inter-small-semibold",children:t.admin_only?"Admin":"Store"})}),e("div",{children:e(Ct,{actions:[{label:"Edit",onClick:r,icon:e(W,{size:20})},{label:"Delete",onClick:c,icon:e(G,{size:20}),variant:"danger"}]})})]})]}),e(mr,{option:t,open:a,onClose:s})]})},pr=({open:t,onClose:a,region:r})=>{const s=z(),{formState:{isDirty:i},handleSubmit:n,reset:c}=s,{mutate:u,isLoading:o}=yt(),{getFulfillmentData:d,getRequirementsData:m}=Ae(r.id),p=R(),g=()=>{c(),a()},h=n(f=>{var _;const{provider_id:v,data:S}=d(f.fulfillment_provider.value);u({is_return:!0,region_id:r.id,name:f.name,profile_id:(_=f.shipping_profile)==null?void 0:_.value,data:S,price_type:"flat_rate",provider_id:v,admin_only:!f.store_option,amount:f.amount,requirements:m(f)},{onSuccess:()=>{p("Success","Shipping option created","success"),g()},onError:k=>{p("Error",A(k),"error")}})});return e(x,{open:t,handleClose:g,children:l(x.Body,{children:[e(x.Header,{handleClose:g,children:e("h1",{className:"inter-xlarge-semibold",children:"Add Return Shipping Option"})}),l("form",{onSubmit:h,children:[e(x.Content,{children:e(rt,{form:s,region:r})}),e(x.Footer,{children:l("div",{className:"w-full flex items-center gap-x-xsmall justify-end",children:[e(N,{variant:"secondary",size:"small",type:"button",onClick:g,children:"Cancel"}),e(N,{variant:"primary",size:"small",type:"submit",loading:o,disabled:o||!i,children:"Save and close"})]})})]})]})})},hr=({region:t})=>{const{shipping_options:a}=et({region_id:t.id,is_return:!0}),{state:r,toggle:s,close:i}=B();return l(D,{children:[e(V,{title:"Return Shipping Options",actions:[{label:"Add Option",onClick:s}],children:l("div",{className:"flex flex-col gap-y-large",children:[e("p",{className:"inter-base-regular text-grey-50",children:"Enter specifics about available regional return shipment methods."}),e("div",{className:"flex flex-col gap-y-small",children:a==null?void 0:a.map(n=>e(qt,{option:n},n.id))})]})}),e(pr,{onClose:i,open:r,region:t})]})},gr=({open:t,onClose:a,region:r})=>{const s=z(),{formState:{isDirty:i},handleSubmit:n,reset:c}=s,{mutate:u,isLoading:o}=yt(),{getFulfillmentData:d,getRequirementsData:m}=Ae(r.id),p=R(),g=()=>{c(),a()},h=n(f=>{var _;const{provider_id:v,data:S}=d(f.fulfillment_provider.value);u({is_return:!1,region_id:r.id,profile_id:(_=f.shipping_profile)==null?void 0:_.value,name:f.name,data:S,price_type:f.price_type.value,provider_id:v,admin_only:!f.store_option,amount:f.amount,requirements:m(f)},{onSuccess:()=>{p("Success","Shipping option created","success"),g()},onError:k=>{p("Error",A(k),"error")}})});return e(x,{open:t,handleClose:g,children:l(x.Body,{children:[e(x.Header,{handleClose:g,children:e("h1",{className:"inter-xlarge-semibold",children:"Add Shipping Option"})}),l("form",{onSubmit:h,children:[e(x.Content,{children:e(rt,{form:s,region:r})}),e(x.Footer,{children:l("div",{className:"w-full flex items-center gap-x-xsmall justify-end",children:[e(N,{variant:"secondary",size:"small",type:"button",onClick:g,children:"Cancel"}),e(N,{variant:"primary",size:"small",type:"submit",loading:o,disabled:o||!i,children:"Save and close"})]})})]})]})})},fr=({region:t})=>{const{shipping_options:a}=et({region_id:t.id,is_return:!1}),{state:r,toggle:s,close:i}=B();return l(D,{children:[e(V,{title:"Shipping Options",actions:[{label:"Add Option",onClick:s}],children:l("div",{className:"flex flex-col gap-y-large",children:[e("p",{className:"inter-base-regular text-grey-50",children:"Enter specifics about available regional shipment methods."}),e("div",{className:"flex flex-col gap-y-small",children:a==null?void 0:a.map(n=>e(qt,{option:n},n.id))})]})}),e(gr,{open:r,onClose:i,region:t})]})},br=({id:t})=>{const{region:a,isLoading:r,isError:s}=xt(t,{enabled:!!t});return r?e("div",{className:"h-full w-full flex items-center justify-center",children:e(le,{variant:"secondary"})}):s?l("div",{className:"bg-grey-0 rounded-rounded border border-grey-20 flex flex-col gap-y-xsmall items-center justify-center w-full h-full text-center ",children:[e("h1",{className:"inter-large-semibold",children:"Something went wrong..."}),e("p",{className:"inter-base-regular text-grey-50",children:"We can't find a region with that ID, use the menu to the left to select a region."})]}):a?l("div",{className:"flex flex-col gap-y-xsmall",children:[e(ur,{region:a}),e(fr,{region:a}),e(hr,{region:a})]}):null},yr=({onClose:t})=>{const[a,r]=b.useState(["details"]),s=z({defaultValues:mt()}),{formState:{isDirty:i},handleSubmit:n,reset:c}=s,{mutate:u,isLoading:o}=Kt(),d=oe(),m=R(),{isFeatureEnabled:p}=Je(),g=()=>{c(mt()),t()},h=n(f=>{var S;const v={name:f.details.name,countries:f.details.countries.map(_=>_.value),currency_code:(S=f.details.currency_code)==null?void 0:S.value,fulfillment_providers:f.providers.fulfillment_providers.map(_=>_.value),payment_providers:f.providers.payment_providers.map(_=>_.value),tax_rate:f.details.tax_rate,tax_code:f.details.tax_code||void 0};p("tax_inclusive_pricing")&&(v.includes_tax=f.details.includes_tax),u(v,{onSuccess:({region:_})=>{m("Success","Region created","success"),d(`/a/settings/regions/${_.id}`),g()},onError:_=>{m("Error",A(_),"error")}})},f=>{f.providers&&!a.includes("providers")&&r(v=>[...v,"providers"])});return e("form",{className:"w-full",onSubmit:h,noValidate:!0,children:l(ee,{children:[e(ee.Header,{children:l("div",{className:"flex w-full justify-between px-8 medium:w-8/12",children:[e(N,{size:"small",variant:"ghost",type:"button",onClick:g,children:e(tt,{size:20})}),e("div",{className:"flex gap-x-small",children:e(N,{size:"small",variant:"primary",loading:o,disabled:!i||o,type:"submit",children:"Create region"})})]})}),e(ee.Main,{className:"no-scrollbar flex w-full justify-center",children:e("div",{className:"my-16 max-w-[700px] small:w-4/5 medium:w-7/12 large:w-6/12",children:l(Ue,{value:a,onValueChange:r,type:"multiple",children:[l(Ue.Item,{title:"Details",value:"details",forceMountContent:!0,required:!0,children:[e("p",{className:"inter-base-regular mb-xlarge text-grey-50",children:"Add the region details."}),e(zt,{form:Z(s,"details"),isCreate:!0})]}),l(Ue.Item,{title:"Providers",value:"providers",forceMountContent:!0,required:!0,children:[e("p",{className:"inter-base-regular mb-xlarge text-grey-50",children:"Add which fulfillment and payment providers shoulb be available in this region."}),e(jt,{form:Z(s,"providers")})]})]})})})]})})},mt=()=>({details:{countries:[]},providers:{payment_providers:void 0,fulfillment_providers:void 0}}),xr=({region:t})=>{var a,r;return e(U.Item,{value:t.id,label:t.name,sublabel:t.countries&&t.countries.length?`(${t.countries.map(s=>s.display_name).join(", ")})`:void 0,children:l("div",{className:"flex flex-col gap-y-2xsmall inter-small-regular text-grey-50",children:[l("p",{children:["Payment providers:"," ",e("span",{className:"truncate",children:(a=t.payment_providers)!=null&&a.length?t.payment_providers.map(s=>ce(s.id).label).join(", "):"Not configured"})]}),l("p",{children:["Fulfillment providers:"," ",e("span",{className:"truncate",children:(r=t.fulfillment_providers)!=null&&r.length?t.fulfillment_providers.map(s=>ae(s.id).label).join(", "):"Not configured"})]})]})})},vr=({id:t})=>{const a=oe(),{trackRegions:r}=Nt(),{regions:s,isLoading:i}=vt(void 0,{onSuccess:({regions:p,count:g})=>{r({regions:p.map(h=>h.name),count:g})}}),[n,c]=gt.useState(t);b.useEffect(()=>{t&&u(t),!t&&s&&s.length>0&&u(s[0].id)},[t,s]),b.useEffect(()=>{i||!n&&s&&s.length>0&&a(`/a/settings/regions/${s[0].id}`,{replace:!0})},[s,i,n]);const u=p=>{p!==n&&(c(p),a(`/a/settings/regions/${p}`))},{state:o,toggle:d,close:m}=B();return l(D,{children:[l(V,{title:"Regions",customActions:e("div",{children:e(N,{variant:"ghost",size:"small",className:"h-xlarge w-xlarge",onClick:d,children:e(Y,{})})}),className:"h-full",children:[e("p",{className:"text-base-regular text-grey-50 mt-2xsmall",children:"Manage the markets that you will operate within."}),e("div",{className:"mt-large",children:e(U.Root,{value:n,onValueChange:u,children:s==null?void 0:s.map(p=>e(xr,{region:p},p.id))})})]}),e(Pt,{isVisible:o,isFullScreen:!0,children:e(yr,{onClose:m})})]})},Sr=()=>{const a=Jt()["*"];return l("div",{className:"flex flex-col gap-y-xsmall h-full",children:[e(De,{label:"Back to Settings",path:"/a/settings"}),l("div",{className:"grid grid-cols-1 medium:grid-cols-3 gap-xsmall pb-xlarge",children:[e("div",{className:"w-full h-full",children:e(vr,{id:a})}),e("div",{className:"col-span-2",children:e(br,{id:a})})]})]})},Ft=({handleClose:t,initialReason:a})=>{const{register:r,handleSubmit:s,formState:{errors:i}}=z({defaultValues:{value:a==null?void 0:a.value,label:a==null?void 0:a.label,description:a==null?void 0:a.description}}),n=R(),{mutate:c,isLoading:u}=Xt(),o=d=>{c({...d,description:d.description||void 0},{onSuccess:()=>{n("Success","Created a new return reason","success")},onError:()=>{n("Error","Cant create a Return reason with an existing code","error")}}),t()};return e(x,{handleClose:t,children:l(x.Body,{children:[e(x.Header,{handleClose:t,children:e("span",{className:"inter-xlarge-semibold",children:"Add Reason"})}),l("form",{onSubmit:s(o),children:[l(x.Content,{children:[l("div",{className:"grid grid-cols-2 gap-large mb-large",children:[e(I,{...r("value",{required:"Value is required",pattern:T.whiteSpaceRule("Value"),minLength:T.minOneCharRule("Value")}),label:"Value",required:!0,placeholder:"wrong_size",errors:i}),e(I,{...r("label",{required:"Label is required",pattern:T.whiteSpaceRule("Label"),minLength:T.minOneCharRule("Label")}),label:"Label",required:!0,placeholder:"Wrong size",errors:i})]}),e(Sa,{className:"mt-large",rows:3,...r("description"),label:"Description",placeholder:"Customer received the wrong size",errors:i})]}),e(x.Footer,{children:l("div",{className:"flex w-full h-8 justify-end",children:[e(N,{variant:"ghost",className:"mr-2 w-32 text-small justify-center",size:"large",onClick:t,type:"button",children:"Cancel"}),e(N,{loading:u,disabled:u,size:"large",className:"w-32 text-small justify-center",variant:"primary",children:"Create"})]})})]})]})})},Nr=({reason:t})=>{const{state:a,open:r,close:s}=B(),{state:i,open:n,close:c}=B(),{register:u,reset:o,handleSubmit:d}=z(),m=R(),{mutate:p}=ea(t==null?void 0:t.id),{mutate:g}=ta(t==null?void 0:t.id),h=async()=>{p(void 0)},f=S=>{g({label:S.label,description:S.description||void 0},{onSuccess:()=>{m("Success","Successfully updated return reason","success")},onError:_=>{m("Error",A(_),"error")}})},v=()=>{o({label:t.label,description:t.description})};return b.useEffect(()=>{t&&o({label:t.label,description:t.description})},[t]),l(D,{children:[e(K,{actionables:[{label:"Duplicate reason",icon:e(za,{size:20}),onClick:()=>r()},{label:"Delete reason",variant:"danger",icon:e(G,{size:20}),onClick:()=>n()}],events:[{label:"Save",onClick:d(f)},{label:"Cancel changes",onClick:v}],title:"Details",subtitle:t==null?void 0:t.value,children:l("form",{onSubmit:d(f),children:[e(I,{...u("label"),label:"Label"}),e(I,{...u("description"),label:"Description",className:"mt-base",placeholder:"Customer received the wrong size"})]})}),a&&e(Ft,{initialReason:t,handleClose:s}),i&&e(Ee,{heading:"Delete Return Reason",text:"Are you sure you want to delete this return reason?",handleClose:c,onDelete:h})]})},Cr=()=>{const{state:t,open:a,close:r}=B(),[s,i]=b.useState(null),{isLoading:n,return_reasons:c}=aa({onSuccess:u=>{wr(u.return_reasons);const o=u.return_reasons;(!s||_r(c,o))&&i(o[0])}});return l("div",{children:[e(de,{previousRoute:"/a/settings",previousBreadcrumb:"Settings",currentPage:"Return Reasons"}),l(Rt,{children:[e(K,{title:"Return Reasons",actionables:[{label:"Add reason",icon:e("span",{className:"text-grey-90",children:e(Y,{size:20})}),onClick:a}],subtitle:"Manage reasons for returned items",children:e("div",{className:"mt-large",children:n?e("div",{className:"flex items-center justify-center",children:e(le,{variant:"secondary"})}):e(U.Root,{onValueChange:u=>i(kr(c,u)),value:s==null?void 0:s.value,children:c==null?void 0:c.map(u=>e(U.Item,{label:u.label,description:u.description,className:"mt-xsmall",value:u.value}))})})}),s&&e(Nr,{reason:s})]}),t&&e(Ft,{handleClose:r})]})},_r=(t,a)=>t&&(t==null?void 0:t.length)>(a==null?void 0:a.length),wr=t=>t==null?void 0:t.sort((a,r)=>a.created_at<r.created_at?-1:1),kr=(t,a)=>t.find(r=>r.value===a),lt=({lockName:t=!1,form:a})=>{const{register:r,path:s,formState:{errors:i}}=a;return l("div",{children:[e("p",{className:"inter-base-semibold mb-base",children:"Details"}),e(I,{disabled:t,label:"Name",prefix:t?e(Tt,{size:16,className:"text-grey-40"}):void 0,placeholder:t?"Default":"Rate name",...r(s("name"),{required:t?void 0:T.required("Name")}),required:!t,className:"mb-base min-w-[335px] w-full",errors:i}),e(I,{type:"number",min:0,max:100,step:.01,formNoValidate:!0,label:"Tax Rate",prefix:"%",placeholder:"12",...r(s("rate"),{min:T.min("Tax Rate",0),max:T.max("Tax Rate",100),required:T.required("Tax Rate"),valueAsNumber:!0}),required:!0,className:"mb-base min-w-[335px] w-full",errors:i}),e(I,{placeholder:"1000",label:"Tax Code",...r(s("code"),{required:T.required("Tax Code")}),required:!0,className:"mb-base min-w-[335px] w-full",errors:i})]})},te=({onEdit:t,onDelete:a,index:r,name:s,description:i})=>l("div",{className:"p-base border rounded-rounded flex gap-base items-center",children:[e("div",{children:l(Pe,{className:"inter-base-semibold flex justify-center items-center w-[40px] h-[40px]",variant:"default",children:["§",r]})}),l("div",{className:"flex-1",children:[e("div",{className:"inter-small-semibold",children:s}),e("div",{className:"inter-small-regular text-grey-50",children:i})]}),e("div",{children:e(Ct,{forceDropdown:!0,actions:[{label:"Edit",onClick:()=>t(),icon:e(W,{size:20})},{label:"Delete rule",variant:"danger",onClick:()=>a(),icon:e(G,{size:20})}]})})]}),st=({showSearch:t=!0,label:a,objectName:r,selectedIds:s=[],isLoading:i,pagination:n,totalCount:c,data:u,columns:o,searchValue:d,onPaginationChange:m,onChange:p,onSearch:g})=>{const h=q=>{m(q)},f=b.useMemo(()=>Math.floor(n.offset/n.limit),[n]),v=b.useMemo(()=>c&&n.limit?Math.ceil(c/n.limit):0,[c,n]),{getTableProps:S,getTableBodyProps:_,rows:k,prepareRow:C,canPreviousPage:M,canNextPage:y,pageCount:P,nextPage:E,previousPage:me,state:{pageIndex:pe,pageSize:he,selectedRowIds:se}}=O.useTable({columns:o,data:u||[],manualPagination:!0,initialState:{pageIndex:f,pageSize:n.limit,selectedRowIds:s.reduce((q,J)=>(q[J]=!0,q),{})},pageCount:v,autoResetSelectedRows:!1,autoResetPage:!1,getRowId:q=>q.id},O.usePagination,O.useRowSelect,q=>{q.visibleColumns.push(J=>[{id:"selection",Header:({getToggleAllRowsSelectedProps:Le})=>e("div",{children:e(ke,{...Le()})}),Cell:({row:Le})=>e("div",{children:e(ke,{...Le.getToggleRowSelectedProps()})})},...J])});b.useEffect(()=>{p(Object.keys(se))},[se]);const ge=()=>{y&&(h({...n,offset:n.offset+n.limit}),E())},fe=()=>{M&&(h({...n,offset:Math.max(n.offset-n.limit,0)}),me())};return l("div",{children:[e("div",{className:"inter-base-semibold my-large",children:a}),e(at,{isLoading:i,hasPagination:!0,pagingState:{count:c,offset:n.offset,pageSize:n.offset+k.length,title:r,currentPage:pe+1,pageCount:P,nextPage:ge,prevPage:fe,hasNext:y,hasPrev:M},numberOfRows:he,children:e(w,{immediateSearchFocus:t,enableSearch:t,searchPlaceholder:"Search Products..",handleSearch:g,searchValue:d,...S(),children:e(w.Body,{..._(),children:k.map(q=>(C(q),e(w.Row,{...q.getRowProps(),children:q.cells.map(J=>e(w.Cell,{...J.getCellProps(),children:J.render("Cell")}))})))})})})]})},Pr=({items:t,onChange:a})=>{const[s,i]=b.useState({limit:12,offset:0}),[n,c]=b.useState(""),u=Fa(n,500),{isLoading:o,count:d,products:m}=ra({q:u,...s}),p=h=>{i(f=>({...f,offset:0})),c(h)},g=b.useMemo(()=>[{Header:"Name",accessor:"title",Cell:({row:{original:h}})=>l("div",{className:"flex items-center",children:[e("div",{className:"h-[40px] w-[30px] my-1.5 flex items-center mr-4 rounded-sm overflow-hidden",children:h.thumbnail?e("img",{src:h.thumbnail,className:"h-full object-cover rounded-soft"}):e(qa,{})}),e("div",{className:"flex flex-col",children:e("span",{children:h.title})})]})}],[]);return e(st,{label:"Select Products",objectName:"Product",totalCount:d,pagination:s,onPaginationChange:i,selectedIds:t,data:m,columns:g,isLoading:o,onSearch:p,searchValue:n,onChange:a})},Er=({items:t,onChange:a})=>{const[s,i]=b.useState({limit:12,offset:0}),{isLoading:n,count:c,product_types:u}=la(s),o=b.useMemo(()=>[{Header:"Name",accessor:"value",Cell:({row:{original:d}})=>e("div",{className:"w-[200px]",children:d.value})}],[]);return e(st,{showSearch:!1,label:"Select Product Types",objectName:"Product Types",totalCount:c,pagination:s,onPaginationChange:i,selectedIds:t,data:u,columns:o,isLoading:n,onChange:a})},Rr=({regionId:t,items:a,onChange:r})=>{const[i,n]=b.useState({limit:12,offset:0}),{isLoading:c,count:u,shipping_options:o}=et({region_id:t}),d=b.useMemo(()=>[{Header:"Name",accessor:"name",Cell:({row:{original:m}})=>e("div",{className:"w-[200px]",children:m.name})}],[]);return e(st,{showSearch:!1,label:"Select Shipping Option",objectName:"Shipping Options",totalCount:u,pagination:i,onPaginationChange:n,selectedIds:a,data:o,columns:d,isLoading:c,onChange:r})},Ot=({regionId:t,type:a,items:r,onSubmit:s})=>{const i=a&&r,{pop:n}=b.useContext(re),[c,u]=b.useState(a??"products"),[o,d]=b.useState({type:a??"products",items:r??[]}),m=()=>{s(o),n()},p=h=>{h!==c&&(u(h),d({type:h,items:[]}))},g=h=>{d(f=>({...f,items:h}))};return l(D,{children:[e(x.Content,{children:l("div",{className:"min-h-[680px]",children:[!i&&l(D,{children:[e("div",{className:"inter-base-semibold mb-large",children:"Type"}),l(U.Root,{className:"flex gap-base",value:c,onValueChange:p,children:[e(U.Item,{className:"flex-1",label:"Products",description:"Select individual products",value:"products"}),e(U.Item,{className:"flex-1",label:"Product Types",description:"Select product types",value:"product_types"}),e(U.Item,{className:"flex-1",label:"Shipping Options",description:"Select shipping options",value:"shipping_options"})]})]}),c==="products"&&e(Pr,{items:o.items,onChange:g}),c==="product_types"&&e(Er,{items:o.items,onChange:g}),c==="shipping_options"&&e(Rr,{regionId:t,items:o.items,onChange:g})]})}),e(x.Footer,{children:l("div",{className:"flex w-full justify-end gap-x-xsmall",children:[e(N,{variant:"ghost",size:"small",className:"w-[112px]",onClick:()=>n(),children:"Back"}),e(N,{variant:"primary",className:"w-[112px]",size:"small",onClick:m,children:"Add"})]})})]})},Tr=({modalContext:t,regionId:a,taxRate:r,onDismiss:s})=>{const{mutate:i,isLoading:n}=sa(r.id),[c,u]=b.useState({}),o=z({defaultValues:{details:{name:r.name,code:r.code||void 0,rate:r.rate||void 0},products:r.products.map(C=>C.id),product_types:r.product_types.map(C=>C.id),shipping_options:r.shipping_options.map(C=>C.id)}}),{register:d,setValue:m,handleSubmit:p,watch:g}=o,h=R(),f=p(C=>{const M={name:C.details.name,code:C.details.code,rate:C.details.rate,product_types:C.product_types,products:C.products,shipping_options:C.shipping_options},y=["products","product_types","shipping_options"];for(const[P,E]of Object.entries(c))!E&&P in M&&y.includes(P)&&delete M[P];i(M,{onSuccess:()=>{h("Success","Successfully updated Tax Rate.","success"),s()},onError:P=>{h("Error",A(P),"error")}})});b.useEffect(()=>{d("products"),d("product_types"),d("shipping_options")},[]);const[v,S,_]=g(["products","product_types","shipping_options"]),k=C=>{switch(u(M=>(M[C.type]=!0,M)),C.type){case"products":m("products",C.items);break;case"product_types":m("product_types",C.items);break;case"shipping_options":m("shipping_options",C.items);break}};return l("form",{onSubmit:f,children:[l(x.Content,{children:[e("div",{className:"mb-xlarge",children:e(lt,{form:Z(o,"details")})}),l("div",{children:[e("p",{className:"inter-base-semibold mb-base",children:"Overrides"}),(S.length>0||v.length>0||_.length>0)&&l("div",{className:"flex flex-col gap-base",children:[v.length>0&&e(te,{onDelete:()=>k({type:"products",items:[]}),onEdit:()=>{t.push(Se(t.pop,a,k,{items:v,type:"products"}))},index:1,name:"Product Rules",description:`Applies to ${v.length} product${v.length>1?"s":""}`}),S.length>0&&e(te,{onDelete:()=>k({type:"product_types",items:[]}),onEdit:()=>{t.push(Se(t.pop,a,k,{items:S,type:"product_types"}))},index:2,name:"Product Type Rules",description:`Applies to ${S.length} product type${S.length>1?"s":""}`}),_.length>0&&e(te,{onDelete:()=>k({type:"shipping_options",items:[]}),onEdit:()=>{t.push(Se(t.pop,a,k,{items:_,type:"shipping_options"}))},index:3,name:"Shipping Option Rules",description:`Applies to ${_.length} shipping option${_.length>1?"s":""}`})]}),!(S.length&&v.length&&_.length)&&l(N,{type:"button",onClick:()=>{t.push(Se(t.pop,a,k))},className:"w-full mt-base",size:"medium",variant:"secondary",children:[e(Y,{})," Add Overrides"]})]})]}),e(x.Footer,{children:l("div",{className:"flex items-center justify-end w-full",children:[e(N,{type:"button",onClick:s,variant:"ghost",size:"small",className:"w-eventButton justify-center",children:"Cancel"}),e(N,{type:"submit",variant:"primary",size:"small",className:"w-eventButton justify-center",loading:n,disabled:n,children:"Save"})]})})]})},Se=(t,a,r,s={})=>({title:"Add override",onBack:()=>t(),view:e(Ot,{regionId:a,onSubmit:r,...s})}),Mr=({onDismiss:t,taxRate:a})=>{const{mutate:r,isLoading:s}=Xe(a.id),i=z({defaultValues:{details:{name:a.name,rate:a.rate||void 0,code:a.code||void 0}}}),{handleSubmit:n}=i,c=R();return l("form",{onSubmit:n(o=>{const d={tax_rate:o.details.rate,tax_code:o.details.code};r(d,{onSuccess:()=>{c("Success","Successfully updated default rate.","success"),t()},onError:m=>{c("Error",A(m),"error")}})}),children:[e(x.Content,{children:e(lt,{form:Z(i,"details"),lockName:!0})}),e(x.Footer,{children:l("div",{className:"flex items-center justify-end w-full",children:[e(N,{type:"button",onClick:t,variant:"ghost",size:"small",className:"w-eventButton justify-center",children:"Cancel"}),e(N,{type:"submit",variant:"primary",size:"small",className:"w-eventButton justify-center",loading:s,children:"Save"})]})})]})},Ir=({taxRate:t,taxRateId:a,regionId:r,onDismiss:s})=>{const{isLoading:i,tax_rate:n}=na(a,{expand:["products","product_types","shipping_options"]},{enabled:t.type==="rate"}),c=b.useContext(re);return e(Ye,{isLargeModal:!0,context:c,handleClose:s,children:l(x.Body,{children:[e(x.Header,{handleClose:s,children:e("div",{children:e("h1",{className:"inter-xlarge-semibold",children:"Edit Tax Rate"})})}),t.type==="region"?e(Mr,{taxRate:t,onDismiss:s}):i||!n?e(le,{}):e(Tr,{regionId:r,modalContext:c,taxRate:n,onDismiss:s})]})})},Dr=({regionId:t,onDismiss:a})=>{const{mutate:r,isLoading:s}=ia(),i=z({defaultValues:{products:[],product_types:[],shipping_options:[]}}),{setValue:n,handleSubmit:c,watch:u}=i,o=R(),d=b.useContext(re),m=c(v=>{r({product_types:v.product_types,products:v.products,shipping_options:v.shipping_options,name:v.details.name,code:v.details.code,rate:v.details.rate,region_id:t},{onSuccess:()=>{o("Success","Successfully created tax rate.","success"),a()},onError:S=>{o("Error",A(S),"error")}})}),[p,g,h]=u(["products","product_types","shipping_options"]),f=v=>{switch(v.type){case"products":n("products",v.items);break;case"product_types":n("product_types",v.items);break;case"shipping_options":n("shipping_options",v.items);break}};return e(Ye,{isLargeModal:!0,context:d,handleClose:a,children:e("form",{onSubmit:m,children:l(x.Body,{children:[e(x.Header,{handleClose:a,children:e("div",{children:e("h1",{className:"inter-xlarge-semibold",children:"Add Tax Rate"})})}),l(x.Content,{children:[e(lt,{form:Z(i,"details")}),l("div",{children:[e("p",{className:"inter-base-semibold mb-base",children:"Overrides"}),(g.length>0||p.length>0||h.length>0)&&l("div",{className:"flex flex-col gap-base",children:[p.length>0&&e(te,{onDelete:()=>f({type:"products",items:[]}),onEdit:()=>{d.push(Ne(d.pop,t,f,{items:p,type:"products"}))},index:1,name:"Product Rules",description:`Applies to ${p.length} product${p.length>1?"s":""}`}),g.length>0&&e(te,{onDelete:()=>f({type:"product_types",items:[]}),onEdit:()=>{d.push(Ne(d.pop,t,f,{items:g,type:"product_types"}))},index:2,name:"Product Type Rules",description:`Applies to ${g.length} product type${g.length>1?"s":""}`}),h.length>0&&e(te,{onDelete:()=>f({type:"shipping_options",items:[]}),onEdit:()=>{d.push(Ne(d.pop,t,f,{items:h,type:"shipping_options"}))},index:3,name:"Shipping Option Rules",description:`Applies to ${h.length} shipping option${h.length>1?"s":""}`})]}),!(g.length>0&&p.length>0&&h.length>0)&&l(N,{type:"button",onClick:()=>{d.push(Ne(d.pop,t,f))},className:"w-full mt-base",size:"medium",variant:"secondary",children:[e(Y,{})," Add Overrides"]})]})]}),e(x.Footer,{children:l("div",{className:"flex items-center justify-end w-full",children:[e(N,{type:"button",onClick:a,variant:"ghost",size:"small",className:"w-eventButton justify-center",children:"Cancel"}),e(N,{type:"submit",variant:"primary",size:"small",className:"w-eventButton justify-center",loading:s,disabled:s,children:"Create"})]})})]})})})},Ne=(t,a,r,s={})=>({title:"Add override",onBack:()=>t(),view:e(Ot,{regionId:a,onSubmit:r,...s})}),Ar=({region:t})=>{const{register:a,handleSubmit:r,control:s,reset:i,formState:{isDirty:n}}=z({defaultValues:{automatic_taxes:t.automatic_taxes,gift_cards_taxable:t.gift_cards_taxable,tax_provider_id:{label:t.tax_provider_id===null?"System Tax Provider":t.tax_provider_id,value:t.tax_provider_id}}}),c=R();b.useEffect(()=>{i({automatic_taxes:t.automatic_taxes,gift_cards_taxable:t.gift_cards_taxable,tax_provider_id:{label:t.tax_provider_id===null?"System Tax Provider":t.tax_provider_id,value:t.tax_provider_id}})},[t]);const{isLoading:u,tax_providers:o}=ca(),d=Xe(t.id),m=b.useMemo(()=>o?[{label:"System Tax Provider",value:null},...o.map(g=>({label:g.id,value:g.id}))]:[{label:"System Tax Provider",value:null}],[o]);return l("form",{className:"flex flex-col flex-1",onSubmit:r(g=>{const h={...g,tax_provider_id:g.tax_provider_id.value};d.mutate(h,{onSuccess:()=>{c("Success","Region tax settings were successfully updated.","success")},onError:f=>{c("Error",A(f),"error")}})}),children:[l("div",{className:"flex flex-col gap-base flex-1",children:[e(L,{name:"tax_provider_id",control:s,rules:{required:!0},render:({field:{value:g,onChange:h}})=>e(Et,{disabled:u,label:"Tax Provider",options:m,value:g,onChange:h,className:"mb-base"})}),l("div",{className:"flex item-center gap-x-1.5",children:[e(it,{className:"inter-base-regular",...a("automatic_taxes"),label:"Calculate taxes automatically?"}),e(nt,{content:"When checked Medusa will automatically apply tax calculations to Carts in this Region. When unchecked you will have to manually compute taxes at checkout. Manual taxes are recommended if using a 3rd party tax provider to avoid performing too many requests"})]}),l("div",{className:"flex item-center gap-x-1.5",children:[e(it,{className:"inter-base-regular",...a("gift_cards_taxable"),label:"Apply tax to gift cards?"}),e(nt,{content:"When checked taxes will be applied to gift cards on checkout. In some contries tax regulations require that taxes are applied to gift cards on purchase."})]})]}),e("div",{className:"flex justify-end",children:n&&e(N,{loading:d.isLoading,variant:"primary",size:"medium",type:"submit",children:"Save"})})]})},Lr=({row:t,onEdit:a})=>{const r=wt(),s=R(),i=oa(t.original.id),n=async u=>{if(!u||u.type!==Re.RATE)return Promise.resolve();if(await r({heading:"Delete tax rate",text:"Are you sure you want to delete this tax rate?"}))return i.mutateAsync().then(()=>{s("Success","Tax rate was deleted.","success")}).catch(d=>{s("Error",A(d),"error")})},c=[{label:"Edit",onClick:()=>a(t.original),icon:e(W,{size:20})}];return t.original.type===Re.RATE&&c.push({label:"Delete Tax Rate",variant:"danger",onClick:()=>n(t.original),icon:e(G,{size:20})}),e(w.Row,{color:"inherit",forceDropdown:!0,actions:c,...t.getRowProps(),className:"group",children:t.cells.map(u=>e(w.Cell,{children:u.render("Cell")}))})},zr=()=>[b.useMemo(()=>[{Header:e("div",{className:"pl-2",children:"Name"}),accessor:"name",Cell:({row:a,cell:{value:r}})=>e("div",{className:"text-grey-90 group-hover:text-violet-60 pl-2",children:a.original.type==="region"?l("div",{className:"flex gap-x-xsmall text-grey-40 items-center",children:[e(Tt,{size:"12"})," ",r]}):r})},{Header:"Code",accessor:"code",Cell:({cell:{value:a}})=>e("div",{children:e(Pe,{variant:"default",children:a})})},{Header:"Tax Rate",accessor:"rate",Cell:({cell:{value:a}})=>l("div",{children:[a," %"]})}],[])],jr=10,qr=({id:t})=>{const[a,r]=b.useState({limit:jr,offset:0}),[s,i]=b.useState(!1),[n,c]=b.useState(null),[u,o]=b.useState([]),{tax_rates:d,isLoading:m}=da({region_id:t,...a},{enabled:!!t}),{region:p,isLoading:g}=xt(t,{enabled:!!t});b.useEffect(()=>{if(!m&&!g&&p&&d){const C={id:p.id,name:"Default",code:p.tax_code??null,rate:p.tax_rate??null,type:Re.REGION};o([C,...d.map(M=>({id:M.id,name:M.name,code:M.code,rate:M.rate,type:Re.RATE}))])}},[m,g,p,d]);const[h]=zr(),{getTableProps:f,getTableBodyProps:v,headerGroups:S,rows:_,prepareRow:k}=O.useTable({columns:h,data:u||[],manualPagination:!0,autoResetPage:!1});return t?l(D,{children:[l(K,{title:"Details",actionables:[{label:"New Tax Rate",onClick:()=>i(!0),icon:e(Y,{})}],children:[l(w,{...f(),className:Qe({relative:g}),children:[e(w.Head,{children:S==null?void 0:S.map(C=>e(w.HeadRow,{...C.getHeaderGroupProps(),children:C.headers.map(M=>e(w.HeadCell,{...M.getHeaderProps(),children:M.render("Header")}))}))}),g||m?e("div",{className:"flex w-full h-full absolute items-center justify-center mt-10",children:e("div",{className:"",children:e(le,{size:"large",variant:"secondary"})})}):e(w.Body,{...v(),children:_.map(C=>(k(C),e(Lr,{onEdit:c,row:C},C.original.id)))})]}),e("h3",{className:"inter-large-semibold mt-2xlarge mb-base",children:"Tax Calculation Settings"}),e("div",{className:"flex flex-1",children:!g&&p&&e(Ar,{region:p})})]}),s&&e(Dr,{regionId:t,onDismiss:()=>i(!1)}),n&&e(Ir,{regionId:t,taxRate:n,taxRateId:n.id,onDismiss:()=>c(null)})]}):null},ne="reg_id",Fr=()=>{const t=oe(),[a,r]=ua(),{regions:s,isLoading:i}=vt();return b.useEffect(()=>{!i&&(s!=null&&s.length)&&!a.get(ne)&&r({[ne]:s[0].id})},[s,i,a,r]),e(D,{children:l("div",{children:[e(de,{previousRoute:"/a/settings",previousBreadcrumb:"Settings",currentPage:"Taxes"}),l(Rt,{threeCols:!0,children:[e(K,{forceDropdown:!0,title:"Regions",subtitle:"Select the region you wish to manage taxes for",actionables:[{icon:e(ja,{}),label:"Go to Region settings",onClick:()=>t("/a/settings/regions")}],children:i||!s?e("div",{className:"flex-grow h-full flex items-center justify-center",children:e(le,{size:"large",variant:"secondary"})}):e(U.Root,{value:a.get(ne)||void 0,onValueChange:n=>r({[ne]:n}),children:s.map(n=>e(U.Item,{label:n.name,description:n.countries.length?`${n.countries.map(c=>c.display_name).join(", ")}`:void 0,value:n.id,id:n.id},n.id))})}),e(qr,{id:a.get(ne)})]})]})})},Or=({handleClose:t})=>{const a=R(),{mutate:r,isLoading:s}=ma(),{control:i,register:n,handleSubmit:c}=z(),u=d=>{r({user:d.user,role:d.role.value},{onSuccess:()=>{a("Success",`Invitation sent to ${d.user}`,"success"),t()},onError:m=>{a("Error",A(m),"error")}})},o=[{value:"member",label:"Member"},{value:"admin",label:"Admin"},{value:"developer",label:"Developer"}];return e(x,{handleClose:t,children:e("form",{onSubmit:c(u),children:l(x.Body,{children:[e(x.Header,{handleClose:t,children:e("span",{className:"inter-xlarge-semibold",children:"Invite Users"})}),e(x.Content,{children:l("div",{className:"flex flex-col gap-y-base",children:[e(I,{label:"Email",placeholder:"lebron@james.com",required:!0,...n("user",{required:!0})}),e(L,{name:"role",control:i,defaultValue:{label:"Member",value:"member"},render:({field:{value:d,onChange:m}})=>e(Et,{label:"Role",onChange:m,options:o,value:d})})]})}),e(x.Footer,{children:l("div",{className:"flex w-full h-8 justify-end",children:[e(N,{variant:"ghost",className:"mr-2 w-32 text-small justify-center",size:"large",type:"button",onClick:t,children:"Cancel"}),e(N,{loading:s,disabled:s,size:"large",className:"w-32 text-small justify-center",variant:"primary",children:"Invite"})]})})]})})})},pt=({color:t="bg-violet-60",user:a})=>{const r=a.first_name||a.last_name?`${a.first_name} ${a.last_name}`:a.email;return l("div",{className:"flex items-center bg-inherit px-2.5 py-1.5 w-full",children:[e("div",{className:"w-[24px] h-[24px]",children:e(_t,{user:a,color:t})}),e("span",{className:"pl-2.5 w-40 truncate",children:r})]})},Br=({handleClose:t,user:a,onSuccess:r})=>{const{mutate:s,isLoading:i}=ft(a.id),{register:n,handleSubmit:c,reset:u,formState:{errors:o}}=z(),d=R();return b.useEffect(()=>{u(Ur(a))},[a]),e(x,{handleClose:t,children:e("form",{onSubmit:c(p=>{s(p,{onSuccess:()=>{d("Success","User was updated","success"),r()},onError:g=>{d("Error",A(g),"error")},onSettled:()=>{t()}})}),children:l(x.Body,{children:[e(x.Header,{handleClose:t,children:e("span",{className:"inter-xlarge-semibold",children:"Edit User"})}),l(x.Content,{children:[l("div",{className:"w-full grid grid-cols-2 gap-large mb-base",children:[e(I,{label:"First Name",placeholder:"First name...",required:!0,...n("first_name",{required:T.required("First name"),pattern:T.whiteSpaceRule("First name"),minLength:T.minOneCharRule("First name")}),errors:o}),e(I,{label:"Last Name",placeholder:"Last name...",required:!0,...n("last_name",{required:T.required("Last name"),pattern:T.whiteSpaceRule("Last name"),minLength:T.minOneCharRule("last name")}),errors:o})]}),e(I,{label:"Email",disabled:!0,value:a.email})]}),e(x.Footer,{children:l("div",{className:"w-full flex justify-end",children:[e(N,{variant:"ghost",size:"small",onClick:t,className:"mr-2",children:"Cancel"}),e(N,{loading:i,disabled:i,variant:"primary",size:"small",children:"Save"})]})})]})})})},Ur=t=>({first_name:t.first_name,last_name:t.last_name}),Ce=t=>new Date(t.expires_at)<new Date?"expired":"pending",Hr=({users:t,invites:a,triggerRefetch:r})=>{const[s,i]=b.useState([]),[n,c]=b.useState([]),[u,o]=b.useState(null),[d,m]=b.useState(!1),[p,g]=b.useState(null),h=R(),{store:f,isLoading:v}=Me();b.useEffect(()=>{i([...t.map((y,P)=>({entity:y,entityType:"user",tableElement:_(y,P)})),...a.map((y,P)=>({entity:y,entityType:"invite",tableElement:k(y,P)}))])},[t,a]),b.useEffect(()=>{c(s)},[s]);const S=()=>{m(!1),o(null),g(null)},_=(y,P)=>l(w.Row,{color:"inherit",actions:[{label:"Edit User",onClick:()=>o(y),icon:e(W,{size:20})},{label:"Remove User",variant:"danger",onClick:()=>{m(!0),o(y)},icon:e(G,{size:20})}],children:[e(w.Cell,{children:e(pt,{user:y})}),e(w.Cell,{className:"w-80",children:y.email}),l(w.Cell,{className:"inter-small-semibold text-violet-60",children:[y.role.charAt(0).toUpperCase(),y.role.slice(1)]}),e(w.Cell,{})]},`user-${P}`),k=(y,P)=>l(w.Row,{actions:[{label:"Resend Invitation",onClick:()=>{ie.invites.resend(y.id).then(()=>{h("Success","Invitiation link has been resent","success")}).then(()=>r())},icon:e(Ba,{size:20})},{label:"Copy invite link",disabled:v,onClick:()=>{const E=(f==null?void 0:f.invite_link_template)??`${window.location.origin}/invite?token={invite_token}`;Ra(E.replace("{invite_token}",y.token)),h("Success","Invite link copied to clipboard","success")},icon:e(Oa,{size:20})},{label:"Remove Invitation",variant:"danger",onClick:()=>{g(y)},icon:e(G,{size:20})}],children:[e(w.Cell,{className:"text-grey-40",children:e(pt,{user:{email:y.user_email}})}),e(w.Cell,{className:"text-grey-40 w-80",children:y.user_email}),e(w.Cell,{}),e(w.Cell,{children:new Date(y==null?void 0:y.expires_at)<new Date?e(ct,{title:"Expired",variant:"danger"}):e(ct,{title:"Pending",variant:"success"})})]},`invite-${P}`),C=[{title:"Team permissions",options:[{title:"All",count:s.length,onClick:()=>c(s)},{title:"Member",count:s.filter(y=>y.entityType==="user"&&y.entity.role==="member").length,onClick:()=>c(s.filter(y=>y.entityType==="user"&&y.entity.role==="member"))},{title:"Admin",count:s.filter(y=>y.entityType==="user"&&y.entity.role==="admin").length,onClick:()=>c(s.filter(y=>y.entityType==="user"&&y.entity.role==="admin"))},{title:"No team permissions",count:s.filter(y=>y.entityType==="invite").length,onClick:()=>c(s.filter(y=>y.entityType==="invite"))}]},{title:"Status",options:[{title:"All",count:s.length,onClick:()=>c(s)},{title:"Active",count:s.filter(y=>y.entityType==="user").length,onClick:()=>c(s.filter(y=>y.entityType==="user"))},{title:"Pending",count:s.filter(y=>y.entityType==="invite"&&Ce(y.entity)==="pending").length,onClick:()=>c(s.filter(y=>y.entityType==="invite"&&Ce(y.entity)==="pending"))},{title:"Expired",count:s.filter(y=>y.entityType==="invite"&&Ce(y.entity)==="expired").length,onClick:()=>c(s.filter(y=>y.entityType==="invite"&&Ce(y.entity)==="expired"))}]}];return l("div",{className:"w-full h-full overflow-y-auto",children:[l(w,{filteringOptions:C,enableSearch:!0,handleSearch:y=>{c(s.filter(P=>{var E,me,pe,he,se,ge,fe,q;return((me=(E=P.entity)==null?void 0:E.first_name)==null?void 0:me.includes(y))||((he=(pe=P.entity)==null?void 0:pe.last_name)==null?void 0:he.includes(y))||((ge=(se=P.entity)==null?void 0:se.email)==null?void 0:ge.includes(y))||((q=(fe=P.entity)==null?void 0:fe.user_email)==null?void 0:q.includes(y))}))},children:[e(w.Head,{children:l(w.HeadRow,{children:[e(w.HeadCell,{className:"w-72",children:"Name"}),e(w.HeadCell,{className:"w-80",children:"Email"}),e(w.HeadCell,{className:"w-72",children:"Team permissions"}),e(w.HeadCell,{children:"Status"})]})}),e(w.Body,{children:n.map(y=>y.tableElement)})]}),u&&(d?e(Ee,{text:"Are you sure you want to remove this user?",heading:"Remove user",onDelete:()=>ie.users.delete(u.id).then(()=>{h("Success","User has been removed","success"),r()}),handleClose:S}):e(Br,{handleClose:S,user:u,onSuccess:()=>r()})),p&&e(Ee,{text:"Are you sure you want to remove this invite?",heading:"Remove invite",onDelete:()=>ie.invites.delete(p.id).then(()=>{h("Success","Invitiation has been removed","success"),r()}),handleClose:S})]})},Vr=()=>{const[t,a]=b.useState([]),[r,s]=b.useState([]),[i,n]=b.useState(0),[c,u]=b.useState(!1),o=()=>{n(m=>m+1)};return b.useEffect(()=>{ie.users.list().then(m=>m.data).then(m=>{ie.invites.list().then(p=>p.data).then(p=>{a(m.users),s(p.invites)})})},[i]),e("div",{className:"flex flex-col h-full",children:l("div",{className:"w-full flex flex-col grow",children:[e(de,{previousRoute:"/a/settings",previousBreadcrumb:"Settings",currentPage:"The Team"}),l(K,{title:"The Team",subtitle:"Manage users of your Medusa Store",actionables:[{label:"Invite Users",onClick:()=>u(!0),icon:e("span",{className:"text-grey-90",children:e(Y,{size:20})})}],children:[e("div",{className:"flex grow  flex-col pt-2",children:e(Hr,{users:t,invites:r,triggerRefetch:o})}),l("div",{className:"inter-small-regular text-grey-50",children:[t.length," member",t.length===1?"":"s"]}),c&&e(Or,{handleClose:()=>{o(),u(!1)}})]})]})})},We=({size:t="32px",color:a="currentColor",...r})=>e("svg",{width:t,height:t,viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r,children:e("path",{d:"M18.9095 10.761C19.5268 10.761 20.1188 11.0063 20.5553 11.4427C20.9918 11.8792 21.237 12.4713 21.237 13.0886M23.5646 13.0886C23.5647 13.7675 23.4162 14.4383 23.1297 15.0538C22.8432 15.6693 22.4255 16.2147 21.9059 16.6518C21.3863 17.0888 20.7773 17.4069 20.1218 17.5837C19.4663 17.7605 18.78 17.7918 18.1111 17.6754C17.6743 17.6001 17.2119 17.6955 16.8985 18.009L14.8363 20.0712H13.0906V21.8168H11.345V23.5625H8.43555V21.3762C8.43555 20.913 8.61942 20.4684 8.94683 20.1418L13.9891 15.0996C14.3025 14.7861 14.3979 14.3237 14.3227 13.8869C14.2127 13.2516 14.2358 12.6004 14.3907 11.9745C14.5455 11.3487 14.8287 10.7618 15.2222 10.2511C15.6158 9.74039 16.1112 9.31702 16.6769 9.0078C17.2427 8.69858 17.8665 8.51026 18.5088 8.45477C19.1512 8.39928 19.7981 8.47784 20.4085 8.68545C21.0189 8.89307 21.5795 9.22523 22.0548 9.66087C22.5301 10.0965 22.9097 10.6261 23.1696 11.2162C23.4295 11.8062 23.564 12.4438 23.5646 13.0886V13.0886Z",stroke:a,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),Ge=100,$r=[{accessor:"pixel_id",Header:e("div",{className:"text-small font-semibold text-gray-500",children:"PixelID"}),Cell:({row:{original:t}})=>e("span",{className:"text-gray-900",children:t.pixel_id})},{accessor:"type",Header:e("div",{className:"text-small font-semibold text-gray-500",children:"Type"}),Cell:({row:{original:t}})=>e("span",{className:"text-gray-900",children:t.type})},{accessor:"enabled",Header:e("div",{className:"text-small font-semibold text-gray-500",children:"Enabled"}),Cell:({row:{original:t}})=>{const a=R(),{mutateAsync:r}=Ie(`/admin/pixels/${t.id}`,["pixels",t.id]),s=async()=>{try{await r({enabled:!t.enabled}),a("Success","Pixel updated","success")}catch(i){a("Error",i.message,"error")}finally{}};return e(ue,{checked:t.enabled,onCheckedChange:s})}}];function Gr(t){const{row:a}=t,r=a.original.id,[s,i]=b.useState(!1),{mutateAsync:n}=pa(`/admin/pixels/${r}`,["pixels",r]),c=[{label:"Delete",onClick:()=>i(!0),icon:e(G,{size:16}),variant:"danger"}];return l(D,{children:[e(w.Row,{...t.row.getRowProps(),actions:c,children:a.cells.map(u=>e(w.Cell,{...u.getCellProps(),children:u.render("Cell")}))}),s&&e(Ee,{handleClose:()=>i(!1),onDelete:()=>n(),confirmText:"Yes, delete",successText:"Pixel deleted",text:"Are you sure you want to delete this facebook pixel?",heading:"Delete pixel"})]})}function Wr(){var u;const[t,a]=b.useState(0),[r,s]=b.useState(0),{data:i,isLoading:n}=Ke("/admin/pixels",["pixels"]),c=O.useTable({columns:$r,data:(i==null?void 0:i.pixels)||[],manualPagination:!0,initialState:{pageIndex:r,pageSize:Ge,selectedRowIds:{}},pageCount:t,autoResetSelectedRows:!1,autoResetPage:!1,getRowId:o=>o.id});return e(at,{isLoading:n,numberOfRows:Ge,pagingState:{count:((u=i==null?void 0:i.pixels)==null?void 0:u.length)||0,offset:0,title:"Pixels",pageCount:1,currentPage:1,hasNext:!1,hasPrev:!1,pageSize:Ge,nextPage:()=>{},prevPage:()=>{}},children:l(w,{...c.getTableProps(),children:[c.headerGroups.map(o=>e(w.HeadRow,{...o.getHeaderGroupProps(),children:o.headers.map(d=>e(w.HeadCell,{...d.getHeaderProps(),children:d.render("Header")}))})),e(w.Body,{...c.getTableBodyProps(),children:c.rows.map(o=>(c.prepareRow(o),e(Gr,{row:o},o.id)))})]})})}function Zr(t){const{closeModal:a}=t,r=R(),{register:s,handleSubmit:i,formState:n,control:c}=z({defaultValues:{type:{value:be.Fb,label:"Facebook"}}}),{mutateAsync:u}=Ie("/admin/pixels",["pixels"]),o=async g=>{try{console.log({data:g});const h=await u({...g,type:g.type.value});r("Success","New Facebook Pixel added","success")}catch(h){r("Error",h.message,"error")}finally{a()}},{isDirty:d,isValid:m}=n,p=[{value:be.Fb.toString(),label:"Facebook"},{value:be.Gg.toString(),label:"Google"},{value:be.Tiktok.toString(),label:"Tiktok"}];return l(ee,{children:[e(ee.Header,{children:l("div",{className:"flex w-full justify-between px-8 medium:w-8/12",children:[e(N,{size:"small",variant:"ghost",onClick:a,children:e(tt,{size:20})}),e("div",{className:"flex gap-x-small",children:e(N,{size:"small",variant:"primary",onClick:i(o),disabled:!d&&!m,className:"rounded-rounded",children:"Add Pixel"})})]})}),e(ee.Main,{className:"no-scrollbar flex w-full justify-center",children:l("div",{className:"my-16 max-w-[700px] small:w-4/5 medium:w-7/12 large:w-6/12",children:[e("h1",{className:"inter-xlarge-semibold pb-8 text-grey-90",children:"Add Tracking Pixel"}),l("div",{className:"grid grid-cols-1 gap-6",children:[l("div",{className:"w-full",children:[e(I,{label:"Pixel ID",type:"string",...s("pixel_id",{required:!0}),className:"w-[338px]",placeholder:"Enter Pixel ID"}),e("p",{className:"text-small text-grey-50",children:"This pixel will initiate Add to Cart, Purchase, and Checkout Events."})]}),e(L,{name:"type",control:c,render:({field:{onChange:g,value:h,onBlur:f}})=>e($,{label:"Tracking Type",value:h,isMulti:!1,onChange:v=>{g(v)},onBlur:f,options:p})})]})]})})]})}function Qr(){const[t,a,r]=B(!1);return l("div",{children:[e(de,{currentPage:"Social tracking",previousBreadcrumb:"Settings",previousRoute:"/a/settings"}),l(K,{title:"Social tracking",subtitle:"Social tracking pixel id form Facebook, Google, Tiktok, .etc for tracking events in store.",actionables:[{label:"Create Pixel",onClick:a}],children:[e(Wr,{}),e(Pt,{isVisible:t,isFullScreen:!0,children:e(Zr,{closeModal:r})})]})]})}var X=(t=>(t.Payment="payment",t.Email="email",t.Sms="sms",t.GoogleApi="google-api",t.Tracking="tracking",t))(X||{}),j=(t=>(t.MPAY="mpay",t.STRIPE="stripe",t.SQUARE="square",t.MAILGUN="mailgun",t.TEXTGRID="textgrid",t.GOOGLE="google",t.MEDUSA="medusa",t.DUMMY="dummy",t))(j||{});const Yr=({type:t})=>{const a=r=>{switch(r){case X.Payment:return"Payment";case X.Email:return"Email";case X.Sms:return"Sms";case X.GoogleApi:return"Google Api";case X.Tracking:return"Tracking"}};return e(U.Item,{value:t,label:a(t),children:e("div",{className:"inter-small-regular flex flex-col gap-y-2xsmall text-grey-50"})})};function Kr({types:t,selectedType:a,handleChange:r}){return e(D,{children:e(V,{title:"Configs",className:"h-full",children:e("div",{className:"mt-large",children:e(U.Root,{value:a,onValueChange:r,children:t==null?void 0:t.map((s,i)=>e(Yr,{type:s},i))})})})})}const ht={[j.SQUARE]:l("span",{children:["To get Square App info"," ",e("a",{href:"https://squareup.com/dashboard/apps/my-applications",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"click here"})]}),[j.STRIPE]:l("span",{children:["To get Stripe Api config info"," ",e("a",{href:"https://dashboard.stripe.com/test/apikeys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"click here"})]})};function Jr({open:t,onClose:a,title:r,configs:s,provider:i}){const n=Ie("/system-config",["system-config"]),{register:c,control:u,reset:o,handleSubmit:d,formState:m,setValue:p}=z({defaultValues:{configs:s}});b.useEffect(()=>{p("configs",s)},[s]);const g=()=>{o({configs:s}),a()},h=R(),f=k=>{n.mutate(k,{onSuccess:()=>{h("Success","System config updated","success")},onError:C=>{h("Error",A(C),"error")}}),g()},{fields:v}=Da({name:"configs",control:u}),{isDirty:S}=m,_=b.forwardRef(({type:k,...C},M)=>{switch(k){case"boolean":return l("div",{className:"flex w-full items-center justify-between",children:[e("h3",{className:"inter-base-semibold mb-2xsmall",children:C.label}),e(L,{name:C.name,control:u,render:({field:{value:y,onChange:P}})=>e(ue,{checked:y==="true",onCheckedChange:E=>P(String(E))})})]});case"string":default:return e(I,{...C,ref:M})}});return e(Ua,{isVisible:t,close:g,children:l("div",{className:"flex h-full flex-col justify-between p-6",children:[l("div",{className:"flex items-center justify-between",children:[e("h3",{className:"inter-large-semibold flex items-center gap-2 text-xl text-gray-900",children:r}),e(N,{variant:"secondary",className:"h-8 w-8 p-2",onClick:g,children:e(tt,{size:20,className:"text-grey-50"})})]}),l("form",{onSubmit:d(f),className:"contents",children:[e("div",{className:"flex-grow",children:v.map((k,C)=>e("div",{className:"my-6",children:e(_,{type:k.dataType,label:k.key_name,required:k.required,...c(`configs.${C}.value`,{required:k.required})})},C))}),l("div",{className:"ư-full flex justify-between gap-2",children:[e("div",{className:"inline-flex py-1 text-small",children:ht[i]&&ht[i]}),l("div",{className:"flex items-center justify-end gap-x-xsmall",children:[e(N,{variant:"secondary",size:"small",type:"button",onClick:g,children:"Cancel"}),e(N,{variant:"primary",size:"small",type:"submit",loading:n.isLoading,disabled:n.isLoading||!S,children:"Save and close"})]})]})]})]})})}const Ze={[j.MPAY]:{title:"MPay",description:"",showDetails:!0},[j.STRIPE]:{title:"Stripe",description:"",showDetails:!1},[j.SQUARE]:{title:"Square",description:"",showDetails:!1},[j.MAILGUN]:{title:"Mailgun",description:"",showDetails:!0},[j.TEXTGRID]:{title:"Textgrid",description:"",showDetails:!0},[j.GOOGLE]:{title:"GoogleApi",description:"",showDetails:!0},[j.DUMMY]:{title:"Dummy Tracking",description:"",showDetails:!0}},Xr={[j.MPAY]:["privateKey","publicKey","connection-token","implementDirect"],[j.STRIPE]:["secretKey","publicKey"],[j.SQUARE]:["environment","accessToken","applicationId"],[j.MAILGUN]:["private-apiKey","public-apiKey","webhook-key","domain"],[j.TEXTGRID]:["service-host","fromNumber","accountSID","authToken","webhook-secret"],[j.GOOGLE]:["api-key"],[j.MEDUSA]:[],[j.DUMMY]:["showTrackingUrl","enableTrackingPage","contactEmail","contactPhone"]};function el({configs:t}){const a=b.useMemo(()=>{var r=Q.groupBy(t,"provider");return Q.fromPairs(Q.sortBy(Q.toPairs(r),s=>s[1][0].created_at).reverse())},[t]);return e("div",{className:"flex flex-col gap-y-xsmall",children:Object.keys(a).map(r=>{const s=Q.sortBy(a[r],"created_at").filter(i=>Xr[r].some(n=>i.key.includes(n)));return Ze[r].showDetails?e(tl,{provider:r,provider_detail:Ze[r],config:s},r):null})})}function tl({provider:t,provider_detail:a,config:r}){const{state:s,toggle:i,close:n}=B();return l(V,{title:a.title,forceDropdown:!0,actions:[{label:"Edit",onClick:i,icon:e(W,{size:20})}],children:[l("div",{className:"flex flex-col gap-y-large",children:[e("p",{className:"inter-base-regular text-grey-50",children:Ze[t].description}),e("div",{className:"flex flex-col gap-y-small",children:r.map(c=>e(al,{option:c},c.id))})]}),e(Jr,{configs:r,open:s,onClose:n,title:`Update ${a.title} Config`,provider:t})]})}function al({option:t}){const{description:a,key_name:r}=b.useMemo(()=>{switch(t.type){case"payment":return t.provider===j.MPAY&&t.dataType==="boolean"?{description:t.value==="true"?"Direct Card Mode enable":"Inline Payment Mode enable",key_name:"MPay Mode"}:{description:t.key_description,key_name:t.key_name};default:return{description:t.key_description,key_name:t.key_name}}},[t]);return e(D,{children:e("div",{className:"flex items-center justify-between rounded-rounded border border-grey-20 bg-grey-0 p-base",children:l("div",{className:"flex items-center gap-x-base",children:[e("div",{className:"flex h-10 w-10 items-center justify-center rounded-rounded bg-grey-10 p-2.5",children:e(We,{size:20,className:"text-grey-50"})}),l("div",{children:[e("p",{className:"inter-base-semibold",children:r}),e("div",{children:e("p",{className:"inter-small-regular text-grey-50",children:a})})]})]})})})}function rl(){const{data:t,isLoading:a}=Ke("/system-config",["system-config"]),[r,s]=b.useState(void 0);b.useEffect(()=>{t&&t.configs&&t.configs.length>0&&s(t.configs[0].type)},[t]);const i=u=>{u!==r&&s(u)},n=b.useMemo(()=>{if(t&&t.configs){const u=Q.uniqBy(t.configs,"type");return Q.sortBy(u,"created_at").map(o=>o.type)}return[]},[t]),c=(()=>t&&t.configs?t.configs.filter(u=>u.type===r):[])();return l("div",{className:"flex h-full flex-col gap-y-xsmall",children:[e(De,{label:"Back to Settings",path:"/a/settings"}),l("div",{className:"grid grid-cols-1 gap-xsmall pb-xlarge medium:grid-cols-3",children:[e("div",{className:"h-full w-full",children:e(Kr,{types:n,handleChange:i,selectedType:r})}),e("div",{className:"col-span-2",children:e(el,{configs:c})})]})]})}const ll=()=>l(Ha,{children:[e(F,{heading:"Regions",description:"Manage the markets you will operate within",icon:e(ya,{}),to:"/a/settings/regions"}),e(F,{heading:"Currencies",description:"Manage the markets you will operate within",icon:e(St,{}),to:"/a/settings/currencies"}),e(F,{heading:"Store Details",description:"Manage your business details",icon:e(ot,{}),to:"/a/settings/details"}),e(F,{heading:"Social tracking",description:"Manage your Social tracking",icon:e(ot,{}),to:"/a/settings/pixels"}),e(F,{heading:"Shipping",description:"Manage shipping profiles",icon:e(wa,{}),to:"/a/settings/shipping-profiles",disabled:!0}),e(F,{heading:"Return Reasons",description:"Manage Order settings",icon:e(va,{}),to:"/a/settings/return-reasons"}),e(F,{heading:"The Team",description:"Manage users of your Medusa Store",icon:e(ka,{}),to:"/a/settings/team"}),e(F,{heading:"Personal Information",description:"Manage your Medusa profile",icon:e(Na,{}),to:"/a/settings/personal-information"}),e(F,{heading:"hello@medusajs.com",description:"Can’t find the answers you’re looking for?",icon:e(_a,{}),externalLink:"mailto: hello@medusajs.com"}),e(F,{heading:"Tax Settings",description:"Manage taxes across regions and products",icon:e(xa,{}),to:"/a/settings/taxes"}),e(we,{featureFlag:"sales_channels",children:e(F,{heading:"Sales channels",description:"Control which products are available in which channels",icon:e(fa,{}),to:"/a/sales-channels"})}),e(we,{featureFlag:"publishable_api_keys",children:e(F,{heading:"API key management",description:"Create and manage API keys",icon:e(We,{}),to:"/a/publishable-api-keys"})}),e(F,{heading:"System Config",description:"Configuration for system",icon:e(We,{}),to:"/a/settings/system-config"})]}),Ns=()=>l(ha,{className:"h-full",children:[e(H,{index:!0,element:e(ll,{})}),e(H,{path:"/details",element:e(tr,{})}),e(H,{path:"/regions/*",element:e(Sr,{})}),e(H,{path:"/currencies",element:e(er,{})}),e(H,{path:"/return-reasons",element:e(Cr,{})}),e(H,{path:"/team",element:e(Vr,{})}),e(H,{path:"/personal-information",element:e(cr,{})}),e(H,{path:"/taxes",element:e(Fr,{})}),e(H,{path:"/pixels",element:e(Qr,{})}),e(H,{path:"/system-config",element:e(rl,{})})]});export{Ns as default};
