import{r as g,a as e,q as A,u as F,l as ne,j as l,K as ie,M as R,B as _,O as ye,P as ve,G as oe,Q as Ne,U as we,V as Se,W as Te,Y as Re,F as le,R as ce,b as B,k as He,a0 as Oe,a1 as Me,S as Ee}from"./index-effbfb95.js";import{B as k}from"./body-card-d3fddb8c.js";import{l as Q}from"./lodash-72dfe3e0.js";import{r as M,a as q,T as m,S as j,A as Ie}from"./index-0d9858ea.js";import{D as $}from"./index-f258cc00.js";import{E as U}from"./edit-icon-8c1c10d1.js";import{h as W}from"./moment-fbc5633a.js";import{C as J,g as K}from"./display-total-6e4997b2.js";import{I as z,P as ue,T as De}from"./index-dd9f9076.js";import{T as Ge}from"./index-a6859a1b.js";import{T as Z}from"./trash-icon-abcb5140.js";import{u as X}from"./use-query-filters-844ebb5f.js";import{I as ae}from"./index-d33be3e8.js";import{u as de}from"./index.esm-5a89640b.js";import{M as _e}from"./index-52359d87.js";import{g as me}from"./error-messages-d2d0bb30.js";import{u as fe}from"./use-notification-9f7c3c92.js";import{D as ke}from"./delete-prompt-37f35e36.js";import{B as je}from"./index-3da0109e.js";import{u as ze}from"./use-set-search-params-b6913614.js";import{A as Be}from"./index-5ca1a7bd.js";import{S as E}from"./index-04f3341e.js";import{B as Fe}from"./index-d895e52c.js";import{R as qe}from"./index-698bc9f9.js";import{R as Le}from"./refresh-icon-ede960a5.js";import{T as Ae}from"./index-f53357e2.js";import{u as Qe,v as Ue}from"./validate-email-bd4107a8.js";import{s as Ve}from"./index-84767cd7.js";import{I as Ye}from"./image-placeholder-b3cbea02.js";import{L as $e}from"./index-740955bd.js";import"./chevron-down-6a69fe38.js";import"./_isIndex-6af6139d.js";import"./index-1ec19c89.js";import"./index-e0338379.js";import"./index-e25e2e97.js";import"./toConsumableArray-6f61c395.js";import"./unsupportedIterableToArray-27301055.js";import"./index-0f96226b.js";import"./index-a4458bf1.js";import"./use-debounce-438a4ce8.js";import"./index-dd953a8b.js";import"./react-select.esm-1ec1493a.js";import"./createSuper-ad9f6885.js";const We=()=>[g.useMemo(()=>[{Header:"Date added",accessor:"created_at",Cell:({cell:{value:t}})=>W(t).format("DD MMM YYYY")},{Header:"Name",accessor:"customer",Cell:({row:t})=>e(J,{customer:t.original,color:K(t.index)})},{Header:"Email",accessor:"email"},{Header:"",accessor:"col"},{accessor:"orders",Header:()=>e("div",{className:"text-right",children:"Orders"}),Cell:({cell:{value:t}})=>e("div",{className:"text-right",children:(t==null?void 0:t.length)||0})},{Header:"",accessor:"col-2"}],[])],Je=["q","offset","limit"],Ke=(a,t)=>{var s;switch(t.type){case"setFilters":return{...a,query:(s=t==null?void 0:t.payload)==null?void 0:s.query};case"setQuery":return{...a,offset:0,query:t.payload};case"setOffset":return{...a,offset:t.payload};case"reset":return t.payload;default:return a}},Ze=(a,t=null)=>{a&&a[0]==="?"&&(a=a.substring(1));const s=g.useMemo(()=>Xe(a,t),[a,t]),[r,n]=g.useReducer(Ke,s),i=x=>{n({type:"setDefaults",payload:x})},o=x=>{if(x>0){const N=r.offset+r.limit;n({type:"setOffset",payload:N})}else{const N=Math.max(r.offset-r.limit,0);n({type:"setOffset",payload:N})}},p=()=>{n({type:"setFilters",payload:{...r,offset:0,query:null}})},d=x=>{n({type:"setFilters",payload:x})},f=x=>{n({type:"setQuery",payload:x})},c=()=>{const x={...r.additionalFilters};for(const[N,u]of Object.entries(r))N==="query"?u&&typeof u=="string"&&(x.q=u):(N==="offset"||N==="limit")&&(x[N]=u);return x},b=()=>{const x=c();return A.stringify(x,{skipNulls:!0})},P=x=>{const N=x??r,u={};for(const[S,T]of Object.entries(N))S==="query"?T&&typeof T=="string"&&(u.q=T):(S==="offset"||S==="limit")&&(u[S]=T);return u},h=()=>{const x=P();return A.stringify(x,{skipNulls:!0})},y=g.useMemo(()=>c(),[r]),C=g.useMemo(()=>P(),[r]),H=g.useMemo(()=>h(),[r]);return{...r,filters:{...r},representationObject:C,representationString:H,queryObject:y,paginate:o,getQueryObject:c,getQueryString:b,setQuery:f,setFilters:d,setDefaultFilters:i,reset:p}},Xe=(a,t=null)=>{const s={offset:0,limit:15,additionalFilters:t};if(a){const r=A.parse(a);for(const[n,i]of Object.entries(r))if(Je.includes(n))switch(n){case"offset":{typeof i=="string"&&(s.offset=parseInt(i));break}case"limit":{typeof i=="string"&&(s.limit=parseInt(i));break}case"q":{typeof i=="string"&&(s.query=i);break}}}return s},se=15,et={expand:"orders"},tt=()=>{const a=F(),{reset:t,paginate:s,setQuery:r,queryObject:n,representationObject:i}=Ze(location.search,et),o=parseInt(n.offset)||0,p=parseInt(n.limit)||se,{customers:d,isLoading:f,count:c}=ne({...n},{keepPreviousData:!0}),[b,P]=g.useState(n.query),[h,y]=g.useState(0);g.useEffect(()=>{if(typeof c<"u"){const w=Math.ceil(c/p);y(w)}},[c]);const[C]=We(),{getTableProps:H,getTableBodyProps:x,headerGroups:N,rows:u,prepareRow:S,canPreviousPage:T,canNextPage:O,pageCount:I,gotoPage:L,nextPage:v,previousPage:Y,state:{pageIndex:he}}=M.useTable({columns:C,data:d||[],manualPagination:!0,initialState:{pageSize:p,pageIndex:o/p},pageCount:h,autoResetPage:!1},M.usePagination);g.useEffect(()=>{const w=setTimeout(()=>{b?(r(b),L(0)):typeof b<"u"&&t()},400);return()=>clearTimeout(w)},[b]);const Ce=()=>{O&&(s(1),v())},xe=()=>{T&&(s(-1),Y())},te=(w={})=>{const D=A.stringify(w);window.history.replaceState("/a/discounts","",`${`?${D}`}`)},be=()=>{const w=i;Q.isEmpty(w)?te({offset:0,limit:se}):te(w)};return g.useEffect(()=>{be()},[i]),e(q,{hasPagination:!0,numberOfRows:n.limit,pagingState:{count:c,offset:n.offset,pageSize:n.offset+u.length,title:"Customers",currentPage:he+1,pageCount:I,nextPage:Ce,prevPage:xe,hasNext:O,hasPrev:T},isLoading:f,children:l(m,{enableSearch:!0,handleSearch:P,searchValue:b,...H(),children:[e(m.Head,{children:N==null?void 0:N.map(w=>e(m.HeadRow,{...w.getHeaderGroupProps(),children:w.headers.map(D=>e(m.HeadCell,{className:"w-[100px]",...D.getHeaderProps(),children:D.render("Header")}))}))}),e(m.Body,{...x(),children:u.map(w=>(S(w),e(m.Row,{color:"inherit",actions:[{label:"Edit",onClick:()=>a(w.original.id),icon:e(U,{size:20})},{label:"Details",onClick:()=>a(w.original.id),icon:e($,{size:20})}],linkTo:w.original.id,...w.getRowProps(),children:w.cells.map((D,Pe)=>e(m.Cell,{...D.getCellProps(),children:D.render("Cell",{index:Pe})}))})))})]})})};function pe(a){const t=F();return e(Ge,{setActiveView:s=>{t(s==="customers"?"/a/customers":"/a/customers/groups")},views:["customers","groups"],activeView:a.activeView})}function ge(a){const t=Q.sortBy(a.groups,"name");if(!t.length)return null;const s=t.length-1,r=t[0].name,n=t.map(i=>i.name).join(", ");return l("div",{title:n,className:"text-small",children:[e("span",{children:r}),!!s&&l("span",{className:"text-grey-40",children:[" + ",s," more"]})]})}const at=[{Header:()=>l("div",{className:"flex items-center gap-1",children:["Title ",e(j,{size:16})]}),accessor:"name"},{Header:()=>l("div",{className:"flex items-center gap-1",children:["Members ",e(j,{size:16})]}),id:"members",accessor:a=>{var t;return(t=a.customers)==null?void 0:t.length}}],st=[{id:"selection",Header:({getToggleAllPageRowsSelectedProps:a})=>e(ae,{...a()}),Cell:({row:a})=>e(m.Cell,{onClick:t=>t.stopPropagation(),className:"w-[100px]",children:e(ae,{...a.getToggleRowSelectedProps()})})},{Header:()=>l("div",{className:"flex items-center gap-1",children:["Name ",e(j,{size:16})]}),id:"avatar",Cell:({row:a})=>e(J,{customer:a.original,color:K(a.index)})},{Header:()=>l("div",{className:"flex items-center gap-1",children:["Email ",e(j,{size:16})]}),accessor:"email"},{accessor:"groups",Header:()=>e("div",{className:"text-left",children:"Segments"}),Cell:({cell:{value:a}})=>e(ge,{groups:a})}],rt=[{Header:()=>l("div",{className:"flex items-center gap-1",children:["Name ",e(j,{size:16})]}),id:"avatar",Cell:({row:a})=>e(J,{customer:a.original,color:K(a.index)})},{Header:()=>l("div",{className:"flex items-center gap-1",children:["Email ",e(j,{size:16})]}),accessor:"email"},{accessor:"groups",disableSortBy:!0,Header:"Groups",Cell:({cell:{value:a}})=>e(ge,{groups:a})},{Header:"",id:"settings-col"}],nt={additionalFilters:{expand:"groups"},limit:15};function it(a){const{headerGroup:t}=a;return e(m.HeadRow,{...t.getHeaderGroupProps(),children:t.headers.map((s,r)=>e(m.HeadCell,{className:"w-[100px]",...s.getHeaderProps(),children:s.render("Header")}))})}function ot(a){return e(m.Row,{color:"inherit",linkTo:`/a/customers/${a.row.original.id}`,...a.row.getRowProps(),children:a.row.cells.map((t,s)=>e(m.Cell,{...t.getCellProps(),children:t.render("Cell",{index:s})}))})}function lt(a){var L;const{setSelectedCustomerIds:t,selectedCustomerIds:s,handleSubmit:r,onClose:n}=a,{paginate:i,setQuery:o,setFilters:p,filters:d,queryObject:f}=X(nt),[c,b]=g.useState(0),[P,h]=g.useState(),{customer_groups:y}=ie({expand:"customers"}),{customers:C=[],count:H=0,isLoading:x}=ne({...f,groups:P?[P]:null});g.useEffect(()=>{if(typeof H<"u"){const v=Math.ceil(H/f.limit);b(v)}},[H]);const N={columns:st,data:C,initialState:{pageSize:f.limit,pageIndex:f.offset/f.limit,selectedRowIds:s.reduce((v,Y)=>(v[Y]=!0,v),{})},pageCount:c,autoResetSelectedRows:!1,manualPagination:!0,autoResetPage:!1,getRowId:v=>v.id},u=M.useTable(N,M.usePagination,M.useRowSelect);g.useEffect(()=>{t(Object.keys(u.state.selectedRowIds))},[u.state.selectedRowIds]),g.useEffect(()=>{p("offset",0),u.gotoPage(0)},[P]);const S=[{title:"Groups",options:[{title:"All",onClick:()=>h(null)},...(y||[]).map(v=>({title:v.name,count:v.customers.length,onClick:()=>h(v.id)}))]}],T=()=>{u.canNextPage&&(i(1),u.nextPage())},O=()=>{u.canPreviousPage&&(i(-1),u.previousPage())},I=v=>{o(v),v&&u.gotoPage(0)};return e(R,{handleClose:n,children:l(R.Body,{children:[e(R.Header,{handleClose:n,children:e("h3",{className:"inter-xlarge-semibold",children:"Edit Customers"})}),e(R.Content,{children:e(q,{isLoading:x,hasPagination:!0,numberOfRows:f.limit,pagingState:{count:H,offset:f.offset,pageSize:f.offset+u.rows.length,title:"Customers",currentPage:u.state.pageIndex+1,pageCount:u.pageCount,nextPage:T,prevPage:O,hasNext:u.canNextPage,hasPrev:u.canPreviousPage},children:l(m,{filteringOptions:S,enableSearch:!0,handleSearch:I,searchValue:f.q,...u.getTableProps(),children:[e(m.Head,{children:(L=u.headerGroups)==null?void 0:L.map(v=>e(it,{headerGroup:v}))}),e(m.Body,{...u.getTableBodyProps(),children:u.rows.map(v=>(u.prepareRow(v),e(ot,{row:v})))})]})})}),e(R.Footer,{children:l("div",{className:"flex items-center justify-end gap-x-xsmall w-full",children:[e(_,{variant:"ghost",size:"small",className:"w-eventButton",onClick:n,children:"Cancel"}),e(_,{variant:"primary",size:"small",className:"w-eventButton",onClick:r,children:"Save"})]})})]})})}function ct(a){const{headerGroup:t}=a;return e(m.HeadRow,{...t.getHeaderGroupProps(),children:a.headerGroup.headers.map((s,r)=>{const{render:n,getHeaderProps:i,getSortByToggleProps:o}=s,p=r?"w-[100px]":"w-[60px]";return e(m.HeadCell,{className:p,...i(o()),children:n("Header")})})})}function ut(a){const{row:t,removeCustomers:s}=a,r=F(),n=[{label:"Details",onClick:()=>r(`/a/customers/${t.original.id}`),icon:e($,{size:20})},{label:"Delete from the group",variant:"danger",onClick:()=>s({customer_ids:[{id:t.original.id}]}),icon:e(Z,{size:20})}];return e(m.Row,{color:"inherit",actions:n,linkTo:`/a/customers/${a.row.original.id}`,...a.row.getRowProps(),children:a.row.cells.map((i,o)=>e(m.Cell,{...i.getCellProps(),children:i.render("Cell",{index:o})}))})}function dt(a){var y;const{customers:t,removeCustomers:s,setQuery:r,paginate:n,filteringOptions:i,queryObject:o,count:p,isLoading:d}=a,f={data:t,columns:rt,initialState:{pageSize:o.limit,pageIndex:o.offset/o.limit},pageCount:Math.ceil(p/o.limit),manualPagination:!0,autoResetPage:!1},c=M.useTable(f,M.useSortBy,M.usePagination),b=()=>{c.canNextPage&&(n(1),c.nextPage())},P=()=>{c.canPreviousPage&&(n(-1),c.previousPage())},h=C=>{r(C),C&&c.gotoPage(0)};return e(q,{isLoading:d,hasPagination:!0,numberOfRows:o.limit,pagingState:{count:p,offset:o.offset,pageSize:o.offset+c.rows.length,title:"Customer Groups",currentPage:c.state.pageIndex+1,pageCount:c.pageCount,nextPage:b,prevPage:P,hasNext:c.canNextPage,hasPrev:c.canPreviousPage},children:l(m,{enableSearch:!0,handleSearch:h,searchValue:o.q,filteringOptions:i,...c.getTableProps(),children:[e(m.Head,{children:(y=c.headerGroups)==null?void 0:y.map((C,H)=>e(ct,{headerGroup:C},H))}),e(m.Body,{...c.getTableBodyProps(),children:c.rows.map(C=>(c.prepareRow(C),e(ut,{row:C,removeCustomers:s},C.id)))})]})})}function mt(a){const{initialData:t,handleSubmit:s,handleClose:r}=a,n=!!t,[i,o]=g.useState(n?Object.keys(t.metadata||{}).map(c=>({key:c,value:t.metadata[c]})):[]),{register:p,handleSubmit:d}=de({defaultValues:t}),f=c=>{var y;const b={},P=((y=a.initialData)==null?void 0:y.metadata)||{};i.forEach(C=>b[C.key]=C.value);for(const C in P)C in b||(b[C]=null);const h={name:c.name,metadata:b};s(h)};return e(R,{handleClose:r,children:l(R.Body,{children:[e(R.Header,{handleClose:r,children:l("span",{className:"inter-xlarge-semibold",children:[a.initialData?"Edit":"Create a New"," Customer Group"]})}),l(R.Content,{children:[l("div",{className:"space-y-4",children:[e("span",{className:"inter-base-semibold",children:"Details"}),e("div",{className:"flex space-x-4",children:e(z,{label:"Title",...p("name"),placeholder:"Customer group name",required:!0})})]}),e("div",{className:"mt-8",children:e(_e,{metadata:i,setMetadata:o})})]}),e(R.Footer,{children:l("div",{className:"flex w-full h-8 justify-end",children:[e(_,{variant:"ghost",className:"mr-2 w-32 text-small justify-center",size:"large",onClick:r,children:"Cancel"}),e(_,{size:"medium",className:"w-32 text-small justify-center",variant:"primary",onClick:d(f),children:l("span",{children:[a.initialData?"Edit":"Publish"," Group"]})})]})})]})})}const V=g.createContext();function ee(a){var c;const t=fe(),{mutate:s}=ye(),{mutate:r}=ve((c=a.group)==null?void 0:c.id),[n,i]=g.useState(!1),o=()=>i(!0),p=()=>i(!1),d=b=>{const P=!!a.group,h=P?r:s,y=`Successfully ${P?"edited":"created"} the customer group`;h(b,{onSuccess:()=>{t("Success",y,"success"),p()},onError:C=>t("Error",me(C),"error")})},f={group:a.group,isModalVisible:n,showModal:o,hideModal:p};return l(V.Provider,{value:f,children:[a.children,n&&e(mt,{handleClose:p,handleSubmit:d,initialData:a.group})]})}const ft={additionalFilters:{expand:"groups"},limit:15,offset:0};function pt(){return e("div",{className:"h-full flex center justify-center items-center min-h-[756px]",children:e("span",{className:"text-xs text-gray-400",children:"No customers in this group yet"})})}function gt(a){const t=a.group.id,[s,r]=g.useState(!1),{q:n,queryObject:i,paginate:o,setQuery:p}=X(ft),{customers:d=[],isLoading:f,count:c}=we(t,i,{keepPreviousData:!0}),{mutate:b}=Se(t),{mutate:P}=Te(t),[h,y]=g.useState(d.map(u=>u.id));g.useEffect(()=>{f||y(d.map(u=>u.id))},[f,d]);const C=!f&&!d.length&&!n,H=[{label:"Edit customers",onClick:()=>r(!0),icon:e("span",{className:"text-grey-90",children:e(ue,{size:20})})}],x=()=>{const u=d.map(S=>S.id);return{toAdd:Q.difference(h,u),toRemove:Q.difference(u,h)}};return l(k,{title:"Customers",actionables:H,className:"w-full my-4 min-h-[756px]",children:[s&&e(lt,{selectedCustomerIds:h,setSelectedCustomerIds:y,handleSubmit:()=>{const{toAdd:u,toRemove:S}=x();u.length&&b({customer_ids:u.map(T=>({id:T}))}),S.length&&P({customer_ids:S.map(T=>({id:T}))}),r(!1)},onClose:()=>r(!1)}),C?e(pt,{}):e(dt,{query:n,count:c||0,paginate:o,setQuery:p,customers:d,groupId:a.group.id,queryObject:i,removeCustomers:P})]})}function ht(a){const{showModal:t}=g.useContext(V),[s,r]=g.useState(!1),n=F(),{mutate:i}=Re(a.customerGroup.id),o=[{label:"Edit",onClick:t,icon:e(U,{size:20})},{label:"Delete",onClick:()=>{r(!0)},variant:"danger",icon:e(Z,{size:20})}],p=async()=>{i(),n("/a/customers/groups")},d=()=>r(!1);return l(le,{children:[e(k,{title:a.customerGroup.name,actionables:o,className:"min-h-0 w-full",subtitle:" "}),s&&e(ke,{onDelete:p,handleClose:d,confirmText:"Yes, delete",heading:"Delete the group",successText:"Group deleted",text:"Are you sure you want to delete this customer group?"})]})}function Ct(){const{id:a}=oe(),{customer_group:t}=Ne(a);return t?e(ee,{group:t,children:l("div",{className:"-mt-4 pb-4",children:[e(je,{path:"/a/customers/groups",label:"Back to customer groups",className:"mb-4"}),e(ht,{customerGroup:t}),e(gt,{group:t})]})}):null}const xt={additionalFilters:{expand:"customers"},limit:15,offset:0};function bt(){return e("div",{className:"h-full flex center justify-center items-center min-h-[756px]",children:e("span",{className:"text-xs text-gray-400",children:"No customer groups yet"})})}function Pt(a){return e(m.HeadCell,{className:"w-[100px]",...a.col.getHeaderProps(a.col.getSortByToggleProps()),children:a.col.render("Header")})}function yt(a){return e(m.HeadRow,{...a.headerGroup.getHeaderGroupProps(),children:a.headerGroup.headers.map(t=>e(Pt,{col:t},t.id))})}function vt(a){const{row:t}=a,s=F(),{showModal:r}=g.useContext(V),n=[{label:"Edit",onClick:r,icon:e(U,{size:20})},{label:"Details",onClick:()=>s(t.original.id),icon:e($,{size:20})}];return e(m.Row,{color:"inherit",actions:n,linkTo:a.row.original.id,...a.row.getRowProps(),children:a.row.cells.map((i,o)=>e(m.Cell,{...i.getCellProps(),children:i.render("Cell",{index:o})}))})}function Nt(a){var P;const{customerGroups:t,queryObject:s,count:r,paginate:n,setQuery:i,isLoading:o}=a,p={columns:at,data:t||[],initialState:{pageSize:s.limit,pageIndex:s.offset/s.limit},pageCount:Math.ceil(r/s.limit),manualPagination:!0,autoResetPage:!1},d=M.useTable(p,M.useSortBy,M.usePagination),f=()=>{d.canNextPage&&(n(1),d.nextPage())},c=()=>{d.canPreviousPage&&(n(-1),d.previousPage())},b=h=>{i(h),h&&d.gotoPage(0)};return e(q,{isLoading:o,hasPagination:!0,numberOfRows:s.limit,pagingState:{count:r,offset:s.offset,pageSize:s.offset+d.rows.length,title:"Customer groups",currentPage:d.state.pageIndex+1,pageCount:d.pageCount,nextPage:f,prevPage:c,hasNext:d.canNextPage,hasPrev:d.canPreviousPage},children:l(m,{enableSearch:!0,handleSearch:b,searchValue:s.q,...d.getTableProps(),children:[e(m.Head,{children:(P=d.headerGroups)==null?void 0:P.map((h,y)=>e(yt,{headerGroup:h},y))}),e(m.Body,{...d.getTableBodyProps(),children:d.rows.map(h=>(d.prepareRow(h),e(ee,{group:h.original,children:e(vt,{row:h})},h.id)))})]})})}function wt(){const a=X(xt),{customer_groups:t,isLoading:s,count:r=0}=ie(a.queryObject);return ze(a.representationObject),!(t!=null&&t.length)&&!a.queryObject.q?s?null:e(bt,{}):e(Nt,{count:r,customerGroups:t||[],isLoading:s,...a})}function St(){const{showModal:a}=g.useContext(V);return e("div",{className:"flex flex-col grow h-full",children:e("div",{className:"w-full flex flex-col grow",children:e(k,{actionables:[{label:"New group",onClick:a,icon:e("span",{className:"text-grey-90",children:e(ue,{size:20})})}],customHeader:e(pe,{activeView:"groups"}),children:e(wt,{})})})})}function Tt(){return e(ee,{children:l(ce,{children:[e(B,{index:!0,element:e(St,{})}),e(B,{path:"/:id",element:e(Ct,{})})]})})}const Rt=a=>{switch(a){case"captured":return e(E,{variant:"success",title:"Paid"});case"awaiting":return e(E,{variant:"warning",title:"Awaiting"});case"requires":return e(E,{variant:"danger",title:"Requires action"});default:return e(E,{variant:"primary",title:"N/A"})}},Ht=a=>{switch(a){case"fulfilled":return e(E,{variant:"success",title:"Fulfilled"});case"shipped":return e(E,{variant:"success",title:"Shipped"});case"not_fulfilled":return e(E,{variant:"default",title:"Not fulfilled"});case"partially_fulfilled":return e(E,{variant:"warning",title:"Partially fulfilled"});case"partially_shipped":return e(E,{variant:"warning",title:"Partially shipped"});case"requires":return e(E,{variant:"danger",title:"Requires action"});default:return e(E,{variant:"primary",title:"N/A"})}},Ot=()=>g.useMemo(()=>[{Header:"Order",accessor:"display_id",Cell:({value:t})=>l("span",{className:"text-grey-90",children:["#",t]})},{accessor:"items",Cell:({value:t})=>{const s=g.useRef(null),r=Qe(s),{visibleItems:n,remainder:i}=g.useMemo(()=>{if(!t||t.length===0)return{visibleItems:[],remainder:0};const o=Math.max(Math.floor(r/20)-1,1),p=t.slice(0,o),d=t.length-o;return{visibleItems:p,remainder:d}},[t,r]);return t?l("div",{className:"flex gap-x-2xsmall",children:[e("div",{ref:s,className:"flex gap-x-xsmall",children:n.map(o=>e(De,{content:o.title,children:e("div",{className:"h-[35px] w-[25px] flex items-center justify-center rounded-rounded overflow-hidden",children:o.thumbnail?e("img",{className:"object-cover",src:o.thumbnail,alt:o.title}):e(Ye,{})})},o.id))}),i>0&&l("span",{className:"text-grey-40 inter-small-regular",children:["+ ",i," more"]})]}):null}},{Header:"Date",accessor:"created_at",Cell:({value:t})=>W(t).format("DD MMM YYYY hh:mm")},{Header:"Fulfillment",accessor:"fulfillment_status",Cell:({value:t})=>Ht(t)},{Header:"Status",accessor:"payment_status",Cell:({value:t})=>Rt(t)},{Header:()=>e("div",{className:"text-right",children:"Total"}),accessor:"total",Cell:({value:t,row:{original:{currency_code:s}}})=>e("div",{className:"text-right",children:Ve({amount:t,currencyCode:s})})}],[]),G=15,Mt=({id:a})=>{const[t,s]=g.useState(null),[r,n]=g.useState(0),{orders:i,isLoading:o,count:p}=He({customer_id:a,offset:r,limit:G},{keepPreviousData:!0}),d=Ot(),{getTableProps:f,getTableBodyProps:c,headerGroups:b,rows:P,prepareRow:h,canPreviousPage:y,canNextPage:C,pageCount:H,nextPage:x,previousPage:N,state:{pageIndex:u}}=M.useTable({columns:d,data:i||[],manualPagination:!0,initialState:{pageSize:G,pageIndex:Math.floor(r/G)},pageCount:Math.ceil(p||0/G),autoResetPage:!1},M.usePagination),S=()=>{C&&(n(r+G),x())},T=()=>{y&&(n(r-G),N())};return l(le,{children:[e(q,{hasPagination:!0,isLoading:o,pagingState:{count:p,offset:r,pageSize:r+P.length,title:"Orders",currentPage:u+1,pageCount:H,nextPage:S,prevPage:T,hasNext:C,hasPrev:y},children:l(m,{...f(),children:[e(m.Head,{children:b.map(O=>e(m.HeadRow,{...O.getHeaderGroupProps(),children:O.headers.map(I=>e(m.HeadCell,{...I.getHeaderProps(),children:I.render("Header")}))}))}),e(m.Body,{...c(),children:P.map(O=>(h(O),e(m.Row,{forceDropdown:!0,actions:[{label:"Transfer order",icon:e(Le,{size:"20"}),onClick:()=>{s(O.original)}}],...O.getRowProps(),linkTo:`/a/orders/${O.original.id}`,children:O.cells.map(I=>e(m.Cell,{...I.getCellProps(),children:I.render("Cell")}))})))})]})}),t&&e(Ae,{onDismiss:()=>s(null),order:t})]})},Et=({handleClose:a,customer:t})=>{const{register:s,reset:r,handleSubmit:n,formState:{isDirty:i}}=de({defaultValues:re(t)}),o=fe(),p=Oe(t.id),d=n(f=>{p.mutate({first_name:f.first_name,last_name:f.last_name,phone:f.phone,email:f.email},{onSuccess:()=>{a(),o("Success","Successfully updated customer","success")},onError:c=>{a(),o("Error",me(c),"error")}})});return g.useEffect(()=>{r(re(t))},[t]),e(R,{handleClose:a,children:l(R.Body,{children:[e(R.Header,{handleClose:a,children:e("span",{className:"inter-xlarge-semibold",children:"Customer Details"})}),l(R.Content,{children:[e("div",{className:"inter-base-semibold text-grey-90 mb-4",children:"General"}),l("div",{className:"w-full flex mb-4 space-x-2",children:[e(z,{label:"First Name",...s("first_name"),placeholder:"Lebron"}),e(z,{label:"Last Name",...s("last_name"),placeholder:"James"})]}),e("div",{className:"inter-base-semibold text-grey-90 mb-4",children:"Contact"}),l("div",{className:"flex space-x-2",children:[e(z,{label:"Email",...s("email",{validate:f=>!!Ue(f),disabled:t.has_account}),prefix:t.has_account&&e($e,{size:16,className:"text-grey-50"}),disabled:t.has_account}),e(z,{label:"Phone number",...s("phone"),placeholder:"+45 42 42 42 42"})]})]}),e(R.Footer,{children:l("div",{className:"w-full flex justify-end",children:[e(_,{variant:"ghost",size:"small",onClick:a,className:"mr-2",children:"Cancel"}),e(_,{loading:p.isLoading,disabled:!i||p.isLoading,variant:"primary",className:"min-w-[100px]",size:"small",onClick:d,children:"Save"})]})})]})})},re=a=>({first_name:a.first_name,email:a.email,last_name:a.last_name,phone:a.phone}),It=()=>{const{id:a}=oe(),{customer:t,isLoading:s}=Me(a),[r,n]=g.useState(!1),i=()=>t!=null&&t.first_name&&(t!=null&&t.last_name)?`${t.first_name} ${t.last_name}`:t==null?void 0:t.email,o=[{label:"Edit",onClick:()=>n(!0),icon:e(U,{size:20})},{label:"Delete (not implemented yet)",onClick:()=>console.log("TODO: delete customer"),variant:"danger",icon:e(Z,{size:20})}];return l("div",{children:[e(Fe,{currentPage:"Customer Details",previousBreadcrumb:"Customers",previousRoute:"/a/customers"}),l(k,{className:"relative mb-4 h-auto w-full pt-[100px]",children:[e("div",{className:"from-fuschia-20 absolute inset-x-0 top-0 z-0 h-[120px] w-full bg-gradient-to-b"}),l("div",{className:"flex grow flex-col overflow-y-auto",children:[e("div",{className:"mb-4 h-[64px] w-[64px]",children:e(Be,{user:t,font:"inter-2xlarge-semibold",color:"bg-fuschia-40"})}),l("div",{className:"flex items-center justify-between",children:[e("h1",{className:"inter-xlarge-semibold text-grey-90 max-w-[50%] truncate",children:i()}),e(Ie,{actions:o})]}),e("h3",{className:"inter-small-regular text-grey-50 pt-1.5",children:t==null?void 0:t.email})]}),l("div",{className:"mt-6 flex space-x-6 divide-x",children:[l("div",{className:"flex flex-col",children:[e("div",{className:"inter-smaller-regular text-grey-50 mb-1",children:"First seen"}),e("div",{children:W(t==null?void 0:t.created_at).format("DD MMM YYYY")})]}),l("div",{className:"flex flex-col pl-6",children:[e("div",{className:"inter-smaller-regular text-grey-50 mb-1",children:"Phone"}),e("div",{className:"max-w-[200px] truncate",children:(t==null?void 0:t.phone)||"N/A"})]}),l("div",{className:"flex flex-col pl-6",children:[e("div",{className:"inter-smaller-regular text-grey-50 mb-1",children:"Orders"}),e("div",{children:t==null?void 0:t.orders.length})]}),l("div",{className:"h-100 flex flex-col pl-6",children:[e("div",{className:"inter-smaller-regular text-grey-50 mb-1",children:"User"}),e("div",{className:"h-50 flex items-center justify-center",children:e(E,{variant:t!=null&&t.has_account?"success":"danger",title:t!=null&&t.has_account?"True":"False"})})]})]})]}),e(k,{title:`Orders (${t==null?void 0:t.orders.length})`,subtitle:"An overview of Customer Orders",children:s||!t?e("div",{className:"pt-2xlarge flex w-full items-center justify-center",children:e(Ee,{size:"large",variant:"secondary"})}):e("div",{className:"mt-large flex  grow flex-col pt-2",children:e(Mt,{id:t.id})})}),e("div",{className:"mt-large",children:e(qe,{data:t,title:"Raw customer",rootName:"customer"})}),r&&t&&e(Et,{customer:t,handleClose:()=>n(!1)})]})},Dt=()=>e("div",{className:"flex flex-col grow h-full",children:e("div",{className:"w-full flex flex-col grow",children:e(k,{customHeader:e(pe,{activeView:"customers"}),className:"h-fit",children:e(tt,{})})})}),Na=()=>l(ce,{children:[e(B,{index:!0,element:e(Dt,{})}),e(B,{path:"/groups/*",element:e(Tt,{})}),e(B,{path:"/:id",element:e(It,{})})]});export{Na as default};
