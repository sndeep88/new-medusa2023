import{e as V,r as g,a as t,u as he,bq as Ze,br as ge,az as We,j as l,B as F,C as Xe,K as et,d as z,F as ae,m as tt,M as I,Z as Fe,bs as be,bt as ke,aA as rt,G as De,a9 as st,y as nt,bu as at,be as it,x as lt,bv as ot,A as ct,bw as dt,bx as ut,q as U,c as mt,by as pt,R as ft,b as oe}from"./index-effbfb95.js";import{I as ue,M as ht,P as ie,T as gt}from"./index-dd9f9076.js";import{B as ye}from"./body-card-d3fddb8c.js";import{T as bt}from"./index-a6859a1b.js";import{C as yt,B as xt}from"./index-d895e52c.js";import{R as vt}from"./index-698bc9f9.js";import{u as Ae,b as se,F as Ct,a as St,C as H}from"./index.esm-5a89640b.js";import{h as Nt}from"./moment-fbc5633a.js";import{F as Oe}from"./index-ec3b8ff9.js";import{E as J}from"./edit-icon-8c1c10d1.js";import{T as le}from"./trash-icon-abcb5140.js";import{S as ee}from"./index-04f3341e.js";import{u as Re}from"./use-imperative-dialog-cb4e5fcf.js";import{u as Q,a as _t}from"./use-notification-9f7c3c92.js";import{g as L}from"./error-messages-d2d0bb30.js";import{F as B}from"./focus-modal-d105ce27.js";import{A as q}from"./index-bf34ad3b.js";import{D as _e,F as Pt,a as Pe,S as wt,b as Tt}from"./index-b17c211e.js";import{T as we,S as je}from"./time-picker-3cbb3a44.js";import{S as ne}from"./index-523daaeb.js";import{S as Et,R as $}from"./index-b6a697c3.js";import{F as It}from"./feature-toggle-9157e4de.js";import{S as Ft}from"./chevron-down-6a69fe38.js";import{L as kt,C as Dt}from"./index-5dfb0d3a.js";import{A as xe,M as At,T as N,r as te,a as Ot}from"./index-0d9858ea.js";import{u as ve}from"./use-query-filters-844ebb5f.js";import{I as qe}from"./image-placeholder-b3cbea02.js";import{d as Rt}from"./utils-d0ea9dd4.js";import{l as G}from"./lodash-72dfe3e0.js";import{C as jt}from"./index-b6704001.js";import{u as me}from"./use-toggle-state-9e07c572.js";import{c as Te}from"./react-select.esm-1ec1493a.js";import{a as qt,E as Mt}from"./index-dddb2ad8.js";import{C as zt}from"./index.esm-841d990e.js";import{U as Lt,a as Ht}from"./index-40f3c453.js";import{P as Vt}from"./polling-69bcbbd8.js";import{u as Ut}from"./use-set-search-params-b6913614.js";import{U as Bt,P as $t}from"./index-4a064b3c.js";import{r as Gt}from"./time-5c3c185e.js";import{u as Qt}from"./use-debounce-438a4ce8.js";import"./index-e0338379.js";import"./index-e25e2e97.js";import"./toConsumableArray-6f61c395.js";import"./unsupportedIterableToArray-27301055.js";import"./index-0f96226b.js";import"./index-a4458bf1.js";import"./index-1ec19c89.js";import"./createSuper-ad9f6885.js";import"./index-202b6dd7.js";import"./arrow-down-icon-49435f5a.js";import"./index-903c1727.js";import"./chevron-up-ae6c75fe.js";import"./index-d33be3e8.js";import"./index-740955bd.js";import"./react-select-creatable.esm-e43d0869.js";import"./_isIndex-6af6139d.js";import"./file-icon-3c84b281.js";const Ce=(e,r,s)=>e[r]?{[r]:e[r]}:{[s]:e[s]};var pe=(e=>(e.ACTIVE="active",e.DRAFT="draft",e))(pe||{}),K=(e=>(e.SALE="sale",e.OVERRIDE="override",e))(K||{}),A=(e=>(e.CREATE="create",e.EDIT_DETAILS="edit_details",e.EDIT_PRICES="edit_prices",e))(A||{});const Yt=e=>({description:e.description,type:e.type,name:e.name,ends_at:e.ends_at?new Date(e.ends_at):null,starts_at:e.starts_at?new Date(e.starts_at):null,prices:e.prices.map(r=>({amount:r.amount,max_quantity:r.max_quantity,min_quantity:r.min_quantity,variant_id:r.variant_id,currency_code:r.currency_code,region_id:r.region_id})),customer_groups:e.customer_groups.map(r=>({label:r.name,value:r.id})),includes_tax:e.includes_tax}),Ee=(e,r)=>{let s;return e.prices&&(s=Object.entries(e.prices).map(([a,n])=>n.map(i=>({variant_id:a,amount:i.amount,...Ce(i,"currency_code","region_id"),min_quantity:i.min_quantity,max_quantity:i.max_quantity}))).flat(1)),{description:e.description,name:e.name,type:K.SALE,status:r,customer_groups:e.customer_groups?e.customer_groups.map(a=>({id:a.value})):void 0,ends_at:e.ends_at||void 0,starts_at:e.starts_at||void 0,prices:s}},Kt=e=>({name:e.name||void 0,description:e.description||void 0,customer_groups:e.customer_groups?e.customer_groups.map(r=>({id:r.value})):[],ends_at:e.ends_at,starts_at:e.starts_at,type:e.type||void 0}),Jt=e=>{let r;if(e.prices)return r=Object.entries(e.prices).map(([s,a])=>a.map(n=>({variant_id:s,amount:n.amount,...Ce(n,"currency_code","region_id"),min_quantity:n.min_quantity,max_quantity:n.max_quantity}))).flat(1),{prices:r}},Me=()=>{const e=new Date;return new Date(e.getTime()+7*24*60*60*1e3)},Zt={customer_groups:[],name:null,description:null,ends_at:null,starts_at:null,prices:null,type:K.SALE,includes_tax:null},ze=V.createContext(null),Le=({priceList:e=Zt,children:r})=>{const[s,a]=g.useState({customer_groups:e.customer_groups,ends_at:e.ends_at,starts_at:e.starts_at}),n=Ae({defaultValues:e}),[i,c]=g.useState(null),o=se({name:"starts_at",control:n.control}),u=se({name:"ends_at",control:n.control}),d=se({name:"customer_groups",control:n.control}),x=f=>{let h=null;switch(f){case"customer_groups":h=d;break;case"starts_at":h=o;break;case"ends_at":h=u;break}a({...s,[f]:h}),setTimeout(()=>n.setValue(f,null),300)},w=f=>{if(s[f])n.setValue(f,s[f]);else switch(f){case"starts_at":n.setValue("starts_at",new Date);break;case"ends_at":n.setValue("ends_at",Me());break;case"customer_groups":n.setValue("customer_groups",[]);break}},m=f=>{for(const h of Object.keys(s))f.includes(h)?w(h):x(h)},b=f=>n.handleSubmit(h=>{f({...h,prices:i})});return t(Ct,{...n,children:t(ze.Provider,{value:{configFields:s,handleConfigurationSwitch:m,prices:i,handleSubmit:b,setPrices:c},children:r})})},Z=()=>{const e=V.useContext(ze),r=St();if(e===null)throw new Error("usePriceListForm must be used within a PriceListFormProvider");return{...r,...e}},Wt=e=>{const r=new Date;return e&&new Date(e)>r},Xt=e=>{const r=new Date;return e&&new Date(e)<r},He=e=>e.status==="draft"?Wt(e==null?void 0:e.starts_at)?t(ee,{title:"Scheduled",variant:"warning"}):Xt(e==null?void 0:e.ends_at)?t(ee,{title:"Expired",variant:"danger"}):t(ee,{title:"Draft",variant:"default"}):t(ee,{title:"Active",variant:"success"}),Ve=(e=[])=>{if(!(e!=null&&e.length))return"";const r=e[0],a=e.length-1||"";return[r,a]},re=e=>(e==null?void 0:e.status)==="active",Ue=e=>{const{handleSubmit:r}=Z(),s=he(),a=Q(),n=()=>{e.viewType!==A.CREATE&&e.onClose?e.onClose():s(-1)},i=Ze(),c=ge(e.id),{isFeatureEnabled:o}=g.useContext(We),u=f=>{const h=Ee(f,pe.ACTIVE);o("tax_inclusive_pricing")&&(h.includes_tax=f.includes_tax),i.mutate(h,{onSuccess:({price_list:S})=>{s(`/a/pricing/${S.id}`)},onError:S=>{a("Error",L(S),"error")}})},d=f=>{const h=Ee(f,pe.DRAFT);o("tax_inclusive_pricing")&&(h.includes_tax=f.includes_tax),i.mutate(h,{onSuccess:({price_list:S})=>{s(`/a/pricing/${S.id}`)},onError:S=>{a("Error",L(S),"error")}})},x=f=>{const h=Kt(f);o("tax_inclusive_pricing")&&(h.includes_tax=f.includes_tax),c.mutate(h,{onSuccess:({price_list:S})=>{a("Success","Successfully updated price list","success"),n()},onError:S=>{a("Error",L(S),"error")}})},w=f=>{c.mutate(Jt(f),{onSuccess:({price_list:h})=>{e.onClose&&e.onClose()},onError:h=>{a("Error",L(h),"error")}})};let m,b;switch(e.viewType){case A.CREATE:m={label:"Publish price list",onClick:r(u)},b={label:"Save as draft",onClick:r(d)};break;case A.EDIT_DETAILS:m={label:"Save changes",onClick:r(x)},b={label:"Cancel",onClick:n};break;case A.EDIT_PRICES:m={label:"Save changes",onClick:r(w)},b={label:"Cancel",onClick:n};break}return l("div",{className:"medium:w-8/12 w-full px-8 flex justify-between",children:[t(F,{size:"small",variant:"ghost",onClick:n,className:"border rounded-rounded w-8 h-8",children:t(Xe,{size:20})}),l("div",{className:"gap-x-small flex",children:[t(F,{onClick:b.onClick,size:"small",variant:"ghost",className:"border rounded-rounded",children:b.label}),t(F,{size:"small",variant:"primary",onClick:m.onClick,className:"rounded-rounded",children:m.label})]})]})},er=e=>{const r=[];return e.customer_groups&&e.customer_groups.length>0&&r.push("customer_groups"),e.starts_at&&r.push("starts_at"),e.ends_at&&r.push("ends_at"),r},tr=()=>{const{customer_groups:e,isLoading:r}=et(),{control:s,handleConfigurationSwitch:a,configFields:n}=Z(),[i,c]=g.useState(er(n));return t(q.Item,{forceMountContent:!0,title:"Configuration",tooltip:"Optional configuration for the price list",value:"configuration",description:"The price overrides apply from the time you hit the publish button and forever if left untouched.",children:t(q,{type:"multiple",value:i,onValueChange:o=>{a(o),c(o)},children:l("div",{className:"mt-5",children:[t(q.Item,{headingSize:"medium",forceMountContent:!0,className:"border-b-0",title:"Price overrides has a start date?",subtitle:"Schedule the price overrides to activate in the future.",value:"starts_at",customTrigger:t(ne,{checked:i.indexOf("starts_at")>-1}),children:t("div",{className:z("flex items-center gap-xsmall accordion-margin-transition",{"mt-4":i.indexOf("starts_at")>-1}),children:t(H,{name:"starts_at",control:s,render:({field:{value:o,onChange:u}})=>{const d=o||new Date;return l(ae,{children:[t(_e,{date:d,label:"Start date",onSubmitDate:u}),t(we,{date:d,label:"Start date",onSubmitDate:u})]})}})})}),t(q.Item,{headingSize:"medium",forceMountContent:!0,className:"border-b-0",title:"Price overrides has an expiry date?",subtitle:"Schedule the price overrides to deactivate in the future.",value:"ends_at",customTrigger:t(ne,{checked:i.indexOf("ends_at")>-1}),children:t("div",{className:z("flex items-center gap-xsmall accordion-margin-transition",{"mt-4":i.indexOf("ends_at")>-1}),children:t(H,{name:"ends_at",control:s,render:({field:{value:o,onChange:u}})=>{const d=o||Me();return l(ae,{children:[t(_e,{date:d,label:"End date",onSubmitDate:u}),t(we,{date:d,label:"End date",onSubmitDate:u})]})}})})}),t(q.Item,{headingSize:"medium",forceMountContent:!0,className:"border-b-0",title:"Customer availabilty",subtitle:"Specifiy which customer groups the price overrides should apply for.",value:"customer_groups",customTrigger:t(ne,{checked:i.indexOf("customer_groups")>-1}),children:t(H,{name:"customer_groups",control:s,render:({field:{value:o,onChange:u,ref:d}})=>t("div",{className:z("flex items-center gap-xsmall accordion-margin-transition w-full",{"mt-4":i.indexOf("customer_groups")>-1}),children:t(Et,{value:o,label:"Customer Groups",onChange:u,isMultiSelect:!0,fullWidth:!0,enableSearch:!0,hasSelectAll:!0,isLoading:r,options:(e==null?void 0:e.map(x=>({label:x.name,value:x.id})))||[],ref:d})})})})]})})})},rr=()=>{const{control:e,register:r}=Z();return t(q.Item,{forceMountContent:!0,required:!0,title:"General",tooltip:"General information for the price list.",value:"general",children:l("div",{className:"flex flex-col gap-y-small group-radix-state-open:mt-5 accordion-margin-transition",children:[t(ue,{label:"Name",required:!0,placeholder:"B2B, Black Friday...",...r("name",{required:"Name is required"})}),t(ue,{label:"Description",required:!0,placeholder:"For our business partners...",...r("description",{required:"Description is required"})}),t(It,{featureFlag:"tax_inclusive_pricing",children:l("div",{className:"mt-3",children:[l("div",{className:"flex justify-between",children:[t("h2",{className:"inter-base-semibold",children:"Tax inclusive prices"}),t(H,{control:e,name:"includes_tax",render:({field:{value:s,onChange:a}})=>t(ne,{checked:!!s,onCheckedChange:a})})]}),t("p",{className:"inter-base-regular text-grey-50",children:"Choose to make all prices in this list inclusive of tax."})]})})]})})},fe=(e=[],r=[])=>{const s=Ie(e,"id"),a=Ie(r,"id"),n=Object.values(s);return Object.values(a).forEach(i=>{s[i.id]||n.push(i)}),n},Ie=(e,r)=>e.reduce((s,a)=>(s[a[r]]={...a},s),{}),Se=V.createContext(null),O=({children:e})=>{const[r,s]=V.useState(!1);return t(Se.Provider,{value:{open:r,handleOpen:()=>s(!0),handleClose:()=>s(!1),toggle:()=>s(a=>!a)},children:e})};Se.displayName="CollapsibleTreeContext";const Be=()=>{const e=V.useContext(Se);if(!e)throw new Error("useCollapsibleTree must be a child of CollapsibleTree");return e},sr=({children:e,className:r,...s})=>{const{open:a}=Be();return t("div",{className:z("pl-5 mt-xsmall",{hidden:!a,"animate-fade-in-top":a},r),...s,children:e})};O.Content=sr;const nr=({actions:e,className:r,children:s})=>{const{open:a,toggle:n}=Be();return t("div",{children:t($e,{className:r,children:l("div",{className:"flex items-center justify-between",children:[t("div",{className:"gap-x-small flex items-center",children:s}),l("div",{className:"flex items-center gap-x-xsmall",children:[e&&t(xe,{customTrigger:Ge(),actions:e}),t("div",{className:"h-5 w-px rounded-circle bg-grey-20"}),t(F,{variant:"ghost",size:"small",className:"p-[6px] text-grey-50",onClick:n,children:a?t(ht,{size:20}):t(ie,{size:20})})]})]})})})};O.Parent=nr;const ar=({className:e,children:r,actions:s})=>l("div",{className:z("col-tree flex items-center relative pb-xsmall last:pb-0",e),children:[l("div",{className:"absolute top-0 left-0 bottom-0",children:[t("div",{className:"border-l border-dashed border-grey-20 h-1/2 w-px"}),t("div",{className:"h-1/2 border-l border-dashed border-grey-20 w-px bottom-half-dash"})]}),t("div",{className:"w-[13px] h-px border-t border-grey-20 border-dashed mr-xsmall"}),l($e,{className:"w-full flex items-center justify-between inter-small-regular",children:[r,s&&t(xe,{forceDropdown:!0,customTrigger:Ge(),actions:s})]})]});O.Leaf=ar;const $e=({children:e,className:r})=>t("div",{className:z("rounded-rounded border border-grey-20 py-2xsmall px-small",r),children:e}),Ge=()=>t(F,{variant:"ghost",size:"small",className:"p-[6px] text-grey-50",children:t(At,{size:20})}),ir=({product:e,getProductActions:r,getVariantActions:s})=>l(O,{children:[l(O.Parent,{actions:r&&r(e),children:[t("div",{children:t("img",{src:e.thumbnail||void 0,className:"w-4 h-5 rounded-base"})}),t("span",{className:"inter-small-semibold",children:e.title})]}),t(O.Content,{children:e.variants.map(a=>t(O.Leaf,{actions:s&&s(a),children:t(lr,{...a})},a.id))})]}),lr=({sku:e,title:r,prices:s=[]})=>{const a=s.filter(n=>n.price_list_id);return l("div",{className:"flex flex-1",children:[l("div",{className:"truncate",children:[t("span",{children:r}),e&&l("span",{className:"text-grey-50 ml-xsmall",children:["(SKU: ",e,")"]})]}),t("div",{className:"flex items-center text-grey-50 flex-1 justify-end",children:t("div",{className:"text-grey-50 mr-xsmall",children:a.length?t("span",{children:`${a.length} price${a.length>1?"s":""}`}):t("span",{className:"inter-small-semibold text-orange-40",children:"Add prices"})})})]})},or=[{Header:t("div",{className:"pl-4",children:"Product Details"}),accessor:"title",Cell:({row:{original:e}})=>l("div",{className:"pl-4 flex items-center w-[400px]",children:[t("div",{className:"h-[40px] w-[30px] my-1.5 flex items-center mr-4",children:e.thumbnail?t("img",{src:e.thumbnail,className:"h-full object-cover rounded-soft"}):t(qe,{})}),t("div",{className:"flex flex-col",children:l("span",{children:[e.title," ",e.subtitle&&l("span",{className:"text-grey-50",children:["(",e.subtitle,")"]})]})})]})},{Header:t("div",{children:"Status"}),accessor:"status",Cell:({cell:{value:e}})=>t(N.Cell,{className:"w-[10%] pr-base",children:t("div",{className:"flex items-center",children:Rt(e)})})},{Header:t("div",{className:"flex justify-end items-center pr-4",children:"Variants"}),accessor:"variants",Cell:({row:{original:e}})=>t(N.Cell,{className:"flex justify-end items-center pr-4",children:e.variants.length})}],cr=({row:e})=>{const{isSelected:r}=e;return t(N.Row,{...e.getRowProps(),className:z({"bg-grey-5":r}),children:e.cells.map(s=>t(N.Cell,{...s.getCellProps(),children:s.render("Cell")}))})},dr=({headerGroup:e})=>t(N.HeadRow,{...e.getHeaderGroupProps(),children:e.headers.map(r=>t(N.HeadCell,{...r.getHeaderProps(r.getSortByToggleProps()),children:r.render("Header")}))}),ur=(e=[],r=[],s=[])=>{const a=e.map(n=>n==null?void 0:n.id);if(e.length<r.length){const i=G.difference(r,a).map(c=>s.find(o=>o.id===c));return e.concat(i)}else if(e.length>r.length){const n=G.difference(a,r),i=e.slice();return n.forEach(c=>{const o=i.findIndex(u=>(u==null?void 0:u.id)===c);i.splice(o,1)}),i}return e},mr={limit:12,offset:0},pr=({close:e,initialSelection:r,onSave:s})=>{const a=ve(mr),{products:n,isLoading:i,count:c=0}=tt(a.queryObject,{keepPreviousData:!0}),[o,u]=g.useState(r.map(m=>m.id)),[d,x]=g.useState(r);g.useEffect(()=>{x(ur(d,o,n))},[o,n]);const w=()=>{s(d),e()};return t(I,{open:!0,handleClose:e,children:l(I.Body,{children:[t(I.Header,{handleClose:e,children:t("h2",{className:"inter-xlarge-semibold",children:"Add Products"})}),t(I.Content,{children:t("div",{className:"w-full flex flex-col justify-between min-h-[300px] h-full ",children:t(je,{columns:or,data:n||[],renderRow:cr,renderHeaderGroup:dr,onChange:m=>u(m),selectedIds:o,isLoading:i,resourceName:"products",totalCount:c,options:{enableSearch:!0,searchPlaceholder:"Search by name or description..."},...a})})}),t(I.Footer,{children:l("div",{className:"w-full flex justify-end gap-2",children:[t(F,{variant:"ghost",className:"rounded-rounded h-8 w-[128px]",onClick:e,children:"Cancel"}),t(F,{variant:"primary",className:"rounded-rounded h-8 w-[128px]",onClick:w,children:"Save"})]})})]})})};function fr(e){const{amount:r,currency:s,onAmountChange:a}=e,{code:n,symbol_native:i,decimal_digits:c}=s,o=10**-c,u=24+i.length*4,d=`0.${"0".repeat(c)}`;return l("div",{className:"w-[314px] relative",children:[t("div",{className:"absolute flex items-center h-full top-0 left-3",children:t("span",{className:"text-small text-grey-40 mt-[1px]",children:n})}),t(zt,{step:o,value:r,onValueChange:(x,w,m)=>a(x,m==null?void 0:m.float),allowNegativeValue:!1,placeholder:d,decimalScale:c,style:{paddingRight:u},className:`focus:bg-white focus:border-violet-6
            border border-solid border-grey-20
            w-full h-[40px]
            py-[10px] pl-12
            rounded-lg
            bg-grey-5
            text-gray-90
            text-right
            text-small`}),t("div",{className:"absolute flex items-center h-full top-0 right-3",children:t("span",{className:"text-small text-grey-40 mt-[1px]",children:i})})]})}function hr(e){const[r,s]=g.useState(`${e.amount||0}`),{amount:a,currency:n,onChange:i}=e,{decimal_digits:c}=n;return g.useEffect(()=>{const u=a/10**c;s(`${u}`)},[a,c]),t(fr,{amount:r,onAmountChange:(u,d)=>{if(typeof d=="number"){const x=Math.round(d*10**c);i(x)}else i(void 0);s(u)},currency:n})}const gr=({value:e,onChange:r})=>{var i,c,o;const{state:s,toggle:a}=me(),n=(c=Te[(i=e.currency_code)==null?void 0:i.toUpperCase()])==null?void 0:c.name;return t("div",{className:"flex flex-col gap-3 py-3 first:border-t border-grey-20 border-solid border-b last:border-b-0",children:l("div",{className:"flex items-center justify-between",children:[l("div",{className:"flex items-center gap-3",children:[l("div",{className:"inter-base-semibold",children:[t("span",{className:"mr-2 uppercase",children:e.currency_code}),t("span",{className:"inter-base-regular text-grey-50 capitalize",children:n})]}),(o=e.region)!=null&&o.countries?t(F,{variant:"secondary",size:"small",className:"rounded-rounded h-[32px]",onClick:a,children:l("div",{className:"flex items-center gap-2",children:[s?t(qt,{size:20}):t(Mt,{size:20}),t("span",{children:"Show regions"})]})}):null]}),t("div",{className:"basis-[220px]",children:t(hr,{amount:e.amount,onChange:r,currency:Te[e.currency_code.toUpperCase()]})})]})})},Y={APPLY_ALL:"all",SELECTED_ONLY:"selected"},Qe=({onClose:e,prices:r,variants:s,onSubmit:a,defaultVariant:n,isEdit:i=!1})=>{const[c,o]=V.useState(Y.SELECTED_ONLY),{handleSubmit:u,control:d,reset:x,formState:{isSubmitting:w}}=Ae({defaultValues:{variants:[],prices:r}}),m=u(b=>{var f;c===Y.APPLY_ALL?a({...b,variants:s==null?void 0:s.map(h=>h.id)}):a({...b,variants:(f=b.variants)==null?void 0:f.filter(Boolean)})});return V.useEffect(()=>{var b;if(r.length>0&&(s==null?void 0:s.length)>0){const f=n?n.id:(b=r[0])==null?void 0:b.variant_id,h=s.findIndex(E=>E.id===f),S=Array(s.length).fill(null);S[h]=f,x({prices:r,variants:S})}},[s,r,n]),l(ae,{children:[l(I.Content,{children:[!i&&l($.Root,{value:c,onValueChange:b=>o(b),className:"pt-2 flex items-center",children:[t($.SimpleItem,{value:Y.SELECTED_ONLY,label:"Apply overrides on selected variants"}),t($.SimpleItem,{value:Y.APPLY_ALL,label:"Apply on all variants"})]}),c===Y.SELECTED_ONLY&&!i&&t("div",{className:"pt-6 flex flex-col gap-2",children:s.map((b,f)=>t("div",{id:b.id,className:"py-2.5 px-3 border border-grey-20 rounded-rounded",children:t(br,{control:d,name:"variants",label:`${b.title} (SKU: ${b.sku})`,id:b.id,index:f,value:b.id})}))}),l("div",{className:"pt-8",children:[t("h6",{className:"inter-base-semibold",children:"Prices"}),t("div",{className:"pt-4",children:r.map((b,f)=>t(H,{control:d,name:`prices.${f}`,render:({field:h})=>t(gr,{value:h.value,onChange:S=>{h.onChange({...h.value,amount:S})}},b.id)},b.id))})]})]}),t(I.Footer,{children:l("div",{className:"flex w-full h-8 justify-end",children:[t(F,{variant:"ghost",className:"mr-2 w-32 text-small justify-center rounded-rounded",size:"large",onClick:e,children:"Cancel"}),t(F,{size:"large",className:"text-small justify-center rounded-rounded",variant:"primary",onClick:m,loading:w,children:"Save and close"})]})})]})},br=({control:e,name:r,id:s,index:a,value:n,...i})=>{const c=se({control:e,name:r});return t(H,{control:e,name:r,render:({field:o})=>t(jt,{className:"shrink-0 inter-small-regular",...i,...o,checked:c==null?void 0:c.some(u=>u===n),onChange:u=>{const d=[...c||[]];d[a]=u.target.checked?s:null,o.onChange(d)}})})},Ye=(e=[],r)=>r.map(s=>e.find(n=>(n==null?void 0:n.currency_code)===s.currency_code)||s),Ke=({products:e,setProducts:r,isLoading:s=!1,onSearch:a,onFileChosen:n})=>{const[i,c]=g.useState(!1),[o,u]=g.useState(null),d=()=>u(null),{prices:x,setPrices:w}=Z(),{store:m}=Fe(),b=_=>{const C=_.target.value;a&&a(C)},f=m==null?void 0:m.currencies.map(_=>({currency_code:_.code,amount:0})),h=_=>[{label:"Edit prices",icon:t(J,{}),onClick:()=>{u(_)}},{label:"Remove from list",icon:t(le,{size:20}),onClick:()=>{},variant:"danger"}],S=_=>{_.variants.forEach(C=>{const D=_.prices.filter(k=>k.amount>0).map(k=>({amount:k.amount,currency_code:k.currency_code}));w(k=>({...k,[C]:D})),d()})},E=yr(e,o);return l("div",{className:"mt-6",children:[l("div",{children:[a&&t("div",{className:"mb-2",children:t(ue,{placeholder:"Search by name or SKU...",prefix:t(Ft,{}),onChange:b})}),t("div",{children:t(kt,{isLoading:s,children:e.map(_=>t("div",{className:"mt-2",children:t(ir,{product:_,getVariantActions:h},_.id)}))})})]}),t("div",{className:"mt-6",children:l(F,{variant:"secondary",size:"medium",className:"w-full rounded-rounded",onClick:()=>c(!0),children:[t(ie,{}),"Add Products Manually"]})}),i&&t(pr,{onSave:r,initialSelection:e,close:()=>c(!1)}),o&&t(I,{open:!0,handleClose:d,children:l(I.Body,{children:[t(I.Header,{handleClose:d,children:t("h2",{className:"inter-xlarge-semibold",children:"Edit Prices"})}),t(Qe,{onClose:d,variants:E.variants,prices:x?Ye(x[o.id],f):f,defaultVariant:o,onSubmit:S})]})})]})},yr=(e=[],r)=>e.find(s=>s.variants.find(a=>a.id===(r==null?void 0:r.id))),xr={limit:50,offset:0},vr=({isEdit:e=!1,id:r})=>{const{products:s=[],isInitialLoading:a,isLoading:n}=be(r,xr,{enabled:e}),[i,c]=g.useState([]),o=fe(s,i);return t(q.Item,{forceMountContent:!0,required:!0,value:"prices",title:"Prices",description:"You will be able to override the prices for the products you add here",tooltip:"Define the price overrides for the price list",children:t(Ke,{products:o,isLoading:e?n:a,setProducts:c,onFileChosen:console.log})})},Cr=()=>{const{control:e}=Z();return t(q.Item,{forceMountContent:!0,required:!0,value:"type",title:"Price list type",description:"Select the type of the price list",tooltip:"Unlike with sale prices a price override will not communicate to the customer that the price is part of a sale.",children:t(H,{name:"type",control:e,rules:{required:!0},render:({field:{onChange:r,value:s}})=>l($.Root,{value:s??void 0,onValueChange:r,className:"flex items-center gap-base group-radix-state-open:mt-5 accordion-margin-transition",children:[t($.Item,{value:K.SALE,className:"flex-1",label:"Sale",description:"Use this if you are creating prices for a sale."}),t($.Item,{value:K.OVERRIDE,className:"flex-1",label:"Override",description:"Use this to override prices."})]})})})},Je=e=>l(B,{children:[t(B.Header,{children:t(Ue,{...e})}),t(B.Main,{children:t("div",{className:"flex justify-center mb-[25%]",children:l("div",{className:"medium:w-7/12 large:w-6/12 small:w-4/5 w-full pt-16",children:[t("h1",{className:"inter-xlarge-semibold mb-[28px]",children:e.viewType===A.CREATE?"Create new price list":"Edit price list"}),l(q,{type:"multiple",defaultValue:["type"],children:[t(Cr,{}),t(rr,{}),t(tr,{}),e.viewType!==A.EDIT_DETAILS&&t(vr,{isEdit:e.viewType!==A.CREATE,id:e.id})]})]})})})]}),Sr=({priceList:e})=>{var a;const[r,s]=g.useState(!1);return l(_r,{priceList:e,setIsOpen:s,children:[l("div",{className:"flex gap-12",children:[e.customer_groups.length?l("div",{className:"border-l border-grey-20 pl-6",children:[t("span",{className:"inter-base-regular text-grey-50",children:"Customer groups"}),t("p",{className:"inter-base-regular text-grey-90",children:t(Nr,{groups:e.customer_groups})})]}):null,l("div",{className:"border-l border-grey-20 pl-6",children:[t("span",{className:"inter-base-regular text-grey-50",children:"Last edited"}),t("p",{className:"inter-base-regular text-grey-90",children:Nt(e.updated_at).format("ddd, D MMM YYYY")})]}),l("div",{className:"border-l border-grey-20 pl-6",children:[t("span",{className:"inter-base-regular text-grey-50",children:"Price overrides"}),t("p",{className:"inter-base-regular text-grey-90",children:(a=e.prices)==null?void 0:a.length})]})]}),r&&t(Oe,{isVisible:r,isFullScreen:!0,children:t(Je,{id:e.id,onClose:()=>s(!1),viewType:A.EDIT_DETAILS})})]})},Nr=({groups:e})=>{const[r,s]=Ve(e.map(a=>a.name));return l(ae,{children:[r,s&&l("span",{className:"text-grey-40",children:[" + ",s," more"]})]})},_r=({priceList:e,setIsOpen:r,...s})=>{const a=Re(),n=he(),i=Q(),c=ke(e==null?void 0:e.id);return t(ye,{actionables:[{label:"Edit price list details",onClick:()=>r(!0),icon:t(J,{size:20})},{label:"Delete price list",onClick:async()=>{await a({heading:"Delete Price list",text:"Are you sure you want to delete this price list?"})&&c.mutate(void 0,{onSuccess:()=>{i("Success","Price list deleted successfully","success"),n("/a/pricing/")},onError:x=>{i("Ooops",L(x),"error")}})},variant:"danger",icon:t(le,{size:20})}],forceDropdown:!0,className:"min-h-[200px]",status:t("div",{className:"flex items-center gap-x-2xsmall",children:He(e)}),title:e.name,subtitle:e.description,...s})},Pr={limit:50,offset:0},wr=({close:e,id:r})=>{const s=ve(Pr),[a,n]=g.useState([]),{products:i,isLoading:c}=be(r,s.queryObject),o=d=>{s.setQuery(d)};g.useEffect(()=>{n(d=>fe(i,d))},[i,fe]);const u=g.useMemo(()=>G.debounce(o,300),[]);return l(B,{children:[t(B.Header,{children:t(Ue,{id:r,viewType:A.EDIT_PRICES,onClose:e})}),t(B.Main,{children:t("div",{className:"flex justify-center mb-[25%]",children:l("div",{className:"medium:w-7/12 large:w-6/12 small:w-4/5 w-full pt-16",children:[t("h1",{className:"inter-xlarge-semibold",children:"Edit prices"}),l("div",{className:"mt-7",children:[l("div",{className:"flex items-center gap-1.5",children:[t("h6",{className:"inter-large-semibold",children:"Prices"}),t(gt,{content:"info tooltip",children:t(_t,{size:16,className:"text-grey-40"})})]}),t("span",{className:"inter-base-regular text-grey-50",children:"You will be able to override the prices for the products you add here"})]}),t(Ke,{products:a,setProducts:n,isLoading:c,onSearch:u,onFileChosen:e,getVariantActions:Tr})]})})})]})},Tr=e=>[{label:"Edit prices",icon:t(J,{size:20}),onClick:()=>{}},{label:"Remove from list",icon:t(le,{size:20}),onClick:()=>{},variant:"danger"}],Er=(e,r)=>e.prices.map(s=>({id:s.id,...Ce(s,"currency_code","region_id"),amount:s.amount,min_quantity:s.min_quantity,max_quantity:s.max_quantity,variant_id:r})).filter(s=>s.amount>0),Ir=({variant:e,prices:r,onClick:s})=>{const{title:a,sku:n}=e,i=r.length>0;return l("div",{className:"flex flex-1 items-center",children:[l("div",{className:"truncate",children:[t("span",{children:a}),n&&l("span",{className:"text-grey-50 ml-xsmall",children:["(SKU: ",n,")"]})]}),l("div",{className:"flex items-center text-grey-50 flex-1 justify-end",children:[t("div",{className:"text-grey-50 mr-xsmall",children:i?t("span",{children:`${r.length} price${r.length>1?"s":""}`}):t("span",{className:"inter-small-semibold text-orange-40",children:"Add prices"})}),t(F,{variant:"ghost",size:"small",className:"w-[32px] h-[32px]",onClick:s,children:t(yt,{className:"text-grey-40"})})]})]})},Fr=({close:e,product:r})=>{const s=rt(),{id:a}=De(),n=ge(a||""),{store:i}=Fe(),c=i==null?void 0:i.currencies.map(d=>({currency_code:d.code,amount:0})),o=Q(),u=d=>()=>s.push({title:"Edit price overrides",onBack:()=>s.pop(),view:t(Qe,{prices:Ye(d.prices.filter(x=>x.price_list_id),c),isEdit:!0,defaultVariant:d,variants:r.variants,onClose:e,onSubmit:x=>{const w=Er(x,d.id);n.mutate({prices:w},{onSuccess:()=>{s.pop(),e(),o("Success","Price overrides updated","success")}})}})});return t(st,{isLargeModal:!0,context:s,handleClose:e,children:l(I.Body,{className:"h-[calc(100vh-134px)] flex flex-col",children:[t(I.Header,{handleClose:e,children:l("h1",{className:"inter-xlarge-semibold",children:["Price overrides"," ",l("span",{className:"text-grey-50 inter-xlarge-regular truncate",children:["(",r.title,")"]})]})}),t(I.Content,{className:"flex-1",children:l(O,{children:[l(O.Parent,{children:[t("div",{children:t("img",{src:r.thumbnail||void 0,className:"w-4 h-5 rounded-base"})}),t("span",{className:"inter-small-semibold",children:r.title})]}),t(O.Content,{children:r.variants.map(d=>t(O.Leaf,{children:t(Ir,{onClick:u(d),variant:d,prices:d.prices.filter(x=>x.price_list_id)},d.id)}))})]})}),t(I.Footer,{children:l("div",{className:"flex w-full h-8 justify-end",children:[t(F,{variant:"ghost",className:"mr-2 w-32 text-small justify-center rounded-rounded",size:"large",onClick:e,children:"Cancel"}),t(F,{disabled:!0,size:"large",className:"w-32 text-small justify-center rounded-rounded",variant:"primary",children:"Save"})]})})]})})};function kr(e){const[r,s]=g.useState(),a=(r==null?void 0:r.status)==="created"||(r==null?void 0:r.status)==="confirmed",{batch_job:n}=ct(e,{enabled:!!e,refetchInterval:a?2e3:!1});return g.useEffect(()=>{s(n)},[n]),r}function Dr(e){var W,X;const[r,s]=g.useState(),[a,n]=g.useState(),i=Q(),{resetInterval:c}=g.useContext(Vt),{mutateAsync:o}=nt(),{mutateAsync:u}=at(),{mutateAsync:d}=it(),{mutateAsync:x}=lt(a),{mutateAsync:w}=ot(a),m=kr(a),b=!!r,f=!!(m!=null&&m.result),h=(m==null?void 0:m.status)==="failed",S=f?(((W=m.result)==null?void 0:W.advancement_count)||0)/(((X=m.result)==null?void 0:X.count)||1):void 0,E=h?"Error occurred while processing":f?void 0:b?"Preprocessing...":"Uploading...",_=async()=>{await w(),i("Success","Import confirmed for processing. Progress info is available in the activity drawer.","success"),e.handleClose()},C=async p=>{try{const y=(await u(p)).uploads[0].key;s(y);const P=await d({dry_run:!0,context:{fileKey:y,price_list_id:e.priceListId},type:"price-list-import"});c(),n(P.batch_job.id)}catch{i("Error","Import failed.","error"),r&&await o({file_key:r})}},D=()=>{var v,y;if(!m)return;const p=(y=(v=m.result)==null?void 0:v.stat_descriptors)==null?void 0:y[0].message.match(/\d+/g);if(p)return{toCreate:Number(p[0])}},k=async()=>{try{r&&o({file_key:r}),x()}catch(p){console.log(p)}};return t(Lt,{type:"prices",fileTitle:"Price List prices",description1Text:"Upload a CSV file with variants and prices to update your price list. Note that any existing prices will be deleted.",description2Title:"Unsure about how to arrange your list?",description2Text:"Download the template file below and update your prices",status:E,progress:S,canImport:f,onSubmit:_,onClose:()=>{e.handleClose(),["confirmed","completed","canceled","failed"].includes((m==null?void 0:m.status)||"")||(r&&o({file_key:r}),a&&x())},summary:D(),onFileRemove:k,processUpload:C,templateLink:"/temp/price-list-import-template.csv"})}const Ar=()=>g.useMemo(()=>[{Header:t("div",{className:"pl-4",children:"Name"}),accessor:"title",Cell:({row:{original:r}})=>l("div",{className:"pl-4 flex items-center",children:[t("div",{className:"h-[40px] w-[30px] my-1.5 flex items-center mr-4",children:r.thumbnail?t("img",{src:r.thumbnail,className:"h-full object-cover rounded-soft"}):t(qe,{})}),t("div",{className:"flex flex-col",children:t("span",{children:r.title})})]})},{Header:t("div",{className:"w-[400px]",children:"Collection"}),accessor:"collection",Cell:({cell:{value:r}})=>t(N.Cell,{children:r!=null&&r.title?r.title:t("span",{className:"text-grey-40",children:"No collection"})})},{Header:"Variants",Cell:({row:{original:r}})=>t(N.Cell,{children:r.variants.length})}],[]),Or=9,Rr={offset:0,limit:Or},jr=({id:e,selectProduct:r})=>{const s=ve(Rr),{products:a,isLoading:n,count:i=0}=be(e,s.queryObject),c=Ar();return t("div",{className:"w-full overflow-y-auto flex flex-col justify-between h-full",children:t(je,{columns:c,data:a||[],renderRow:({row:o})=>{const u=()=>{r(o.original)};return t(Mr,{...o.getRowProps(),product:o.original,priceListId:e,onClick:u,className:"hover:bg-grey-5 hover:cursor-pointer",children:o.cells.map(d=>t(N.Cell,{...d.getCellProps(),children:d.render("Cell")}))})},renderHeaderGroup:qr,isLoading:n,totalCount:i,options:{enableSearch:!1,searchPlaceholder:"Search by name or SKU..."},...s})})},qr=({headerGroup:e})=>t(N.HeadRow,{...e.getHeaderGroupProps(),children:e.headers.map(r=>t(N.HeadCell,{...r.getHeaderProps(r.getSortByToggleProps()),children:r.render("Header")}))}),Mr=({children:e,priceListId:r,product:s,onClick:a,...n})=>{const i=Q(),c=dt(r,s.id),o=[{label:"Edit prices",icon:t(J,{size:20}),onClick:a},{label:"Remove product",icon:t(Dt,{size:20}),variant:"danger",onClick:()=>{c.mutate(void 0,{onSuccess:()=>{i("Success",`Deleted prices of product: ${s.title}`,"success")},onError:u=>i("Error",L(u),"error")})}}];return t(N.Row,{...n,actions:o,children:e})},zr=({id:e})=>{const{state:r,open:s,close:a}=me(),[n,i,c]=me(),[o,u]=g.useState(null);return l(ye,{title:"Prices",actionables:[{label:"Edit manually",onClick:s,icon:t(J,{size:20})},{label:"Import price list",onClick:i,icon:t(Ht,{size:20})}],forceDropdown:!0,children:[t(jr,{id:e,selectProduct:u}),l(Oe,{isVisible:r,isFullScreen:!0,children:[t(wr,{close:a,id:e})," "]}),n&&t(Dr,{priceListId:e,handleClose:()=>c()}),o&&t(Fr,{product:o,close:()=>u(null)})]})},Lr=()=>{const{id:e}=De(),{price_list:r,isLoading:s}=ut(e);return l("div",{className:"pb-xlarge",children:[t(xt,{currentPage:"Edit price list",previousBreadcrumb:"Pricing",previousRoute:"/a/pricing"}),!s&&r?l(Le,{priceList:Yt(r),children:[t(Sr,{priceList:r}),t("div",{className:"mt-4 w-full",children:t(zr,{id:r==null?void 0:r.id})}),t("div",{className:"mt-xlarge",children:t(vt,{data:r,title:"Raw price list",rootName:"price_list"})})]}):null]})},Hr=()=>t(Le,{children:t(Je,{viewType:A.CREATE})}),Vr=e=>{const r=Re(),s=Q(),a=ge(e==null?void 0:e.id),n=ke(e==null?void 0:e.id),i=async()=>{await r({heading:"Delete Price List",text:"Are you sure you want to delete this price list?"})&&n.mutate(void 0,{onSuccess:()=>{s("Success","Successfully deleted the price list","success")},onError:d=>s("Error",L(d),"error")})},c=()=>{a.mutate({status:re(e)?"draft":"active"},{onSuccess:()=>{s("Success",`Successfully ${re(e)?"unpublished":"published"} price list`,"success")}})};return{getActions:()=>[{label:re(e)?"Unpublish":"Publish",onClick:c,icon:re(e)?t(Bt,{size:20}):t($t,{size:20})},{label:"Delete",onClick:i,icon:t(le,{size:20}),variant:"danger"}]}},Ur=()=>[g.useMemo(()=>[{Header:"Name",accessor:"name",Cell:({cell:{value:r}})=>t(N.Cell,{children:t("span",{className:"inter-small-regular",children:r})})},{Header:"Description",accessor:"description",Cell:({cell:{value:r}})=>t(N.Cell,{children:r})},{Header:"Status",accessor:"status",Cell:({row:{original:r}})=>t(N.Cell,{children:He(r)})},{Header:"Groups",accessor:"customer_groups",Cell:({cell:{value:r}})=>{const s=G.isArray(r)?r.map(i=>i.name):[],[a,n]=Ve(s);return l(N.Cell,{children:[a,n&&l("span",{className:"text-grey-40",children:[" + ",n," more"]})]})}},{accessor:"created_at",Cell:({row:{original:r}})=>{const{getActions:s}=Vr(r);return t(N.Cell,{onClick:a=>a.stopPropagation(),className:"w-full flex justify-end",children:t("div",{className:"justify-end",children:t(xe,{forceDropdown:!0,actions:s()})})})}}],[])],Br=(e,r)=>{if(e.size!==r.size)return!1;for(const s of e)if(!r.has(s))return!1;return!0},$r=["type","customer_groups","status","offset","limit"],ce={},Gr=e=>e===null?e:Object.entries(e).reduce((s,[a,n])=>(n.includes("|")?s[a]=Gt(n):s[a]=n,s),{}),Qr=(e,r)=>{var s;switch(r.type){case"setFilters":return{...e,query:(s=r==null?void 0:r.payload)==null?void 0:s.query,status:r.payload.status,type:r.payload.type,customer_groups:r.payload.customer_groups};case"setQuery":return{...e,offset:0,query:r.payload};case"setOffset":return{...e,offset:r.payload};case"reset":return r.payload;default:return e}},Yr=(e,r=null)=>{e&&e[0]==="?"&&(e=e.substring(1));const s=g.useMemo(()=>Jr(e,r),[e,r]),a=g.useMemo(()=>{const p=localStorage.getItem("priceLists::filters");if(p){const v=JSON.parse(p);if(v)return Object.entries(v).map(([y,P])=>({label:y,value:y,removable:!0,representationString:P}))}return[]},[]),[n,i]=g.useReducer(Qr,s),[c,o]=g.useState(a),u=p=>{i({type:"setDefaults",payload:p})},d=p=>{if(p>0){const v=n.offset+n.limit;i({type:"setOffset",payload:v})}else{const v=Math.max(n.offset-n.limit,0);i({type:"setOffset",payload:v})}},x=()=>{i({type:"setFilters",payload:{...n,offset:0,type:{open:!1,filter:null},status:{open:!1,filter:null},customer_groups:{open:!1,filter:null},query:null}})},w=p=>{i({type:"setFilters",payload:p})},m=p=>{i({type:"setQuery",payload:p})},b=()=>{const p={...n.additionalFilters};for(const[v,y]of Object.entries(n))v==="query"?y&&typeof y=="string"&&(p.q=y):v==="offset"||v==="limit"?p[v]=y:y.open&&(v==="date"?p[de[v]]=Gr(y.filter):p[de[v]]=y.filter);return p},f=()=>{const p=b();return U.stringify(p,{skipNulls:!0})},h=p=>{const v=p??n,y={};for(const[P,T]of Object.entries(v))P==="query"?T&&typeof T=="string"&&(y.q=T):P==="offset"||P==="limit"?y[P]=T:T.open&&(y[de[P]]=T.filter);return y},S=()=>{const p=h();return U.stringify(p,{skipNulls:!0})},E=g.useMemo(()=>b(),[n]),_=g.useMemo(()=>h(),[n]),C=g.useMemo(()=>S(),[n]),D=g.useMemo(()=>{const p=G.omit(_,["limit","offset"]),v=U.stringify(p),y=c.find(P=>P.representationString===v);if(y)return y.value;for(const[P,T]of Object.entries(ce)){let R=!0;if(Object.keys(p).length===Object.keys(T).length){for(const[j,M]of Object.entries(T))if(j in p?Array.isArray(M)?R=Array.isArray(p[j])&&Br(new Set(p[j]),new Set(M)):R=p[j]===M:R=!1,!R)break;if(R)return P}}return null},[_,c]),k=g.useMemo(()=>[...c],[c]),Ne=p=>{let v=null;if(p in ce)v=ce[p];else{const y=c.find(P=>P.value===p);y&&(v=U.parse(y.representationString))}if(v){const y={...n,type:{open:!1,filter:null},status:{open:!1,filter:null},customer_groups:{open:!1,filter:null}};for(const[P,T]of Object.entries(v))y[Kr[P]]={open:!0,filter:T};i({type:"setFilters",payload:y})}},W=(p,v)=>{const y=h({...v}),P=G.omit(y,["limit","offset"]),T=U.stringify(P,{skipNulls:!0}),R=localStorage.getItem("priceLists::filters");let j=null;if(R&&(j=JSON.parse(R)),j)j[p]=T,localStorage.setItem("priceLists::filters",JSON.stringify(j));else{const M={};M[p]=T,localStorage.setItem("priceLists::filters",JSON.stringify(M))}o(M=>[...M,{label:p,value:p,representationString:T,removable:!0}]),i({type:"setFilters",payload:v})},X=p=>{const v=localStorage.getItem("priceLists::filters");let y=null;v&&(y=JSON.parse(v)),y&&(delete y[p],localStorage.setItem("priceLists::filters",JSON.stringify(y))),o(P=>P.filter(R=>R.value!==p))};return{...n,filters:{...n},removeTab:X,saveTab:W,setTab:Ne,availableTabs:k,activeFilterTab:D,representationObject:_,representationString:C,queryObject:E,paginate:d,getQueryObject:b,getQueryString:f,setQuery:m,setFilters:w,setDefaultFilters:u,reset:x}},Kr={status:"status",type:"type",customer_groups:"customer_groups"},de={status:"status",type:"type",customer_groups:"customer_groups"},Jr=(e,r=null)=>{const s={type:{open:!1,filter:null},status:{open:!1,filter:null},customer_groups:{open:!1,filter:null},offset:0,limit:15,additionalFilters:r};if(e){const a=U.parse(e);for(const[n,i]of Object.entries(a))if($r.includes(n))switch(n){case"offset":{typeof i=="string"&&(s.offset=parseInt(i));break}case"limit":{typeof i=="string"&&(s.limit=parseInt(i));break}case"q":{typeof i=="string"&&(s.query=i);break}case"status":{typeof i=="string"&&(s.status={open:!0,filter:i});break}case"type":{typeof i=="string"&&(s.status={open:!0,filter:i});break}case"customer_groups":{Array.isArray(i)&&(s.customer_groups={open:!0,filter:i});break}}}return s};function Zr(e){return t(N.HeadCell,{className:"w-[100px]",...e.col.getHeaderProps(e.col.getSortByToggleProps()),children:e.col.render("Header")})}function Wr(e){return t(N.HeadRow,{...e.headerGroup.getHeaderGroupProps(),children:e.headerGroup.headers.map(r=>t(Zr,{col:r},r.id))})}function Xr(e){const{row:r}=e;return t(N.Row,{color:"inherit",linkTo:r.original.id,id:r.original.id,className:"group",...r.getRowProps(),children:r.cells.map((s,a)=>s.render("Cell",{index:a}))})}function es(e){var S;const[r,s]=g.useState(""),{priceLists:a,queryObject:n,count:i,paginate:c,setQuery:o,columns:u,options:d,isLoading:x}=e,w={columns:u,data:a||[],initialState:{pageSize:n.limit,pageIndex:n.offset/n.limit},pageCount:Math.ceil(i/n.limit),manualPagination:!0,autoResetPage:!1},m=te.useTable(w,te.useSortBy,te.usePagination,te.useRowSelect),b=()=>{m.canNextPage&&(c(1),m.nextPage())},f=()=>{m.canPreviousPage&&(c(-1),m.previousPage())},h=Qt(r,500);return g.useEffect(()=>{o(h),m.gotoPage(0)},[h]),t(Ot,{isLoading:x,numberOfRows:n.limit,hasPagination:!0,pagingState:{count:i,offset:n.offset,pageSize:n.offset+m.rows.length,title:"Price Lists",currentPage:m.state.pageIndex+1,pageCount:m.pageCount,nextPage:b,prevPage:f,hasNext:m.canNextPage,hasPrev:m.canPreviousPage},children:l(N,{...m.getTableProps(),...d,enableSearch:d.enableSearch,searchValue:r,handleSearch:d.enableSearch?s:void 0,filteringOptions:d.filter,children:[t(N.Head,{children:(S=m.headerGroups)==null?void 0:S.map((E,_)=>t(Wr,{headerGroup:E},_))}),t(N.Body,{...m.getTableBodyProps(),children:m.rows.map(E=>(m.prepareRow(E),t(Xr,{row:E})))})]})})}const ts=["active","draft"],rs=["sale","override"],ss=({filters:e,submitFilters:r,clearFilters:s,tabs:a,onTabClick:n,activeTab:i,onRemoveTab:c,onSaveTab:o})=>{const[u,d]=g.useState(e),[x,w]=g.useState(""),m=C=>{c&&c(C)},b=()=>{o&&o(x,u)},f=C=>{n&&n(C)};g.useEffect(()=>{d(e)},[e]);const h=()=>{r(u)},S=()=>{s()},E=g.useMemo(()=>Object.entries(e).reduce((C,[,D])=>(D!=null&&D.open&&(C=C+1),C),0),[e]),_=(C,D)=>{d(k=>({...k,[C]:D}))};return l("div",{className:"flex space-x-1",children:[l(Pt,{submitFilters:h,clearFilters:S,triggerElement:l("button",{className:z("flex rounded-rounded items-center space-x-1 focus-visible:outline-none focus-visible:shadow-input focus-visible:border-violet-60"),children:[l("div",{className:"flex rounded-rounded items-center bg-grey-5 border border-grey-20 inter-small-semibold px-2 h-6",children:["Filters",t("div",{className:"text-grey-40 ml-1 flex items-center rounded",children:t("span",{className:"text-violet-60 inter-small-semibold",children:E||"0"})})]}),t("div",{className:"flex items-center rounded-rounded bg-grey-5 border border-grey-20 inter-small-semibold p-1",children:t(ie,{size:14})})]}),children:[t(Pe,{filterTitle:"Status",options:ts,filters:u.status.filter,open:u.status.open,setFilter:C=>_("status",C)}),t(Pe,{filterTitle:"Type",options:rs,filters:u.type.filter,open:u.type.open,setFilter:C=>_("type",C)}),t(wt,{saveFilter:b,name:x,setName:w})]}),a&&a.map(C=>t(Tt,{onClick:()=>f(C.value),label:C.label,isActive:i===C.value,removable:!!C.removable,onRemove:()=>m(C.value)},C.value))]})},ns=15,as={expand:"customer_groups,prices",offset:0,limit:ns},is=()=>{const e=mt(),r=Yr(e.search,as),[s]=Ur(),{price_lists:a,isLoading:n,count:i=0}=pt(r.queryObject,{keepPreviousData:!0});Ut(r.representationObject);const c=()=>{r.setQuery(""),r.reset()};return t("div",{children:t(es,{isLoading:n,columns:s,count:i,priceLists:a||[],options:{enableSearch:!0,filter:t(ss,{filters:r.filters,submitFilters:r.setFilters,clearFilters:c,tabs:r.availableTabs,onTabClick:r.setTab,activeTab:r.activeFilterTab,onRemoveTab:r.removeTab,onSaveTab:r.saveTab})},...r})})},ls=()=>{const e=he();return t("div",{className:"h-full flex flex-col",children:t("div",{className:"w-full flex flex-col grow",children:t(ye,{actionables:[{label:"Add price list",onClick:()=>e("/a/pricing/new"),icon:t(ie,{size:20})}],customHeader:t(bt,{views:["Price lists"]}),className:"h-fit",children:t(is,{})})})})},mn=()=>l(ft,{children:[t(oe,{index:!0,element:t(ls,{})}),t(oe,{path:"/new",element:t(Hr,{})}),t(oe,{path:"/:id",element:t(Lr,{})})]});export{mn as default};
