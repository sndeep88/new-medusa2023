import{j as u,F as U,a as i,B as M,aw as Si,ax as Ci,ay as wi,r as y,af as Ni,d as H,q as we,e as Ne,c as Ri,az as at,k as ki,aA as Ae,aB as $n,M as V,aC as Fi,aD as Mn,C as Ai,aE as En,aF as Ut,aG as Ii,a9 as ot,a5 as Ie,aH as $i,S as Be,aI as ge,aJ as Mi,aK as ct,aL as Ei,aM as Pn,aN as Pi,aO as zi,aP as Vi,aQ as Ti,aR as Qt,aS as qi,aT as Di,Z as Oi,X as Hi,aU as We,aV as ji,aW as Li,a1 as zn,aX as Vn,aY as Tn,aZ as Gi,a_ as Bi,a$ as Ui,b0 as Qi,b1 as qn,b2 as Wi,b3 as Yi,b4 as Xi,b5 as Ki,b6 as Zi,b7 as Ji,b8 as Dn,b9 as er,ba as tr,bb as nr,G as ir,bc as rr,bd as lr,u as On,R as sr,b as an,be as ar}from"./index-effbfb95.js";import{T as on,E as or,a as cr}from"./index-630f70f7.js";import{B as Ce}from"./body-card-d3fddb8c.js";import{T as dr}from"./index-a6859a1b.js";import{l as Pe}from"./lodash-72dfe3e0.js";import{A as dt,r as Ge,a as Hn,T as k,b as jn,S as ur,C as $e,M as mr}from"./index-0d9858ea.js";import{u as gr}from"./analytics-1ab31609.js";import{F as fr,a as Te,S as pr,b as hr}from"./index-b17c211e.js";import{P as Ve,T as ue,b as ut,M as Ye,c as yr,a as me,I as ze}from"./index-dd9f9076.js";import{h as Ue}from"./moment-fbc5633a.js";import{D as ne,C as xr,g as vr}from"./display-total-6e4997b2.js";import{i as Wt}from"./countries-bbdb373c.js";import{f as j,d as cn,B as dn}from"./index-84767cd7.js";import{S as Q}from"./index-04f3341e.js";import{r as _r}from"./time-5c3c185e.js";import{u as X,A as Re,X as Ln}from"./use-notification-9f7c3c92.js";import{u as ke}from"./use-toggle-state-9e07c572.js";import{g as W}from"./error-messages-d2d0bb30.js";import{P as br}from"./polling-69bcbbd8.js";import{u as un}from"./react-hotkeys-hook.esm-745ca041.js";import{A as Yt}from"./index-5ca1a7bd.js";import{C as fe,A as Sr,a as Dt,R as Cr,e as wr,F as mn,b as Nr}from"./address-modal-8731dbad.js";import{D as Rr}from"./index-f258cc00.js";import{C as Fe,L as kr}from"./index-5dfb0d3a.js";import{C as gn}from"./index-a4458bf1.js";import{D as Gn}from"./index-714f5540.js";import{M as Xt,F as Fr}from"./index-d34652be.js";import{R as mt}from"./refresh-icon-ede960a5.js";import{T as Kt}from"./index-7544f455.js";import{B as Ar}from"./index-d895e52c.js";import{u as fn,J as Ir}from"./index-e0338379.js";import{R as $r}from"./index-698bc9f9.js";import{C as ie,u as Me,b as J,c as gt}from"./index.esm-5a89640b.js";import{u as ft}from"./use-imperative-dialog-cb4e5fcf.js";import{n as ae}from"./nested-form-c66382a0.js";import{R as St,S as pt}from"./index-b6a697c3.js";import"./index-e417090c.js";import{S as Bn}from"./index-dd953a8b.js";import{T as Un,E as Mr}from"./index-d74195ae.js";import{a as Er,I as ht}from"./image-placeholder-b3cbea02.js";import{I as oe}from"./index-d33be3e8.js";import{u as Qn}from"./use-debounce-438a4ce8.js";import{T as ce}from"./trash-icon-abcb5140.js";import{E as Zt}from"./edit-icon-8c1c10d1.js";import{C as Pr}from"./index.esm-841d990e.js";import{c as zr}from"./react-select.esm-1ec1493a.js";import{P as Vr}from"./price-form-input-b497b56c.js";import{C as it}from"./index-dbc7810f.js";import{F as Tr}from"./index-a2e12c2a.js";import{M as Jt}from"./api-9aff074a.js";import{r as qr}from"./remove-nullish-de5411fd.js";import{M as Dr}from"./index-52359d87.js";import{C as Or,S as pn}from"./chevron-down-6a69fe38.js";import{C as Hr}from"./chevron-up-ae6c75fe.js";import{D as rt}from"./delete-prompt-37f35e36.js";import{P as Wn}from"./index-b2b331b3.js";import{F as Ct}from"./form-validator-a60b1f3b.js";import{C as Yn}from"./index-1ec19c89.js";import{P as jr,F as Lr,T as Gr}from"./index-f53357e2.js";import{D as Br}from"./duplicate-icon-dbea12ca.js";import"./index-ec3b8ff9.js";import"./axios-4a70c6fc.js";import"./a-0eba6a7f.js";import"./focus-modal-d105ce27.js";import"./index-523daaeb.js";import"./index-903c1727.js";import"./index-e25e2e97.js";import"./unsupportedIterableToArray-27301055.js";import"./createSuper-ad9f6885.js";import"./index-202b6dd7.js";import"./arrow-down-icon-49435f5a.js";import"./toConsumableArray-6f61c395.js";import"./index-0f96226b.js";import"./index-740955bd.js";import"./react-select-creatable.esm-e43d0869.js";import"./_isIndex-6af6139d.js";const Ur=({currency:e,swapAmount:t,manualRefund:n,swapRefund:r,returnRefund:l,paidTotal:s,refundedTotal:a})=>t+n+r+l===0?null:u(U,{children:[!!t&&i(ne,{currency:e,totalAmount:t,totalTitle:"Total for Swaps"}),!!r&&i(ne,{currency:e,totalAmount:l,totalTitle:"Refunded for Swaps"}),!!l&&i(ne,{currency:e,totalAmount:l,totalTitle:"Refunded for Returns"}),!!n&&i(ne,{currency:e,totalAmount:n,totalTitle:"Manually refunded"}),i(ne,{variant:"bold",currency:e,totalAmount:s-a,totalTitle:"Net Total"})]}),Qr=({status:e})=>{switch(e){case"completed":return i(Q,{title:"Completed",variant:"success"});case"pending":return i(Q,{title:"Processing",variant:"default"});case"canceled":return i(Q,{title:"Canceled",variant:"danger"});case"requires_action":return i(Q,{title:"Requires action",variant:"danger"});default:return null}},Wr=({trackingLink:e})=>e.url?i("a",{style:{textDecoration:"none"},target:"_blank",href:e.url,children:u("div",{className:"text-blue-60 ml-2",children:[e.tracking_number," "]})}):u("span",{className:"text-blue-60 ml-2",children:[e.tracking_number," "]}),Yr=({order:e,capturePayment:t,showRefundMenu:n})=>{var c;const r=X(),l=(c=e==null?void 0:e.payments)==null?void 0:c.some(o=>o.provider_id==="system"),{payment_status:s}=e;let a="Capture payment",m=()=>{t.mutate(void 0,{onSuccess:()=>r("Success","Successfully captured payment","success"),onError:o=>r("Error",W(o),"error")})};const d=t.isLoading;let g=!1;switch(s==="awaiting"&&l&&(g=!0),s==="requires_action"&&l&&(g=!0),!0){case(s==="captured"||s==="partially_refunded"):{a="Refund",m=()=>n();break}case g:{m=()=>console.log("TODO: Show alert indicating, that you are capturing a system payment");break}case s==="requires_action":return null}return i(M,{variant:"secondary",size:"small",onClick:m,loading:d,className:"min-w-[130px]",children:a})},Xr=({setFullfilmentToShip:e,order:t,fulfillmentObj:n})=>{var h;const r=ft(),l=X(),s=Si(t.id),a=Ci(t.id),m=wi(t.id),{fulfillment:d}=n,g=!!((h=d.tracking_links)!=null&&h.length),c=()=>{switch(!0){case!!(d!=null&&d.claim_order_id):return{resourceId:d.claim_order_id,resourceType:"claim"};case!!(d!=null&&d.swap_id):return{resourceId:d.swap_id,resourceType:"swap"};default:return{resourceId:t==null?void 0:t.id,resourceType:"order"}}},o=async()=>{const{resourceId:p,resourceType:x}=c();if(await r({heading:"Cancel fulfillment?",text:"Are you sure you want to cancel the fulfillment?"}))switch(x){case"swap":return a.mutate({swap_id:p,fulfillment_id:d.id},{onSuccess:()=>l("Success","Successfully canceled swap","success"),onError:_=>l("Error",W(_),"error")});case"claim":return m.mutate({claim_id:p,fulfillment_id:d.id},{onSuccess:()=>l("Success","Successfully canceled claim","success"),onError:_=>l("Error",W(_),"error")});default:return s.mutate(d.id,{onSuccess:()=>l("Success","Successfully canceled order","success"),onError:_=>l("Error",W(_),"error")})}};return u("div",{className:"flex w-full justify-between",children:[u("div",{className:"flex flex-col space-y-1 py-2",children:[i("div",{className:"text-grey-90",children:d.canceled_at?"Fulfillment has been canceled":`${n.title} Fulfilled by ${Pe.capitalize(d.provider_id)}`}),u("div",{className:"flex text-grey-50",children:[d.shipped_at?"Tracking":"Not shipped",g&&d.tracking_links.map((p,x)=>i(Wr,{trackingLink:p},x))]})]}),!d.canceled_at&&!d.shipped_at&&i("div",{className:"flex items-center space-x-2",children:i(dt,{actions:[{label:"Mark Shipped",icon:i(Wn,{size:"20"}),onClick:()=>e(d)},{label:"Cancel Fulfillment",icon:i(Fe,{size:"20"}),onClick:()=>o()}]})})]})},Kr=10,Zr=["completed","pending","canceled","archived","requires_action"],Jr=["awaiting","captured","refunded","canceled","partially_refunded","requires_action","not_paid"],el=["fulfilled","not_fulfilled","partially_fulfilled","returned","partially_returned","shipped","partially_shipped","requires_action","canceled"],tl=["is in the last","is older than","is after","is before","is equal to"],nl=({tabs:e,activeTab:t,onTabClick:n,onSaveTab:r,onRemoveTab:l,filters:s,submitFilters:a,clearFilters:m})=>{const[d,g]=y.useState(s),[c,o]=y.useState(""),h=S=>{l&&l(S)},p=()=>{r&&r(c,d)},x=S=>{n&&n(S)};y.useEffect(()=>{g(s)},[s]);const f=()=>{a(d)},_=()=>{m()},v=(S,P)=>{g(q=>({...q,[S]:P}))},C=Object.entries(s).reduce((S,[P,q])=>(q!=null&&q.open&&(S=S+1),S),0),[b,F]=y.useState({offset:0,limit:Kr}),{regions:E,count:T,isLoading:N}=Ni(b),$=S=>{S>0?F(P=>({...P,offset:P.offset+P.limit})):S<0&&F(P=>({...P,offset:Math.max(P.offset-P.limit,0)}))};return u("div",{className:"flex space-x-1",children:[u(fr,{submitFilters:f,clearFilters:_,triggerElement:u("button",{className:H("flex rounded-rounded items-center space-x-1 focus-visible:outline-none focus-visible:shadow-input focus-visible:border-violet-60"),children:[u("div",{className:"flex rounded-rounded items-center bg-grey-5 border border-grey-20 inter-small-semibold px-2 h-6",children:["Filters",i("div",{className:"text-grey-40 ml-1 flex items-center rounded",children:i("span",{className:"text-violet-60 inter-small-semibold",children:C||"0"})})]}),i("div",{className:"flex items-center rounded-rounded bg-grey-5 border border-grey-20 inter-small-semibold p-1",children:i(Ve,{size:14})})]}),children:[i(Te,{filterTitle:"Status",options:Zr,filters:d.status.filter,open:d.status.open,setFilter:S=>v("status",S)}),i(Te,{filterTitle:"Payment Status",options:Jr,filters:d.payment.filter,open:d.payment.open,setFilter:S=>v("payment",S)}),i(Te,{filterTitle:"Fulfillment Status",options:el,filters:d.fulfillment.filter,open:d.fulfillment.open,setFilter:S=>v("fulfillment",S)}),i(Te,{filterTitle:"Regions",options:(E==null?void 0:E.map(S=>({value:S.id,label:S.name})))||[],isLoading:N,hasPrev:b.offset>0,hasMore:b.offset+b.limit<(T??0),onShowPrev:()=>$(-1),onShowNext:()=>$(1),filters:d.region.filter,open:d.region.open,setFilter:S=>v("region",S)}),i(Te,{filterTitle:"Date",options:tl,filters:d.date.filter,open:d.date.open,setFilter:S=>v("date",S)}),i(pr,{saveFilter:p,name:c,setName:o})]}),e&&e.map(S=>i(hr,{onClick:()=>x(S.value),label:S.label,isActive:t===S.value,removable:!!S.removable,onRemove:()=>h(S.value)},S.value))]})};function lt(){return lt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},lt.apply(this,arguments)}function il(e,t){if(e==null)return{};var n={},r=Object.keys(e),l,s;for(s=0;s<r.length;s++)l=r[s],!(t.indexOf(l)>=0)&&(n[l]=e[l]);return n}var rl=["cdnSuffix","cdnUrl","countryCode","style","svg"],ll="https://cdn.jsdelivr.net/gh/lipis/flag-icons/flags/4x3/",sl="svg",al=127397,ol=function(t){var n=t.cdnSuffix,r=n===void 0?sl:n,l=t.cdnUrl,s=l===void 0?ll:l,a=t.countryCode,m=t.style,d=t.svg,g=d===void 0?!1:d,c=il(t,rl);if(typeof a!="string")return null;if(g){var o=""+s+a.toLowerCase()+"."+r;return y.createElement("img",Object.assign({},c,{src:o,style:lt({display:"inline-block",width:"1em",height:"1em",verticalAlign:"middle"},m)}))}var h=a.toUpperCase().replace(/./g,function(p){return String.fromCodePoint(p.charCodeAt(0)+al)});return y.createElement("span",Object.assign({role:"img"},c,{style:lt({display:"inline-block",fontSize:"1em",lineHeight:"1em",verticalAlign:"middle"},m)}),h)};const cl=()=>{const e=n=>{switch(n){case"captured":return i(Q,{variant:"success",title:"Paid"});case"awaiting":return i(Q,{variant:"default",title:"Awaiting"});case"requires_action":return i(Q,{variant:"danger",title:"Requires action"});case"canceled":return i(Q,{variant:"warning",title:"Canceled"});default:return i(Q,{variant:"primary",title:"N/A"})}};return[y.useMemo(()=>[{Header:i("div",{className:"pl-2",children:"Order"}),accessor:"display_id",Cell:({cell:{value:n}})=>i("p",{className:"text-grey-90 group-hover:text-violet-60 min-w-[100px] pl-2",children:`#${n}`})},{Header:"Date added",accessor:"created_at",Cell:({cell:{value:n}})=>i("div",{children:i(ue,{content:Ue(n).format("DD MMM YYYY hh:mm a"),children:Ue(n).format("DD MMM YYYY")})})},{Header:"Customer",accessor:"customer",Cell:({row:n,cell:{value:r}})=>{var l,s;return i("div",{children:i(xr,{customer:{first_name:(r==null?void 0:r.first_name)||((l=n.original.shipping_address)==null?void 0:l.first_name),last_name:(r==null?void 0:r.last_name)||((s=n.original.shipping_address)==null?void 0:s.last_name),email:n.original.email},color:vr(n.index)})})}},{Header:"Fulfillment",accessor:"fulfillment_status",Cell:({cell:{value:n}})=>n},{Header:"Payment status",accessor:"payment_status",Cell:({cell:{value:n}})=>e(n)},{Header:"Sales Channel",accessor:"sales_channel",Cell:({cell:{value:n}})=>(n==null?void 0:n.name)??"N/A"},{Header:()=>i("div",{className:"text-right",children:"Total"}),accessor:"total",Cell:({row:n,cell:{value:r}})=>i("div",{className:"text-right",children:j({amount:r,currency:n.original.currency_code,digits:2})})},{Header:"",accessor:"currency_code",Cell:({cell:{value:n}})=>i("div",{className:"text-right text-grey-40",children:n.toUpperCase()})},{Header:"",accessor:"country_code",Cell:({row:n})=>{var r,l,s,a,m;return i("div",{className:"pr-2",children:i("div",{className:"flex rounded-rounded w-full justify-end",children:i(ue,{content:Wt[(l=(r=n.original.shipping_address)==null?void 0:r.country_code)==null?void 0:l.toUpperCase()]||((a=(s=n.original.shipping_address)==null?void 0:s.country_code)==null?void 0:a.toUpperCase()),children:i(ol,{className:"rounded",svg:!0,countryCode:(m=n.original.shipping_address)==null?void 0:m.country_code})})})})}}],[])]},dl=["status","region","fulfillment_status","payment_status","created_at","q","offset","limit"],wt={incomplete:{fulfillment_status:["not_fulfilled","fulfilled"],payment_status:["awaiting"]},complete:{fulfillment_status:["shipped"],payment_status:["captured"]}},ul=e=>e===null?e:Object.entries(e).reduce((n,[r,l])=>(l.includes("|")?n[r]=_r(l):n[r]=l,n),{}),ml=(e,t)=>{var n;switch(t.type){case"setFilters":return{...e,region:t.payload.region,fulfillment:t.payload.fulfillment,payment:t.payload.payment,status:t.payload.status,date:t.payload.date,query:(n=t==null?void 0:t.payload)==null?void 0:n.query};case"setQuery":return{...e,offset:0,query:t.payload};case"setDate":{const r=e.date;return{...e,date:r}}case"setOffset":return{...e,offset:t.payload};case"reset":return t.payload;default:return e}},gl=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0},fl=(e,t=null)=>{e&&e[0]==="?"&&(e=e.substring(1));const n=y.useMemo(()=>hl(e,t),[e,t]),r=y.useMemo(()=>{const A=localStorage.getItem("orders::filters");if(A){const I=JSON.parse(A);if(I)return Object.entries(I).map(([w,R])=>({label:w,value:w,removable:!0,representationString:R}))}return[]},[]),[l,s]=y.useReducer(ml,n),[a,m]=y.useState(r),d=A=>{s({type:"setDate",payload:A})},g=A=>{s({type:"setFulfillment",payload:A})},c=A=>{s({type:"setPayment",payload:A})},o=A=>{s({type:"setStatus",payload:A})},h=A=>{s({type:"setDefaults",payload:A})},p=A=>{if(A>0){const I=l.offset+l.limit;s({type:"setOffset",payload:I})}else{const I=Math.max(l.offset-l.limit,0);s({type:"setOffset",payload:I})}},x=()=>{s({type:"setFilters",payload:{...l,offset:0,region:{open:!1,filter:null},payment:{open:!1,filter:null},fulfillment:{open:!1,filter:null},status:{open:!1,filter:null},date:{open:!1,filter:null},query:null}})},f=A=>{s({type:"setFilters",payload:A})},_=A=>{s({type:"setQuery",payload:A})},v=()=>{const A={...l.additionalFilters};for(const[I,w]of Object.entries(l))I==="query"?w&&typeof w=="string"&&(A.q=w):I==="offset"||I==="limit"?A[I]=w:w.open&&(I==="date"?A[Nt[I]]=ul(w.filter):A[Nt[I]]=w.filter);return A},C=()=>{const A=v();return we.stringify(A,{skipNulls:!0})},b=A=>{const I=A??l,w={};for(const[R,z]of Object.entries(I))R==="query"?z&&typeof z=="string"&&(w.q=z):R==="offset"||R==="limit"?w[R]=z:z.open&&(w[Nt[R]]=z.filter);return w},F=()=>{const A=b();return we.stringify(A,{skipNulls:!0})},E=y.useMemo(()=>v(),[l]),T=y.useMemo(()=>b(),[l]),N=y.useMemo(()=>F(),[l]),$=y.useMemo(()=>{const A=Pe.omit(T,["limit","offset"]),I=we.stringify(A),w=a.find(R=>R.representationString===I);if(w)return w.value;for(const[R,z]of Object.entries(wt)){let O=!0;if(Object.keys(A).length===Object.keys(z).length){for(const[B,Y]of Object.entries(z))if(B in A?Array.isArray(Y)?O=Array.isArray(A[B])&&gl(new Set(A[B]),new Set(Y)):O=A[B]===Y:O=!1,!O)break;if(O)return R}}return null},[T,a]),S=y.useMemo(()=>[{label:"Complete",value:"complete"},{label:"Incomplete",value:"incomplete"},...a],[a]),P=A=>{let I=null;if(A in wt)I=wt[A];else{const w=a.find(R=>R.value===A);w&&(I=we.parse(w.representationString))}if(I){const w={...l,date:{open:!1,filter:null},payment:{open:!1,filter:null},fulfillment:{open:!1,filter:null},status:{open:!1,filter:null}};for(const[R,z]of Object.entries(I))w[pl[R]]={open:!0,filter:z};s({type:"setFilters",payload:w})}},q=(A,I)=>{const w=b({...I}),R=Pe.omit(w,["limit","offset"]),z=we.stringify(R,{skipNulls:!0}),O=localStorage.getItem("orders::filters");let B=null;if(O&&(B=JSON.parse(O)),B)B[A]=z,localStorage.setItem("orders::filters",JSON.stringify(B));else{const Y={};Y[A]=z,localStorage.setItem("orders::filters",JSON.stringify(Y))}m(Y=>[...Y,{label:A,value:A,representationString:z,removable:!0}]),s({type:"setFilters",payload:I})},G=A=>{const I=localStorage.getItem("orders::filters");let w=null;I&&(w=JSON.parse(I)),w&&(delete w[A],localStorage.setItem("orders::filters",JSON.stringify(w))),m(R=>R.filter(O=>O.value!==A))};return{...l,filters:{...l},removeTab:G,saveTab:q,setTab:P,availableTabs:S,activeFilterTab:$,representationObject:T,representationString:N,queryObject:E,paginate:p,getQueryObject:v,getQueryString:C,setQuery:_,setFilters:f,setDefaultFilters:h,setDateFilter:d,setFulfillmentFilter:g,setPaymentFilter:c,setStatusFilter:o,reset:x}},pl={status:"status",fulfillment_status:"fulfillment",payment_status:"payment",created_at:"date",region_id:"region"},Nt={region:"region_id",status:"status",fulfillment:"fulfillment_status",payment:"payment_status",date:"created_at"},hl=(e,t=null)=>{const n={status:{open:!1,filter:null},fulfillment:{open:!1,filter:null},region:{open:!1,filter:null},payment:{open:!1,filter:null},date:{open:!1,filter:null},offset:0,limit:15,additionalFilters:t};if(e){const r=we.parse(e);for(const[l,s]of Object.entries(r))if(dl.includes(l))switch(l){case"offset":{typeof s=="string"&&(n.offset=parseInt(s));break}case"limit":{typeof s=="string"&&(n.limit=parseInt(s));break}case"q":{typeof s=="string"&&(n.query=s);break}case"status":{(typeof s=="string"||Array.isArray(s))&&(n.status={open:!0,filter:s});break}case"fulfillment_status":{(typeof s=="string"||Array.isArray(s))&&(n.fulfillment={open:!0,filter:s});break}case"region_id":{(typeof s=="string"||Array.isArray(s))&&(n.region={open:!0,filter:s});break}case"payment_status":{(typeof s=="string"||Array.isArray(s))&&(n.payment={open:!0,filter:s});break}case"created_at":{n.date={open:!0,filter:s};break}}}return n},hn=15,Rt={expand:"customer,shipping_address",fields:"id,status,display_id,created_at,email,fulfillment_status,payment_status,total,currency_code"},yl=({setContextFilters:e})=>{const t=Ri(),{isFeatureEnabled:n}=Ne.useContext(at),{trackNumberOfOrders:r}=gr();let l=["sales_channel"];n("sales_channels")&&(Rt.expand=Rt.expand+",sales_channel",l=[]);const{removeTab:s,setTab:a,saveTab:m,availableTabs:d,activeFilterTab:g,reset:c,paginate:o,setFilters:h,filters:p,setQuery:x,queryObject:f,representationObject:_}=fl(t.search,Rt),v=f,C=parseInt(v==null?void 0:v.offset)||0,b=parseInt(v.limit)||hn,[F,E]=y.useState(v==null?void 0:v.query),[T,N]=y.useState(0),{orders:$,isLoading:S,count:P}=ki(f,{keepPreviousData:!0,onSuccess:({count:Z})=>{r({count:Z})}});y.useEffect(()=>{const Z=Math.ceil(P/f.limit);N(Z)},[$]),y.useEffect(()=>{e(p)},[p]);const[q]=cl(),{getTableProps:G,getTableBodyProps:A,headerGroups:I,rows:w,prepareRow:R,canPreviousPage:z,canNextPage:O,pageCount:B,gotoPage:Y,nextPage:L,previousPage:te,state:{pageIndex:pe}}=Ge.useTable({columns:q,data:$||[],manualPagination:!0,initialState:{pageSize:b,pageIndex:C/b,hiddenColumns:l},pageCount:T,autoResetPage:!1},Ge.usePagination);y.useEffect(()=>{const Z=setTimeout(()=>{F?(x(F),Y(0)):c()},400);return()=>clearTimeout(Z)},[F]);const be=()=>{O&&(o(1),L())},le=()=>{z&&(o(-1),te())},K=(Z={})=>{const Se=we.stringify(Z);window.history.replaceState("/a/orders","",`${`?${Se}`}`)},_i=()=>{const Z=_;Pe.isEmpty(Z)?K({offset:0,limit:hn}):K(Z)},bi=()=>{c(),E("")};return y.useEffect(()=>{_i()},[_]),i("div",{children:i(Hn,{isLoading:S,hasPagination:!0,numberOfRows:b,pagingState:{count:P,offset:f.offset,pageSize:f.offset+w.length,title:"Orders",currentPage:pe+1,pageCount:B,nextPage:be,prevPage:le,hasNext:O,hasPrev:z},children:u(k,{filteringOptions:i(nl,{filters:p,submitFilters:h,clearFilters:bi,tabs:d,onTabClick:a,activeTab:g,onRemoveTab:s,onSaveTab:m}),enableSearch:!0,handleSearch:E,searchValue:F,...G(),className:H({relative:S}),children:[i(k.Head,{children:I==null?void 0:I.map(Z=>i(k.HeadRow,{...Z.getHeaderGroupProps(),children:Z.headers.map(Se=>i(k.HeadCell,{...Se.getHeaderProps(),children:Se.render("Header")}))}))}),i(k.Body,{...A(),children:w.map(Z=>(R(Z),i(k.Row,{color:"inherit",linkTo:Z.original.id,...Z.getRowProps(),className:"group",children:Z.cells.map(Se=>i(k.Cell,{...Se.getCellProps(),children:Se.render("Cell")}))})))})]})})})},xl=Ne.memo(yl),Xn=({size:e="16",color:t="currentColor",...n})=>u("svg",{width:e,height:e,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n,children:[i("path",{d:"M10 6.66602L13.3333 9.99935L10 13.3327",stroke:t,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),i("path",{d:"M2.66797 2.66602V7.33268C2.66797 8.03993 2.94892 8.7182 3.44902 9.2183C3.94911 9.7184 4.62739 9.99935 5.33464 9.99935H13.3346",stroke:t,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),vl=({form:e})=>{const{control:t,path:n}=e;return i("div",{children:i(ie,{name:n("type"),control:t,render:({field:{value:r,onChange:l}})=>u(St.Root,{value:r,onValueChange:l,className:"flex items-center",children:[i(St.SimpleItem,{label:"Refund",value:"refund",onChange:l}),i(St.SimpleItem,{label:"Replace",value:"replace",onChange:l})]})})})};/**
 * table-core
 *
 * Copyright (c) TanStack
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function he(e,t){return typeof e=="function"?e(t):e}function re(e,t){return n=>{t.setState(r=>({...r,[e]:he(n,r[e])}))}}function st(e){return e instanceof Function}function _l(e){return Array.isArray(e)&&e.every(t=>typeof t=="number")}function bl(e,t){const n=[],r=l=>{l.forEach(s=>{n.push(s);const a=t(s);a!=null&&a.length&&r(a)})};return r(e),n}function D(e,t,n){let r=[],l;return()=>{let s;n.key&&n.debug&&(s=Date.now());const a=e();if(!(a.length!==r.length||a.some((g,c)=>r[c]!==g)))return l;r=a;let d;if(n.key&&n.debug&&(d=Date.now()),l=t(...a),n==null||n.onChange==null||n.onChange(l),n.key&&n.debug&&n!=null&&n.debug()){const g=Math.round((Date.now()-s)*100)/100,c=Math.round((Date.now()-d)*100)/100,o=c/16,h=(p,x)=>{for(p=String(p);p.length<x;)p=" "+p;return p};console.info(`%c⏱ ${h(c,5)} /${h(g,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*o,120))}deg 100% 31%);`,n==null?void 0:n.key)}return l}}function Sl(e,t,n,r){var l,s;const m={...e._getDefaultColumnDef(),...t},d=m.accessorKey;let g=(l=(s=m.id)!=null?s:d?d.replace(".","_"):void 0)!=null?l:typeof m.header=="string"?m.header:void 0,c;if(m.accessorFn?c=m.accessorFn:d&&(d.includes(".")?c=h=>{let p=h;for(const f of d.split(".")){var x;p=(x=p)==null?void 0:x[f]}return p}:c=h=>h[m.accessorKey]),!g)throw new Error;let o={id:`${String(g)}`,accessorFn:c,parent:r,depth:n,columnDef:m,columns:[],getFlatColumns:D(()=>[!0],()=>{var h;return[o,...(h=o.columns)==null?void 0:h.flatMap(p=>p.getFlatColumns())]},{key:"column.getFlatColumns",debug:()=>{var h;return(h=e.options.debugAll)!=null?h:e.options.debugColumns}}),getLeafColumns:D(()=>[e._getOrderColumnsFn()],h=>{var p;if((p=o.columns)!=null&&p.length){let x=o.columns.flatMap(f=>f.getLeafColumns());return h(x)}return[o]},{key:"column.getLeafColumns",debug:()=>{var h;return(h=e.options.debugAll)!=null?h:e.options.debugColumns}})};return o=e._features.reduce((h,p)=>Object.assign(h,p.createColumn==null?void 0:p.createColumn(o,e)),o),o}function yn(e,t,n){var r;let s={id:(r=n.id)!=null?r:t.id,column:t,index:n.index,isPlaceholder:!!n.isPlaceholder,placeholderId:n.placeholderId,depth:n.depth,subHeaders:[],colSpan:0,rowSpan:0,headerGroup:null,getLeafHeaders:()=>{const a=[],m=d=>{d.subHeaders&&d.subHeaders.length&&d.subHeaders.map(m),a.push(d)};return m(s),a},getContext:()=>({table:e,header:s,column:t})};return e._features.forEach(a=>{Object.assign(s,a.createHeader==null?void 0:a.createHeader(s,e))}),s}const Cl={createTable:e=>({getHeaderGroups:D(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(t,n,r,l)=>{var s,a;const m=(s=r==null?void 0:r.map(o=>n.find(h=>h.id===o)).filter(Boolean))!=null?s:[],d=(a=l==null?void 0:l.map(o=>n.find(h=>h.id===o)).filter(Boolean))!=null?a:[],g=n.filter(o=>!(r!=null&&r.includes(o.id))&&!(l!=null&&l.includes(o.id)));return Je(t,[...m,...g,...d],e)},{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getCenterHeaderGroups:D(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(t,n,r,l)=>(n=n.filter(s=>!(r!=null&&r.includes(s.id))&&!(l!=null&&l.includes(s.id))),Je(t,n,e,"center")),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getLeftHeaderGroups:D(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left],(t,n,r)=>{var l;const s=(l=r==null?void 0:r.map(a=>n.find(m=>m.id===a)).filter(Boolean))!=null?l:[];return Je(t,s,e,"left")},{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getRightHeaderGroups:D(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.right],(t,n,r)=>{var l;const s=(l=r==null?void 0:r.map(a=>n.find(m=>m.id===a)).filter(Boolean))!=null?l:[];return Je(t,s,e,"right")},{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getFooterGroups:D(()=>[e.getHeaderGroups()],t=>[...t].reverse(),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getLeftFooterGroups:D(()=>[e.getLeftHeaderGroups()],t=>[...t].reverse(),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getCenterFooterGroups:D(()=>[e.getCenterHeaderGroups()],t=>[...t].reverse(),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getRightFooterGroups:D(()=>[e.getRightHeaderGroups()],t=>[...t].reverse(),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getFlatHeaders:D(()=>[e.getHeaderGroups()],t=>t.map(n=>n.headers).flat(),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getLeftFlatHeaders:D(()=>[e.getLeftHeaderGroups()],t=>t.map(n=>n.headers).flat(),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getCenterFlatHeaders:D(()=>[e.getCenterHeaderGroups()],t=>t.map(n=>n.headers).flat(),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getRightFlatHeaders:D(()=>[e.getRightHeaderGroups()],t=>t.map(n=>n.headers).flat(),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getCenterLeafHeaders:D(()=>[e.getCenterFlatHeaders()],t=>t.filter(n=>{var r;return!((r=n.subHeaders)!=null&&r.length)}),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getLeftLeafHeaders:D(()=>[e.getLeftFlatHeaders()],t=>t.filter(n=>{var r;return!((r=n.subHeaders)!=null&&r.length)}),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getRightLeafHeaders:D(()=>[e.getRightFlatHeaders()],t=>t.filter(n=>{var r;return!((r=n.subHeaders)!=null&&r.length)}),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}}),getLeafHeaders:D(()=>[e.getLeftHeaderGroups(),e.getCenterHeaderGroups(),e.getRightHeaderGroups()],(t,n,r)=>{var l,s,a,m,d,g;return[...(l=(s=t[0])==null?void 0:s.headers)!=null?l:[],...(a=(m=n[0])==null?void 0:m.headers)!=null?a:[],...(d=(g=r[0])==null?void 0:g.headers)!=null?d:[]].map(c=>c.getLeafHeaders()).flat()},{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugHeaders}})})};function Je(e,t,n,r){var l,s;let a=0;const m=function(h,p){p===void 0&&(p=1),a=Math.max(a,p),h.filter(x=>x.getIsVisible()).forEach(x=>{var f;(f=x.columns)!=null&&f.length&&m(x.columns,p+1)},0)};m(e);let d=[];const g=(h,p)=>{const x={depth:p,id:[r,`${p}`].filter(Boolean).join("_"),headers:[]},f=[];h.forEach(_=>{const v=[...f].reverse()[0],C=_.column.depth===x.depth;let b,F=!1;if(C&&_.column.parent?b=_.column.parent:(b=_.column,F=!0),v&&(v==null?void 0:v.column)===b)v.subHeaders.push(_);else{const E=yn(n,b,{id:[r,p,b.id,_==null?void 0:_.id].filter(Boolean).join("_"),isPlaceholder:F,placeholderId:F?`${f.filter(T=>T.column===b).length}`:void 0,depth:p,index:f.length});E.subHeaders.push(_),f.push(E)}x.headers.push(_),_.headerGroup=x}),d.push(x),p>0&&g(f,p-1)},c=t.map((h,p)=>yn(n,h,{depth:a,index:p}));g(c,a-1),d.reverse();const o=h=>h.filter(x=>x.column.getIsVisible()).map(x=>{let f=0,_=0,v=[0];x.subHeaders&&x.subHeaders.length?(v=[],o(x.subHeaders).forEach(b=>{let{colSpan:F,rowSpan:E}=b;f+=F,v.push(E)})):f=1;const C=Math.min(...v);return _=_+C,x.colSpan=f,x.rowSpan=_,{colSpan:f,rowSpan:_}});return o((l=(s=d[0])==null?void 0:s.headers)!=null?l:[]),d}const et={size:150,minSize:20,maxSize:Number.MAX_SAFE_INTEGER},kt=()=>({startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,isResizingColumn:!1,columnSizingStart:[]}),wl={getDefaultColumnDef:()=>et,getInitialState:e=>({columnSizing:{},columnSizingInfo:kt(),...e}),getDefaultOptions:e=>({columnResizeMode:"onEnd",onColumnSizingChange:re("columnSizing",e),onColumnSizingInfoChange:re("columnSizingInfo",e)}),createColumn:(e,t)=>({getSize:()=>{var n,r,l;const s=t.getState().columnSizing[e.id];return Math.min(Math.max((n=e.columnDef.minSize)!=null?n:et.minSize,(r=s??e.columnDef.size)!=null?r:et.size),(l=e.columnDef.maxSize)!=null?l:et.maxSize)},getStart:n=>{const r=n?n==="left"?t.getLeftVisibleLeafColumns():t.getRightVisibleLeafColumns():t.getVisibleLeafColumns(),l=r.findIndex(s=>s.id===e.id);if(l>0){const s=r[l-1];return s.getStart(n)+s.getSize()}return 0},resetSize:()=>{t.setColumnSizing(n=>{let{[e.id]:r,...l}=n;return l})},getCanResize:()=>{var n,r;return((n=e.columnDef.enableResizing)!=null?n:!0)&&((r=t.options.enableColumnResizing)!=null?r:!0)},getIsResizing:()=>t.getState().columnSizingInfo.isResizingColumn===e.id}),createHeader:(e,t)=>({getSize:()=>{let n=0;const r=l=>{if(l.subHeaders.length)l.subHeaders.forEach(r);else{var s;n+=(s=l.column.getSize())!=null?s:0}};return r(e),n},getStart:()=>{if(e.index>0){const n=e.headerGroup.headers[e.index-1];return n.getStart()+n.getSize()}return 0},getResizeHandler:()=>{const n=t.getColumn(e.column.id),r=n==null?void 0:n.getCanResize();return l=>{if(!n||!r||(l.persist==null||l.persist(),Ft(l)&&l.touches&&l.touches.length>1))return;const s=e.getSize(),a=e?e.getLeafHeaders().map(f=>[f.column.id,f.column.getSize()]):[[n.id,n.getSize()]],m=Ft(l)?Math.round(l.touches[0].clientX):l.clientX,d={},g=(f,_)=>{typeof _=="number"&&(t.setColumnSizingInfo(v=>{var C,b;const F=_-((C=v==null?void 0:v.startOffset)!=null?C:0),E=Math.max(F/((b=v==null?void 0:v.startSize)!=null?b:0),-.999999);return v.columnSizingStart.forEach(T=>{let[N,$]=T;d[N]=Math.round(Math.max($+$*E,0)*100)/100}),{...v,deltaOffset:F,deltaPercentage:E}}),(t.options.columnResizeMode==="onChange"||f==="end")&&t.setColumnSizing(v=>({...v,...d})))},c=f=>g("move",f),o=f=>{g("end",f),t.setColumnSizingInfo(_=>({..._,isResizingColumn:!1,startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,columnSizingStart:[]}))},h={moveHandler:f=>c(f.clientX),upHandler:f=>{document.removeEventListener("mousemove",h.moveHandler),document.removeEventListener("mouseup",h.upHandler),o(f.clientX)}},p={moveHandler:f=>(f.cancelable&&(f.preventDefault(),f.stopPropagation()),c(f.touches[0].clientX),!1),upHandler:f=>{var _;document.removeEventListener("touchmove",p.moveHandler),document.removeEventListener("touchend",p.upHandler),f.cancelable&&(f.preventDefault(),f.stopPropagation()),o((_=f.touches[0])==null?void 0:_.clientX)}},x=Nl()?{passive:!1}:!1;Ft(l)?(document.addEventListener("touchmove",p.moveHandler,x),document.addEventListener("touchend",p.upHandler,x)):(document.addEventListener("mousemove",h.moveHandler,x),document.addEventListener("mouseup",h.upHandler,x)),t.setColumnSizingInfo(f=>({...f,startOffset:m,startSize:s,deltaOffset:0,deltaPercentage:0,columnSizingStart:a,isResizingColumn:n.id}))}}}),createTable:e=>({setColumnSizing:t=>e.options.onColumnSizingChange==null?void 0:e.options.onColumnSizingChange(t),setColumnSizingInfo:t=>e.options.onColumnSizingInfoChange==null?void 0:e.options.onColumnSizingInfoChange(t),resetColumnSizing:t=>{var n;e.setColumnSizing(t?{}:(n=e.initialState.columnSizing)!=null?n:{})},resetHeaderSizeInfo:t=>{var n;e.setColumnSizingInfo(t?kt():(n=e.initialState.columnSizingInfo)!=null?n:kt())},getTotalSize:()=>{var t,n;return(t=(n=e.getHeaderGroups()[0])==null?void 0:n.headers.reduce((r,l)=>r+l.getSize(),0))!=null?t:0},getLeftTotalSize:()=>{var t,n;return(t=(n=e.getLeftHeaderGroups()[0])==null?void 0:n.headers.reduce((r,l)=>r+l.getSize(),0))!=null?t:0},getCenterTotalSize:()=>{var t,n;return(t=(n=e.getCenterHeaderGroups()[0])==null?void 0:n.headers.reduce((r,l)=>r+l.getSize(),0))!=null?t:0},getRightTotalSize:()=>{var t,n;return(t=(n=e.getRightHeaderGroups()[0])==null?void 0:n.headers.reduce((r,l)=>r+l.getSize(),0))!=null?t:0}})};let tt=null;function Nl(){if(typeof tt=="boolean")return tt;let e=!1;try{const t={get passive(){return e=!0,!1}},n=()=>{};window.addEventListener("test",n,t),window.removeEventListener("test",n)}catch{e=!1}return tt=e,tt}function Ft(e){return e.type==="touchstart"}const Rl={getInitialState:e=>({expanded:{},...e}),getDefaultOptions:e=>({onExpandedChange:re("expanded",e),paginateExpandedRows:!0}),createTable:e=>{let t=!1,n=!1;return{_autoResetExpanded:()=>{var r,l;if(!t){e._queue(()=>{t=!0});return}if((r=(l=e.options.autoResetAll)!=null?l:e.options.autoResetExpanded)!=null?r:!e.options.manualExpanding){if(n)return;n=!0,e._queue(()=>{e.resetExpanded(),n=!1})}},setExpanded:r=>e.options.onExpandedChange==null?void 0:e.options.onExpandedChange(r),toggleAllRowsExpanded:r=>{r??!e.getIsAllRowsExpanded()?e.setExpanded(!0):e.setExpanded({})},resetExpanded:r=>{var l,s;e.setExpanded(r?{}:(l=(s=e.initialState)==null?void 0:s.expanded)!=null?l:{})},getCanSomeRowsExpand:()=>e.getPrePaginationRowModel().flatRows.some(r=>r.getCanExpand()),getToggleAllRowsExpandedHandler:()=>r=>{r.persist==null||r.persist(),e.toggleAllRowsExpanded()},getIsSomeRowsExpanded:()=>{const r=e.getState().expanded;return r===!0||Object.values(r).some(Boolean)},getIsAllRowsExpanded:()=>{const r=e.getState().expanded;return typeof r=="boolean"?r===!0:!(!Object.keys(r).length||e.getRowModel().flatRows.some(l=>!l.getIsExpanded()))},getExpandedDepth:()=>{let r=0;return(e.getState().expanded===!0?Object.keys(e.getRowModel().rowsById):Object.keys(e.getState().expanded)).forEach(s=>{const a=s.split(".");r=Math.max(r,a.length)}),r},getPreExpandedRowModel:()=>e.getSortedRowModel(),getExpandedRowModel:()=>(!e._getExpandedRowModel&&e.options.getExpandedRowModel&&(e._getExpandedRowModel=e.options.getExpandedRowModel(e)),e.options.manualExpanding||!e._getExpandedRowModel?e.getPreExpandedRowModel():e._getExpandedRowModel())}},createRow:(e,t)=>({toggleExpanded:n=>{t.setExpanded(r=>{var l;const s=r===!0?!0:!!(r!=null&&r[e.id]);let a={};if(r===!0?Object.keys(t.getRowModel().rowsById).forEach(m=>{a[m]=!0}):a=r,n=(l=n)!=null?l:!s,!s&&n)return{...a,[e.id]:!0};if(s&&!n){const{[e.id]:m,...d}=a;return d}return r})},getIsExpanded:()=>{var n;const r=t.getState().expanded;return!!((n=t.options.getIsRowExpanded==null?void 0:t.options.getIsRowExpanded(e))!=null?n:r===!0||r!=null&&r[e.id])},getCanExpand:()=>{var n,r,l;return(n=t.options.getRowCanExpand==null?void 0:t.options.getRowCanExpand(e))!=null?n:((r=t.options.enableExpanding)!=null?r:!0)&&!!((l=e.subRows)!=null&&l.length)},getToggleExpandedHandler:()=>{const n=e.getCanExpand();return()=>{n&&e.toggleExpanded()}}})},Kn=(e,t,n)=>{var r,l,s;const a=n.toLowerCase();return!!(!((r=e.getValue(t))==null||(l=r.toString())==null||(s=l.toLowerCase())==null)&&s.includes(a))};Kn.autoRemove=e=>se(e);const Zn=(e,t,n)=>{var r,l;return!!(!((r=e.getValue(t))==null||(l=r.toString())==null)&&l.includes(n))};Zn.autoRemove=e=>se(e);const Jn=(e,t,n)=>{var r,l;return((r=e.getValue(t))==null||(l=r.toString())==null?void 0:l.toLowerCase())===(n==null?void 0:n.toLowerCase())};Jn.autoRemove=e=>se(e);const ei=(e,t,n)=>{var r;return(r=e.getValue(t))==null?void 0:r.includes(n)};ei.autoRemove=e=>se(e)||!(e!=null&&e.length);const ti=(e,t,n)=>!n.some(r=>{var l;return!((l=e.getValue(t))!=null&&l.includes(r))});ti.autoRemove=e=>se(e)||!(e!=null&&e.length);const ni=(e,t,n)=>n.some(r=>{var l;return(l=e.getValue(t))==null?void 0:l.includes(r)});ni.autoRemove=e=>se(e)||!(e!=null&&e.length);const ii=(e,t,n)=>e.getValue(t)===n;ii.autoRemove=e=>se(e);const ri=(e,t,n)=>e.getValue(t)==n;ri.autoRemove=e=>se(e);const en=(e,t,n)=>{let[r,l]=n;const s=e.getValue(t);return s>=r&&s<=l};en.resolveFilterValue=e=>{let[t,n]=e,r=typeof t!="number"?parseFloat(t):t,l=typeof n!="number"?parseFloat(n):n,s=t===null||Number.isNaN(r)?-1/0:r,a=n===null||Number.isNaN(l)?1/0:l;if(s>a){const m=s;s=a,a=m}return[s,a]};en.autoRemove=e=>se(e)||se(e[0])&&se(e[1]);const de={includesString:Kn,includesStringSensitive:Zn,equalsString:Jn,arrIncludes:ei,arrIncludesAll:ti,arrIncludesSome:ni,equals:ii,weakEquals:ri,inNumberRange:en};function se(e){return e==null||e===""}const kl={getDefaultColumnDef:()=>({filterFn:"auto"}),getInitialState:e=>({columnFilters:[],globalFilter:void 0,...e}),getDefaultOptions:e=>({onColumnFiltersChange:re("columnFilters",e),onGlobalFilterChange:re("globalFilter",e),filterFromLeafRows:!1,maxLeafRowFilterDepth:100,globalFilterFn:"auto",getColumnCanGlobalFilter:t=>{var n,r;const l=(n=e.getCoreRowModel().flatRows[0])==null||(r=n._getAllCellsByColumnId()[t.id])==null?void 0:r.getValue();return typeof l=="string"||typeof l=="number"}}),createColumn:(e,t)=>({getAutoFilterFn:()=>{const n=t.getCoreRowModel().flatRows[0],r=n==null?void 0:n.getValue(e.id);return typeof r=="string"?de.includesString:typeof r=="number"?de.inNumberRange:typeof r=="boolean"||r!==null&&typeof r=="object"?de.equals:Array.isArray(r)?de.arrIncludes:de.weakEquals},getFilterFn:()=>{var n,r;return st(e.columnDef.filterFn)?e.columnDef.filterFn:e.columnDef.filterFn==="auto"?e.getAutoFilterFn():(n=(r=t.options.filterFns)==null?void 0:r[e.columnDef.filterFn])!=null?n:de[e.columnDef.filterFn]},getCanFilter:()=>{var n,r,l;return((n=e.columnDef.enableColumnFilter)!=null?n:!0)&&((r=t.options.enableColumnFilters)!=null?r:!0)&&((l=t.options.enableFilters)!=null?l:!0)&&!!e.accessorFn},getCanGlobalFilter:()=>{var n,r,l,s;return((n=e.columnDef.enableGlobalFilter)!=null?n:!0)&&((r=t.options.enableGlobalFilter)!=null?r:!0)&&((l=t.options.enableFilters)!=null?l:!0)&&((s=t.options.getColumnCanGlobalFilter==null?void 0:t.options.getColumnCanGlobalFilter(e))!=null?s:!0)&&!!e.accessorFn},getIsFiltered:()=>e.getFilterIndex()>-1,getFilterValue:()=>{var n,r;return(n=t.getState().columnFilters)==null||(r=n.find(l=>l.id===e.id))==null?void 0:r.value},getFilterIndex:()=>{var n,r;return(n=(r=t.getState().columnFilters)==null?void 0:r.findIndex(l=>l.id===e.id))!=null?n:-1},setFilterValue:n=>{t.setColumnFilters(r=>{const l=e.getFilterFn(),s=r==null?void 0:r.find(c=>c.id===e.id),a=he(n,s?s.value:void 0);if(xn(l,a,e)){var m;return(m=r==null?void 0:r.filter(c=>c.id!==e.id))!=null?m:[]}const d={id:e.id,value:a};if(s){var g;return(g=r==null?void 0:r.map(c=>c.id===e.id?d:c))!=null?g:[]}return r!=null&&r.length?[...r,d]:[d]})},_getFacetedRowModel:t.options.getFacetedRowModel&&t.options.getFacetedRowModel(t,e.id),getFacetedRowModel:()=>e._getFacetedRowModel?e._getFacetedRowModel():t.getPreFilteredRowModel(),_getFacetedUniqueValues:t.options.getFacetedUniqueValues&&t.options.getFacetedUniqueValues(t,e.id),getFacetedUniqueValues:()=>e._getFacetedUniqueValues?e._getFacetedUniqueValues():new Map,_getFacetedMinMaxValues:t.options.getFacetedMinMaxValues&&t.options.getFacetedMinMaxValues(t,e.id),getFacetedMinMaxValues:()=>{if(e._getFacetedMinMaxValues)return e._getFacetedMinMaxValues()}}),createRow:(e,t)=>({columnFilters:{},columnFiltersMeta:{}}),createTable:e=>({getGlobalAutoFilterFn:()=>de.includesString,getGlobalFilterFn:()=>{var t,n;const{globalFilterFn:r}=e.options;return st(r)?r:r==="auto"?e.getGlobalAutoFilterFn():(t=(n=e.options.filterFns)==null?void 0:n[r])!=null?t:de[r]},setColumnFilters:t=>{const n=e.getAllLeafColumns(),r=l=>{var s;return(s=he(t,l))==null?void 0:s.filter(a=>{const m=n.find(d=>d.id===a.id);if(m){const d=m.getFilterFn();if(xn(d,a.value,m))return!1}return!0})};e.options.onColumnFiltersChange==null||e.options.onColumnFiltersChange(r)},setGlobalFilter:t=>{e.options.onGlobalFilterChange==null||e.options.onGlobalFilterChange(t)},resetGlobalFilter:t=>{e.setGlobalFilter(t?void 0:e.initialState.globalFilter)},resetColumnFilters:t=>{var n,r;e.setColumnFilters(t?[]:(n=(r=e.initialState)==null?void 0:r.columnFilters)!=null?n:[])},getPreFilteredRowModel:()=>e.getCoreRowModel(),getFilteredRowModel:()=>(!e._getFilteredRowModel&&e.options.getFilteredRowModel&&(e._getFilteredRowModel=e.options.getFilteredRowModel(e)),e.options.manualFiltering||!e._getFilteredRowModel?e.getPreFilteredRowModel():e._getFilteredRowModel()),_getGlobalFacetedRowModel:e.options.getFacetedRowModel&&e.options.getFacetedRowModel(e,"__global__"),getGlobalFacetedRowModel:()=>e.options.manualFiltering||!e._getGlobalFacetedRowModel?e.getPreFilteredRowModel():e._getGlobalFacetedRowModel(),_getGlobalFacetedUniqueValues:e.options.getFacetedUniqueValues&&e.options.getFacetedUniqueValues(e,"__global__"),getGlobalFacetedUniqueValues:()=>e._getGlobalFacetedUniqueValues?e._getGlobalFacetedUniqueValues():new Map,_getGlobalFacetedMinMaxValues:e.options.getFacetedMinMaxValues&&e.options.getFacetedMinMaxValues(e,"__global__"),getGlobalFacetedMinMaxValues:()=>{if(e._getGlobalFacetedMinMaxValues)return e._getGlobalFacetedMinMaxValues()}})};function xn(e,t,n){return(e&&e.autoRemove?e.autoRemove(t,n):!1)||typeof t>"u"||typeof t=="string"&&!t}const Fl=(e,t,n)=>n.reduce((r,l)=>{const s=l.getValue(e);return r+(typeof s=="number"?s:0)},0),Al=(e,t,n)=>{let r;return n.forEach(l=>{const s=l.getValue(e);s!=null&&(r>s||r===void 0&&s>=s)&&(r=s)}),r},Il=(e,t,n)=>{let r;return n.forEach(l=>{const s=l.getValue(e);s!=null&&(r<s||r===void 0&&s>=s)&&(r=s)}),r},$l=(e,t,n)=>{let r,l;return n.forEach(s=>{const a=s.getValue(e);a!=null&&(r===void 0?a>=a&&(r=l=a):(r>a&&(r=a),l<a&&(l=a)))}),[r,l]},Ml=(e,t)=>{let n=0,r=0;if(t.forEach(l=>{let s=l.getValue(e);s!=null&&(s=+s)>=s&&(++n,r+=s)}),n)return r/n},El=(e,t)=>{if(!t.length)return;const n=t.map(s=>s.getValue(e));if(!_l(n))return;if(n.length===1)return n[0];const r=Math.floor(n.length/2),l=n.sort((s,a)=>s-a);return n.length%2!==0?l[r]:(l[r-1]+l[r])/2},Pl=(e,t)=>Array.from(new Set(t.map(n=>n.getValue(e))).values()),zl=(e,t)=>new Set(t.map(n=>n.getValue(e))).size,Vl=(e,t)=>t.length,At={sum:Fl,min:Al,max:Il,extent:$l,mean:Ml,median:El,unique:Pl,uniqueCount:zl,count:Vl},Tl={getDefaultColumnDef:()=>({aggregatedCell:e=>{var t,n;return(t=(n=e.getValue())==null||n.toString==null?void 0:n.toString())!=null?t:null},aggregationFn:"auto"}),getInitialState:e=>({grouping:[],...e}),getDefaultOptions:e=>({onGroupingChange:re("grouping",e),groupedColumnMode:"reorder"}),createColumn:(e,t)=>({toggleGrouping:()=>{t.setGrouping(n=>n!=null&&n.includes(e.id)?n.filter(r=>r!==e.id):[...n??[],e.id])},getCanGroup:()=>{var n,r,l,s;return(n=(r=(l=(s=e.columnDef.enableGrouping)!=null?s:!0)!=null?l:t.options.enableGrouping)!=null?r:!0)!=null?n:!!e.accessorFn},getIsGrouped:()=>{var n;return(n=t.getState().grouping)==null?void 0:n.includes(e.id)},getGroupedIndex:()=>{var n;return(n=t.getState().grouping)==null?void 0:n.indexOf(e.id)},getToggleGroupingHandler:()=>{const n=e.getCanGroup();return()=>{n&&e.toggleGrouping()}},getAutoAggregationFn:()=>{const n=t.getCoreRowModel().flatRows[0],r=n==null?void 0:n.getValue(e.id);if(typeof r=="number")return At.sum;if(Object.prototype.toString.call(r)==="[object Date]")return At.extent},getAggregationFn:()=>{var n,r;if(!e)throw new Error;return st(e.columnDef.aggregationFn)?e.columnDef.aggregationFn:e.columnDef.aggregationFn==="auto"?e.getAutoAggregationFn():(n=(r=t.options.aggregationFns)==null?void 0:r[e.columnDef.aggregationFn])!=null?n:At[e.columnDef.aggregationFn]}}),createTable:e=>({setGrouping:t=>e.options.onGroupingChange==null?void 0:e.options.onGroupingChange(t),resetGrouping:t=>{var n,r;e.setGrouping(t?[]:(n=(r=e.initialState)==null?void 0:r.grouping)!=null?n:[])},getPreGroupedRowModel:()=>e.getFilteredRowModel(),getGroupedRowModel:()=>(!e._getGroupedRowModel&&e.options.getGroupedRowModel&&(e._getGroupedRowModel=e.options.getGroupedRowModel(e)),e.options.manualGrouping||!e._getGroupedRowModel?e.getPreGroupedRowModel():e._getGroupedRowModel())}),createRow:(e,t)=>({getIsGrouped:()=>!!e.groupingColumnId,getGroupingValue:n=>{if(e._groupingValuesCache.hasOwnProperty(n))return e._groupingValuesCache[n];const r=t.getColumn(n);return r!=null&&r.columnDef.getGroupingValue?(e._groupingValuesCache[n]=r.columnDef.getGroupingValue(e.original),e._groupingValuesCache[n]):e.getValue(n)},_groupingValuesCache:{}}),createCell:(e,t,n,r)=>({getIsGrouped:()=>t.getIsGrouped()&&t.id===n.groupingColumnId,getIsPlaceholder:()=>!e.getIsGrouped()&&t.getIsGrouped(),getIsAggregated:()=>{var l;return!e.getIsGrouped()&&!e.getIsPlaceholder()&&!!((l=n.subRows)!=null&&l.length)}})};function ql(e,t,n){if(!(t!=null&&t.length)||!n)return e;const r=e.filter(s=>!t.includes(s.id));return n==="remove"?r:[...t.map(s=>e.find(a=>a.id===s)).filter(Boolean),...r]}const Dl={getInitialState:e=>({columnOrder:[],...e}),getDefaultOptions:e=>({onColumnOrderChange:re("columnOrder",e)}),createTable:e=>({setColumnOrder:t=>e.options.onColumnOrderChange==null?void 0:e.options.onColumnOrderChange(t),resetColumnOrder:t=>{var n;e.setColumnOrder(t?[]:(n=e.initialState.columnOrder)!=null?n:[])},_getOrderColumnsFn:D(()=>[e.getState().columnOrder,e.getState().grouping,e.options.groupedColumnMode],(t,n,r)=>l=>{let s=[];if(!(t!=null&&t.length))s=l;else{const a=[...t],m=[...l];for(;m.length&&a.length;){const d=a.shift(),g=m.findIndex(c=>c.id===d);g>-1&&s.push(m.splice(g,1)[0])}s=[...s,...m]}return ql(s,n,r)},{key:!1})})},Ot=0,Ht=10,It=()=>({pageIndex:Ot,pageSize:Ht}),Ol={getInitialState:e=>({...e,pagination:{...It(),...e==null?void 0:e.pagination}}),getDefaultOptions:e=>({onPaginationChange:re("pagination",e)}),createTable:e=>{let t=!1,n=!1;return{_autoResetPageIndex:()=>{var r,l;if(!t){e._queue(()=>{t=!0});return}if((r=(l=e.options.autoResetAll)!=null?l:e.options.autoResetPageIndex)!=null?r:!e.options.manualPagination){if(n)return;n=!0,e._queue(()=>{e.resetPageIndex(),n=!1})}},setPagination:r=>{const l=s=>he(r,s);return e.options.onPaginationChange==null?void 0:e.options.onPaginationChange(l)},resetPagination:r=>{var l;e.setPagination(r?It():(l=e.initialState.pagination)!=null?l:It())},setPageIndex:r=>{e.setPagination(l=>{let s=he(r,l.pageIndex);const a=typeof e.options.pageCount>"u"||e.options.pageCount===-1?Number.MAX_SAFE_INTEGER:e.options.pageCount-1;return s=Math.max(0,Math.min(s,a)),{...l,pageIndex:s}})},resetPageIndex:r=>{var l,s,a;e.setPageIndex(r?Ot:(l=(s=e.initialState)==null||(a=s.pagination)==null?void 0:a.pageIndex)!=null?l:Ot)},resetPageSize:r=>{var l,s,a;e.setPageSize(r?Ht:(l=(s=e.initialState)==null||(a=s.pagination)==null?void 0:a.pageSize)!=null?l:Ht)},setPageSize:r=>{e.setPagination(l=>{const s=Math.max(1,he(r,l.pageSize)),a=l.pageSize*l.pageIndex,m=Math.floor(a/s);return{...l,pageIndex:m,pageSize:s}})},setPageCount:r=>e.setPagination(l=>{var s;let a=he(r,(s=e.options.pageCount)!=null?s:-1);return typeof a=="number"&&(a=Math.max(-1,a)),{...l,pageCount:a}}),getPageOptions:D(()=>[e.getPageCount()],r=>{let l=[];return r&&r>0&&(l=[...new Array(r)].fill(null).map((s,a)=>a)),l},{key:!1,debug:()=>{var r;return(r=e.options.debugAll)!=null?r:e.options.debugTable}}),getCanPreviousPage:()=>e.getState().pagination.pageIndex>0,getCanNextPage:()=>{const{pageIndex:r}=e.getState().pagination,l=e.getPageCount();return l===-1?!0:l===0?!1:r<l-1},previousPage:()=>e.setPageIndex(r=>r-1),nextPage:()=>e.setPageIndex(r=>r+1),getPrePaginationRowModel:()=>e.getExpandedRowModel(),getPaginationRowModel:()=>(!e._getPaginationRowModel&&e.options.getPaginationRowModel&&(e._getPaginationRowModel=e.options.getPaginationRowModel(e)),e.options.manualPagination||!e._getPaginationRowModel?e.getPrePaginationRowModel():e._getPaginationRowModel()),getPageCount:()=>{var r;return(r=e.options.pageCount)!=null?r:Math.ceil(e.getPrePaginationRowModel().rows.length/e.getState().pagination.pageSize)}}}},$t=()=>({left:[],right:[]}),Hl={getInitialState:e=>({columnPinning:$t(),...e}),getDefaultOptions:e=>({onColumnPinningChange:re("columnPinning",e)}),createColumn:(e,t)=>({pin:n=>{const r=e.getLeafColumns().map(l=>l.id).filter(Boolean);t.setColumnPinning(l=>{var s,a;if(n==="right"){var m,d;return{left:((m=l==null?void 0:l.left)!=null?m:[]).filter(o=>!(r!=null&&r.includes(o))),right:[...((d=l==null?void 0:l.right)!=null?d:[]).filter(o=>!(r!=null&&r.includes(o))),...r]}}if(n==="left"){var g,c;return{left:[...((g=l==null?void 0:l.left)!=null?g:[]).filter(o=>!(r!=null&&r.includes(o))),...r],right:((c=l==null?void 0:l.right)!=null?c:[]).filter(o=>!(r!=null&&r.includes(o)))}}return{left:((s=l==null?void 0:l.left)!=null?s:[]).filter(o=>!(r!=null&&r.includes(o))),right:((a=l==null?void 0:l.right)!=null?a:[]).filter(o=>!(r!=null&&r.includes(o)))}})},getCanPin:()=>e.getLeafColumns().some(r=>{var l,s;return((l=r.columnDef.enablePinning)!=null?l:!0)&&((s=t.options.enablePinning)!=null?s:!0)}),getIsPinned:()=>{const n=e.getLeafColumns().map(m=>m.id),{left:r,right:l}=t.getState().columnPinning,s=n.some(m=>r==null?void 0:r.includes(m)),a=n.some(m=>l==null?void 0:l.includes(m));return s?"left":a?"right":!1},getPinnedIndex:()=>{var n,r,l;const s=e.getIsPinned();return s?(n=(r=t.getState().columnPinning)==null||(l=r[s])==null?void 0:l.indexOf(e.id))!=null?n:-1:0}}),createRow:(e,t)=>({getCenterVisibleCells:D(()=>[e._getAllVisibleCells(),t.getState().columnPinning.left,t.getState().columnPinning.right],(n,r,l)=>{const s=[...r??[],...l??[]];return n.filter(a=>!s.includes(a.column.id))},{key:"row.getCenterVisibleCells",debug:()=>{var n;return(n=t.options.debugAll)!=null?n:t.options.debugRows}}),getLeftVisibleCells:D(()=>[e._getAllVisibleCells(),t.getState().columnPinning.left,,],(n,r)=>(r??[]).map(s=>n.find(a=>a.column.id===s)).filter(Boolean).map(s=>({...s,position:"left"})),{key:"row.getLeftVisibleCells",debug:()=>{var n;return(n=t.options.debugAll)!=null?n:t.options.debugRows}}),getRightVisibleCells:D(()=>[e._getAllVisibleCells(),t.getState().columnPinning.right],(n,r)=>(r??[]).map(s=>n.find(a=>a.column.id===s)).filter(Boolean).map(s=>({...s,position:"right"})),{key:"row.getRightVisibleCells",debug:()=>{var n;return(n=t.options.debugAll)!=null?n:t.options.debugRows}})}),createTable:e=>({setColumnPinning:t=>e.options.onColumnPinningChange==null?void 0:e.options.onColumnPinningChange(t),resetColumnPinning:t=>{var n,r;return e.setColumnPinning(t?$t():(n=(r=e.initialState)==null?void 0:r.columnPinning)!=null?n:$t())},getIsSomeColumnsPinned:t=>{var n;const r=e.getState().columnPinning;if(!t){var l,s;return!!((l=r.left)!=null&&l.length||(s=r.right)!=null&&s.length)}return!!((n=r[t])!=null&&n.length)},getLeftLeafColumns:D(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left],(t,n)=>(n??[]).map(r=>t.find(l=>l.id===r)).filter(Boolean),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugColumns}}),getRightLeafColumns:D(()=>[e.getAllLeafColumns(),e.getState().columnPinning.right],(t,n)=>(n??[]).map(r=>t.find(l=>l.id===r)).filter(Boolean),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugColumns}}),getCenterLeafColumns:D(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(t,n,r)=>{const l=[...n??[],...r??[]];return t.filter(s=>!l.includes(s.id))},{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugColumns}})})},jl={getInitialState:e=>({rowSelection:{},...e}),getDefaultOptions:e=>({onRowSelectionChange:re("rowSelection",e),enableRowSelection:!0,enableMultiRowSelection:!0,enableSubRowSelection:!0}),createTable:e=>({setRowSelection:t=>e.options.onRowSelectionChange==null?void 0:e.options.onRowSelectionChange(t),resetRowSelection:t=>{var n;return e.setRowSelection(t?{}:(n=e.initialState.rowSelection)!=null?n:{})},toggleAllRowsSelected:t=>{e.setRowSelection(n=>{t=typeof t<"u"?t:!e.getIsAllRowsSelected();const r={...n},l=e.getPreGroupedRowModel().flatRows;return t?l.forEach(s=>{s.getCanSelect()&&(r[s.id]=!0)}):l.forEach(s=>{delete r[s.id]}),r})},toggleAllPageRowsSelected:t=>e.setRowSelection(n=>{const r=typeof t<"u"?t:!e.getIsAllPageRowsSelected(),l={...n};return e.getRowModel().rows.forEach(s=>{jt(l,s.id,r,e)}),l}),getPreSelectedRowModel:()=>e.getCoreRowModel(),getSelectedRowModel:D(()=>[e.getState().rowSelection,e.getCoreRowModel()],(t,n)=>Object.keys(t).length?Mt(e,n):{rows:[],flatRows:[],rowsById:{}},{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugTable}}),getFilteredSelectedRowModel:D(()=>[e.getState().rowSelection,e.getFilteredRowModel()],(t,n)=>Object.keys(t).length?Mt(e,n):{rows:[],flatRows:[],rowsById:{}},{key:"getFilteredSelectedRowModel",debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugTable}}),getGroupedSelectedRowModel:D(()=>[e.getState().rowSelection,e.getSortedRowModel()],(t,n)=>Object.keys(t).length?Mt(e,n):{rows:[],flatRows:[],rowsById:{}},{key:"getGroupedSelectedRowModel",debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugTable}}),getIsAllRowsSelected:()=>{const t=e.getFilteredRowModel().flatRows,{rowSelection:n}=e.getState();let r=!!(t.length&&Object.keys(n).length);return r&&t.some(l=>l.getCanSelect()&&!n[l.id])&&(r=!1),r},getIsAllPageRowsSelected:()=>{const t=e.getPaginationRowModel().flatRows.filter(l=>l.getCanSelect()),{rowSelection:n}=e.getState();let r=!!t.length;return r&&t.some(l=>!n[l.id])&&(r=!1),r},getIsSomeRowsSelected:()=>{var t;const n=Object.keys((t=e.getState().rowSelection)!=null?t:{}).length;return n>0&&n<e.getFilteredRowModel().flatRows.length},getIsSomePageRowsSelected:()=>{const t=e.getPaginationRowModel().flatRows;return e.getIsAllPageRowsSelected()?!1:t.filter(n=>n.getCanSelect()).some(n=>n.getIsSelected()||n.getIsSomeSelected())},getToggleAllRowsSelectedHandler:()=>t=>{e.toggleAllRowsSelected(t.target.checked)},getToggleAllPageRowsSelectedHandler:()=>t=>{e.toggleAllPageRowsSelected(t.target.checked)}}),createRow:(e,t)=>({toggleSelected:n=>{const r=e.getIsSelected();t.setRowSelection(l=>{if(n=typeof n<"u"?n:!r,r===n)return l;const s={...l};return jt(s,e.id,n,t),s})},getIsSelected:()=>{const{rowSelection:n}=t.getState();return tn(e,n)},getIsSomeSelected:()=>{const{rowSelection:n}=t.getState();return vn(e,n)==="some"},getIsAllSubRowsSelected:()=>{const{rowSelection:n}=t.getState();return vn(e,n)==="all"},getCanSelect:()=>{var n;return typeof t.options.enableRowSelection=="function"?t.options.enableRowSelection(e):(n=t.options.enableRowSelection)!=null?n:!0},getCanSelectSubRows:()=>{var n;return typeof t.options.enableSubRowSelection=="function"?t.options.enableSubRowSelection(e):(n=t.options.enableSubRowSelection)!=null?n:!0},getCanMultiSelect:()=>{var n;return typeof t.options.enableMultiRowSelection=="function"?t.options.enableMultiRowSelection(e):(n=t.options.enableMultiRowSelection)!=null?n:!0},getToggleSelectedHandler:()=>{const n=e.getCanSelect();return r=>{var l;n&&e.toggleSelected((l=r.target)==null?void 0:l.checked)}}})},jt=(e,t,n,r)=>{var l;const s=r.getRow(t);n?(s.getCanMultiSelect()||Object.keys(e).forEach(a=>delete e[a]),s.getCanSelect()&&(e[t]=!0)):delete e[t],(l=s.subRows)!=null&&l.length&&s.getCanSelectSubRows()&&s.subRows.forEach(a=>jt(e,a.id,n,r))};function Mt(e,t){const n=e.getState().rowSelection,r=[],l={},s=function(a,m){return a.map(d=>{var g;const c=tn(d,n);if(c&&(r.push(d),l[d.id]=d),(g=d.subRows)!=null&&g.length&&(d={...d,subRows:s(d.subRows)}),c)return d}).filter(Boolean)};return{rows:s(t.rows),flatRows:r,rowsById:l}}function tn(e,t){var n;return(n=t[e.id])!=null?n:!1}function vn(e,t,n){if(e.subRows&&e.subRows.length){let r=!0,l=!1;return e.subRows.forEach(s=>{l&&!r||(tn(s,t)?l=!0:r=!1)}),r?"all":l?"some":!1}return!1}const Lt=/([0-9]+)/gm,Ll=(e,t,n)=>li(ye(e.getValue(n)).toLowerCase(),ye(t.getValue(n)).toLowerCase()),Gl=(e,t,n)=>li(ye(e.getValue(n)),ye(t.getValue(n))),Bl=(e,t,n)=>nn(ye(e.getValue(n)).toLowerCase(),ye(t.getValue(n)).toLowerCase()),Ul=(e,t,n)=>nn(ye(e.getValue(n)),ye(t.getValue(n))),Ql=(e,t,n)=>{const r=e.getValue(n),l=t.getValue(n);return r>l?1:r<l?-1:0},Wl=(e,t,n)=>nn(e.getValue(n),t.getValue(n));function nn(e,t){return e===t?0:e>t?1:-1}function ye(e){return typeof e=="number"?isNaN(e)||e===1/0||e===-1/0?"":String(e):typeof e=="string"?e:""}function li(e,t){const n=e.split(Lt).filter(Boolean),r=t.split(Lt).filter(Boolean);for(;n.length&&r.length;){const l=n.shift(),s=r.shift(),a=parseInt(l,10),m=parseInt(s,10),d=[a,m].sort();if(isNaN(d[0])){if(l>s)return 1;if(s>l)return-1;continue}if(isNaN(d[1]))return isNaN(a)?-1:1;if(a>m)return 1;if(m>a)return-1}return n.length-r.length}const qe={alphanumeric:Ll,alphanumericCaseSensitive:Gl,text:Bl,textCaseSensitive:Ul,datetime:Ql,basic:Wl},Yl={getInitialState:e=>({sorting:[],...e}),getDefaultColumnDef:()=>({sortingFn:"auto",sortUndefined:1}),getDefaultOptions:e=>({onSortingChange:re("sorting",e),isMultiSortEvent:t=>t.shiftKey}),createColumn:(e,t)=>({getAutoSortingFn:()=>{const n=t.getFilteredRowModel().flatRows.slice(10);let r=!1;for(const l of n){const s=l==null?void 0:l.getValue(e.id);if(Object.prototype.toString.call(s)==="[object Date]")return qe.datetime;if(typeof s=="string"&&(r=!0,s.split(Lt).length>1))return qe.alphanumeric}return r?qe.text:qe.basic},getAutoSortDir:()=>{const n=t.getFilteredRowModel().flatRows[0];return typeof(n==null?void 0:n.getValue(e.id))=="string"?"asc":"desc"},getSortingFn:()=>{var n,r;if(!e)throw new Error;return st(e.columnDef.sortingFn)?e.columnDef.sortingFn:e.columnDef.sortingFn==="auto"?e.getAutoSortingFn():(n=(r=t.options.sortingFns)==null?void 0:r[e.columnDef.sortingFn])!=null?n:qe[e.columnDef.sortingFn]},toggleSorting:(n,r)=>{const l=e.getNextSortingOrder(),s=typeof n<"u"&&n!==null;t.setSorting(a=>{const m=a==null?void 0:a.find(p=>p.id===e.id),d=a==null?void 0:a.findIndex(p=>p.id===e.id);let g=[],c,o=s?n:l==="desc";if(a!=null&&a.length&&e.getCanMultiSort()&&r?m?c="toggle":c="add":a!=null&&a.length&&d!==a.length-1?c="replace":m?c="toggle":c="replace",c==="toggle"&&(s||l||(c="remove")),c==="add"){var h;g=[...a,{id:e.id,desc:o}],g.splice(0,g.length-((h=t.options.maxMultiSortColCount)!=null?h:Number.MAX_SAFE_INTEGER))}else c==="toggle"?g=a.map(p=>p.id===e.id?{...p,desc:o}:p):c==="remove"?g=a.filter(p=>p.id!==e.id):g=[{id:e.id,desc:o}];return g})},getFirstSortDir:()=>{var n,r;return((n=(r=e.columnDef.sortDescFirst)!=null?r:t.options.sortDescFirst)!=null?n:e.getAutoSortDir()==="desc")?"desc":"asc"},getNextSortingOrder:n=>{var r,l;const s=e.getFirstSortDir(),a=e.getIsSorted();return a?a!==s&&((r=t.options.enableSortingRemoval)==null||r)&&(!(n&&(l=t.options.enableMultiRemove)!=null)||l)?!1:a==="desc"?"asc":"desc":s},getCanSort:()=>{var n,r;return((n=e.columnDef.enableSorting)!=null?n:!0)&&((r=t.options.enableSorting)!=null?r:!0)&&!!e.accessorFn},getCanMultiSort:()=>{var n,r;return(n=(r=e.columnDef.enableMultiSort)!=null?r:t.options.enableMultiSort)!=null?n:!!e.accessorFn},getIsSorted:()=>{var n;const r=(n=t.getState().sorting)==null?void 0:n.find(l=>l.id===e.id);return r?r.desc?"desc":"asc":!1},getSortIndex:()=>{var n,r;return(n=(r=t.getState().sorting)==null?void 0:r.findIndex(l=>l.id===e.id))!=null?n:-1},clearSorting:()=>{t.setSorting(n=>n!=null&&n.length?n.filter(r=>r.id!==e.id):[])},getToggleSortingHandler:()=>{const n=e.getCanSort();return r=>{n&&(r.persist==null||r.persist(),e.toggleSorting==null||e.toggleSorting(void 0,e.getCanMultiSort()?t.options.isMultiSortEvent==null?void 0:t.options.isMultiSortEvent(r):!1))}}}),createTable:e=>({setSorting:t=>e.options.onSortingChange==null?void 0:e.options.onSortingChange(t),resetSorting:t=>{var n,r;e.setSorting(t?[]:(n=(r=e.initialState)==null?void 0:r.sorting)!=null?n:[])},getPreSortedRowModel:()=>e.getGroupedRowModel(),getSortedRowModel:()=>(!e._getSortedRowModel&&e.options.getSortedRowModel&&(e._getSortedRowModel=e.options.getSortedRowModel(e)),e.options.manualSorting||!e._getSortedRowModel?e.getPreSortedRowModel():e._getSortedRowModel())})},Xl={getInitialState:e=>({columnVisibility:{},...e}),getDefaultOptions:e=>({onColumnVisibilityChange:re("columnVisibility",e)}),createColumn:(e,t)=>({toggleVisibility:n=>{e.getCanHide()&&t.setColumnVisibility(r=>({...r,[e.id]:n??!e.getIsVisible()}))},getIsVisible:()=>{var n,r;return(n=(r=t.getState().columnVisibility)==null?void 0:r[e.id])!=null?n:!0},getCanHide:()=>{var n,r;return((n=e.columnDef.enableHiding)!=null?n:!0)&&((r=t.options.enableHiding)!=null?r:!0)},getToggleVisibilityHandler:()=>n=>{e.toggleVisibility==null||e.toggleVisibility(n.target.checked)}}),createRow:(e,t)=>({_getAllVisibleCells:D(()=>[e.getAllCells(),t.getState().columnVisibility],n=>n.filter(r=>r.column.getIsVisible()),{key:"row._getAllVisibleCells",debug:()=>{var n;return(n=t.options.debugAll)!=null?n:t.options.debugRows}}),getVisibleCells:D(()=>[e.getLeftVisibleCells(),e.getCenterVisibleCells(),e.getRightVisibleCells()],(n,r,l)=>[...n,...r,...l],{key:!1,debug:()=>{var n;return(n=t.options.debugAll)!=null?n:t.options.debugRows}})}),createTable:e=>{const t=(n,r)=>D(()=>[r(),r().filter(l=>l.getIsVisible()).map(l=>l.id).join("_")],l=>l.filter(s=>s.getIsVisible==null?void 0:s.getIsVisible()),{key:n,debug:()=>{var l;return(l=e.options.debugAll)!=null?l:e.options.debugColumns}});return{getVisibleFlatColumns:t("getVisibleFlatColumns",()=>e.getAllFlatColumns()),getVisibleLeafColumns:t("getVisibleLeafColumns",()=>e.getAllLeafColumns()),getLeftVisibleLeafColumns:t("getLeftVisibleLeafColumns",()=>e.getLeftLeafColumns()),getRightVisibleLeafColumns:t("getRightVisibleLeafColumns",()=>e.getRightLeafColumns()),getCenterVisibleLeafColumns:t("getCenterVisibleLeafColumns",()=>e.getCenterLeafColumns()),setColumnVisibility:n=>e.options.onColumnVisibilityChange==null?void 0:e.options.onColumnVisibilityChange(n),resetColumnVisibility:n=>{var r;e.setColumnVisibility(n?{}:(r=e.initialState.columnVisibility)!=null?r:{})},toggleAllColumnsVisible:n=>{var r;n=(r=n)!=null?r:!e.getIsAllColumnsVisible(),e.setColumnVisibility(e.getAllLeafColumns().reduce((l,s)=>({...l,[s.id]:n||!(s.getCanHide!=null&&s.getCanHide())}),{}))},getIsAllColumnsVisible:()=>!e.getAllLeafColumns().some(n=>!(n.getIsVisible!=null&&n.getIsVisible())),getIsSomeColumnsVisible:()=>e.getAllLeafColumns().some(n=>n.getIsVisible==null?void 0:n.getIsVisible()),getToggleAllColumnsVisibilityHandler:()=>n=>{var r;e.toggleAllColumnsVisible((r=n.target)==null?void 0:r.checked)}}}},_n=[Cl,Xl,Dl,Hl,kl,Yl,Tl,Rl,Ol,jl,wl];function Kl(e){var t;(e.debugAll||e.debugTable)&&console.info("Creating Table Instance...");let n={_features:_n};const r=n._features.reduce((c,o)=>Object.assign(c,o.getDefaultOptions==null?void 0:o.getDefaultOptions(n)),{}),l=c=>n.options.mergeOptions?n.options.mergeOptions(r,c):{...r,...c};let a={...{},...(t=e.initialState)!=null?t:{}};n._features.forEach(c=>{var o;a=(o=c.getInitialState==null?void 0:c.getInitialState(a))!=null?o:a});const m=[];let d=!1;const g={_features:_n,options:{...r,...e},initialState:a,_queue:c=>{m.push(c),d||(d=!0,Promise.resolve().then(()=>{for(;m.length;)m.shift()();d=!1}).catch(o=>setTimeout(()=>{throw o})))},reset:()=>{n.setState(n.initialState)},setOptions:c=>{const o=he(c,n.options);n.options=l(o)},getState:()=>n.options.state,setState:c=>{n.options.onStateChange==null||n.options.onStateChange(c)},_getRowId:(c,o,h)=>{var p;return(p=n.options.getRowId==null?void 0:n.options.getRowId(c,o,h))!=null?p:`${h?[h.id,o].join("."):o}`},getCoreRowModel:()=>(n._getCoreRowModel||(n._getCoreRowModel=n.options.getCoreRowModel(n)),n._getCoreRowModel()),getRowModel:()=>n.getPaginationRowModel(),getRow:c=>{const o=n.getRowModel().rowsById[c];if(!o)throw new Error;return o},_getDefaultColumnDef:D(()=>[n.options.defaultColumn],c=>{var o;return c=(o=c)!=null?o:{},{header:h=>{const p=h.header.column.columnDef;return p.accessorKey?p.accessorKey:p.accessorFn?p.id:null},cell:h=>{var p,x;return(p=(x=h.renderValue())==null||x.toString==null?void 0:x.toString())!=null?p:null},...n._features.reduce((h,p)=>Object.assign(h,p.getDefaultColumnDef==null?void 0:p.getDefaultColumnDef()),{}),...c}},{debug:()=>{var c;return(c=n.options.debugAll)!=null?c:n.options.debugColumns},key:!1}),_getColumnDefs:()=>n.options.columns,getAllColumns:D(()=>[n._getColumnDefs()],c=>{const o=function(h,p,x){return x===void 0&&(x=0),h.map(f=>{const _=Sl(n,f,x,p),v=f;return _.columns=v.columns?o(v.columns,_,x+1):[],_})};return o(c)},{key:!1,debug:()=>{var c;return(c=n.options.debugAll)!=null?c:n.options.debugColumns}}),getAllFlatColumns:D(()=>[n.getAllColumns()],c=>c.flatMap(o=>o.getFlatColumns()),{key:!1,debug:()=>{var c;return(c=n.options.debugAll)!=null?c:n.options.debugColumns}}),_getAllFlatColumnsById:D(()=>[n.getAllFlatColumns()],c=>c.reduce((o,h)=>(o[h.id]=h,o),{}),{key:!1,debug:()=>{var c;return(c=n.options.debugAll)!=null?c:n.options.debugColumns}}),getAllLeafColumns:D(()=>[n.getAllColumns(),n._getOrderColumnsFn()],(c,o)=>{let h=c.flatMap(p=>p.getLeafColumns());return o(h)},{key:!1,debug:()=>{var c;return(c=n.options.debugAll)!=null?c:n.options.debugColumns}}),getColumn:c=>n._getAllFlatColumnsById()[c]};return Object.assign(n,g),n._features.forEach(c=>Object.assign(n,c.createTable==null?void 0:c.createTable(n))),n}function Zl(e,t,n,r){const l=()=>{var a;return(a=s.getValue())!=null?a:e.options.renderFallbackValue},s={id:`${t.id}_${n.id}`,row:t,column:n,getValue:()=>t.getValue(r),renderValue:l,getContext:D(()=>[e,n,t,s],(a,m,d,g)=>({table:a,column:m,row:d,cell:g,getValue:g.getValue,renderValue:g.renderValue}),{key:!1,debug:()=>e.options.debugAll})};return e._features.forEach(a=>{Object.assign(s,a.createCell==null?void 0:a.createCell(s,n,t,e))},{}),s}const Jl=(e,t,n,r,l,s,a)=>{let m={id:t,index:r,original:n,depth:l,parentId:a,_valuesCache:{},_uniqueValuesCache:{},getValue:d=>{if(m._valuesCache.hasOwnProperty(d))return m._valuesCache[d];const g=e.getColumn(d);if(g!=null&&g.accessorFn)return m._valuesCache[d]=g.accessorFn(m.original,r),m._valuesCache[d]},getUniqueValues:d=>{if(m._uniqueValuesCache.hasOwnProperty(d))return m._uniqueValuesCache[d];const g=e.getColumn(d);if(g!=null&&g.accessorFn)return g.columnDef.getUniqueValues?(m._uniqueValuesCache[d]=g.columnDef.getUniqueValues(m.original,r),m._uniqueValuesCache[d]):(m._uniqueValuesCache[d]=[m.getValue(d)],m._uniqueValuesCache[d])},renderValue:d=>{var g;return(g=m.getValue(d))!=null?g:e.options.renderFallbackValue},subRows:s??[],getLeafRows:()=>bl(m.subRows,d=>d.subRows),getParentRow:()=>m.parentId?e.getRow(m.parentId):void 0,getParentRows:()=>{let d=[],g=m;for(;;){const c=g.getParentRow();if(!c)break;d.push(c),g=c}return d.reverse()},getAllCells:D(()=>[e.getAllLeafColumns()],d=>d.map(g=>Zl(e,m,g,g.id)),{key:!1,debug:()=>{var d;return(d=e.options.debugAll)!=null?d:e.options.debugRows}}),_getAllCellsByColumnId:D(()=>[m.getAllCells()],d=>d.reduce((g,c)=>(g[c.column.id]=c,g),{}),{key:"row.getAllCellsByColumnId",debug:()=>{var d;return(d=e.options.debugAll)!=null?d:e.options.debugRows}})};for(let d=0;d<e._features.length;d++){const g=e._features[d];Object.assign(m,g==null||g.createRow==null?void 0:g.createRow(m,e))}return m};function yt(){return{accessor:(e,t)=>typeof e=="function"?{...t,accessorFn:e}:{...t,accessorKey:e},display:e=>e,group:e=>e}}function xt(){return e=>D(()=>[e.options.data],t=>{const n={rows:[],flatRows:[],rowsById:{}},r=function(l,s,a){s===void 0&&(s=0);const m=[];for(let g=0;g<l.length;g++){const c=Jl(e,e._getRowId(l[g],g,a),l[g],g,s,void 0,a==null?void 0:a.id);if(n.flatRows.push(c),n.rowsById[c.id]=c,m.push(c),e.options.getSubRows){var d;c.originalSubRows=e.options.getSubRows(l[g],g),(d=c.originalSubRows)!=null&&d.length&&(c.subRows=r(c.originalSubRows,s+1,c))}}return m};return n.rows=r(t),n},{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugTable},onChange:()=>{e._autoResetPageIndex()}})}function es(){return e=>D(()=>[e.getState().sorting,e.getPreSortedRowModel()],(t,n)=>{if(!n.rows.length||!(t!=null&&t.length))return n;const r=e.getState().sorting,l=[],s=r.filter(d=>{var g;return(g=e.getColumn(d.id))==null?void 0:g.getCanSort()}),a={};s.forEach(d=>{const g=e.getColumn(d.id);g&&(a[d.id]={sortUndefined:g.columnDef.sortUndefined,invertSorting:g.columnDef.invertSorting,sortingFn:g.getSortingFn()})});const m=d=>{const g=[...d];return g.sort((c,o)=>{for(let p=0;p<s.length;p+=1){var h;const x=s[p],f=a[x.id],_=(h=x==null?void 0:x.desc)!=null?h:!1;let v=0;if(f.sortUndefined){const C=c.getValue(x.id),b=o.getValue(x.id),F=C===void 0,E=b===void 0;(F||E)&&(v=F&&E?0:F?f.sortUndefined:-f.sortUndefined)}if(v===0&&(v=f.sortingFn(c,o,x.id)),v!==0)return _&&(v*=-1),f.invertSorting&&(v*=-1),v}return c.index-o.index}),g.forEach(c=>{var o;l.push(c),(o=c.subRows)!=null&&o.length&&(c.subRows=m(c.subRows))}),g};return{rows:m(n.rows),flatRows:l,rowsById:n.rowsById}},{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugTable},onChange:()=>{e._autoResetPageIndex()}})}function ts(){return e=>D(()=>[e.getState().expanded,e.getPreExpandedRowModel(),e.options.paginateExpandedRows],(t,n,r)=>!n.rows.length||t!==!0&&!Object.keys(t??{}).length||!r?n:si(n),{key:!1,debug:()=>{var t;return(t=e.options.debugAll)!=null?t:e.options.debugTable}})}function si(e){const t=[],n=r=>{var l;t.push(r),(l=r.subRows)!=null&&l.length&&r.getIsExpanded()&&r.subRows.forEach(n)};return e.rows.forEach(n),{rows:t,flatRows:e.flatRows,rowsById:e.rowsById}}function ns(e){return t=>D(()=>[t.getState().pagination,t.getPrePaginationRowModel(),t.options.paginateExpandedRows?void 0:t.getState().expanded],(n,r)=>{if(!r.rows.length)return r;const{pageSize:l,pageIndex:s}=n;let{rows:a,flatRows:m,rowsById:d}=r;const g=l*s,c=g+l;a=a.slice(g,c);let o;t.options.paginateExpandedRows?o={rows:a,flatRows:m,rowsById:d}:o=si({rows:a,flatRows:m,rowsById:d}),o.flatRows=[];const h=p=>{o.flatRows.push(p),p.subRows.length&&p.subRows.forEach(h)};return o.rows.forEach(h),o},{key:!1,debug:()=>{var n;return(n=t.options.debugAll)!=null?n:t.options.debugTable}})}/**
 * react-table
 *
 * Copyright (c) TanStack
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function xe(e,t){return e?is(e)?y.createElement(e,t):e:null}function is(e){return rs(e)||typeof e=="function"||ls(e)}function rs(e){return typeof e=="function"&&(()=>{const t=Object.getPrototypeOf(e);return t.prototype&&t.prototype.isReactComponent})()}function ls(e){return typeof e=="object"&&typeof e.$$typeof=="symbol"&&["react.memo","react.forward_ref"].includes(e.$$typeof.description)}function vt(e){const t={state:{},onStateChange:()=>{},renderFallbackValue:null,...e},[n]=y.useState(()=>({current:Kl(t)})),[r,l]=y.useState(()=>n.current.initialState);return n.current.setOptions(s=>({...s,...e,state:{...r,...e.state},onStateChange:a=>{l(a),e.onStateChange==null||e.onStateChange(a)}})),n.current}const ss=[{label:"Missing Item",value:"missing_item"},{label:"Wrong Item",value:"wrong_item"},{label:"Production Failure",value:"production_failure"},{label:"Other",value:"other"}],as=({reasonDetails:e,index:t,isClaim:n=!1,addReasonDetails:r})=>{const{return_reasons:l}=$n(),s=y.useMemo(()=>n?ss:(l==null?void 0:l.map(h=>({label:h.label,value:h.id})))||[],[l,n]),{control:a,register:m,handleSubmit:d,formState:{isDirty:g}}=Me({defaultValues:e}),{pop:c}=Ae(),o=d(h=>{r(t,h),c()});return u(U,{children:[i(V.Content,{children:u("div",{className:"flex flex-col gap-y-base",children:[i("h2",{className:"inter-base-semibold",children:"Reason for Return"}),i(ie,{control:a,name:"reason",render:({field:h})=>i(Bn,{label:"Reason",placeholder:"Choose a return reason",...h,options:s,isClearable:!0})}),i(Un,{label:"Note",placeholder:"Product was damaged during shipping",...m("note")})]})}),i(V.Footer,{children:u("div",{className:"flex w-full items-center justify-end gap-x-xsmall",children:[i(M,{size:"small",variant:"secondary",onClick:c,type:"button",children:"Cancel"}),i(M,{size:"small",variant:"primary",onClick:o,disabled:!g,type:"button",children:"Save and go back"})]})})]})},os=()=>{const{pop:e,push:t}=Ae();return{pushScreen:r=>{t({title:"Select Reason",onBack:()=>e(),view:i(as,{...r})})}}},cs=({row:e,form:t,isClaim:n=!1})=>{var o;const{control:r,path:l,setValue:s,clearErrors:a,formState:{errors:m}}=t,{pushScreen:d}=os(),g=J({control:r,name:l(`items.${e.index}.return_reason_details`)}),c=(h,p)=>{s(l(`items.${h}.return_reason_details`),p),p.reason&&a(l(`items.${h}.return_reason_details`))};return u("div",{className:"grid w-full grid-cols-[74px,1fr,1fr] pb-small",children:[i("span",{}),i("div",{className:"flex items-center",children:i("p",{className:"inter-small-semibold",children:(o=g==null?void 0:g.reason)==null?void 0:o.label})}),i("div",{className:"flex justify-end",children:u("div",{className:"flex flex-col items-end",children:[i(ie,{control:r,name:l(`items.${e.index}.return_reason_details`),render:({field:{ref:h},fieldState:{error:p}})=>i(M,{ref:h,variant:p?"danger":"secondary",size:"small",type:"button",className:"max-w-[120px]",onClick:()=>d({reasonDetails:g,index:e.index,isClaim:n,addReasonDetails:c}),children:u("span",{children:[g!=null&&g.reason?"Edit":"Select"," reason"]})})}),!(g!=null&&g.reason)&&i(ut,{errors:m,name:l(`items.${e.index}.return_reason_details`)})]})})]})},ds=({instance:e,form:t,isClaim:n})=>{const{getRowModel:r,getHeaderGroups:l}=e;return u(k,{children:[i(k.Head,{children:l().map(s=>i(k.HeadRow,{children:s.headers.map(a=>i(k.HeadCell,{className:"inter-small-semibold text-grey-50",style:{width:a.getSize(),maxWidth:a.getSize()},children:xe(a.column.columnDef.header,a.getContext())},a.id))},s.id))}),i(k.Body,{children:r().rows.map(s=>u(y.Fragment,{children:[i(k.Row,{className:H("last-of-type:border-b-0",{"border-b-0":s.getIsExpanded()}),children:s.getVisibleCells().map(a=>i(k.Cell,{style:{width:a.column.getSize(),maxWidth:a.column.getSize()},children:xe(a.column.columnDef.cell,a.getContext())},a.id))}),s.getIsExpanded()&&i(k.Row,{className:H("border-t-0",{"border-b-0":s.index===r().rows.length-1}),children:i(k.Cell,{colSpan:s.getVisibleCells().length,children:i(cs,{row:s,form:t,isClaim:n})})})]},s.id))})]})},Xe=({src:e,className:t,size:n="small"})=>i("div",{className:H("bg-grey-5 flex items-center justify-center overflow-hidden rounded-rounded",{"w-[30px] h-10":n==="small","w-9 h-12":n==="medium","w-[170px] h-[226px]":n==="large"},t),children:e?i("img",{src:e,className:"object-cover object-center flex-1"}):i(Er,{})}),rn=({control:e,name:t,isSelectedPath:n,isSelectable:r=!1,updateQuantity:l,index:s,maxQuantity:a})=>{const m=J({control:e,name:t}),d=J({control:e,name:n,disabled:!n||!r}),g=y.useMemo(()=>r?d&&(a??0)>1:!0,[r,d,a]);return i("div",{className:"flex items-center justify-end",children:g?u("div",{className:"inter-small-regular grid grid-cols-3 gap-x-2xsmall text-grey-50",children:[i(M,{variant:"ghost",size:"small",type:"button",onClick:()=>l(s,-1),disabled:m===1,className:"h-large w-large rounded-base disabled:text-grey-30","aria-label":"Decrease quantity",children:i(Ye,{size:16})}),i("div",{className:"flex items-center justify-center",children:i("p",{"aria-label":"Quantity",children:m})}),i(M,{variant:"ghost",size:"small",type:"button",onClick:()=>l(s,1),disabled:a?m===a:void 0,className:"h-large w-large rounded-base disabled:text-grey-30","aria-label":"Increase quantity",children:i(Ve,{size:16})})]}):i("p",{className:"inter-small-regular text-grey-50",children:m})})},De=yt(),us=({form:e,orderCurrency:t})=>{const{control:n,setValue:r,getValues:l,path:s}=e,a=y.useCallback((c,o)=>{const h=s(`items.${c}.quantity`),p=l(h);r(h,p+o),p+o===0&&r(s(`items.${c}.return`),!1,{shouldDirty:!0})},[l,s,r]),m=J({control:n,name:s("items")}),d=y.useCallback(c=>{m.forEach((o,h)=>{r(s(`items.${h}.return`),c.target.checked,{shouldDirty:!0})})},[m,s,r]);return y.useMemo(()=>[De.display({id:"selection",maxSize:36,header:({table:c})=>i("div",{className:"pl-base pr-large",children:i(oe,{checked:c.getIsAllRowsSelected(),onChange:o=>{c.toggleAllRowsSelected(o.target.checked),c.toggleAllRowsExpanded(o.target.checked),d(o)},indeterminate:c.getIsSomeRowsSelected()})}),cell:({row:{index:c,getToggleSelectedHandler:o,toggleExpanded:h}})=>i(ie,{control:n,name:s(`items.${c}.return`),render:({field:{value:p,onChange:x}})=>i("div",{className:"pl-base pr-large",children:i(oe,{checked:p,onChange:f=>{o()(f),h(f.target.checked),x(f)}})})})}),De.accessor("variant_title",{header:"Product",cell:({getValue:c,row:{original:o}})=>{const h=c();return u("div",{className:"flex items-center gap-x-base py-xsmall",children:[i("div",{children:i(Xe,{src:o.thumbnail})}),u("div",{className:"inter-small-regular",children:[u("div",{className:"flex items-center gap-x-2xsmall",children:[i("p",{children:o.product_title}),h&&u("p",{className:"text-grey-50",children:["(",h,")"]})]}),o.sku&&i("span",{children:i(fe,{value:o.sku,displayValue:o.sku,iconSize:14})})]})]})}}),De.display({id:"quantity",header:()=>i("p",{className:"text-right",children:"Quantity"}),maxSize:50,cell:({row:{index:c,original:{original_quantity:o}}})=>y.createElement(rn,{index:c,maxQuantity:o,isSelectable:!0,control:n,path:s,updateQuantity:a,name:s(`items.${c}.quantity`),isSelectedPath:s(`items.${c}.return`),key:c})}),De.accessor("refundable",{maxSize:80,header:()=>i("p",{className:"text-right",children:"Refundable"}),cell:({getValue:c})=>i("p",{className:"text-right",children:j({amount:c()||0,currency:t})})}),De.display({id:"order_currency",maxSize:20,cell:()=>i("p",{className:"pl-base text-grey-50",children:t.toUpperCase()})})],[n,t,s,d,a])},ms=({form:e,order:t,isClaim:n=!1})=>{const{control:r,path:l,formState:{errors:s}}=e,{fields:a}=gt({control:r,name:l("items"),keyName:"fieldId",shouldUnregister:!0}),m=us({form:e,orderCurrency:t.currency_code}),d=vt({data:a,columns:m,getCoreRowModel:xt(),getExpandedRowModel:ts()});return u("div",{className:"flex flex-col gap-y-base",children:[u("h2",{className:"inter-base-semibold",children:["Items to ",n?"claim":"return"]}),i(ds,{form:e,instance:d,isClaim:n}),i(ut,{errors:s,name:l("items")})]})},gs=({count:e=0,table:t,className:n})=>{const{getState:r,getPageCount:l,getCanNextPage:s,getCanPreviousPage:a,previousPage:m,nextPage:d}=t,{pageIndex:g,pageSize:c}=r().pagination,{from:o,to:h}=y.useMemo(()=>{const p=g*c+1,x=Math.min(e,(g+1)*c);return{from:p,to:x}},[e,g,c]);return u("div",{className:H("inter-small-regular text-grey-50 flex items-center justify-between",n),children:[i("div",{children:i("p",{children:`${o} – ${h} of ${e} results`})}),u("div",{className:"flex items-center gap-x-small",children:[i("p",{children:`${r().pagination.pageIndex+1} of ${l()}`}),u("div",{className:"flex items-center gap-x-2xsmall",children:[i(M,{variant:"ghost",size:"small",className:"w-xlarge h-xlarge disabled:text-grey-40",type:"button",disabled:!a(),onClick:m,children:i(Fi,{size:16})}),i(M,{variant:"ghost",size:"small",className:"w-xlarge h-xlarge disabled:text-grey-40",type:"button",disabled:!s(),onClick:d,children:i(jn,{size:16})})]})]})]})},fs=({instance:e,isLoadingData:t,setSearchTerm:n})=>{const[r,l]=y.useState(void 0),{getHeaderGroups:s,getRowModel:a}=e;return y.useEffect(()=>{n(r)},[r,n]),i(kr,{isLoading:t,children:u(k,{enableSearch:!0,searchPlaceholder:"Search products",searchValue:r,handleSearch:l,children:[i(k.Head,{children:s().map(m=>i(k.HeadRow,{children:m.headers.map(d=>i(k.HeadCell,{className:"inter-small-semibold text-grey-50",style:{width:d.getSize(),maxWidth:d.getSize()},children:xe(d.column.columnDef.header,d.getContext())},d.id))},m.id))}),i(k.Body,{children:a().rows.map(m=>i(k.Row,{className:"last-of-type:border-b-0",children:m.getVisibleCells().map(d=>i(k.Cell,{style:{width:d.column.getSize(),maxWidth:d.column.getSize()},children:xe(d.column.columnDef.cell,d.getContext())},d.id))},m.id))})]})})},Ee=yt(),ps=e=>y.useMemo(()=>[Ee.display({id:"selection",maxSize:36,header:({table:n})=>i("div",{className:"pl-base pr-large",children:i(oe,{checked:n.getIsAllRowsSelected(),onChange:n.getToggleAllRowsSelectedHandler(),indeterminate:n.getIsSomePageRowsSelected()})}),cell:({row:{getIsSelected:n,getIsSomeSelected:r,getToggleSelectedHandler:l,getCanSelect:s}})=>{const a=s();return i("div",{className:"pl-base pr-large",children:a?i(oe,{checked:n(),indeterminate:r(),onChange:l(),disabled:!a}):i(ue,{content:"This variant does not have a price for the region/currency of this order, and cannot be selected.",children:i(oe,{checked:n(),indeterminate:r(),onChange:l(),disabled:!a})})})}}),Ee.accessor("title",{header:({header:{column:{getToggleSortingHandler:n,getIsSorted:r}}})=>u("div",{className:"flex cursor-pointer items-center",onClick:n(),children:[i("p",{className:"select-none",children:"Title"}),i("div",{className:"flex h-large w-large items-center justify-center",onClick:n(),children:i(ur,{size:16,isSorted:r()})})]}),cell:({cell:{getValue:n},row:{original:{product:r,sku:l},getCanSelect:s}})=>{const a=s();return u("div",{className:H("inter-small-regular flex items-center gap-base py-xsmall",{"opacity-50":!a}),children:[i(Xe,{src:r==null?void 0:r.thumbnail}),u("div",{children:[u("p",{children:[r==null?void 0:r.title," ",u("span",{className:"text-grey-50",children:["(",n(),")"]})]}),l&&i("p",{className:"text-grey-50",children:l})]})]})}}),Ee.display({maxSize:80,id:"options",header:()=>i("p",{className:"select-none",children:"Options"}),cell:({row:{original:n}})=>{var r;return i("p",{children:(r=n.options)==null?void 0:r.map(l=>l.value).join(", ")})}}),Ee.accessor("inventory_quantity",{maxSize:20,header:()=>i("p",{className:"select-none text-right",children:"Stock"}),cell:({cell:{getValue:n},row:{getCanSelect:r}})=>{const l=r();return i("p",{className:H("text-right",{"opacity-50":!l}),children:n()})}}),Ee.accessor("calculated_price_incl_tax",{maxSize:80,header:()=>i("p",{className:"text-right",children:"Price"}),cell:({getValue:n,row:{original:{original_price_incl_tax:r}}})=>{const l=n();return u("div",{className:"text-right",children:[r!==l&&i(ue,{content:"The price has been overridden in a price list, that is applicable to this order.",side:"top",children:i("p",{className:"cursor-default text-grey-40 line-through",children:j({amount:r||0,currency:e.currency_code})})}),i("p",{children:j({amount:l||0,currency:e.currency_code})})]})}}),Ee.display({id:"order_currency",maxSize:24,cell:()=>i("p",{className:"pl-base text-grey-50",children:e.currency_code.toUpperCase()})})],[e]),Et=12,hs=({append:e,remove:t,selectedIds:n,order:r})=>{const{pop:l}=Ae(),[{pageIndex:s,pageSize:a},m]=y.useState({pageIndex:0,pageSize:Et}),[d,g]=y.useState([]),c=y.useMemo(()=>s*a,[s,a]),[o,h]=y.useState(void 0),p=Qn(o,500),{variants:x,count:f,isLoading:_}=Mn({limit:Et,offset:c,q:p,region_id:r.region_id,customer_id:r.customer_id},{keepPreviousData:!0}),v=y.useMemo(()=>f?Math.ceil(f/Et):0,[f]),C=y.useMemo(()=>({pageIndex:s,pageSize:a}),[s,a]),b=ps(r),F=$=>{const{currency_code:S,region_id:P}=r,q=$.original.prices.some(A=>A.region_id===P),G=$.original.prices.some(A=>A.currency_code===S);return!!(q||G)},E=vt({columns:b,data:x||[],initialState:{rowSelection:n.reduce(($,S)=>($[S]=!0,$),{})},state:{pagination:C,sorting:d},enableRowSelection:F,onPaginationChange:m,manualPagination:!0,getRowId:$=>$.id,pageCount:v,onSortingChange:g,getSortedRowModel:es(),getCoreRowModel:xt(),getPaginationRowModel:ns()}),{getSelectedRowModel:T}=E,N=()=>{const $=T().rows.map(q=>q.original),S=[];for(const q of n){const G=$.findIndex(A=>A.id===q);G!==-1&&S.push(G)}t(S);const P=$.map(q=>({variant_id:q.id,quantity:1,sku:q.sku,product_title:q.product.title,variant_title:q.title,thumbnail:q.product.thumbnail,in_stock:q.inventory_quantity,price:q.calculated_price_incl_tax,original_price:q.original_price_incl_tax}));e(P),l()};return u(U,{children:[u(V.Content,{children:[i(fs,{instance:E,isLoadingData:_,setSearchTerm:h}),i(gs,{table:E,count:f,className:"mt-11"})]}),i(V.Footer,{children:u("div",{className:"flex w-full items-center justify-end gap-x-xsmall",children:[i(M,{variant:"secondary",size:"small",onClick:l,children:"Go back"}),i(M,{variant:"primary",size:"small",type:"button",onClick:N,children:"Add products"})]})})]})},ys=()=>{const{push:e,pop:t}=Ae();return{pushScreen:r=>{e({title:"Add Product Variants",onBack:()=>t(),view:i(hs,{...r})})}}},xs=({instance:e})=>{const{getHeaderGroups:t,getRowModel:n}=e;return i("div",{children:u(k,{children:[i(k.Head,{children:t().map(r=>i(k.HeadRow,{children:r.headers.map(l=>i(k.HeadCell,{className:"inter-small-semibold text-grey-50",style:{width:l.getSize(),maxWidth:l.getSize()},children:xe(l.column.columnDef.header,l.getContext())},l.id))},r.id))}),i(k.Body,{children:n().rows.map(r=>i(k.Row,{className:"py-small last-of-type:border-b-0",children:r.getVisibleCells().map(l=>i(k.Cell,{className:"py-small",style:{width:l.column.getSize(),maxWidth:l.column.getSize()},children:xe(l.column.columnDef.cell,l.getContext())},l.id))},r.id))})]})})},Oe=yt(),vs=({form:e,orderCurrency:t,removeItem:n})=>{const{control:r,setValue:l,getValues:s,path:a}=e,m=y.useCallback((g,c)=>{const o=a(`items.${g}.quantity`),h=s(o);l(o,h+c)},[s,a,l]);return y.useMemo(()=>[Oe.display({id:"product_display",header:"Product",cell:({row:{original:{thumbnail:g,product_title:c,variant_title:o,sku:h}}})=>u("div",{className:"flex items-center gap-base",children:[i(Xe,{src:g}),u("div",{className:"inter-small-regular",children:[u("div",{className:"flex items-center gap-x-2xsmall",children:[i("p",{children:c}),o&&u("p",{className:"text-grey-50",children:["(",o,")"]})]}),h&&i("span",{children:i(fe,{value:h,displayValue:h,iconSize:14})})]})]})}),Oe.display({id:"quantity",header:()=>i("p",{className:"text-right",children:"Quantity"}),maxSize:50,cell:({row:{index:g,original:{in_stock:c}}})=>y.createElement(rn,{index:g,maxQuantity:c,control:r,updateQuantity:m,name:a(`items.${g}.quantity`),isSelectable:!1,key:g})}),Oe.accessor("price",{maxSize:50,header:()=>i("p",{className:"text-right",children:"Price"}),cell:({getValue:g,row:{original:{original_price:c}}})=>{const o=g();return u("div",{className:"text-right",children:[c!==o&&i(ue,{content:"The price has been overridden in a price list, that is applicable to this order.",side:"top",children:i("p",{className:"cursor-default text-grey-40 line-through",children:j({amount:c,currency:t})})}),i("p",{children:j({amount:o,currency:t})})]})}}),Oe.display({id:"order_currency",maxSize:20,cell:()=>i("p",{className:"pl-base text-grey-50",children:t.toUpperCase()})}),Oe.display({id:"remove",maxSize:28,cell:({row:{index:g}})=>i("div",{className:"flex items-center justify-end",children:i(M,{variant:"ghost",size:"small",className:"h-xlarge w-xlarge text-grey-40",type:"button",onClick:()=>n(g),children:i(ce,{size:20})})})})],[r,t,a,n,m])},_s=({form:e,order:t})=>{const{control:n,path:r}=e,{fields:l,append:s,remove:a}=gt({control:n,name:r("items"),keyName:"fieldId"}),m=vs({orderCurrency:t.currency_code,form:e,removeItem:a}),d=vt({data:l,columns:m,getCoreRowModel:xt()}),{pushScreen:g}=ys();return u("div",{className:H({"flex flex-col gap-y-base":l.length>0,"flex items-center justify-between":!l.length}),children:[i("div",{className:"flex w-full items-center",children:i("h2",{className:"inter-base-semibold",children:"Items to send"})}),l.length>0&&i(xs,{instance:d}),i("div",{className:"flex w-full items-center justify-end",children:i(M,{variant:"secondary",size:"small",type:"button",onClick:()=>g({append:s,remove:a,selectedIds:l.map(c=>c.variant_id),order:t}),children:"Add products"})})]})},ai=({name:e,label:t,currencyCode:n,errors:r,value:l,onChange:s})=>{const{symbol_native:a,decimal_digits:m}=zr[n.toUpperCase()],d=p=>`${p/10**m}`,[g,c]=y.useState(l!=null?d(l):void 0);y.useEffect(()=>{l&&c(d(l))},[l,m]);const o=(p,x)=>{if(x){const f=Math.round(x*10**m);s(f)}else s(0);c(p)},h=10**-m;return u("div",{children:[t&&i(yr,{label:t,className:"mb-xsmall"}),u("div",{className:H("w-full flex items-center bg-grey-5 border border-gray-20 px-base py-xsmall rounded-rounded h-10 focus-within:shadow-input focus-within:border-violet-60 inter-base-regular",{"border-rose-50":r&&e&&r[e]}),children:[i("div",{className:"inter-base-regular text-grey-40",children:i("p",{children:n.toUpperCase()})}),u("div",{className:"flex items-center gap-2xsmall w-full",children:[i(Pr,{step:h,value:g,onValueChange:(p,x,f)=>o(p,f==null?void 0:f.float),allowNegativeValue:!1,placeholder:"-",decimalScale:m,className:"bg-transparent outline-none outline-0 w-full remove-number-spinner leading-base text-grey-90 font-normal caret-violet-60 placeholder-grey-40 text-right"}),i("div",{className:"flex items-center min-w-[16px] ml-2xsmall",children:i("p",{className:"text-grey-40 w-full text-right",children:a})})]})]}),i(ut,{name:e,errors:r})]})},oi=({form:e,initialValue:t=0,order:n})=>{const{control:r,path:l,setValue:s,clearErrors:a,formState:{errors:m}}=e,d=J({control:r,name:l("amount")});return u("div",{className:"grid grid-cols-[40px_1fr] justify-end gap-x-xsmall",children:[i("div",{className:"flex flex-shrink justify-end",children:d!==void 0?i(M,{variant:"secondary",size:"small",type:"button",className:"h-10 w-10","aria-label":"Cancel editing refund amount",onClick:()=>{s(l("amount"),void 0),a(l("amount"))},children:i(Ai,{size:16,className:"text-grey-40"})}):i(M,{variant:"ghost",size:"small",type:"button",onClick:()=>{s(l("amount"),t)},"aria-label":"Edit refund amount",className:"h-10 w-10",children:i(Zt,{size:16,className:"text-grey-40"})})}),i("div",{children:d!==void 0?i(ie,{control:r,name:l("amount"),rules:{min:{value:0,message:"Refund amount cannot be negative"},required:!0,validate:o=>{if(o===void 0||!(o>=0))return"The refund amount must be at least 0"}},render:({field:{value:o,onChange:h,name:p}})=>i(ai,{currencyCode:n.currency_code,onChange:h,name:p,value:o,errors:m})}):i("div",{className:"flex h-10 items-center",children:i("p",{children:j({amount:t,currency:n.currency_code})})})})]})},Gt=({thumbnail:e,productTitle:t,variantTitle:n,sku:r,quantity:l,price:s,total:a,currencyCode:m,isFree:d=!1})=>u("div",{className:"flex items-center justify-between",children:[u("div",{className:"flex items-center gap-x-base",children:[i("div",{children:i(Xe,{src:e})}),u("div",{className:"inter-small-regular",children:[u("div",{className:"flex items-center gap-x-2xsmall",children:[i("p",{children:t}),n&&u("p",{className:"text-grey-50",children:["(",n,")"]})]}),r&&i("span",{children:i(fe,{value:r,displayValue:r,iconSize:14})})]})]}),u("div",{className:"inter-small-regular flex items-center gap-x-base",children:[i("p",{className:"text-grey-40",children:j({amount:s,currency:m})}),u("p",{className:"text-grey-40",children:["x ",l]}),i("p",{className:H({"line-through":d}),children:j({amount:a,currency:m})})]})]}),Bt=({type:e,title:t,price:n,currencyCode:r})=>u("div",{className:"flex items-center justify-between",children:[u("div",{className:"flex items-center gap-x-base",children:[i("div",{className:" w-[30px] h-10 rounded-rounded flex items-center justify-center text-grey-50",children:i(Xn,{size:16})}),u("div",{className:"inter-small-regular",children:[i("p",{children:e==="return"?"Return shipping":"Replacement shipping"}),i("p",{className:"text-grey-50",children:t})]})]}),i("p",{className:"inter-small-regular",children:n?j({amount:n,currency:r}):"Free"})]}),bs=({form:e,order:t})=>{const{control:n}=e,r=J({control:n,name:"return_items.items",defaultValue:[]}),l=y.useMemo(()=>r.filter(c=>c.return),[r]),s=J({control:n,name:"return_shipping"}),a=J({control:n,name:"additional_items.items",defaultValue:[]}),m=J({control:n,name:"replacement_shipping"}),d=J({control:n,name:"claim_type.type"}),g=y.useMemo(()=>{const c=l.reduce((o,h)=>o+h.total/h.original_quantity*h.quantity,0);return{total:c<0?j({amount:0,currency:t.currency_code}):j({amount:c,currency:t.currency_code}),totalAsNumber:c<0?0:c}},[l,t.currency_code]);return(l==null?void 0:l.length)>0||(a==null?void 0:a.length)>0?u("div",{className:"inter-base-regular",children:[u("div",{className:"flex flex-col gap-y-base border-y border-grey-20 py-large",children:[l.length>0&&u("div",{children:[i("p",{className:"inter-base-semibold mb-small",children:"Claimed items"}),u("div",{className:"flex flex-col gap-y-xsmall",children:[l.map((c,o)=>i(Gt,{currencyCode:t.currency_code,productTitle:c.product_title,quantity:c.quantity,sku:c.sku,price:c.total/c.original_quantity,total:c.total/c.original_quantity*c.quantity,variantTitle:c.variant_title,thumbnail:c.thumbnail},o)),s.option&&i(Bt,{currencyCode:t.currency_code,price:s.price,title:s.option.label,type:"return"})]})]}),d!=="refund"&&a.length>0&&u("div",{children:[u("div",{className:"mb-small flex items-center gap-x-2xsmall",children:[i("p",{className:"inter-base-semibold",children:"Replacement items"}),i(me,{type:"warning",content:"The customer will receive a full refund for the claimed items, as the cost of replacement items and shipping will not be deducted. Alternatively, you can choose to set a custom refund amount when you receive the returned items or create an exchange instead."})]}),u("div",{className:"flex flex-col gap-y-xsmall",children:[a.map((c,o)=>i(Gt,{currencyCode:t.currency_code,productTitle:c.product_title,quantity:c.quantity,sku:c.sku,price:c.price,total:c.price*c.quantity,variantTitle:c.variant_title,thumbnail:c.thumbnail,isFree:!0},o)),(m==null?void 0:m.option)&&i(Bt,{currencyCode:t.currency_code,price:m.price,title:m.option.label,type:"replacement"})]})]})]}),i("div",{className:"pt-large",children:u("div",{className:"inter-large-semibold flex items-center justify-between","data-testid":"refund-amount-container",children:[u("div",{className:"flex items-center gap-x-2xsmall",children:[i("p",{className:"inter-base-semibold",children:"Refund amount"}),i(me,{type:"info",content:d==="replace"&&s.option?"The customer will be refunded once the returned items are received":"The customer will be refunded immediately"})]}),i("div",{className:"flex items-center",children:d==="refund"?i(oi,{form:ae(e,"refund_amount"),order:t,initialValue:g.totalAsNumber}):i("p",{children:g.total})})]})})]}):null},Ss=({form:e,type:t})=>{const{control:n,path:r}=e,l={return:"return",swap:"exchange",claim:"claim"}[t];return i(ie,{control:n,name:r("send_notification"),render:({field:{value:s,onChange:a}})=>u("div",{className:"flex items-center",children:[i("div",{className:"mr-xsmall",children:i(oe,{checked:s,onChange:a})}),i("p",{className:"inter-small-semibold mr-1.5",children:"Send notifications"}),i(me,{type:"info",content:`If unchecked the customer will not receive communication about this ${l}.`})]})})},Cs=({form:e,order:t})=>{const{resetField:n,path:r,formState:{errors:l},control:s}=e,{region:a}=En(t.region_id),m=J({control:s,name:r()}),d=y.useMemo(()=>["first_name","last_name","address_1","city","country_code","postal_code","country_code"].every(x=>!!m[x]&&!l[r(x)]),[m,l,r]),g=y.useMemo(()=>(a==null?void 0:a.countries.map(h=>({value:h.iso_2,label:h.display_name})))||[],[a]),{pop:c}=Ae(),o=()=>{n(r()),c()};return u(U,{children:[i(V.Content,{children:i(Sr,{form:e,type:Dt.SHIPPING,countryOptions:g,required:!0})}),i(V.Footer,{children:u("div",{className:"flex w-full items-center justify-end gap-x-xsmall",children:[i(M,{variant:"secondary",size:"small",type:"button",onClick:o,children:"Cancel"}),i(M,{variant:"primary",size:"small",disabled:!d,type:"button",onClick:c,children:"Save and go back"})]})})]})},ws=()=>{const{pop:e,push:t}=Ae();return{pushScreen:r=>{t({title:"Shipping Information",onBack:()=>e(),view:i(Cs,{...r})})}}},Ns=({form:e,order:t})=>{const{control:n,path:r}=e,{pushScreen:l}=ws(),{address_1:s,address_2:a,city:m,country_code:d,company:g,postal_code:c,province:o}=J({control:n,name:r()});return u("div",{children:[i("h2",{className:"inter-base-semibold",children:"Shipping address"}),u("div",{className:"flex items-center justify-between",children:[u("div",{className:"inter-small-regular text-grey-50",children:[i("p",{children:`${s}${a?`, ${a}`:""}`}),u("p",{children:[`${g?`${g}, `:""}`,`${c} ${m}`]}),u("p",{children:[`${o?`${o}, `:""}`,d==null?void 0:d.label]})]}),i(M,{variant:"secondary",size:"small",type:"button",onClick:()=>l({form:e,order:t}),children:"Ship to a different address"})]})]})},bn=({form:e,order:t,isReturn:n=!1,isClaim:r=!1,required:l=!1})=>{const{control:s,path:a,setValue:m,formState:{errors:d}}=e,{shipping_options:g}=Ut({region_id:t.region_id,is_return:n}),c=y.useMemo(()=>(g==null?void 0:g.map(f=>{var _;return{label:f.name,value:{id:f.id,taxRate:((_=f.tax_rates)==null?void 0:_.reduce((v,C)=>v+(C.rate||0)/100,0))||0},suffix:i("span",{className:H({"line-through":r&&f.amount!==0}),children:j({amount:f.price_incl_tax||f.amount||0,currency:t.currency_code})})}}))||[],[r,t.currency_code,g]),o=J({control:s,name:a("option")}),h=J({control:s,name:a("price")}),p=()=>{if(o){const f=g==null?void 0:g.find(_=>_.id===o.value.id);m(a("price"),Math.round(((f==null?void 0:f.amount)||0)*(1+o.value.taxRate)))}},x=()=>{m(a("price"),void 0)};return u("div",{className:"flex flex-col gap-y-base",children:[u("div",{className:"flex flex-col",children:[u("h2",{className:"inter-base-semibold",children:["Shipping for ",n?"return":"replacement"," items"]}),i(Rs,{isClaim:r,isReturn:n})]}),i(ie,{control:s,name:a("option"),rules:{required:l?"Shipping method is required":!1},render:({field:{value:f,onChange:_,onBlur:v,ref:C,name:b}})=>i(Bn,{ref:C,placeholder:"Choose shipping method",label:"Shipping method",name:b,options:c,value:f,onChange:_,onBlur:v,isClearable:!0,errors:d})}),o&&!r&&i("div",{className:"flex w-full items-center justify-end",children:h!==void 0?i("div",{className:"flex w-full items-center justify-end",children:u("div",{className:"grid grid-cols-[1fr_40px] gap-x-xsmall",children:[i(ie,{control:s,name:a("price"),render:({field:{value:f,onChange:_}})=>i(Vr,{currencyCode:t.currency_code,onChange:_,amount:f,name:a("price"),errors:d})}),i(M,{variant:"secondary",size:"small",className:"flex h-10 w-10 items-center justify-center",type:"button",onClick:x,children:i(ce,{size:20,className:"text-grey-40"})})]})}):i(M,{size:"small",variant:"secondary",type:"button",className:"h-10",onClick:p,children:"Add custom price"})})]})},Rs=({isClaim:e=!1,isReturn:t=!1})=>{const n=y.useMemo(()=>{if(e&&t)return"Return shipping for items claimed by the customer is complimentary.";if(!t)return"Shipping for replacement items is complimentary."},[e,t]);return n?i("p",{className:"inter-small-regular text-grey-50",children:n}):null},ks=e=>e.shipping_address?Object.keys(e.shipping_address).map(n=>n).reduce((n,r)=>{if(r==="country_code"){const l=e.shipping_address.country_code?Wt[e.shipping_address.country_code.toUpperCase()]:"";n[r]={value:e.shipping_address[r],label:l}}else n[r]=e.shipping_address[r]||void 0;return n},{}):{address_1:void 0,address_2:void 0,city:void 0,company:void 0,country_code:void 0,first_name:void 0,last_name:void 0,phone:void 0,postal_code:void 0,province:void 0},Fs=()=>({send_notification:!0}),As=()=>({items:[]}),Is=()=>({type:"refund"}),Sn=()=>({option:void 0,price:void 0}),ci=e=>{var n;const t={items:[]};return(n=e.returnable_items)!=null&&n.length&&e.returnable_items.forEach(r=>{const l=r.quantity-(r.returned_quantity||0);t.items.push({item_id:r.id,thumbnail:r.thumbnail,refundable:r.refundable||0,product_title:r.variant.product.title,sku:r.variant.sku,variant_title:r.variant.title,quantity:l,original_quantity:r.quantity,total:r.total||0,return_reason_details:{note:void 0,reason:void 0},return:!1})}),t},$s=(e,t)=>{var l;const n=ci(e);return{items:(l=n==null?void 0:n.items)==null?void 0:l.reduce((s,a)=>{if(!a)return s;const m=t.items.findIndex(d=>d.item_id===a.item_id);if(a.item_id&&m>-1){const d=t.items[m],g=d.requested_quantity-d.received_quantity,c=(a.total||0)/a.original_quantity;s.push({...a,price:c,quantity:g,original_quantity:g})}return s},[])}},Cn=(e,t)=>({receive_items:$s(e,t)}),wn=e=>({claim_type:Is(),additional_items:As(),notification:Fs(),return_items:ci(e),shipping_address:ks(e),return_shipping:Sn(),replacement_shipping:Sn()}),Ms=({order:e,onClose:t})=>{const n=Ae(),{mutate:r,isLoading:l}=Ii(e.id),s=Me({defaultValues:wn(e)}),{handleSubmit:a,reset:m,formState:{isDirty:d},setError:g}=s,c=X(),o=ft();y.useEffect(()=>{m(wn(e))},[e,m]);const h=()=>{n.reset(),t()},p=async()=>{let v=!0;d&&(v=await o({heading:"Are you sure you want to close?",text:"You have unsaved changes, are you sure you want to close?"})),v&&h()},x=a(v=>{var $;const C=v.claim_type.type,b=v.return_shipping,F=($=v.refund_amount)==null?void 0:$.amount,E=C==="replace"&&v.replacement_shipping.option?{option_id:v.replacement_shipping.option.value.id,price:0}:void 0,T=v.return_items.items.filter(S=>S.return).map(S=>{var P;return{item_id:S.item_id,quantity:S.quantity,note:S.return_reason_details.note||void 0,reason:(P=S.return_reason_details.reason)==null?void 0:P.value}}),N=T.filter(S=>!S.reason);if(N.length>0){N.forEach(S=>{const P=T.findIndex(q=>q.item_id===S.item_id);g(`return_items.items.${P}.return_reason_details`,{type:"manual",message:"Please select a reason"},{shouldFocus:!0})});return}if(C==="replace"&&!v.replacement_shipping.option){g("replacement_shipping.option",{type:"manual",message:"A shipping method for replacement items is required"},{shouldFocus:!0});return}r({claim_items:T,type:C,return_shipping:b.option?{option_id:b.option.value.id,price:0}:void 0,additional_items:C==="replace"?v.additional_items.items.map(S=>({quantity:S.quantity,variant_id:S.variant_id})):void 0,no_notification:!v.notification.send_notification,refund_amount:C==="refund"&&F!==void 0?F:void 0,shipping_address:C==="replace"?{address_1:v.shipping_address.address_1,address_2:v.shipping_address.address_2||void 0,city:v.shipping_address.city,country_code:v.shipping_address.country_code.value,company:v.shipping_address.company||void 0,first_name:v.shipping_address.first_name,last_name:v.shipping_address.last_name,phone:v.shipping_address.phone||void 0,postal_code:v.shipping_address.postal_code,province:v.shipping_address.province||void 0}:void 0,shipping_methods:E?[E]:void 0},{onSuccess:()=>{c("Successfully created claim",`A claim for order #${e.display_id} was successfully created`,"success"),h()},onError:S=>{c("Error creating claim",W(S),"error")}})}),f=J({control:s.control,name:"claim_type.type"}),_=J({control:s.control,name:"return_items.items"});return i(ot,{open:!0,handleClose:p,context:n,isLargeModal:!0,children:u(V.Body,{children:[i(V.Header,{handleClose:p,children:i("h1",{className:"inter-xlarge-semibold",children:"Create Claim"})}),u("form",{onSubmit:x,"data-testid":"register-claim-form",children:[i(V.Content,{children:u("div",{className:"flex flex-col gap-y-xlarge",children:[i(ms,{form:ae(s,"return_items"),order:e,isClaim:!0}),i(bn,{form:ae(s,"return_shipping"),order:e,isReturn:!0,isClaim:!0}),i(vl,{form:ae(s,"claim_type")}),f==="replace"&&u(U,{children:[i(_s,{form:ae(s,"additional_items"),order:e}),i(Ns,{form:ae(s,"shipping_address"),order:e}),i(bn,{form:ae(s,"replacement_shipping"),isClaim:!0,order:e})]}),i(bs,{form:s,order:e})]})}),i(V.Footer,{children:u("div",{className:"flex w-full items-center justify-between",children:[i(Ss,{form:ae(s,"notification"),type:"claim"}),u("div",{className:"flex items-center justify-end gap-x-xsmall",children:[i(M,{variant:"secondary",size:"small",type:"button",onClick:p,children:"Cancel"}),i(M,{variant:"primary",size:"small",disabled:!d||l||(_==null?void 0:_.length)<1,children:"Submit and close"})]})]})})]})]})})},di=({useCustomShippingPrice:e,inclTax:t,shippingPrice:n,currencyCode:r,updateShippingPrice:l,setUseCustomShippingPrice:s})=>e?u("div",{className:"flex items-end mt-4 gap-x-base w-full",children:[i(ai,{label:`Shipping price (${t?"incl. tax":"excl. tax"})`,currencyCode:r,onChange:a=>l(a??0),value:n}),i(M,{onClick:()=>s(!1),className:"w-10 h-10 text-grey-40",variant:"ghost",size:"small",children:i(ce,{size:20})})]}):i("div",{className:"flex w-full mt-4 justify-end",children:i(M,{onClick:()=>s(!0),variant:"ghost",className:"border border-grey-20",size:"small",children:"Add custom price"})}),Es=({onSubmit:e,reason:t,existingNote:n,customReturnOptions:r=void 0,addImage:l,images:s})=>{const{pop:a}=y.useContext(Ie),{return_reasons:m}=$n(),[d,g]=y.useState(n||""),[c,o]=y.useState([]),[h,p]=y.useState(t?{value:t,label:t.label}:null),x=C=>{o(b=>[...b,...C])},f=C=>{const b=[...c];b.splice(b.indexOf(C),1),o(b)},_=C=>{Jt.uploads.delete(C)},v=C=>{g(C.target.value)};return u(U,{children:[i(V.Content,{children:u("div",{className:"h-full",children:[i("h2",{className:"inter-base-semibold mb-4",children:"Reason for Return"}),i(pt,{label:"Reason",value:h,onChange:p,options:r||(m==null?void 0:m.map(C=>({value:C,label:C.label})))||[]}),i(ze,{label:"Note",value:d,className:"my-4",onChange:C=>v(C)}),l&&u("div",{children:[s&&s.map(C=>i(Nn,{url:C,name:C.split("//").pop(),size:void 0,onDelete:()=>_(C)})),c.map(C=>i(Nn,{url:window.URL.createObjectURL(C),name:C.name,size:(C.size/1e3).toFixed(2),onDelete:()=>f(C)})),i("div",{className:"h-20",children:i(Tr,{onFileChosen:x,filetypes:["image/png","image/jpeg"]})})]})]})}),i(V.Footer,{children:u("div",{className:"flex w-full justify-end gap-x-xsmall",children:[i(M,{variant:"ghost",size:"small",className:"w-[112px]",onClick:()=>a(),children:"Back"}),i(M,{variant:"primary",className:"w-[112px]",size:"small",disabled:typeof h>"u",onClick:()=>{e(h,d,c),a()},children:"Add"})]})})]})},Nn=({url:e,onDelete:t,name:n,size:r})=>u("div",{className:"flex items-center w-full justify-between my-8",children:[u("div",{className:"flex items-center",children:[i("div",{className:"w-20 h-20 bg-voilet-60",children:i("img",{className:"object-cover rounded-rounded w-full h-full",src:e})}),u("div",{className:"inter-small-regular ml-8 flex flex-col",children:[n,r&&u("span",{className:"text-grey-50",children:[r," KB"]})]})]}),i(M,{variant:"ghost",size:"small",className:"w-8 h-8 text-grey-40",onClick:t,children:i(ce,{size:20})})]}),Ps=(e,t)=>{const{swap_id:n,claim_order_id:r}=e,l=(s,a)=>s.filter(m=>m.id==a&&m.canceled_at).length>0;return n?l(t.swaps,n):r?l(t.claims,r):!1},ui=({order:e,allItems:t,toReturn:n,customReturnOptions:r=void 0,imagesOnReturns:l=!1,setToReturn:s,isSwapOrClaim:a=!1})=>{const{push:m,pop:d}=y.useContext(Ie),g=(p,x)=>{var _;if(x.quantity-x.returned_quantity===n[x.id].quantity&&p>0||n[x.id].quantity===1&&p<0)return;const f={...n,[x.id]:{...n[x.id],quantity:(((_=n[x.id])==null?void 0:_.quantity)||0)+p}};s(f)},c=p=>{const x=p.id,f={...n};x in n?delete f[x]:f[x]={images:l?[]:null,reason:null,note:"",quantity:p.quantity-p.returned_quantity},s(f)},o=async p=>Jt.uploads.create(p).then(({data:x})=>x.uploads.map(({url:f})=>f)),h=(p,x,f,_)=>{let v={};l&&(f!=null&&f.length)?o(f).then(C=>{v={...n,[_]:{...n[_],reason:p,note:x,images:[...n[_].images||[],...C]}},s(v)}):(v={...n,[_]:{...n[_],reason:p,note:x}},s(v))};return u(k,{children:[i(k.Head,{className:"border-none",children:u(k.HeadRow,{className:"text-grey-50 inter-small-semibold",children:[i(k.HeadCell,{colSpan:2,children:"Product Details"}),i(k.HeadCell,{className:"text-right pr-8",children:"Quantity"}),i(k.HeadCell,{className:"text-right",children:"Refundable"}),i(k.HeadCell,{})]})}),i(k.Body,{children:t.map(p=>{var f,_,v,C,b,F,E,T,N,$,S;if(p.returned_quantity===p.quantity||Ps(p,e))return;const x=p.id in n;return u(y.Fragment,{children:[u(k.Row,{className:H("border-b-grey-0 hover:bg-grey-0"),children:[i(k.Cell,{children:u("div",{className:"items-center ml-1 h-full flex",children:[i("div",{onClick:()=>c(p),className:`mr-4 w-5 h-5 flex justify-center text-grey-0 border-grey-30 border cursor-pointer rounded-base ${x&&"bg-violet-60"}`,children:i("span",{className:"self-center",children:x&&i($e,{size:16})})}),i("input",{className:"hidden",checked:x,tabIndex:-1,onChange:()=>c(p),type:"checkbox"})]})}),i(k.Cell,{children:u("div",{className:"min-w-[240px] flex py-2",children:[i("div",{className:"w-[30px] h-[40px] ",children:i("img",{className:"h-full w-full object-cover rounded",src:p.thumbnail})}),u("div",{className:"inter-small-regular text-grey-50 flex flex-col ml-4",children:[i("span",{children:i("span",{className:"text-grey-90",children:p.title})}),u("div",{className:"flex gap-4",children:[((f=p==null?void 0:p.variant)==null?void 0:f.title)&&i("span",{children:p.variant.title}),((_=p==null?void 0:p.variant)==null?void 0:_.sku)&&i(fe,{value:p.variant.sku,iconSize:14})]})]})]})}),i(k.Cell,{className:"text-right w-32 pr-8",children:p.id in n?u("div",{className:"flex w-full text-right justify-end text-grey-50 ",children:[i("span",{onClick:()=>g(-1,p),className:"w-5 h-5 flex items-center justify-center rounded cursor-pointer hover:bg-grey-20 mr-2",children:i(Ye,{size:16})}),i("span",{children:n[p.id].quantity||""}),i("span",{onClick:()=>g(1,p),className:H("w-5 h-5 flex items-center justify-center rounded cursor-pointer hover:bg-grey-20 ml-2"),children:i(Ve,{size:16})})]}):i("span",{className:"text-grey-40",children:p.quantity-p.returned_quantity})}),i(k.Cell,{className:"text-right",children:j({currency:e.currency_code,amount:p.refundable||0})}),i(k.Cell,{className:"text-right text-grey-40 pr-1",children:e.currency_code.toUpperCase()})]}),x&&!a&&u(k.Row,{className:"last:border-b-0 hover:bg-grey-0",children:[i(k.Cell,{}),i(k.Cell,{colSpan:2,children:i("div",{className:"max-w-[470px] truncate",children:((v=n[p.id])==null?void 0:v.reason)&&u("span",{className:"inter-small-regular text-grey-40",children:[i("span",{className:"text-grey-80 mr-1",children:i("span",{className:"inter-small-semibold mr-1",children:(C=n[p.id])==null?void 0:C.reason.label})}),((b=n[p.id])==null?void 0:b.note)||"",i("span",{className:"ml-2",children:((E=(F=n[p.id])==null?void 0:F.images)==null?void 0:E.length)>0&&u(U,{children:["(",(N=(T=n[p.id])==null?void 0:T.images)==null?void 0:N.length," image"," ",((S=($=n[p.id])==null?void 0:$.images)==null?void 0:S.length)>1?"s":"",")"]})})]})})}),i(k.Cell,{colSpan:2,children:i("div",{className:"flex w-full justify-end mb-small",children:i(M,{onClick:()=>{var P,q;return m(zs(d,(P=n[p.id])==null?void 0:P.reason,(q=n[p.id])==null?void 0:q.note,r,l,(G,A,I)=>h(G,A,I,p.id)))},variant:"ghost",size:"small",className:"border border-grey-20",children:"Select Reason"})})})]})]},p.id)})})]})},zs=(e,t,n,r,l,s)=>({title:"Return Reasons",onBack:()=>e(),view:i(Es,{reason:t,existingNote:n,customReturnOptions:r,addImage:l,onSubmit:s})}),mi=(e,t)=>{let n=e.items.reduce((l,s)=>l.set(s.id,{...s}),new Map),r=[];if(e.claims&&e.claims.length)for(const l of e.claims)l.claim_items=l.claim_items??[],r=[...r,...l.claim_items],!(l.fulfillment_status==="not_fulfilled"&&l.payment_status==="na")&&l.additional_items&&l.additional_items.length&&(n=l.additional_items.filter(s=>s.shipped_quantity||s.shipped_quantity===s.fulfilled_quantity).reduce((s,a)=>s.set(a.id,{...a}),n));if(!t&&e.swaps&&e.swaps.length)for(const l of e.swaps)n=l.additional_items.reduce((s,a)=>s.set(a.id,{...a}),n);for(const l of r){const s=n.get(l.item_id);s&&(s.quantity=s.quantity-l.quantity,s.quantity!==0?n.set(s.id,s):n.delete(s.id))}return[...n.values()]},Vs=({order:e,onDismiss:t})=>{const n=y.useContext(Ie),[r,l]=y.useState(!1),[s,a]=y.useState(!1),[m,d]=y.useState(0),[g,c]=y.useState(0),[o,h]=y.useState({}),[p,x]=y.useState(!1),[f,_]=y.useState(e.no_notification),[v,C]=y.useState(),[b,F]=y.useState(null),[E,T]=y.useState([]),N=X(),$=$i(e.id);y.useEffect(()=>{e&&T(mi(e,!1))},[e]);const{isLoading:S,shipping_options:P}=Ut({region_id:e.region_id,is_return:!0});y.useEffect(()=>{const z=Object.keys(o).map(O=>E.find(B=>B.id===O)).filter(O=>typeof O<"u").reduce((O,B)=>{const Y=(B.refundable||0)/(B.quantity-B.returned_quantity);return O+Y*o[B.id].quantity},0)-(v||0);d(z),c(z)},[o,v]);const q=async()=>{const R={items:Object.entries(o).map(([z,O])=>{var L;const B={reason_id:(L=O.reason)==null?void 0:L.value.id,...O};delete B.reason;const Y=qr(B);return{item_id:z,...Y}}),refund:Math.round(g),no_notification:f!==e.no_notification?f:void 0};if(b){const z=b.tax_rates.reduce((O,B)=>O+B.rate/100,0);R.return_shipping={option_id:b.value,price:v?Math.round(v/(1+z)):0}}return l(!0),$.mutateAsync(R).then(()=>t()).then(()=>N("Success","Successfully returned order","success")).catch(z=>N("Error",W(z),"error")).finally(()=>l(!1))},G=w=>{w<e.refundable_amount&&w>=0&&c(w)},A=w=>{F(w);const R=P==null?void 0:P.find(z=>w.value===z.id);R&&C(R.price_incl_tax)};y.useEffect(()=>{if(!p&&b){const w=P==null?void 0:P.find(R=>b.value===R.id);w&&C(w.price_incl_tax)}},[p,b]);const I=w=>{w>=0&&C(w)};return i(ot,{context:n,handleClose:t,children:u(V.Body,{children:[i(V.Header,{handleClose:t,children:i("h2",{className:"inter-xlarge-semibold",children:"Request Return"})}),u(V.Content,{children:[u("div",{className:"mb-7",children:[i("h3",{className:"inter-base-semibold",children:"Items to return"}),i(ui,{order:e,allItems:E,toReturn:o,setToReturn:w=>h(w)})]}),u("div",{children:[i("h3",{className:"inter-base-semibold ",children:"Shipping"}),S?i("div",{className:"flex justify-center",children:i(Be,{size:"medium",variant:"secondary"})}):i(pt,{label:"Shipping Method",className:"mt-2",placeholder:"Add a shipping method",value:b,onChange:A,options:(P==null?void 0:P.map(w=>({label:w.name,value:w.id,tax_rates:w.tax_rates})))||[]}),b&&i(di,{inclTax:!0,useCustomShippingPrice:p,shippingPrice:v,currencyCode:e.currency_code,updateShippingPrice:I,setUseCustomShippingPrice:x})]}),m>=0&&u("div",{className:"mt-10",children:[!p&&b&&u("div",{className:"inter-small-regular mb-4 flex justify-between",children:[i("span",{children:"Shipping"}),u("div",{children:[cn(e.currency_code,v||0)," ",i("span",{className:"ml-3 text-grey-40",children:e.currency_code.toUpperCase()})]})]}),u("div",{className:"inter-base-semibold flex w-full justify-between",children:[i("span",{children:"Total Refund"}),i("div",{className:"flex items-center",children:!s&&u(U,{children:[u("span",{className:"mr-2 cursor-pointer text-grey-40",onClick:()=>a(!0),children:[i(Zt,{size:20})," "]}),`${cn(e.currency_code,g)} ${e.currency_code.toUpperCase()}`]})})]}),s&&i(it.Root,{className:"mt-2",size:"small",currentCurrency:e.currency_code,readOnly:!0,children:i(it.Amount,{label:"Amount",amount:g,onChange:G})})]})]}),i(V.Footer,{children:u("div",{className:"flex w-full justify-between",children:[u("div",{className:"flex h-full cursor-pointer items-center",onClick:()=>_(!f),children:[i("div",{className:`flex h-5 w-5 justify-center rounded-base border border-grey-30 text-grey-0 ${!f&&"bg-violet-60"}`,children:i("span",{className:"self-center",children:!f&&i($e,{size:16})})}),i("input",{id:"noNotification",className:"hidden",name:"noNotification",checked:!f,onChange:()=>_(!f),type:"checkbox"}),u("span",{className:"ml-3 flex items-center gap-x-xsmall text-grey-90",children:["Send notifications",i(me,{content:"Notify customer of created return"})]})]}),u("div",{className:"flex gap-x-xsmall",children:[i(M,{onClick:()=>t(),className:"w-[112px]",type:"submit",size:"small",variant:"ghost",children:"Back"}),i(M,{onClick:q,loading:r,className:"w-[112px]",type:"submit",size:"small",variant:"primary",disabled:Object.keys(o).length===0,children:"Submit"})]})]})})]})})},Ts=(e,t)=>{let n=e.find(r=>r.region_id===t.region_id);return n||(n=e.find(r=>r.currency_code===t.currency_code)),n?j({currency:t.currency_code,amount:n.amount*(1+t.tax_rate/100)}):0},qs=({isAdditionalItems:e,order:t,itemsToAdd:n,handleRemoveItem:r,handleToAddQuantity:l})=>u(k,{children:[u(k.HeadRow,{className:"text-grey-50 inter-small-semibold",children:[i(k.HeadCell,{children:"Product Details"}),i(k.HeadCell,{className:"text-right pr-8",children:"Quantity"}),i(k.HeadCell,{className:"text-right",children:e?"Unit Price":"Refundable"}),i(k.HeadCell,{}),i(k.HeadCell,{})]}),i(k.Body,{children:n.map((s,a)=>u(k.Row,{className:H("border-b-grey-0 hover:bg-grey-0"),children:[i(k.Cell,{children:u("div",{className:"min-w-[240px] flex py-2",children:[i("div",{className:"w-[30px] h-[40px] ",children:i("img",{className:"h-full w-full object-cover rounded",src:s.product.thumbnail})}),u("div",{className:"inter-small-regular text-grey-50 flex flex-col ml-4",children:[u("span",{children:[i("span",{className:"text-grey-90",children:s.product.title})," "]}),i("span",{children:s.title})]})]})}),i(k.Cell,{className:"text-right w-32 pr-8",children:u("div",{className:"flex w-full text-right justify-end text-grey-50 ",children:[i("span",{onClick:()=>l(-1,a),className:"w-5 h-5 flex items-center justify-center rounded cursor-pointer hover:bg-grey-20 mr-2",children:i(Ye,{size:16})}),i("span",{children:s.quantity||""}),i("span",{onClick:()=>l(1,a),className:H("w-5 h-5 flex items-center justify-center rounded cursor-pointer hover:bg-grey-20 ml-2"),children:i(Ve,{size:16})})]})}),i(k.Cell,{className:"text-right",children:Ts(s.prices,t)}),i(k.Cell,{className:"text-right text-grey-40 pr-1",children:t.currency_code.toUpperCase()}),i(k.Cell,{children:i(M,{onClick:()=>r(a),variant:"ghost",size:"small",className:"w-8 h-8 text-grey-40",children:i(ce,{size:20})})})]}))})]}),Ds=({order:e,onDismiss:t})=>{const{refetch:n}=ge(e.id),{mutate:r,isLoading:l}=Mi(e.id),s=y.useContext(Ie),[a,m]=y.useState({}),[d,g]=y.useState(!1),[c,o]=y.useState([]),[h,p]=y.useState(null),[x,f]=y.useState(void 0),[_,v]=y.useState(e.no_notification),C=X(),b=y.useMemo(()=>e?mi(e,!1):[],[e]),{shipping_options:F,isLoading:E}=Ut({is_return:!0,region_id:e.region_id}),T=y.useMemo(()=>Object.keys(a).map(w=>b.find(R=>R.id===w)).reduce((w,R)=>R?w+(R.refundable||0)/(R.quantity-R.returned_quantity)*a[R.id].quantity:w,0)-(x||0),[a,x]),N=y.useMemo(()=>c.reduce((I,w)=>{var O,B;let R=(O=w.prices.find(Y=>Y.region_id===e.region_id))==null?void 0:O.amount;R||(R=(B=w.prices.find(Y=>Y.currency_code===e.currency_code))==null?void 0:B.amount),R||(R=0);const z=R*w.quantity;return I+z},0),[c]),$=(I,w)=>{const R=[...c],z=R[w];R[w]={...z,quantity:z.quantity+I},o(R)},S=I=>{const w=[...c];w.splice(I,1),o(w)},P=I=>{if(!F)return;p(I);const w=F==null?void 0:F.find(R=>I.value===R.id);f(w==null?void 0:w.amount)},q=I=>{I!==void 0&&I>=0?f(I):f(0)};y.useEffect(()=>{if(!d&&h&&F){const I=F.find(w=>h.value===w.id);f(I==null?void 0:I.amount)}},[d,h]);const G=I=>{const w=c.map(R=>R.id);o(R=>[...R,...I.filter(z=>!w.includes(z.id)).map(z=>({...z,quantity:1}))])},A=()=>{const w={return_items:Object.entries(a).map(([R,z])=>{var O;return{item_id:R,note:z.note??void 0,quantity:z.quantity,reason_id:((O=z.reason)==null?void 0:O.value.id)??void 0}}),additional_items:c.map(R=>({variant_id:R.id,quantity:R.quantity})),no_notification:_!==e.no_notification?_:void 0};return h&&(w.return_shipping={option_id:h.value,price:Math.round(x||0)}),r(w,{onSuccess:()=>{n(),C("Success","Successfully created exchange","success"),t()},onError:R=>{C("Error",W(R),"error")}})};return i(ot,{context:s,handleClose:t,children:u(V.Body,{children:[i(V.Header,{handleClose:t,children:i("h2",{className:"inter-xlarge-semibold",children:"Register Exchange"})}),u(V.Content,{children:[u("div",{className:"mb-7",children:[i("h3",{className:"inter-base-semibold",children:"Items to return"}),i(ui,{order:e,allItems:b,toReturn:a,setToReturn:I=>m(I)})]}),u("div",{children:[i("h3",{className:"inter-base-semibold ",children:"Shipping"}),E?i("div",{className:"flex justify-center",children:i(Be,{size:"medium",variant:"secondary"})}):i(pt,{label:"Shipping Method",className:"mt-2",placeholder:"Add a shipping method",value:h,onChange:P,options:(F==null?void 0:F.map(I=>({label:I.name,value:I.id})))||[]}),h&&i(di,{inclTax:!1,useCustomShippingPrice:d,shippingPrice:x,currencyCode:e.currency_code,updateShippingPrice:q,setUseCustomShippingPrice:g})]}),u("div",{className:"flex justify-between mt-8 items-center",children:[i("h3",{className:"inter-base-semibold ",children:"Items to send"}),c.length===0?i(M,{variant:"ghost",className:"border border-grey-20",size:"small",onClick:()=>{s.push(Rn(s.pop,c,G))},children:"Add Product"}):i(U,{})]}),c.length>0&&u(U,{children:[i(qs,{isAdditionalItems:!0,order:e,itemsToAdd:c,handleRemoveItem:S,handleToAddQuantity:$}),i("div",{className:"flex w-full justify-end",children:i(M,{variant:"ghost",className:"border border-grey-20",size:"small",onClick:()=>{s.push(Rn(s.pop,c,G))},children:"Add Product"})})]}),u("div",{className:"flex text-grey-90 justify-between items-center inter-small-regular mt-8",children:[i("span",{children:"Return Total"}),i("span",{children:j({currency:e.currency_code,amount:T})})]}),u("div",{className:"flex text-grey-90 justify-between items-center inter-small-regular mt-2",children:[i("span",{children:"Additional Total"}),i("span",{children:j({currency:e.currency_code,amount:N,digits:2,tax:e.tax_rate??void 0})})]}),u("div",{className:"flex text-grey-90 justify-between items-center inter-small-regular mt-2",children:[i("span",{children:"Outbond Shipping"}),i("span",{children:"Calculated at checkout"})]}),u("div",{className:"flex justify-between items-center inter-base-semibold mt-4",children:[i("span",{children:"Estimated difference"}),i("span",{className:"inter-large-semibold",children:j({currency:e.currency_code,amount:N-T,digits:2,tax:e.tax_rate??void 0})})]})]}),i(V.Footer,{children:u("div",{className:"flex w-full justify-between",children:[u("div",{className:"items-center h-full flex cursor-pointer",onClick:()=>v(!_),children:[i("div",{className:`w-5 h-5 flex justify-center text-grey-0 border-grey-30 border rounded-base ${!_&&"bg-violet-60"}`,children:i("span",{className:"self-center",children:!_&&i($e,{size:16})})}),i("input",{id:"noNotification",className:"hidden",name:"noNotification",checked:!_,type:"checkbox"}),u("span",{className:"ml-3 flex items-center text-grey-90 gap-x-xsmall",children:["Send notifications",i(me,{content:"If unchecked the customer will not receive communication about this exchange"})]})]}),i(M,{onClick:A,disabled:Object.keys(a).length===0||c.length===0,loading:l,type:"submit",variant:"primary",children:"Complete"})]})})]})})},Rn=(e,t,n)=>({title:"Add Products",onBack:()=>e(),view:i(Cr,{selectedItems:t||[],onSubmit:n})}),Ke="returnable_items",Pt=["customer","billing_address","shipping_address","discounts","discounts.rule","shipping_methods","payments","fulfillments","fulfillments.tracking_links","returns","claims","swaps","swaps.return_order","swaps.additional_items"],_t=()=>{const{isFeatureEnabled:e}=y.useContext(at);return e("order_editing")&&Pt.indexOf("edits")===-1&&Pt.push("edits"),{orderRelations:Pt.join(",")}},Os=e=>{const{order:t,refetch:n}=ge(e,{fields:Ke}),{order_edits:r}=ct({order_id:e}),{isFeatureEnabled:l}=y.useContext(at),{notes:s}=Ei({resource_id:e,limit:100,offset:0}),{notifications:a}=Pn({resource_id:e});return{events:y.useMemo(()=>{var c;if(!t)return;let d=[...t.items];if(t.swaps&&t.swaps.length)for(const o of t.swaps)d=[...d,...o.additional_items];if(t.claims&&t.claims.length)for(const o of t.claims)d=[...d,...o.additional_items];const g=[];if(g.push({id:"refund-event",time:new Date,orderId:t.id,type:"refund-required",currency_code:t.currency_code}),g.push({id:"payment-required",time:new Date,orderId:t.id,type:"payment-required",currency_code:t.currency_code}),l("order_editing"))for(const o of r||[])g.push({id:o.id,time:o.created_at,orderId:t.id,type:"edit-created",edit:o}),o.requested_at&&g.push({id:o.id,time:o.requested_at,orderId:t.id,type:"edit-requested",email:t.email,edit:o}),o.declined_at&&g.push({id:o.id,time:o.declined_at,orderId:t.id,type:"edit-declined",edit:o}),o.canceled_at&&g.push({id:o.id,time:o.canceled_at,orderId:t.id,type:"edit-canceled",edit:o}),o.confirmed_at&&g.push({id:o.id,time:o.confirmed_at,orderId:t.id,type:"edit-confirmed",edit:o});if(g.push({id:`${t.id}-placed`,time:t.created_at,amount:t.total,currency_code:t.currency_code,tax:t.tax_rate,type:"placed",orderId:t.id}),t.status==="canceled"&&g.push({id:`${t.id}-canceled`,time:t.updated_at,type:"canceled",orderId:t.id}),s)for(const o of s)g.push({id:o.id,time:o.created_at,type:"note",authorId:o.author_id,value:o.value,orderId:t.id});for(const o of t.refunds)g.push({amount:o.amount,currencyCode:t.currency_code,id:o.id,note:o.note,reason:o.reason,time:o.created_at,type:"refund",refund:o});for(const o of t.fulfillments)g.push({id:o.id,time:o.created_at,type:"fulfilled",items:o.items.map(h=>kn(d,h.item_id)),noNotification:o.no_notification,orderId:t.id}),o.shipped_at&&g.push({id:o.id,time:o.shipped_at,type:"shipped",items:o.items.map(h=>kn(d,h.item_id)),noNotification:o.no_notification,orderId:t.id});for(const o of t.returns)g.push({id:o.id,items:o.items.map(h=>zt(d,h)),status:o.status,currentStatus:o.status,time:o.updated_at,type:"return",noNotification:o.no_notification,orderId:t.id,order:t,raw:o,refunded:Hs(o.claim_order_id,t)}),o.status!=="requested"&&g.push({id:o.id,items:o.items.map(h=>zt(d,h)),status:"requested",time:o.created_at,type:"return",raw:o,currentStatus:o.status,noNotification:o.no_notification,order:t,orderId:t.id});for(const o of t.swaps)g.push({id:o.id,time:o.canceled_at?o.canceled_at:o.created_at,noNotification:o.no_notification===!0,fulfillmentStatus:o.fulfillment_status,returnId:o.return_order.id,paymentStatus:o.payment_status,returnStatus:o.return_order.status,type:"exchange",newItems:o.additional_items.map(h=>He(h)),returnItems:o.return_order.items.map(h=>zt(d,h)),exchangeCartId:o.payment_status!=="captured"?o.cart_id:void 0,canceledAt:o.canceled_at,orderId:o.order_id,raw:o}),(o.fulfillment_status==="fulfilled"||o.fulfillment_status==="shipped")&&(g.push({id:o.id,time:o.fulfillments[0].created_at,type:"fulfilled",items:o.additional_items.map(h=>He(h)),noNotification:o.no_notification,orderId:t.id,sourceType:"exchange"}),o.fulfillments[0].shipped_at&&g.push({id:o.id,time:o.fulfillments[0].shipped_at,type:"shipped",items:o.additional_items.map(h=>He(h)),noNotification:o.no_notification,orderId:t.id,sourceType:"exchange"}));if(t.claims)for(const o of t.claims)g.push({id:o.id,type:"claim",newItems:o.additional_items.map(h=>{var p;return{quantity:h.quantity,title:h.title,thumbnail:h.thumbnail,variant:{title:(p=h.variant)==null?void 0:p.title}}}),fulfillmentStatus:o.fulfillment_status,returnStatus:(c=o.return_order)==null?void 0:c.status,refundStatus:o.payment_status,refundAmount:o.refund_amount,currencyCode:t.currency_code,claimItems:o.claim_items.map(h=>Fn(h)),time:o.canceled_at?o.canceled_at:o.created_at,noNotification:o.no_notification,claimType:o.type,canceledAt:o.canceled_at,orderId:t.id,claim:o,order:t}),(o.fulfillment_status==="fulfilled"||o.fulfillment_status==="shipped")&&(g.push({id:o.id,time:o.fulfillments[0].created_at,type:"fulfilled",items:o.additional_items.map(h=>He(h)),noNotification:o.no_notification,orderId:t.id,sourceType:"claim"}),o.fulfillments[0].shipped_at&&g.push({id:o.id,time:o.fulfillments[0].shipped_at,type:"shipped",items:o.additional_items.map(h=>He(h)),noNotification:o.no_notification,orderId:t.id,sourceType:"claim"})),o.canceled_at&&g.push({id:`${o.id}-created`,type:"claim",newItems:o.additional_items.map(h=>{var p;return{quantity:h.quantity,title:h.title,thumbnail:h.thumbnail,variant:{title:(p=h.variant)==null?void 0:p.title}}}),fulfillmentStatus:o.fulfillment_status,refundStatus:o.payment_status,refundAmount:o.refund_amount,currencyCode:t.currency_code,claimItems:o.claim_items.map(h=>Fn(h)),time:o.created_at,noNotification:o.no_notification,claimType:o.type,isCanceled:!0,orderId:t.id});if(a)for(const o of a)g.push({id:o.id,time:o.created_at,to:o.to,type:"notification",title:o.event_name,orderId:t.id});return g.sort((o,h)=>o.time>h.time?-1:o.time<h.time?1:0),g[g.length-1].first=!0,g},[t,r,s,a,l]),refetch:n}};function kn(e,t){var r;const n=e.find(l=>l.id===t);if(n)return{title:n.title,quantity:n.quantity,thumbnail:n.thumbnail,variant:{title:((r=n==null?void 0:n.variant)==null?void 0:r.title)||"-"}}}function zt(e,t){var r;const n=e.find(l=>l.id===t.item_id);if(n)return{title:n.title,quantity:t.quantity,requestedQuantity:t.requested_quantity,receivedQuantity:t.received_quantity,variant:{title:((r=n==null?void 0:n.variant)==null?void 0:r.title)||"-"},thumbnail:n.thumbnail}}function Fn(e){var t;return{title:e.item.title,quantity:e.quantity,thumbnail:e.item.thumbnail,variant:{title:(t=e.item.variant)==null?void 0:t.title}}}function He(e){var t;return{title:e.title,quantity:e.quantity,thumbnail:e.thumbnail,variant:{title:(t=e.variant)==null?void 0:t.title}}}function Hs(e,t){const n=t.claims.find(r=>r.id===e);return n?n.type==="refund":!1}const js=({size:e="24",color:t="currentColor",...n})=>u("svg",{width:e,height:e,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n,children:[i("path",{d:"M3.33301 2.91669V7.91669H8.33301",stroke:t,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),i("path",{d:"M3.41396 11.6784C3.57168 13.1642 4.14444 13.9943 5.18922 15.0653C6.23401 16.1363 7.6093 16.8262 9.0944 17.0244C10.5795 17.2226 12.0883 16.9175 13.3787 16.1581C14.6691 15.3988 15.6663 14.2291 16.2103 12.8369C16.7542 11.4446 16.8134 9.91052 16.3783 8.48073C15.9432 7.05094 15.039 5.80836 13.8109 4.95238C12.5828 4.0964 11.1019 3.67666 9.60596 3.76051C8.10998 3.84436 6.68561 4.42693 5.56142 5.41475L3.33301 7.41474",stroke:t,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),gi=({size:e="24",color:t="currentColor",...n})=>u("svg",{width:e,height:e,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n,children:[i("path",{d:"M18.0893 3.08926C18.4147 2.76382 18.4147 2.23618 18.0893 1.91074C17.7638 1.58531 17.2362 1.58531 16.9107 1.91074L18.0893 3.08926ZM9.41074 9.41074L8.82149 10L10 11.1785L10.5893 10.5893L9.41074 9.41074ZM16.9107 1.91074L9.41074 9.41074L10.5893 10.5893L18.0893 3.08926L16.9107 1.91074Z",fill:t}),i("path",{d:"M17.5 2.5L12.25 17.5L9.25 10.75L2.5 7.75L17.5 2.5Z",stroke:t,strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})]}),Ls=({onSubmit:e})=>{const[t,n]=y.useState(void 0),r=y.useRef(null),l=m=>{n(`${t||""}${m}`)},s=()=>{e&&t&&(e(t),n(""))},a=y.useCallback(m=>{var d,g;switch(m.key){case"Enter":m.preventDefault(),m.stopPropagation(),s(),(d=r.current)==null||d.blur();break;case"Esc":case"Escape":(g=r.current)==null||g.blur();break}},[t,n,e]);return i("form",{children:u("div",{className:"flex items-center py-xsmall px-small bg-grey-5 border border-grey-20 rounded-rounded",onClick:()=>{var m;return(m=r.current)==null?void 0:m.focus()},children:[u("div",{className:"flex items-center gap-x-small flex-grow",children:[i(Mr,{onEmojiClick:l}),i("input",{type:"text",placeholder:"Write a note...",value:t,onChange:m=>n(m.target.value),className:"flex-grow bg-transparent inter-base-regular placeholder:text-grey-40 focus:outline-none",ref:r,id:"note-input",autoComplete:"off",onKeyDown:a})]}),i("button",{className:"text-grey-30 hover:text-violet-60",type:"button",onClick:s,children:i(gi,{size:20})})]})})},Vt=e=>e.quantity-e.fulfilled_quantity-e.returned_quantity,Gs=({items:e,toFulfill:t,setToFulfill:n,quantities:r,setQuantities:l})=>{const s=(m,d)=>{const g=r[d.id];let c={...r};m===-1?c={...c,[d.id]:g-1}:c={...c,[d.id]:g+1},l(c)},a=m=>{const d=m.id,g=t.indexOf(d);if(g!==-1){const c=[...t];c.splice(g,1),n(c)}else{const c=[...t,d];n(c);const o={...r,[m.id]:Vt(m)};l(o)}};return u(k,{children:[u(k.HeadRow,{className:"text-grey-50 inter-small-semibold border-t border-t-grey-20",children:[i(k.HeadCell,{children:"Details"}),i(k.HeadCell,{}),i(k.HeadCell,{className:"text-right pr-8",children:"Quantity"})]}),i(k.Body,{children:e==null?void 0:e.filter(m=>Vt(m)>0).map(m=>{var g;const d=t.includes(m.id);return i(U,{children:u(k.Row,{className:"border-b-grey-0 hover:bg-grey-0",children:[i(k.Cell,{className:"w-[50px]",children:u("div",{className:"items-center ml-1 h-full flex",children:[i("div",{onClick:()=>a(m),className:`w-5 h-5 flex justify-center text-grey-0 border-grey-30 border cursor-pointer rounded-base ${d&&"bg-violet-60"}`,children:i("span",{className:"self-center",children:d&&i($e,{size:16})})}),i("input",{className:"hidden",checked:d,tabIndex:-1,onChange:()=>a(m),type:"checkbox"})]})}),i(k.Cell,{children:u("div",{className:"min-w-[240px] flex py-2",children:[i("div",{className:"w-[30px] h-[40px] ",children:i("img",{className:"h-full w-full object-cover rounded",src:m.thumbnail})}),u("div",{className:"inter-small-regular text-grey-50 flex flex-col ml-4",children:[i("span",{children:i("span",{className:"text-grey-90",children:m.title})}),i("span",{children:((g=m==null?void 0:m.variant)==null?void 0:g.title)||""})]})]})}),i(k.Cell,{className:"text-right w-32 pr-8",children:t.includes(m.id)?u("div",{className:"flex w-full text-right justify-end text-grey-50 ",children:[i("span",{onClick:()=>s(-1,m),className:H("w-5 h-5 flex text-grey-50 items-center justify-center rounded cursor-pointer hover:bg-grey-20 mr-2",{"pointer-events-none text-grey-30":r[m.id]===1}),children:i(Ye,{size:16})}),i("span",{children:r[m.id]||""}),i("span",{onClick:()=>s(1,m),className:H("w-5 h-5 flex text-grey-50 items-center justify-center rounded cursor-pointer hover:bg-grey-20 ml-2",{"pointer-events-none text-grey-30":m.quantity-m.fulfilled_quantity===r[m.id]}),children:i(Ve,{size:16})})]}):i("span",{className:"text-grey-40",children:Vt(m)})})]})})})})]})},ln=({handleCancel:e,orderToFulfill:t,orderId:n})=>{const[r,l]=y.useState([]),[s,a]=y.useState({}),[m,d]=y.useState(!1),[g,c]=y.useState([{key:"",value:""}]),o="items"in t?t.items:t.additional_items,h=Pi(n),p=zi(n),x=Vi(n),f=h.isLoading||p.isLoading||x.isLoading,_=X(),v=()=>{const[C]=t.id.split("_");let b=h,F="Successfully fulfilled order",E;const T=g.reduce((N,$)=>$.key?{...N,[$.key]:$.value}:N,{});switch(C){case"swap":b=p,F="Successfully fulfilled swap",E={swap_id:t.id,metadata:T,no_notification:m};break;case"claim":b=x,F="Successfully fulfilled claim",E={claim_id:t.id,metadata:T,no_notification:m};break;default:E={metadata:T,no_notification:m},E.items=r.map(N=>({item_id:N,quantity:s[N]})).filter(N=>!!N);break}b.mutate(E,{onSuccess:()=>{_("Success",F,"success"),e()},onError:N=>_("Error",W(N),"error")})};return i(V,{handleClose:e,children:u(V.Body,{children:[i(V.Header,{handleClose:e,children:i("span",{className:"inter-xlarge-semibold",children:"Create Fulfillment"})}),i(V.Content,{children:u("div",{className:"flex flex-col",children:[i("span",{className:"inter-base-semibold mb-2",children:"Items"}),i(Gs,{items:o,toFulfill:r,setToFulfill:l,quantities:s,setQuantities:a}),i("div",{className:"mt-4",children:i(Dr,{metadata:g,setMetadata:c})})]})}),i(V.Footer,{children:u("div",{className:"flex w-full h-8 justify-between",children:[u("div",{className:"items-center h-full flex cursor-pointer",onClick:()=>d(!m),children:[i("div",{className:`w-5 h-5 flex justify-center text-grey-0 border-grey-30 border rounded-base ${!m&&"bg-violet-60"}`,children:i("span",{className:"self-center",children:!m&&i($e,{size:16})})}),i("input",{id:"noNotification",className:"hidden",name:"noNotification",checked:!m,type:"checkbox"}),u("span",{className:"ml-3 flex items-center text-grey-90 gap-x-xsmall",children:["Send notifications",i(me,{content:""})]})]}),u("div",{className:"flex",children:[i(M,{variant:"ghost",className:"mr-2 w-32 text-small justify-center",size:"large",onClick:e,children:"Cancel"}),i(M,{size:"large",className:"w-32 text-small justify-center",variant:"primary",disabled:!(r!=null&&r.length)||f,onClick:v,loading:f,children:"Complete"})]})]})})]})})},Bs=({instance:e})=>{const{getRowModel:t,getHeaderGroups:n}=e;return u(k,{children:[i(k.Head,{children:n().map(r=>i(k.HeadRow,{children:r.headers.map(l=>i(k.HeadCell,{className:"inter-small-semibold text-grey-50",style:{width:l.getSize(),maxWidth:l.getSize()},children:xe(l.column.columnDef.header,l.getContext())},l.id))},r.id))}),i(k.Body,{children:t().rows.map(r=>i(k.Row,{className:"last-of-type:border-b-0",children:r.getVisibleCells().map(l=>i(k.Cell,{style:{width:l.column.getSize(),maxWidth:l.column.getSize()},children:xe(l.column.columnDef.cell,l.getContext())},l.id))},r.id))})]})},je=yt(),Us=({form:e,orderCurrency:t})=>{const{control:n,setValue:r,getValues:l,path:s}=e,a=y.useCallback((c,o)=>{const h=s(`items.${c}.quantity`),p=l(h);r(h,p+o)},[l,s,r]),m=J({control:n,name:s("items")}),d=y.useCallback(c=>{m.forEach((o,h)=>{r(s(`items.${h}.receive`),c.target.checked,{shouldDirty:!0})})},[m,s,r]);return y.useMemo(()=>[je.display({id:"selection",maxSize:36,header:({table:c})=>i("div",{className:"pl-base pr-large",children:i(oe,{checked:c.getIsAllRowsSelected(),onChange:o=>{c.toggleAllRowsSelected(o.target.checked),d(o)},indeterminate:c.getIsSomeRowsSelected()})}),cell:({row:{index:c,getToggleSelectedHandler:o}})=>i(ie,{control:n,name:s(`items.${c}.receive`),render:({field:{value:h,onChange:p}})=>i("div",{className:"pl-base pr-large",children:i(oe,{checked:h,onChange:x=>{o()(x),p(x)}})})})}),je.accessor("variant_title",{header:"Product",cell:({getValue:c,row:{original:o}})=>{const h=c();return u("div",{className:"flex items-center gap-x-base py-xsmall",children:[i("div",{children:i(Xe,{src:o.thumbnail})}),u("div",{className:"inter-small-regular",children:[u("div",{className:"flex items-center gap-x-2xsmall",children:[i("p",{children:o.product_title}),h&&u("p",{className:"text-grey-50",children:["(",h,")"]})]}),o.sku&&i("span",{children:i(fe,{value:o.sku,displayValue:o.sku,iconSize:14})})]})]})}}),je.display({id:"quantity",header:()=>i("p",{className:"text-right",children:"Quantity"}),maxSize:50,cell:({row:{index:c,original:{original_quantity:o}}})=>y.createElement(rn,{index:c,maxQuantity:o,control:n,path:s,updateQuantity:a,isSelectable:!0,isSelectedPath:s(`items.${c}.receive`),name:s(`items.${c}.quantity`),key:c})}),je.accessor("refundable",{maxSize:80,header:()=>i("p",{className:"text-right",children:"Refundable"}),cell:({getValue:c})=>i("p",{className:"text-right",children:j({amount:c()||0,currency:t})})}),je.display({id:"order_currency",maxSize:20,cell:()=>i("p",{className:"pl-base text-grey-50",children:t.toUpperCase()})})],[n,t,s,d,a])},Qs=({form:e,order:t})=>{const{control:n,path:r,formState:{errors:l}}=e,{fields:s}=gt({control:n,name:r("items"),keyName:"fieldId"}),a=Us({form:e,orderCurrency:t.currency_code}),m=vt({data:s,columns:a,getCoreRowModel:xt()});return u("div",{className:"flex flex-col gap-y-xsmall",children:[i("h2",{className:"inter-base-semibold",children:"Items to receive"}),i(Bs,{instance:m}),i(ut,{errors:l,name:r("items")})]})},Ws=({form:e,order:t,returnRequest:n})=>{const{control:r}=e,l=J({control:r,name:"receive_items.items"}),s=y.useMemo(()=>l.filter(d=>d.receive),[l]),a=y.useMemo(()=>l.filter(d=>d.receive).reduce((d,g)=>d+g.price*g.quantity,0),[l]),m=y.useMemo(()=>{if(!n.shipping_method||n.claim_order_id)return null;const d=n.shipping_method.tax_lines.reduce((c,o)=>c+o.rate/100,0);return{priceInclTax:Math.round(n.shipping_method.price*(1+d)),title:n.shipping_method.shipping_option.name}},[n]);return s.length===0?null:u("div",{className:"inter-base-regular",children:[i("div",{className:"flex flex-col gap-y-base border-y border-grey-20 py-large",children:s.length>0&&u("div",{children:[i("p",{className:"inter-base-semibold mb-small",children:"Receiving"}),u("div",{className:"flex flex-col gap-y-xsmall",children:[s.map((d,g)=>i(Gt,{currencyCode:t.currency_code,productTitle:d.product_title,quantity:d.quantity,price:d.price,total:d.price*d.quantity,variantTitle:d.variant_title,thumbnail:d.thumbnail},g)),m&&i(Bt,{currencyCode:t.currency_code,title:m.title,price:m.priceInclTax,type:"return"})]})]})}),i("div",{className:"flex flex-col gap-y-xsmall pt-large",children:u("div",{className:"inter-large-semibold flex items-center justify-between","data-testid":"refund-amount-container",children:[i("p",{className:"inter-base-semibold",children:"Refund amount"}),i(oi,{form:ae(e,"refund_amount"),order:t,initialValue:a-((m==null?void 0:m.priceInclTax)||0)})]})})]})},sn=({order:e,returnRequest:t,onClose:n})=>{const{mutate:r,isLoading:l}=Ti(t.id),{orderRelations:s}=_t(),{refetch:a}=ge(e.id,{fields:Ke,expand:s}),m=y.useMemo(()=>{if(t.claim_order_id){const _=e.claims.find(v=>v.id===t.claim_order_id);return _?_.payment_status==="refunded":!1}return!1},[e.claims,t.claim_order_id]),d=y.useMemo(()=>m||!!t.swap_id,[m,t.swap_id]),g=Me({defaultValues:Cn(e,t)}),{handleSubmit:c,reset:o,setError:h,formState:{isDirty:p}}=g,x=X();y.useEffect(()=>{o(Cn(e,t))},[e,t,o]);const f=c(_=>{var C;if(_.receive_items.items.filter(b=>b.receive).length===0){h("receive_items.items",{type:"manual",message:"Please select at least one item to receive"});return}let v;((C=_.refund_amount)==null?void 0:C.amount)!==void 0&&!d&&(v=_.refund_amount.amount),m&&(v=0),r({items:_.receive_items.items.map(b=>({item_id:b.item_id,quantity:b.quantity})),refund:v},{onSuccess:()=>{x("Successfully received return",`Received return for order #${e.display_id}`,"success"),a(),n()},onError:b=>{x("Failed to receive return",W(b),"error")}})});return i(V,{handleClose:n,open:!0,children:u(V.Body,{children:[i(V.Header,{handleClose:n,children:i("h1",{className:"inter-xlarge-semibold",children:"Receive Return"})}),u("form",{onSubmit:f,children:[i(V.Content,{children:u("div",{className:"flex flex-col gap-y-large",children:[i(Qs,{order:e,form:ae(g,"receive_items")}),!d&&i(Ws,{form:g,order:e,returnRequest:t})]})}),i(V.Footer,{children:u("div",{className:"flex w-full items-center justify-end gap-x-xsmall",children:[i(M,{size:"small",variant:"secondary",children:"Cancel"}),i(M,{size:"small",variant:"primary",disabled:!p||l,loading:l,children:"Save and close"})]})})]})]})})},Ys=({paymentStatus:e})=>{switch(e){case"captured":return i(Q,{title:"Paid",variant:"success"});case"awaiting":return i(Q,{title:"Awaiting",variant:"default"});case"not_paid":return i(Q,{title:"Not paid",variant:"default"});case"canceled":return i(Q,{title:"Canceled",variant:"danger"});case"requires_action":return i(Q,{title:"Requires Action",variant:"danger"});default:return null}},fi=({fulfillmentStatus:e})=>{switch(e){case"shipped":return i(Q,{title:"Shipped",variant:"success"});case"fulfilled":return i(Q,{title:"Fulfilled",variant:"warning"});case"canceled":return i(Q,{title:"Canceled",variant:"danger"});case"partially_fulfilled":return i(Q,{title:"Partially fulfilled",variant:"warning"});case"not_fulfilled":return i(Q,{title:"Not fulfilled",variant:"default"});case"requires_action":return i(Q,{title:"Requires Action",variant:"danger"});default:return null}},pi=({returnStatus:e})=>{switch(e){case"received":return i(Q,{title:"Received",variant:"success"});case"requested":return i(Q,{title:"Requested",variant:"default"});case"canceled":return i(Q,{title:"Canceled",variant:"danger"});case"requires_action":return i(Q,{title:"Requires Action",variant:"danger"});default:return null}},Xs=({refundStatus:e})=>{switch(e){case"na":return i(Q,{title:"N/A",variant:"default"});case"not_refunded":return i(Q,{title:"Refunded",variant:"default"});case"refunded":return i(Q,{title:"Refunded",variant:"success"});case"canceled":return i(Q,{title:"Canceled",variant:"danger"});default:return null}},Ze=({actions:e})=>i(dt,{customTrigger:i("button",{className:"btn-ghost py-0 px-2xsmall flex justify-center items-center focus:outline-none focus:ring-2 rounded-base focus:ring-violet-40",children:i(mr,{size:20})}),forceDropdown:!0,actions:e}),Ks=({size:e="20",color:t="currentColor",...n})=>u("svg",{width:e,height:e,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n,children:[i("path",{d:"M11.2971 16.7566C11.1653 16.9839 10.976 17.1726 10.7483 17.3037C10.5206 17.4349 10.2624 17.5039 9.99964 17.5039C9.73686 17.5039 9.47869 17.4349 9.25097 17.3037C9.02326 17.1726 8.83401 16.9839 8.70215 16.7566",stroke:t,strokeWidth:"1.49999",strokeLinecap:"round",strokeLinejoin:"round"}),i("path",{d:"M14.9723 10.7567C14.6386 9.53526 14.4795 8.27274 14.4998 7.00671",stroke:t,strokeWidth:"1.49999",strokeLinecap:"round",strokeLinejoin:"round"}),i("path",{d:"M5.69498 5.7016C5.56468 6.1243 5.49894 6.56426 5.49998 7.00659C5.49998 12.2566 3.25 13.7565 3.25 13.7565H13.7499",stroke:t,strokeWidth:"1.49999",strokeLinecap:"round",strokeLinejoin:"round"}),i("path",{d:"M14.4994 7.00665C14.5006 6.19145 14.2804 5.39124 13.8622 4.69148C13.444 3.99173 12.8435 3.41871 12.125 3.03365C11.4065 2.64859 10.5969 2.46595 9.78261 2.50523C8.96836 2.54451 8.18007 2.80424 7.50195 3.25667",stroke:t,strokeWidth:"1.49999",strokeLinecap:"round",strokeLinejoin:"round"}),i("path",{d:"M2.5 2.50665L17.4999 17.5065",stroke:t,strokeWidth:"1.49999",strokeLinecap:"round",strokeLinejoin:"round"})]});var ve=(e=>(e.GREEN="text-emerald-40",e.RED="text-rose-50",e.ORANGE="text-orange-40",e.VIOLET="text-violet-60",e.DEFAULT="text-grey-50",e))(ve||{});const ee=({icon:e,iconColor:t="text-grey-50",title:n,topNode:r,midNode:l,time:s,noNotification:a=!1,isFirst:m=!1,expandable:d=!1,children:g})=>{const[c,o]=y.useState(!d),h=()=>{o(p=>!p)};return u("div",{className:"mb-base",children:[u("div",{className:"flex items-center justify-between",children:[u("div",{className:"flex items-center gap-x-xsmall",children:[i("div",{className:H("h-5 w-5",t),children:e}),i("div",{className:"inter-small-semibold",children:n}),i("div",{className:"inter-small-regular text-grey-50"})]}),u("div",{className:"flex items-center gap-x-xsmall",children:[a&&i(ue,{content:"Notifications related to this event are disabled",children:i(Ks,{size:20,className:"text-grey-40"})}),r,d&&i("button",{onClick:h,children:c?i(Hr,{size:16}):i(Or,{size:16})})]})]}),u("div",{className:"flex gap-x-xsmall",children:[i("div",{className:"flex w-5 justify-center pt-base",children:!m&&i("div",{className:"min-h-[24px] w-px"})}),u("div",{className:"inter-small-regular mt-2xsmall w-full",children:[u("div",{className:"flex items-center",children:[i(ue,{content:new Date(s).toUTCString(),children:i("div",{className:"inter-small-regular text-grey-50",children:Ue(s).fromNow()})}),l&&i("span",{className:"mx-2xsmall ",children:i(Zs,{})}),l]}),g&&c&&i("div",{className:"mt-small w-full pb-base",children:g})]})]})]})},Zs=({size:e="2px",bg:t="bg-grey-50"})=>i("div",{className:`aspect-square h-[2px] w-[2px] ${t} rounded-full`}),_e=({item:e})=>e?u("div",{className:"flex items-center gap-x-small mb-base last:mb-0",children:[e.thumbnail&&i("div",{className:"h-10 w-[30px] rounded-base overflow-hidden",children:i("img",{src:e.thumbnail,alt:`Thumbnail for ${e.title}`,className:"h-full w-full object-cover"})}),u("div",{className:"flex flex-col inter-small-regular w-full",children:[u("div",{className:"flex items-center justify-between w-full",children:[i("p",{children:e.title}),i("span",{className:"inter-small-semibold text-violet-60",children:`x${e.quantity}`})]}),i("p",{className:"text-grey-50",children:e.variant.title})]})]}):null,Js=({event:e})=>{var v,C,b,F,E,T,N,$,S,P,q,G;const{state:t,open:n,close:r}=ke(),{state:l,open:s,close:a}=ke(),{orderRelations:m}=_t(),{refetch:d}=ge(e.orderId,{fields:Ke,expand:m}),g=X(),c=!e.canceledAt&&(((v=e.claim)==null?void 0:v.return_order)||((b=(C=e.claim)==null?void 0:C.additional_items)==null?void 0:b.length)>0),{mutate:o}=Qt((E=(F=e.claim)==null?void 0:F.return_order)==null?void 0:E.id),{mutate:h}=qi((T=e.order)==null?void 0:T.id),f=ia(e,()=>{h(e.claim.id,{onSuccess:()=>{g("Claim canceled","The claim has been canceled","success")},onError:A=>{g("Failed to cancel claim",W(A),"error")}})},()=>{o(void 0,{onSuccess:()=>{g("Return canceled","The return has been canceled","success"),d()},onError:A=>{g("Failed to cancel return",W(A),"error")}})}),_={icon:e.canceledAt?i(Fe,{size:20}):i(Re,{size:20}),iconColor:e.canceledAt?ve.DEFAULT:ve.ORANGE,title:e.canceledAt?"Claim Canceled":"Claim Created",time:e.canceledAt?e.canceledAt:e.time,topNode:f,children:[u(y.Fragment,{children:[u("div",{className:"flex flex-col gap-y-base",children:[i(ea,{event:e}),ta(e),(($=(N=e.claim)==null?void 0:N.additional_items)==null?void 0:$.length)>0&&na(e),c&&u("div",{className:"flex items-center gap-x-xsmall",children:[((S=e.claim.return_order)==null?void 0:S.status)==="requested"&&i(M,{variant:"secondary",size:"small",onClick:n,children:"Receive Return"}),((q=(P=e.claim)==null?void 0:P.additional_items)==null?void 0:q.length)>0&&((G=e.claim)==null?void 0:G.fulfillment_status)==="not_fulfilled"&&i(M,{variant:"secondary",size:"small",onClick:s,children:"Fulfill Replacement"})]})]}),t&&i(sn,{onClose:r,order:e.order,returnRequest:e.claim.return_order}),l&&i(ln,{handleCancel:a,orderToFulfill:e.claim,orderId:e.claim.order_id})]},e.id)]};return i(ee,{..._})},ea=({event:e})=>{var s,a,m,d,g,c,o,h,p,x;const t=i("div",{className:"h-11 w-px bg-grey-20"}),n=!!((s=e.claim)!=null&&s.fulfillment_status)&&((m=(a=e.claim)==null?void 0:a.additional_items)==null?void 0:m.length)>0,r=!!((d=e.claim)!=null&&d.return_order);let l=(g=e.claim)==null?void 0:g.payment_status;return((c=e.claim)==null?void 0:c.type)==="replace"&&(l=((h=(o=e.claim)==null?void 0:o.return_order)==null?void 0:h.status)==="received"?"refunded":(p=e.claim)==null?void 0:p.payment_status),e.canceledAt!==null&&(l="canceled"),u("div",{className:"inter-small-regular flex items-center gap-x-base",children:[u("div",{className:"flex flex-col gap-y-2xsmall",children:[i("span",{className:"text-grey-50",children:"Refund:"}),i(Xs,{refundStatus:l})]}),r&&u(U,{children:[t,u("div",{className:"flex flex-col gap-y-2xsmall",children:[i("span",{className:"text-grey-50",children:"Return:"}),i(pi,{returnStatus:e.returnStatus})]})]}),n&&u(U,{children:[t,u("div",{className:"flex flex-col gap-y-2xsmall",children:[i("span",{className:"text-grey-50",children:"Fulfillment:"}),i(fi,{fulfillmentStatus:(x=e.claim)==null?void 0:x.fulfillment_status})]})]})]})},ta=e=>u("div",{className:"flex flex-col gap-y-small",children:[i("span",{className:"inter-small-regular text-grey-50",children:"Claim Items"}),i("div",{children:e.claimItems.map((t,n)=>i(_e,{item:t},n))})]}),na=e=>u("div",{className:"flex flex-col gap-y-small",children:[i("span",{className:"inter-small-regular text-grey-50",children:"Replacement Items"}),i("div",{children:e.newItems.map((t,n)=>i(_e,{item:t},n))})]}),ia=(e,t,n)=>{var l;const r=[];return!e.canceledAt&&!e.isCanceled&&(e.claim.return_order&&((l=e.claim.return_order)==null?void 0:l.status)==="requested"&&r.push({icon:i(ce,{size:20}),label:"Cancel return",variant:"danger",onClick:n}),e.refundStatus!=="refunded"&&!e.isCanceled&&r.push({icon:i(ce,{size:20}),label:"Cancel claim",variant:"danger",onClick:t})),r.length?i(Ze,{actions:r}):null},ra=({event:e})=>{const t=i("div",{className:"h-11 w-px bg-grey-20"});return u("div",{className:"inter-small-regular flex items-center gap-x-base",children:[u("div",{className:"flex flex-col gap-y-2xsmall",children:[i("span",{className:"text-grey-50",children:"Payment:"}),i(Ys,{paymentStatus:e.paymentStatus})]}),t,u("div",{className:"flex flex-col gap-y-2xsmall",children:[i("span",{className:"text-grey-50",children:"Return:"}),i(pi,{returnStatus:e.returnStatus})]}),t,u("div",{className:"flex flex-col gap-y-2xsmall",children:[i("span",{className:"text-grey-50",children:"Fulfillment:"}),i(fi,{fulfillmentStatus:e.fulfillmentStatus})]})]})},la=({event:e,refetch:t})=>{const[n,r]=y.useState(!1),[l,s]=y.useState(!1),[a,m]=y.useState(!1),[d,g]=y.useState(!1),c=Di(e.orderId),o=Qt(e.returnId),[h,p]=y.useState(void 0),[x,f]=y.useState(void 0),[_,v]=y.useState(!0),{store:C}=Oi(),{orderRelations:b}=_t(),{order:F}=ge(e.orderId,{expand:b,fields:Ke}),E=X();y.useEffect(()=>{var I,w;if(C){if(e.paymentStatus!=="not_paid"){v(!1);return}((I=C.swap_link_template)==null?void 0:I.indexOf("{cart_id}"))===-1&&f("Store payment link does not have the default format, as it does not contain '{cart_id}'. Either update the payment link to include '{cart_id}' or update this method to reflect the format of your payment link."),C.swap_link_template||f("No payment link has been set for this store. Please update store settings."),e.exchangeCartId&&p((w=C.swap_link_template)==null?void 0:w.replace(/\{cart_id\}/,e.exchangeCartId))}},[C==null?void 0:C.swap_link_template,e.exchangeCartId,e.paymentStatus,C]);const T=aa(_,h,x,e.exchangeCartId),N=async()=>{await c.mutateAsync(e.id),t()},$=async()=>{await o.mutateAsync(),t()},S=()=>{Jt.orders.processSwapPayment(e.orderId,e.id).then(I=>{E("Success","Payment processed successfully","success"),t()}).catch(I=>{E("Error",W(I),"error")})},P=oa(e),q=sa(e),G=[];e.paymentStatus==="awaiting"&&G.push({label:"Capture payment",icon:i(Gn,{size:20}),onClick:S}),e.returnStatus==="requested"&&G.push({label:"Cancel return",icon:i(Kt,{size:20}),onClick:()=>s(!l)}),!e.isCanceled&&!e.canceledAt&&e.fulfillmentStatus!=="fulfilled"&&e.fulfillmentStatus!=="shipped"&&G.push({label:"Cancel exchange",icon:i(Fe,{size:20}),onClick:()=>r(!n),variant:"danger"});const A={title:e.canceledAt?"Exchange Cancelled":"Exchange Requested",icon:e.canceledAt?i(Fe,{size:20}):i(mt,{size:20}),expandable:!!e.canceledAt,iconColor:e.canceledAt?ve.DEFAULT:ve.ORANGE,time:e.time,noNotification:e.noNotification,topNode:ca(e,G),children:[u("div",{className:"flex flex-col gap-y-base",children:[e.canceledAt&&u("div",{children:[i("span",{className:"inter-small-semibold mr-2",children:"Requested on:"}),i("span",{className:"text-grey-50",children:new Date(e.time).toUTCString()})]}),!e.canceledAt&&i(ra,{event:e}),!e.canceledAt&&T,P,q,u("div",{className:"flex items-center gap-x-xsmall",children:[e.returnStatus==="requested"&&i(M,{variant:"secondary",size:"small",onClick:()=>m(!0),children:"Receive Return"}),e.fulfillmentStatus==="not_fulfilled"&&i(M,{variant:"secondary",size:"small",onClick:()=>g(!0),children:"Fulfill Exchange"})]})]},e.id)]};return u(U,{children:[i(ee,{...A}),n&&i(rt,{handleClose:()=>r(!n),onDelete:N,confirmText:"Yes, cancel",heading:"Cancel exchange",text:"Are you sure you want to cancel this exchange?",successText:"Exchange cancelled"}),l&&i(rt,{handleClose:()=>s(!l),onDelete:$,confirmText:"Yes, cancel",heading:"Cancel return",text:"Are you sure you want to cancel this return?",successText:"Return cancelled"}),a&&F&&i(sn,{order:F,returnRequest:e.raw.return_order,onClose:()=>m(!1)}),d&&i(ln,{orderId:e.orderId,orderToFulfill:e.raw,handleCancel:()=>g(!1)})]})};function sa(e){return u("div",{className:"flex flex-col gap-y-small",children:[i("span",{className:"inter-small-regular text-grey-50",children:"New Items"}),i("div",{children:e.newItems.map((t,n)=>i(_e,{item:t},n))})]})}function aa(e,t,n,r){return e?u("div",{className:"inter-small-regular flex flex-col gap-y-xsmall text-grey-50",children:[u("div",{className:"flex items-center gap-x-xsmall",children:[n&&i(me,{content:n}),i("span",{children:"Payment link:"})]}),t&&i(fe,{value:t,displayValue:r})]}):null}function oa(e){return u("div",{className:"flex flex-col gap-y-small",children:[i("span",{className:"inter-small-regular text-grey-50",children:"Return Items"}),i("div",{children:e.returnItems.filter(t=>!!t).map(t=>i(_e,{item:{...t,quantity:t.requestedQuantity}},t.id))})]})}function ca(e,t){return t.length===0?null:i(Ze,{actions:t})}const da=({event:e})=>{const t=e.sourceType==="claim"?"Replacement Items Fulfilled":e.sourceType==="exchange"?"Exchange Items Fulfilled":"Items Fulfilled",n={icon:i(Wn,{size:20}),time:e.time,title:t,children:e.items.map((r,l)=>i(_e,{item:r},l)),noNotification:e.noNotification,isFirst:e.first};return i(ee,{...n})},ua=({event:e})=>{const t=e.sourceType==="claim"?"Replacement Items Shipped":e.sourceType==="exchange"?"Exchange Items Shipped":"Items Shipped",n={icon:i(Kt,{size:20}),time:e.time,title:t,children:e.items.map((r,l)=>i(_e,{item:r},l)),noNotification:e.noNotification,isFirst:e.first};return i(ee,{...n})},ma=e=>{const{user:t}=Hi();return y.useMemo(()=>(t==null?void 0:t.id)===e,[t,e])},ga=({event:e})=>{const[t,n]=y.useState(!1),{user:r,isLoading:l}=We(e.authorId),s=ji(e.id),a=ma(r==null?void 0:r.id);if(l||!r)return null;const m=r.first_name&&r.last_name?`${r.first_name} ${r.last_name}`:r.email;return u(U,{children:[i(ee,{title:m,icon:i(Yt,{user:r}),time:e.time,topNode:i(Ze,{actions:[{label:"Delete",icon:i(ce,{size:20}),onClick:()=>n(!t),variant:"danger"}]}),isFirst:e.first,children:i("div",{className:H("rounded-2xl px-base py-base",{"bg-grey-5":!a,"bg-violet-5 text-violet-90":a}),children:e.value})}),t&&i(rt,{handleClose:()=>n(!t),onDelete:async()=>s.mutate(void 0),confirmText:"Yes, delete",heading:"Delete note",successText:"Deleted note"})]})},hi=({notificationId:e,email:t,handleCancel:n})=>{const{mutate:r,isLoading:l}=Li(e),{register:s,handleSubmit:a}=Me({defaultValues:{to:t}}),m=X();return i(V,{handleClose:n,children:i("form",{onSubmit:a(g=>{r({to:g.to.trim()},{onSuccess:()=>{m("Success",`Notification re-send to ${g.to}`,"success"),n()},onError:c=>m("Error",W(c),"error")})}),children:u(V.Body,{children:[i(V.Header,{handleClose:n,children:i("span",{className:"inter-xlarge-semibold",children:"Resend notification"})}),i(V.Content,{children:i("div",{className:"flex flex-col",children:i("div",{className:"flex flex-col space-y-2",children:i(ze,{label:"Email",type:"text",placeholder:"Email",...s("to",{required:"Must be filled"})})})})}),i(V.Footer,{children:i("div",{className:"flex w-full h-8 justify-end",children:u("div",{className:"flex",children:[i(M,{variant:"ghost",className:"mr-2 w-32 text-small justify-center",size:"large",onClick:n,children:"Cancel"}),i(M,{size:"large",className:"w-32 text-small justify-center",variant:"primary",type:"submit",disabled:l,loading:l,children:"Send"})]})})})]})})})},fa={"order.items_returned":"Return Received Notice Sent","order.return_requested":"Return Request Confirmation Sent","order.placed":"Order Confirmation Sent","order.shipment_created":"Shipment Confirmation Sent"},pa=({event:e})=>{const[t,n]=y.useState(!1),r=i(Ze,{actions:[{label:"Re-Send Mail",icon:i(gi,{size:20}),onClick:()=>n(!0)}]});return u(U,{children:[i(ee,{icon:i(Xt,{size:20}),title:fa[e.title]||e.title,time:e.time,topNode:r,midNode:i(ha,{email:e.to})}),t&&i(hi,{handleCancel:()=>n(!1),notificationId:e.id,email:e.to})]})},ha=({email:e})=>u("div",{className:"flex items-center",children:[i("div",{className:"text-grey-40 mr-2xsmall",children:i(jn,{size:16})}),i("span",{children:e})]}),ya=({event:e})=>{const t={icon:i(Fe,{size:20}),iconColor:ve.RED,time:e.time,title:"Order Canceled"};return i(ee,{...t})},bt=({user:e})=>{if(!e)return null;const{first_name:t,last_name:n,email:r}=e,l=!t&&!n?r:`${t||""} ${n||""}`;return u("div",{className:"flex inter-small-regular items-center text-grey-50",children:["By",i("span",{className:"w-base h-base mx-xsmall",children:i(Yt,{user:e,font:"inter-xsmall-semibold"})}),l]})},xa=({event:e})=>{const{user:t}=We(e.edit.canceled_by);return i(ee,{title:"Order Edit canceled",icon:i(Ln,{size:20}),time:e.time,isFirst:e.first,midNode:i(bt,{user:t})})},yi="usr";function va(e){var t;return!!((t=e.declined_by)!=null&&t.startsWith(yi))}function _a(e){var t;return!!((t=e.confirmed_by)!=null&&t.startsWith(yi))}const ba=({event:e})=>{const t=_a(e.edit),n=`Order Edit ${t?"force confirmed":"confirmation accepted"}`,{user:r}=We(e.edit.confirmed_by,{enabled:t&&!!e.edit.confirmed_by}),{customer:l}=zn(e.edit.confirmed_by,{enabled:!t&&!!e.edit.confirmed_by});return i(ee,{title:n,time:e.time,isFirst:e.first,icon:i(Fr,{size:20}),midNode:i(bt,{user:r||l})})};let Tt;const Qe=y.createContext({});function Sa(e){const{orderId:t}=e,[n,r,l]=ke(!1),{order_edits:s,count:a}=ct({order_id:t});y.useEffect(()=>{n||(Tt=void 0)},[n]);const m={isModalVisible:n,showModal:r,hideModal:l,orderEdits:s,activeOrderEditId:Tt,setActiveOrderEdit:d=>Tt=d};return i(Qe.Provider,{value:m,children:e.children})}const Ca=e=>e.requested_at&&e.requested_by?{type:"requested",user_id:e.requested_by}:{type:"created",user_id:e.created_by},wa=({event:e})=>{const{isModalVisible:t,showModal:n,setActiveOrderEdit:r}=y.useContext(Qe),{order_edit:l,isFetching:s}=Vn(e.edit.id),{type:a,user_id:m}=Ca(l||e.edit),d=X(),g=`Order Edit ${a}`,{user:c}=We(m),o=ft(),h=Tn(e.edit.id),p=Gi(e.edit.id),x=Bi(e.edit.id),f=()=>{h.mutate(void 0,{onSuccess:()=>{d("Success","Successfully deleted Order Edit","success")},onError:F=>{d("Error",W(F),"error")}})},_=()=>{p.mutate(void 0,{onSuccess:()=>{d("Success","Successfully canceled Order Edit","success")},onError:F=>{d("Error",W(F),"error")}})},v=async()=>{await o({heading:"Delete Confirm",text:"By force confirming you allow the order edit to be fulfilled. You will still have to reconcile payments manually after confirming.",confirmText:"Yes, Force Confirm",cancelText:"No, Cancel"})&&x.mutate(void 0,{onSuccess:()=>{d("Success","Successfully confirmed Order Edit","success")},onError:E=>{d("Error",W(E),"error")}})},C=()=>{console.log("TODO")},b=()=>{r(l.id),n()};return t&&(l==null?void 0:l.status)==="created"||s?null:i(U,{children:u(ee,{title:g,icon:i(Zt,{size:20}),time:e.time,isFirst:e.first,midNode:i(bt,{user:c}),children:[l.internal_note&&i("div",{className:"px-base py-small mt-base mb-large rounded-large bg-grey-10 inter-base-regular text-grey-90",children:l.internal_note}),i("div",{children:i(Na,{orderEdit:l})}),(l.status==="created"||l.status==="requested")&&i("div",{className:"space-y-xsmall mt-large",children:a==="created"?u(U,{children:[i(M,{className:"w-full border border-grey-20",size:"small",variant:"ghost",onClick:b,children:"Continue order edit"}),i(on,{onDelete:f,className:"w-full border border-grey-20",children:"Delete the order edit"})]}):u(U,{children:[i(M,{className:"w-full border border-grey-20",size:"small",variant:"ghost",onClick:C,children:"Copy Confirmation-Request Link"}),i(M,{className:"w-full border border-grey-20",size:"small",variant:"ghost",onClick:v,children:"Force Confirm"}),i(on,{onDelete:_,className:"w-full border border-grey-20",children:"Cancel Order Edit"})]})})]})})},Na=({orderEdit:e})=>{if(!e)return i(U,{});const t=e.changes.filter(r=>r.type==="item_add"||r.type==="item_update"&&r.line_item&&r.original_line_item&&r.original_line_item.quantity<r.line_item.quantity),n=e.changes.filter(r=>r.type==="item_remove"||r.type==="item_update"&&r.line_item&&r.original_line_item&&r.original_line_item.quantity>r.line_item.quantity);return u("div",{className:"flex flex-col gap-y-base",children:[t.length>0&&u("div",{children:[i("span",{className:"inter-small-regular text-grey-50",children:"Added"}),t.map(r=>i(An,{change:r},r.id))]}),n.length>0&&u("div",{children:[i("span",{className:"inter-small-regular text-grey-50",children:"Removed"}),n.map(r=>i(An,{change:r},r.id))]})]})},An=({change:e})=>{var l,s,a,m,d,g;let t;const n=e.type==="item_add";n?t=e.line_item.quantity:t=((l=e.original_line_item)==null?void 0:l.quantity)-((s=e.line_item)==null?void 0:s.quantity),t=Math.abs(t);const r=n?e.line_item:e.original_line_item;return u("div",{className:"flex gap-x-base mt-xsmall",children:[i("div",{children:i("div",{className:"flex h-[40px] w-[30px] rounded-rounded overflow-hidden",children:r!=null&&r.thumbnail?i("img",{src:r.thumbnail,className:"object-cover"}):i(ht,{})})}),u("div",{className:"flex flex-col",children:[u("span",{className:"inter-small-semibold text-grey-90",children:[t>1&&u(U,{children:[t,"x"]})," ",r==null?void 0:r.title,"  ",((a=r==null?void 0:r.variant)==null?void 0:a.sku)&&i(fe,{value:(m=r==null?void 0:r.variant)==null?void 0:m.sku,iconSize:14})]}),i("span",{className:"flex inter-small-regular text-grey-50",children:(g=(d=r==null?void 0:r.variant)==null?void 0:d.options)==null?void 0:g.map(c=>c.value)})]})]})},Ra=({event:e})=>{const{order_edit:t}=Vn(e.edit.id),n=va(e.edit),{user:r}=We(e.edit.declined_by,{enabled:n&&!!e.edit.declined_by}),{customer:l}=zn(e.edit.declined_by,{enabled:!n&&!!e.edit.declined_by}),s=t==null?void 0:t.declined_reason;return i(ee,{title:"Order Edit declined",icon:i(Ln,{size:20}),time:e.time,isFirst:e.first,midNode:i(bt,{user:l||r}),children:s&&i("div",{className:"px-base py-small mt-base rounded-large bg-grey-10 inter-base-regular text-grey-90",children:s})})},ka=({event:e})=>{var m;const{order_edits:t}=ct({order_id:e.orderId}),{order:n}=ge(e.orderId),r=((m=t==null?void 0:t.find(d=>d.status==="requested"))==null?void 0:m.difference_due)||0;if(!n||!t)return null;const l=r?n.total+n.refunded_total-n.paid_total+r:n.refunded_total-n.paid_total;if(l<=0)return null;const s=()=>{console.log("TODO")},a=()=>{console.log("TODO")};return u(ee,{title:"Customer payment required",icon:i(Re,{size:20}),iconColor:ve.VIOLET,time:e.time,isFirst:e.first,midNode:i("span",{className:"inter-small-regular text-grey-50",children:j({amount:l,currency:e.currency_code})}),children:[i(M,{size:"small",className:"w-full border border-grey-20 mb-xsmall",variant:"ghost",onClick:s,children:"Copy Payment Link"}),i(M,{size:"small",className:"w-full border border-grey-20",variant:"ghost",onClick:a,children:"Mark as Paid"})]})},In=[{label:"Discount",value:"discount"},{label:"Other",value:"other"}],xi=({order:e,onDismiss:t,initialAmount:n,initialReason:r})=>{const{register:l,handleSubmit:s,control:a}=Me({defaultValues:{amount:n,reason:In[r==="other"?1:0]}}),[m,d]=y.useState(e.no_notification),g=X(),{mutate:c,isLoading:o}=Ui(e.id),h=y.useMemo(()=>e.paid_total-e.refunded_total,[e]),p=_=>_<=h,x=_=>{c({amount:_.amount,reason:_.reason.value,no_notification:m,note:_.note},{onSuccess:()=>{g("Success","Successfully refunded order","success"),t()},onError:v=>{g("Error",W(v),"error")}})},f=e.payments.some(_=>_.provider_id==="system");return i(V,{handleClose:t,children:i("form",{onSubmit:s(x),children:u(V.Body,{children:[i(V.Header,{handleClose:t,children:i("h2",{className:"inter-xlarge-semibold",children:"Create a refund"})}),u(V.Content,{children:[f&&u("div",{className:"inter-small-regular mb-6 p-4 text-orange-50 bg-orange-5 rounded-rounded flex",children:[i("div",{className:"h-full mr-3",children:i(Re,{size:20})}),u("div",{className:"flex flex-col",children:[i("span",{className:"inter-small-semibold",children:"Attention!"}),"One or more of your payments is a system payment. Be aware, that captures and refunds are not handled by Medusa for such payments."]})]}),i("span",{className:"inter-base-semibold",children:"Details"}),u("div",{className:"grid gap-y-base mt-4",children:[i(it.Root,{size:"small",currentCurrency:e.currency_code,readOnly:!0,children:i(ie,{name:"amount",control:a,rules:{required:Ct.required("Amount"),min:Ct.min("Amount",1),max:Ct.maxInteger("Amount",e.currency_code)},render:({field:{value:_,onChange:v,onBlur:C}})=>i(it.Amount,{label:"Refund Amount",amount:_,onBlur:C,invalidMessage:"Cannot refund more than the order's net total.",onValidate:p,onChange:v})})}),i(ie,{name:"reason",control:a,defaultValue:{label:"Discount",value:"discount"},rules:{required:!0},render:({field:{value:_,onChange:v}})=>i(pt,{label:"Reason",options:In,value:_,onChange:v})}),i(Un,{...l("note"),label:"Note",placeholder:"Discount for loyal customer"})]})]}),i(V.Footer,{children:u("div",{className:"flex w-full  justify-between",children:[u("div",{className:"items-center h-full flex cursor-pointer",onClick:()=>d(!m),children:[i("div",{className:`w-5 h-5 flex justify-center text-grey-0 border-grey-30 border rounded-base ${!m&&"bg-violet-60"}`,children:i("span",{className:"self-center",children:!m&&i($e,{size:16})})}),i("input",{id:"noNotification",className:"hidden",name:"noNotification",checked:!m,onChange:()=>d(!m),type:"checkbox"}),u("span",{className:"ml-3 flex items-center text-grey-90 gap-x-xsmall",children:["Send notifications",i(me,{content:"Notify customer of created return"})]})]}),u("div",{className:"flex gap-x-xsmall",children:[i(M,{onClick:t,size:"small",className:"w-[112px]",variant:"ghost",children:"Cancel"}),i(M,{type:"submit",size:"small",className:"w-[112px]",variant:"primary",loading:o,disabled:o,children:"Complete"})]})]})})]})})})},Fa=({event:e})=>{var m;const{order:t}=ge(e.orderId),{order_edits:n}=ct({order_id:e.orderId}),r=((m=n==null?void 0:n.find(d=>d.status==="requested"))==null?void 0:m.difference_due)||0,[l,s]=y.useState(!1);if(!t||!n)return null;const a=t.paid_total-t.refunded_total-t.total-r;return a<=0?null:u(U,{children:[i(ee,{title:"Refund required",icon:i(Re,{size:20}),iconColor:ve.RED,time:e.time,isFirst:e.first,children:u(M,{onClick:()=>s(!0),variant:"ghost",size:"small",className:"w-full border border-grey-20 mb-xsmall text-rose-50",children:["Refund",j({amount:a,currency:e.currency_code})]})}),l&&i(xi,{order:t,initialAmount:a,initialReason:"other",onDismiss:()=>s(!1)})]})},Aa=({event:e})=>{var s;const[t,n]=y.useState(!1),{notifications:r}=Pn({resource_id:(s=e.edit)==null?void 0:s.id}),l=r==null?void 0:r.find(a=>a.event_name==="order-edit.requested");return l?u(U,{children:[i(ee,{title:"Order Edit confirmation-request sent",icon:i(Xt,{size:20}),time:e.time,isFirst:e.first,midNode:i("span",{className:"inter-small-regular text-grey-50",children:e.email}),children:i(M,{className:"w-full border border-grey-20 mb-5",size:"small",variant:"ghost",onClick:()=>n(!0),children:"Resend Confirmation-Request"})}),t&&i(hi,{handleCancel:()=>n(!1),notificationId:l.id,email:l.to})]}):null},Ia=({event:e})=>{const t={icon:i(Yn,{size:20}),time:e.time,title:"Order Placed",midNode:i("div",{className:"inter-small-regular text-grey-50",children:j({amount:e.amount,currency:e.currency_code})}),isFirst:e.first};return i(ee,{...t})},$a=({size:e="24px",color:t="currentColor",...n})=>u("svg",{width:e,height:e,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n,children:[i("path",{d:"M2.5 5.83398H17.5",stroke:t,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),i("path",{d:"M7.97565 9.16602H5.83398",stroke:t,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),i("path",{d:"M7.5 14.1667H5C3.61917 14.1667 2.5 13.0475 2.5 11.6667V5C2.5 3.61917 3.61917 2.5 5 2.5H15C16.3808 2.5 17.5 3.61917 17.5 5V8.33333",stroke:t,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),i("path",{d:"M13.3249 14.166L11.6582 15.8327L13.3249 17.4993",stroke:t,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),i("path",{d:"M14.9993 12.5H15.8327C16.7535 12.5 17.4993 13.2458 17.4993 14.1667C17.4993 15.0875 16.7535 15.8333 15.8327 15.8333H11.666",stroke:t,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),Ma=({event:e})=>{const t={icon:i($a,{size:20}),title:"Refund",time:e.time,midNode:i("span",{className:"inter-small-regular text-grey-50",children:j({amount:e.amount,currency:e.currencyCode})}),children:u("div",{className:"flex w-full flex-col gap-y-xsmall",children:[e.reason&&i("span",{className:"text-grey-50",children:`${e.reason.slice(0,1).toUpperCase()}${e.reason.slice(1)}`}),e.note&&u("div",{className:"rounded-2xl bg-grey-5 px-base py-base",children:["Note: ",e.note]})]})};return i(ee,{...t})},Ea=({event:e,refetch:t})=>{var c;const[n,r]=y.useState(!1),l=Qt(e.id),{state:s,close:a,open:m}=ke(),d=()=>{l.mutate(void 0,{onSuccess:()=>{t()}})},g=Pa(e,d,m);return(c=e.raw)!=null&&c.claim_order_id?null:u(U,{children:[i(ee,{...g}),n&&i(rt,{handleClose:()=>r(!1),onDelete:async()=>d(),heading:"Cancel return",confirmText:"Yes, cancel",successText:"Canceled return",text:"Are you sure you want to cancel this return?"}),s&&i(sn,{onClose:a,order:e.order,returnRequest:e.raw})]})};function Pa(e,t,n){let r="Return",l,s;const a=[];switch(e.status){case"requested":r="Return Requested",l=i(Re,{size:20,className:"text-orange-40"}),e.currentStatus==="requested"&&(s=e.currentStatus&&e.currentStatus==="requested"&&i(M,{variant:"secondary",size:"small",className:H("mt-large"),onClick:n,children:"Receive Return"}),a.push({icon:i(ce,{size:20}),label:"Cancel return",variant:"danger",onClick:t}));break;case"received":r="Return Received",l=i(Yn,{size:20,className:"text-emerald-40"});break;case"canceled":r="Return Canceled",l=i(Fe,{size:20,className:"text-grey-50"});break;case"requires_action":r="Return Requires Action",l=i(Re,{size:20,className:"text-rose-50"});break}return{title:r,icon:l,time:e.time,topNode:a.length>0&&i(Ze,{actions:a}),noNotification:e.noNotification,children:e.status==="requested"?[e.items.map((m,d)=>i(_e,{item:m},d)),Ne.createElement(Ne.Fragment,{key:"button"},s)]:e.status==="received"?[e.items.map((m,d)=>i(_e,{item:{...m,quantity:m.receivedQuantity??m.quantity}},d))]:null}}const za=({orderId:e})=>{const{orderRelations:t}=_t(),{events:n,refetch:r}=Os(e),l=X(),s=Qi(),{order:a}=ge(e,{expand:t,fields:Ke}),[m,d]=y.useState(!1),[g,c]=y.useState(!1),{state:o,close:h,open:p}=ke(),x=[{icon:i(js,{size:20}),label:"Request Return",onClick:()=>d(!0)},{icon:i(mt,{size:20}),label:"Register Exchange",onClick:()=>c(!0)},{icon:i(Re,{size:20}),label:"Register Claim",onClick:p}],f=_=>{_&&s.mutate({resource_id:e,resource_type:"order",value:_},{onSuccess:()=>l("Success","Added note","success"),onError:v=>l("Error",W(v),"error")})};return u(U,{children:[u("div",{className:"h-full w-5/12 rounded-rounded border border-grey-20 bg-grey-0",children:[u("div",{className:"border-b border-grey-20 py-large px-xlarge",children:[u("div",{className:"flex items-center justify-between",children:[i("h3",{className:"inter-xlarge-semibold",children:"Timeline"}),i("div",{className:H({"pointer-events-none opacity-50":!n}),children:i(dt,{actions:x})})]}),i("div",{className:H("mt-base",{"pointer-events-none opacity-50":!n}),children:i(Ls,{onSubmit:f})})]}),i("div",{className:"py-large px-xlarge",children:n?i("div",{className:"flex flex-col",children:n.map((_,v)=>i("div",{children:Va(_,r)},v))}):i("div",{className:"flex h-96 w-full items-center justify-center",children:i(Be,{variant:"secondary",size:"large"})})})]}),m&&a&&i(Vs,{order:a,onDismiss:()=>d(!1)}),g&&a&&i(Ds,{order:a,onDismiss:()=>c(!1)}),o&&a&&i(Ms,{order:a,onClose:h})]})};function Va(e,t){switch(e.type){case"placed":return i(Ia,{event:e});case"fulfilled":return i(da,{event:e});case"note":return i(ga,{event:e});case"shipped":return i(ua,{event:e});case"canceled":return i(ya,{event:e});case"return":return i(Ea,{event:e,refetch:t});case"exchange":return i(la,{event:e,refetch:t},e.id);case"claim":return i(Js,{event:e});case"notification":return i(pa,{event:e});case"refund":return i(Ma,{event:e});case"edit-created":return i(wa,{event:e});case"edit-canceled":return i(xa,{event:e});case"edit-declined":return i(Ra,{event:e});case"edit-confirmed":return i(ba,{event:e});case"edit-requested":return i(Aa,{event:e});case"refund-required":return i(Fa,{event:e});case"payment-required":return i(ka,{event:e});default:return null}}let Le=!1;const Ta=({item:e,currencyCode:t,change:n,customerId:r,regionId:l})=>{var E,T,N,$;const s=X(),{pop:a,push:m}=Ne.useContext(Ie),d=(n==null?void 0:n.type)==="item_add",g=(n==null?void 0:n.type)==="item_update",c=!!e.fulfilled_quantity,{mutateAsync:o}=qn(e.order_edit_id),{mutateAsync:h}=Wi(e.order_edit_id,e.id),{mutateAsync:p}=Yi(e.order_edit_id,e.id),{mutateAsync:x}=Xi(e.order_edit_id,n==null?void 0:n.id),f=async S=>{if(!Le){Le=!0;try{await p({quantity:S})}finally{Le=!1}}},_=async()=>{if(!e.variant){s("Warning","Cannot duplicate an item without a variant","warning");return}try{await o({variant_id:e.variant_id,quantity:e.quantity})}catch{s("Error","Failed to duplicate item","error")}},v=async()=>{try{n?(n.type==="item_add"&&await x(),n.type==="item_update"&&(await x(),await h())):await h(),s("Success","Item removed","success")}catch{s("Error","Failed to remove item","error")}},b={title:"Replace Product Variants",onBack:a,view:i(vi,{onSubmit:async S=>{const P=S[0].id;try{await v(),await o({variant_id:P,quantity:e.quantity}),s("Success","Item added","success")}catch{s("Error","Failed to replace the item","error")}},customerId:r,regionId:l,currencyCode:t,isReplace:!0})},F=[!c&&{label:"Replace with other item",onClick:()=>m(b),icon:i(mt,{size:"20"})},{label:"Duplicate item",onClick:_,icon:i(Br,{size:"20"})},!c&&{label:"Remove item",onClick:v,variant:"danger",icon:i(ce,{size:"20"})}].filter(Boolean);return i(ue,{side:"top",open:c?void 0:!1,content:"This line item is part of a fulfillment and cannot be edited. Cancel the fulfillment to edit the line item.",children:u("div",{className:"flex justify-between mb-1 h-[64px] py-2 mx-[-5px] px-[5px] hover:bg-grey-5 rounded-rounded",children:[u("div",{className:"flex space-x-4 justify-center flex-grow-1",children:[i("div",{className:"flex h-[48px] w-[36px] rounded-rounded overflow-hidden",children:e.thumbnail?i("img",{src:e.thumbnail,className:"object-cover"}):i(ht,{})}),u("div",{className:"flex flex-col justify-center",children:[u("div",{className:"flex gap-2 items-center max-w-[310px]",children:[i("span",{className:H("font-semibold text-grey-900 flex-shrink-0 flex-grow",{"text-gray-400":c}),children:e.title}),((E=e==null?void 0:e.variant)==null?void 0:E.options)&&u("span",{className:H("text-gray-400 flex gap-3 flex-shrink-1 truncate",{"text-gray-400":c}),children:["(",e.variant.options.map(S=>S.value).join(" • "),")"]})]}),u("div",{className:"flex items-center",children:[d&&i("div",{className:"text-small text-blue-500 bg-blue-10 h-[24px] w-[42px] mr-2 flex-shrink-0 flex items-center justify-center rounded-rounded",children:"New"}),g&&i("div",{className:"text-small text-orange-500 bg-orange-10 h-[24px] w-[68px] mr-2 flex-shrink-0 flex items-center justify-center rounded-rounded",children:"Modified"}),i("div",{className:"min-h-[20px]",children:((T=e.variant)==null?void 0:T.sku)&&i(fe,{value:(N=e.variant)==null?void 0:N.sku,displayValue:i("span",{className:H("text-gray-500 flex gap-3",{"text-gray-400":c}),children:($=e.variant)==null?void 0:$.sku}),successDuration:1e3})})]})]})]}),u("div",{className:"flex items-center justify-between min-w-[312px]",children:[u("div",{className:H("flex items-center flex-grow-0 text-gray-400",{"pointer-events-none":c}),children:[i(Ye,{className:H("cursor-pointer text-gray-400",{"pointer-events-none":Le}),onClick:()=>e.quantity>1&&!c&&f(e.quantity-1)}),i("span",{className:H("px-8 text-center text-gray-900 min-w-[74px]",{"!text-gray-400":c}),children:e.quantity}),i(Ve,{className:H("cursor-pointer text-gray-400",{"pointer-events-none":Le}),onClick:()=>f(e.quantity+1)})]}),u("div",{className:"flex gap-6 items-center h-full",children:[i("div",{className:H("flex small:space-x-2 medium:space-x-4 large:space-x-6",{"!text-gray-400 pointer-events-none":c}),children:u("div",{className:H("text-gray-900 min-w-[60px] text-right",{"!text-gray-400 pointer-events-none":c}),children:[j({amount:e.unit_price*e.quantity,currency:t,tax:e.includes_tax?0:e.tax_lines,digits:2}),i("span",{className:"text-gray-400 ml-2",children:t.toUpperCase()})]})}),i(dt,{forceDropdown:!0,actions:F})]})]})]})})},nt=12,qa=e=>{const{isReplace:t,regionId:n,currencyCode:r,customerId:l,setSelectedVariants:s}=e,[a,m]=y.useState(""),[d,g]=y.useState(0),[c,o]=y.useState(0),[h,p]=y.useState(0),x=Qn(a,500),{isLoading:f,count:_,variants:v}=Mn({q:x,limit:nt,offset:d,region_id:n,customer_id:l});y.useEffect(()=>{typeof _<"u"&&o(Math.ceil(_/nt))},[_]);const C=y.useMemo(()=>[{Header:i("div",{className:"text-gray-500 text-small font-semibold",children:"Name"}),accessor:"title",Cell:({row:{original:N}})=>u("div",{className:"flex items-center",children:[i("div",{className:"h-[40px] w-[30px] my-1.5 flex items-center mr-4",children:N.product.thumbnail?i("img",{src:N.product.thumbnail,className:"h-full object-cover rounded-soft"}):i(ht,{})}),u("div",{className:"flex flex-col",children:[i("span",{children:N.product.title}),N.title]})]})},{Header:i("div",{className:"text-gray-500 text-small font-semibold",children:"SKU"}),accessor:"sku",Cell:({row:{original:N}})=>i("div",{children:N.sku})},{Header:i("div",{className:"text-gray-500 text-small font-semibold",children:"Options"}),accessor:"options",Cell:({row:{original:N}})=>{var S;const $=(S=N.options)==null?void 0:S.map(({value:P})=>P).join(", ");return i("div",{title:$,className:"truncate max-w-[160px]",children:i("span",{children:$})})}},{Header:i("div",{className:"text-right text-gray-500 text-small font-semibold",children:"In Stock"}),accessor:"inventory_quantity",Cell:({row:{original:N}})=>i("div",{className:"text-right",children:N.inventory_quantity})},{Header:i("div",{className:"text-right text-gray-500 text-small font-semibold",children:"Price"}),accessor:"amount",Cell:({row:{original:N}})=>{if(!N.original_price_incl_tax)return null;const $=N.calculated_price_type!=="default";return u("div",{className:"flex justify-end items-center gap-2",children:[u("div",{className:"flex flex-col items-end",children:[$&&i("span",{className:"text-gray-400 line-through",children:j({amount:N.original_price_incl_tax,currency:r})}),i("span",{children:j({amount:N.calculated_price_incl_tax,currency:r})})]}),u("span",{className:"text-gray-400",children:[" ",r.toUpperCase()]})]})}}],[]),b=Ge.useTable({columns:C,data:v||[],manualPagination:!0,initialState:{pageIndex:h,pageSize:nt,selectedRowIds:{}},pageCount:c,autoResetSelectedRows:!1,autoResetPage:!1,getRowId:N=>N.id},Ge.usePagination,Ge.useRowSelect,N=>{N.visibleColumns.push($=>[{id:"selection",Header:({getToggleAllRowsSelectedProps:S})=>t?null:i("div",{children:i(oe,{...S(),type:t?"radio":"checkbox"})}),Cell:({row:S,toggleAllRowsSelected:P,toggleRowSelected:q})=>{const G=S.getToggleRowSelectedProps(),A=S.getToggleRowSelectedProps();return i("div",{className:H({"mr-2":t}),children:i(oe,{...A,type:t?"radio":"checkbox",onChange:t?()=>{P(!1),q(S.id,!G.checked)}:A.onChange})})}},...$])});y.useEffect(()=>{if(!v)return;const N=v.filter($=>b.state.selectedRowIds[$.id]);s(N)},[b.state.selectedRowIds,v]);const F=()=>{b.canNextPage&&(g(N=>N+b.state.pageSize),p(N=>N+1),b.nextPage())},E=()=>{b.canPreviousPage&&(g(N=>Math.max(N-b.state.pageSize,0)),p(N=>N-1),b.previousPage())},T=N=>{g(0),p(0),m(N)};return i(Hn,{hasPagination:!0,isLoading:f,numberOfRows:nt,pagingState:{count:_,offset:d,pageSize:d+b.rows.length,title:"Products",currentPage:b.state.pageIndex+1,pageCount:b.pageCount,nextPage:F,prevPage:E,hasNext:b.canNextPage,hasPrev:b.canPreviousPage},children:u(k,{immediateSearchFocus:!0,enableSearch:!0,searchPlaceholder:"Search Product Variants...",searchValue:a,handleSearch:T,...b.getTableProps(),children:[b.headerGroups.map(N=>i(k.HeadRow,{...N.getHeaderGroupProps(),children:N.headers.map($=>i(k.HeadCell,{...$.getHeaderProps(),children:$.render("Header")}))})),i(k.Body,{...b.getTableBodyProps(),children:b.rows.map(N=>(b.prepareRow(N),i(k.Row,{...N.getRowProps(),children:N.cells.map($=>i(k.Cell,{...$.getCellProps(),children:$.render("Cell")}))})))})]})})};function Da(e){const{currencyCode:t,amountPaid:n,newTotal:r,differenceDue:l}=e;return u(U,{children:[i("div",{className:"h-px w-full bg-grey-20 mb-6"}),u("div",{className:"flex justify-between h-[40px] mb-2",children:[i("span",{className:"text-gray-500",children:"Amount Paid"}),u("span",{className:"text-gray-900",children:[j({amount:n,currency:t}),u("span",{className:"text-gray-400",children:[" ",t.toUpperCase()]})]})]}),u("div",{className:"flex justify-between h-[40px] mb-2",children:[i("span",{className:"text-gray-900 font-semibold",children:"New Total"}),i("span",{className:"text-2xl font-semibold",children:j({amount:r,currency:t})})]}),u("div",{className:"flex justify-between",children:[i("span",{className:"text-gray-500",children:"Difference Due"}),u("span",{className:H("text-gray-900",{"text-rose-500":l<0,"text-emerald-500":l>=0}),children:[j({amount:l,currency:t}),u("span",{className:"text-gray-400",children:[" ",t.toUpperCase()]})]})]}),i("div",{className:"h-px w-full bg-grey-20 mt-8 mb-6"})]})}function vi(e){const{pop:t}=Ne.useContext(Ie),[n,r]=y.useState([]),l=async()=>{await e.onSubmit(n),t()},s=()=>{r([]),t()};return u(U,{children:[i(V.Content,{children:i("div",{className:"min-h-[680px] flex flex-col justify-between",children:i(qa,{regionId:e.regionId,customerId:e.customerId,currencyCode:e.currencyCode,isReplace:!!e.isReplace,setSelectedVariants:r})})}),i(V.Footer,{children:u("div",{className:"flex justify-end w-full space-x-xsmall",children:[i(M,{variant:"secondary",size:"small",onClick:s,children:"Back"}),i(M,{variant:"primary",size:"small",onClick:l,children:"Save and go back"})]})})]})}function Oa(e){const{close:t,currentSubtotal:n,orderEdit:r,currencyCode:l,regionId:s,customerId:a,paidTotal:m,refundedTotal:d}=e,g=y.useRef(),c=X(),[o,h]=y.useState(),[p,x]=y.useState(!1),[f,_]=y.useState(""),v=n!==r.subtotal,C=!!r.changes.length,{mutateAsync:b,isLoading:F}=Zi(r.id),{mutateAsync:E,isLoading:T}=Ji(r.id),{mutateAsync:N}=Tn(r.id),{mutateAsync:$}=qn(r.id),S=y.useContext(Ie),P=async()=>{try{await b(),o&&await E({internal_note:o}),c("Success","Order edit set as requested","success")}catch{c("Error","Failed to request confirmation","error")}t()},q=async()=>{await N(),t()};y.useEffect(()=>{p&&g.current.focus()},[p]);const G=async R=>{try{const z=R.map(O=>$({variant_id:O.id,quantity:1}));await Promise.all(z),c("Success","Added successfully","success")}catch{c("Error","Error occurred","error")}},A=()=>{p&&_(""),x(R=>!R)};let I=r.items.sort((R,z)=>new Date(R.created_at)-new Date(z.created_at));f&&(I=I.filter(R=>{var z;return R.title.toLowerCase().includes(f)||((z=R.variant)==null?void 0:z.sku.toLowerCase().includes(f))}));const w={title:"Add Product Variants",onBack:S.pop,view:i(vi,{onSubmit:G,customerId:a,regionId:s,currencyCode:l})};return i(ot,{open:!0,isLargeModal:!0,handleClose:q,context:S,children:u(V.Body,{children:[i(V.Header,{handleClose:q,children:i("h1",{className:"inter-xlarge-semibold",children:"Edit Order"})}),u(V.Content,{children:[u("div",{className:"flex justify-between items-center mb-4",children:[i("span",{className:"text-gray-900 text-large font-semibold",children:"Items"}),u("div",{className:"flex items-center justify-between",children:[i(M,{size:"small",variant:"ghost",className:"border border-grey-20 text-gray-900 flex-shrink-0 h-[32px] mr-2",onClick:()=>S.push(w),children:"Add items"}),!p&&i(M,{size:"small",variant:"secondary",className:H("h-full flex-shrink-0 w-[32px] h–[32px]",{"focus:bg-grey-20":p}),onClick:()=>x(!0),children:i(pn,{size:16,className:"text-gray-500"})}),p&&i(ze,{small:!0,deletable:!0,ref:g,value:f,onDelete:A,placeholder:"Filter items...",onChange:R=>_(R.target.value),prefix:i(pn,{size:14,className:"text-gray-400"})})]})]}),I.map(R=>i(Ta,{item:R,customerId:a,regionId:s,currencyCode:l,change:r.changes.find(z=>z.line_item_id===R.id||z.original_line_item_id===R.id)},R.id)),i("div",{className:"mt-8"}),v&&i(Da,{currencyCode:l,amountPaid:m-d,newTotal:r.total,differenceDue:r.total-m+d}),C&&u("div",{className:"flex items-center justify-between",children:[i("span",{className:"text-gray-500",children:"Note"}),i(ze,{className:"max-w-[455px]",placeholder:"Add a note...",onChange:R=>h(R.target.value),value:o})]})]}),i(V.Footer,{children:u("div",{className:"flex items-center justify-end w-full gap-2",children:[i(M,{variant:"secondary",size:"small",type:"button",onClick:q,children:"Cancel"}),i(M,{variant:"primary",size:"small",type:"button",disabled:T||F,loading:T||F,onClick:P,children:"Save and close"})]})})]})})}let qt=!1;function Ha(e){const{order:t}=e,n=X(),{hideModal:r,orderEdits:l,activeOrderEditId:s,setActiveOrderEdit:a}=y.useContext(Qe),{mutateAsync:m}=Ki(),d=l==null?void 0:l.find(c=>c.id===s);y.useEffect(()=>{s||qt||(qt=!0,m({order_id:t.id}).then(({order_edit:c})=>a(c.id)).catch(()=>{n("Error","There is already an active order edit on this order","error"),r()}).finally(()=>qt=!1))},[s]);const g=()=>{r()};return d?i(Oa,{close:g,orderEdit:d,currentSubtotal:t.subtotal,regionId:t.region_id,customerId:t.customer_id,currencyCode:t.currency_code,paidTotal:t.paid_total,refundedTotal:t.refunded_total}):null}const ja=({orderId:e,email:t,handleClose:n})=>{const{mutate:r,isLoading:l}=Dn(e),{register:s,handleSubmit:a}=Me({defaultValues:{email:t}}),m=X();return i(V,{handleClose:n,isLargeModal:!0,children:i("form",{onSubmit:a(g=>{const c={email:g.email};return r(c,{onSuccess:()=>{m("Success","Successfully updated the email address","success"),n()},onError:o=>m("Error",W(o),"error")})}),children:u(V.Body,{children:[i(V.Header,{handleClose:n,children:i("span",{className:"inter-xlarge-semibold",children:"Email Address"})}),i(V.Content,{children:i("div",{className:"space-y-4",children:i("div",{className:"flex mt-4 space-x-4",children:i(ze,{label:"Email",...s("email"),placeholder:"Email"})})})}),i(V.Footer,{children:u("div",{className:"flex w-full h-8 justify-end",children:[i(M,{variant:"ghost",className:"mr-2 w-32 text-small justify-center",size:"large",type:"button",onClick:n,children:"Cancel"}),i(M,{size:"large",className:"w-32 text-small justify-center",variant:"primary",loading:l,disabled:l,type:"submit",children:"Save"})]})})]})})})},La=({orderId:e,fulfillment:t,handleCancel:n})=>{const{control:r,watch:l,handleSubmit:s}=Me({defaultValues:{tracking_numbers:[{value:""}]},shouldUnregister:!0}),[a,m]=y.useState(!1),{fields:d,append:g,remove:c}=gt({control:r,name:"tracking_numbers"}),o=l("tracking_numbers"),h=d.map((b,F)=>({...b,...o[F]})),p=er(e),x=tr(e),f=nr(e),_=p.isLoading||x.isLoading||f.isLoading,v=X();return i(V,{handleClose:n,isLargeModal:!0,children:i("form",{onSubmit:s(b=>{const F=t.claim_order_id||t.swap_id||t.order_id,[E]=F.split("_"),T=b.tracking_numbers.map(P=>P.value);let N=p,$="Successfully marked order as shipped",S;switch(E){case"swap":N=x,S={fulfillment_id:t.id,swap_id:F,tracking_numbers:T,no_notification:a},$="Successfully marked swap as shipped";break;case"claim":N=f,S={fulfillment_id:t.id,claim_id:F,tracking_numbers:T},$="Successfully marked claim as shipped";break;default:S={fulfillment_id:t.id,tracking_numbers:T,no_notification:a};break}N.mutate(S,{onSuccess:()=>{v("Success",$,"success"),n()},onError:P=>v("Error",W(P),"error")})},b=>{console.log(b)}),children:u(V.Body,{children:[i(V.Header,{handleClose:n,children:i("span",{className:"inter-xlarge-semibold",children:"Mark Fulfillment Shipped"})}),u(V.Content,{children:[u("div",{className:"flex flex-col",children:[i("span",{className:"inter-base-semibold mb-2",children:"Tracking"}),i("div",{className:"flex flex-col space-y-2",children:h.map((b,F)=>i(ie,{name:`tracking_numbers.${F}.value`,control:r,rules:{shouldUnregister:!0},render:({field:E})=>i(ze,{deletable:F!==0,label:F===0?"Tracking number":"",type:"text",placeholder:"Tracking number...",...E,onDelete:()=>c(F)})},b.id))})]}),i("div",{className:"flex w-full justify-end mt-4",children:i(M,{size:"small",onClick:()=>g({value:void 0}),variant:"secondary",disabled:h.some(b=>!b.value),children:"+ Add Additional Tracking Number"})})]}),i(V.Footer,{children:u("div",{className:"flex w-full h-8 justify-between",children:[u("div",{className:"items-center h-full flex cursor-pointer",onClick:()=>m(!a),children:[i("div",{className:`w-5 h-5 flex justify-center text-grey-0 border-grey-30 border rounded-base ${!a&&"bg-violet-60"}`,children:i("span",{className:"self-center",children:!a&&i($e,{size:16})})}),i("input",{id:"noNotification",className:"hidden",name:"noNotification",checked:!a,type:"checkbox"}),u("span",{className:"ml-3 flex items-center text-grey-90 gap-x-xsmall",children:["Send notifications",i(me,{content:""})]})]}),u("div",{className:"flex",children:[i(M,{variant:"ghost",className:"mr-2 w-32 text-small justify-center",size:"large",onClick:n,type:"button",children:"Cancel"}),i(M,{size:"large",className:"w-32 text-small justify-center",variant:"primary",type:"submit",loading:_,disabled:_,children:"Complete"})]})]})})]})})})},Ga=({item:e,currencyCode:t})=>u("div",{className:"flex justify-between mb-1 h-[64px] py-2 mx-[-5px] px-[5px] hover:bg-grey-5 rounded-rounded",children:[u("div",{className:"flex space-x-4 justify-center",children:[i("div",{className:"flex h-[48px] w-[36px] rounded-rounded overflow-hidden",children:e.thumbnail?i("img",{src:e.thumbnail,className:"object-cover"}):i(ht,{})}),u("div",{className:"flex flex-col justify-center max-w-[185px]",children:[i("span",{className:"inter-small-regular text-grey-90 truncate",children:e.title}),(e==null?void 0:e.variant)&&i("span",{className:"inter-small-regular text-grey-50 truncate",children:`${e.variant.title}${e.variant.sku?` (${e.variant.sku})`:""}`})]})]}),u("div",{className:"flex  items-center",children:[u("div",{className:"flex small:space-x-2 medium:space-x-4 large:space-x-6 mr-3",children:[i("div",{className:"inter-small-regular text-grey-50",children:j({amount:((e==null?void 0:e.total)??0)/e.quantity,currency:t,digits:2,tax:[]})}),u("div",{className:"inter-small-regular text-grey-50",children:["x ",e.quantity]}),i("div",{className:"inter-small-regular text-grey-90",children:j({amount:e.total??0,currency:t,digits:2,tax:[]})})]}),i("div",{className:"inter-small-regular text-grey-50",children:t.toUpperCase()})]})]}),Ba=e=>{var n,r;if(!e)return[];const t=[];return e.fulfillments.forEach((l,s)=>{t.push({title:`Fulfillment #${s+1}`,type:"default",fulfillment:l})}),(n=e.claims)!=null&&n.length&&e.claims.forEach(l=>{l.fulfillment_status!=="not_fulfilled"&&l.fulfillments.forEach((s,a)=>{t.push({title:`Claim fulfillment #${a+1}`,type:"claim",fulfillment:s,claim:l})})}),(r=e.swaps)!=null&&r.length&&e.swaps.forEach(l=>{l.fulfillment_status!=="not_fulfilled"&&l.fulfillments.forEach((s,a)=>{t.push({title:`Swap fulfillment #${a+1}`,type:"swap",fulfillment:s,swap:l})})}),t},Ua=()=>{var z,O,B,Y;const{id:e}=ir(),{isFeatureEnabled:t}=Ne.useContext(at),n=ft(),[r,l]=y.useState(null),[s,a]=y.useState(null),{state:m,toggle:d}=ke(),[g,c]=y.useState(!1),[o,h]=y.useState(!1),[p,x]=y.useState(null),{order:f,isLoading:_}=ge(e),v=rr(e),C=lr(e),{mutate:b}=Dn(e),{region:F}=En(f==null?void 0:f.region_id,{enabled:!!(f!=null&&f.region_id)}),E=On(),T=X(),[,N]=fn(`${f==null?void 0:f.display_id}`,{successDuration:5500,onCopied:()=>T("Success","Order ID copied","success")}),[,$]=fn(f==null?void 0:f.email,{successDuration:5500,onCopied:()=>T("Success","Email copied","success")});un("esc",()=>E("/a/orders")),un("command+i",N);const{hasMovements:S,swapAmount:P,manualRefund:q,swapRefund:G,returnRefund:A}=y.useMemo(()=>{var le;let L=0,te=0,pe=0;const be=Pe.sum((f==null?void 0:f.swaps.map(K=>K.difference_due))||[0]);return(le=f==null?void 0:f.refunds)!=null&&le.length&&f.refunds.forEach(K=>{(K.reason==="other"||K.reason==="discount")&&(L+=K.amount),K.reason==="return"&&(pe+=K.amount),K.reason==="swap"&&(te+=K.amount)}),{hasMovements:be+L+te+pe!==0,swapAmount:be,manualRefund:L,swapRefund:te,returnRefund:pe}},[f]),I=async()=>{if(await n({heading:"Cancel order",text:"Are you sure you want to cancel the order?",extraConfirmation:!0,entityName:`order #${f==null?void 0:f.display_id}`}))return C.mutate(void 0,{onSuccess:()=>T("Success","Successfully canceled order","success"),onError:te=>T("Error",W(te),"error")})},w=Ba(f),R=[{label:"Go to Customer",icon:i(Rr,{size:"20"}),onClick:()=>E(`/a/customers/${f==null?void 0:f.customer.id}`)},{label:"Transfer ownership",icon:i(mt,{size:"20"}),onClick:()=>d()}];return R.push({label:"Edit Shipping Address",icon:i(Kt,{size:"20"}),onClick:()=>l({address:f==null?void 0:f.shipping_address,type:Dt.SHIPPING})}),R.push({label:"Edit Billing Address",icon:i(Gn,{size:"20"}),onClick:()=>{l({address:f==null?void 0:f.billing_address,type:Dt.BILLING})}}),f!=null&&f.email&&R.push({label:"Edit Email Address",icon:i(Xt,{size:"20"}),onClick:()=>{a({email:f==null?void 0:f.email})}}),!f&&_?i("div",{className:"flex h-full w-full items-center justify-center",children:i(Be,{size:"small",variant:"secondary"})}):(!f&&!_&&E("/404"),i("div",{children:u(Sa,{orderId:e,children:[i(Ar,{currentPage:"Order Details",previousBreadcrumb:"Orders",previousRoute:"/a/orders"}),_||!f?i(Ce,{className:"flex w-full items-center justify-center pt-2xlarge",children:i(Be,{size:"large",variant:"secondary"})}):u(U,{children:[u("div",{className:"flex space-x-4",children:[u("div",{className:"flex h-full w-7/12 flex-col",children:[i(Ce,{className:"mb-4 min-h-[200px] w-full",customHeader:i(ue,{side:"top",content:"Copy ID",children:u("button",{className:"inter-xlarge-semibold flex cursor-pointer items-center gap-x-2 text-grey-90 active:text-violet-90",onClick:N,children:["#",f.display_id," ",i(gn,{size:16})]})}),subtitle:Ue(f.created_at).format("D MMMM YYYY hh:mm a"),status:i(Qr,{status:f.status}),forceDropdown:!0,actionables:[{label:"Cancel Order",icon:i(Fe,{size:"20"}),variant:"danger",onClick:()=>I()}],children:u("div",{className:"mt-6 flex space-x-6 divide-x",children:[u("div",{className:"flex flex-col",children:[i("div",{className:"inter-smaller-regular mb-1 text-grey-50",children:"Email"}),u("button",{className:"flex cursor-pointer items-center gap-x-1 text-grey-90 active:text-violet-90",onClick:$,children:[f.email,i(gn,{size:12})]})]}),u("div",{className:"flex flex-col pl-6",children:[i("div",{className:"inter-smaller-regular mb-1 text-grey-50",children:"Phone"}),i("div",{children:((z=f.shipping_address)==null?void 0:z.phone)||"N/A"})]}),u("div",{className:"flex flex-col pl-6",children:[i("div",{className:"inter-smaller-regular mb-1 text-grey-50",children:"Payment"}),i("div",{children:(O=f.payments)==null?void 0:O.map(L=>Pe.capitalize(L.provider_id)).join(", ")})]})]})}),i(Qe.Consumer,{children:({showModal:L})=>{var te,pe,be;return i(Ce,{className:"mb-4 h-auto min-h-0 w-full",title:"Summary",actionables:t("order_editing")?[{label:"Edit Order",onClick:L}]:void 0,children:u("div",{className:"mt-6",children:[(te=f.items)==null?void 0:te.map((le,K)=>i(Ga,{item:le,currencyCode:f.currency_code},K)),i(ne,{currency:f.currency_code,totalAmount:f.subtotal,totalTitle:"Subtotal"}),(pe=f==null?void 0:f.discounts)==null?void 0:pe.map((le,K)=>i(ne,{currency:f.currency_code,totalAmount:-1*f.discount_total,totalTitle:u("div",{className:"inter-small-regular flex items-center text-grey-90",children:["Discount:"," ",i(dn,{className:"ml-3",variant:"default",children:le.code})]})},K)),(be=f==null?void 0:f.gift_cards)==null?void 0:be.map((le,K)=>i(ne,{currency:f.currency_code,totalAmount:-1*f.gift_card_total,totalTitle:u("div",{className:"inter-small-regular flex items-center text-grey-90",children:["Gift card:",i(dn,{className:"ml-3",variant:"default",children:le.code}),i("div",{className:"ml-2",children:i(fe,{value:le.code,showValue:!1,iconSize:16})})]})},K)),i(ne,{currency:f.currency_code,totalAmount:f.shipping_total,totalTitle:"Shipping"}),i(ne,{currency:f.currency_code,totalAmount:f.tax_total,totalTitle:"Tax"}),i(ne,{variant:"large",currency:f.currency_code,totalAmount:f.total,totalTitle:S?"Original Total":"Total"}),i(Ur,{manualRefund:q,swapAmount:P,swapRefund:G,returnRefund:A,paidTotal:f.paid_total,refundedTotal:f.refunded_total,currency:f.currency_code})]})})}}),i(Ce,{className:"mb-4 h-auto min-h-0 w-full",title:"Payment",status:i(jr,{status:f.payment_status}),customActionable:i(Yr,{order:f,capturePayment:v,showRefundMenu:()=>h(!0)}),children:u("div",{className:"mt-6",children:[f.payments.map(L=>u("div",{className:"flex flex-col",children:[i(ne,{currency:f.currency_code,totalAmount:L.amount,totalTitle:L.id,subtitle:`${Ue(L.created_at).format("DD MMM YYYY hh:mm")}`}),!!L.amount_refunded&&u("div",{className:"mt-4 flex justify-between",children:[u("div",{className:"flex",children:[i("div",{className:"mr-2 text-grey-40",children:i(Xn,{})}),i("div",{className:"inter-small-regular text-grey-90",children:"Refunded"})]}),u("div",{className:"flex",children:[u("div",{className:"inter-small-regular mr-3 text-grey-90",children:["-",j({amount:L.amount_refunded,currency:f.currency_code})]}),i("div",{className:"inter-small-regular text-grey-50",children:f.currency_code.toUpperCase()})]})]})]},L.id)),u("div",{className:"mt-4 flex justify-between",children:[i("div",{className:"inter-small-semibold text-grey-90",children:"Total Paid"}),u("div",{className:"flex",children:[i("div",{className:"inter-small-semibold mr-3 text-grey-90",children:j({amount:f.paid_total-f.refunded_total,currency:f.currency_code})}),i("div",{className:"inter-small-regular text-grey-50",children:f.currency_code.toUpperCase()})]})]})]})}),i(Ce,{className:"mb-4 h-auto min-h-0 w-full",title:"Fulfillment",status:i(Lr,{status:f.fulfillment_status}),customActionable:f.fulfillment_status!=="fulfilled"&&f.status!=="canceled"&&f.fulfillment_status!=="shipped"&&i(M,{variant:"secondary",size:"small",onClick:()=>c(!0),children:"Create Fulfillment"}),children:u("div",{className:"mt-6",children:[f.shipping_methods.map(L=>{var te;return u("div",{className:"flex flex-col",children:[i("span",{className:"inter-small-regular text-grey-50",children:"Shipping Method"}),i("span",{className:"inter-small-regular mt-2 text-grey-90",children:((te=L==null?void 0:L.shipping_option)==null?void 0:te.name)||""}),i("div",{className:"mt-4 flex w-full flex-grow items-center",children:i(Ir,{data:L==null?void 0:L.data})})]},L.id)}),i("div",{className:"inter-small-regular mt-6 ",children:w.map((L,te)=>i(Xr,{order:f,fulfillmentObj:L,setFullfilmentToShip:x},te))})]})}),i(Ce,{className:"mb-4 h-auto min-h-0 w-full",title:"Customer",actionables:R,children:u("div",{className:"mt-6",children:[u("div",{className:"flex w-full items-center space-x-4",children:[i("div",{className:"flex h-[40px] w-[40px] ",children:i(Yt,{user:f.customer,font:"inter-large-semibold",color:"bg-fuschia-40"})}),u("div",{children:[i("h1",{className:"inter-large-semibold text-grey-90",children:wr(f)}),f.shipping_address&&u("span",{className:"inter-small-regular text-grey-50",children:[f.shipping_address.city,","," ",Wt[(B=f.shipping_address.country_code)==null?void 0:B.toUpperCase()]]})]})]}),u("div",{className:"mt-6 flex space-x-6 divide-x",children:[u("div",{className:"flex flex-col",children:[i("div",{className:"inter-small-regular mb-1 text-grey-50",children:"Contact"}),u("div",{className:"inter-small-regular flex flex-col",children:[i("span",{children:f.email}),i("span",{children:((Y=f.shipping_address)==null?void 0:Y.phone)||""})]})]}),i(mn,{title:"Shipping",addr:f.shipping_address}),i(mn,{title:"Billing",addr:f.billing_address})]})]})}),i("div",{className:"mt-large",children:i($r,{data:f,title:"Raw order"})})]}),i(za,{orderId:f.id})]}),r&&i(Nr,{handleClose:()=>l(null),submit:b,address:r.address||void 0,type:r.type,allowedCountries:F==null?void 0:F.countries}),s&&i(ja,{handleClose:()=>a(null),email:s.email,orderId:f.id}),g&&i(ln,{orderToFulfill:f,handleCancel:()=>c(!1),orderId:f.id}),o&&i(xi,{order:f,onDismiss:()=>h(!1)}),m&&i(Gr,{order:f,onDismiss:d}),p&&i(La,{handleCancel:()=>x(null),fulfillment:p,orderId:f.id}),i(Qe.Consumer,{children:({isModalVisible:L})=>L&&i(Ha,{order:f})})]})]})}))};function Qa(e){var n;const t={filterable_fields:{fulfillment_status:e.fulfillment.filter,payment_status:e.payment.filter,region_id:e.region.filter,status:e.status.filter,created_at:Object.keys(e.date.filter||{}).reduce((r,l)=>(r[l]=new Date(Number(e.date.filter[l])*1e3).toISOString(),r),{})}};for(const r in t.filterable_fields)(t.filterable_fields[r]===null||((n=t.filterable_fields[r])==null?void 0:n.length)===0)&&delete t.filterable_fields[r];return t}const Wa=["orders","drafts"],Ya=()=>{const e="orders",{resetInterval:t}=y.useContext(br),n=On(),r=ar(),l=X(),[s,a]=y.useState(),{open:m,close:d,state:g}=ke(!1),c=y.useMemo(()=>[u(M,{variant:"secondary",size:"small",onClick:()=>m(),children:[i(or,{size:20}),"Export Orders"]})],[e]);return u(U,{children:[i("div",{className:"flex flex-col grow h-full",children:i("div",{className:"w-full flex flex-col grow",children:i(Ce,{customHeader:i(dr,{views:Wa,setActiveView:h=>{h==="drafts"&&n("/a/draft-orders")},activeView:e}),className:"h-fit",customActionable:c,children:i(xl,{setContextFilters:a})})})}),g&&i(cr,{title:"Export Orders",handleClose:()=>d(),onSubmit:()=>{const h={dry_run:!1,type:"order-export",context:s?Qa(s):{}};r.mutate(h,{onSuccess:()=>{t(),l("Success","Successfully initiated export","success")},onError:p=>{l("Error",W(p),"error")}}),d()},loading:r.isLoading})]})},vc=()=>u(sr,{children:[i(an,{index:!0,element:i(Ya,{})}),i(an,{path:"/:id",element:i(Ua,{})})]});export{vc as default};
