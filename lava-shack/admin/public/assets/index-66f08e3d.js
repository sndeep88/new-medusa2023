import{r as P,a as e,G as U,u as k,bF as x,j as u,B as T,C as M,d as j,cC as A,c as G,bB as L,F as q,R as V,b as w}from"./index-effbfb95.js";import{B as Y}from"./body-card-d3fddb8c.js";import{I as H,P as $}from"./index-dd9f9076.js";import{T as O}from"./index-a6859a1b.js";import{u as J,F as Q,a as K,C as W}from"./index.esm-5a89640b.js";import{F as C}from"./focus-modal-d105ce27.js";import{u as F}from"./use-notification-9f7c3c92.js";import{g as v}from"./error-messages-d2d0bb30.js";import{E as X}from"./Editor-bf113ee3.js";import{r as Z,a as ee,T as m}from"./index-0d9858ea.js";import{b as f}from"./shared-f9889298.js";import{u as ae}from"./use-debounce-438a4ce8.js";import{T as te}from"./trash-icon-abcb5140.js";import{U as re,P as se}from"./index-4a064b3c.js";import{S as I}from"./index-04f3341e.js";import{h as ne}from"./moment-fbc5633a.js";import{B as le}from"./index-d895e52c.js";import"./lodash-72dfe3e0.js";import"./index-1ec19c89.js";import"./index-0f96226b.js";import"./chevron-down-6a69fe38.js";const B=P.createContext(null),E=({children:a,page:t})=>{const r=J({defaultValues:t??{title:"",content:"<p>Enter page content</p>"}}),n=s=>r.handleSubmit(g=>{s({...g})});return e(Q,{...r,children:e(B.Provider,{value:{handleSubmit:n},children:a})})},R=()=>{const a=P.useContext(B),t=K();if(a===null)throw new Error("usePageForm must be used within a PageFormProvider");return{...t,...a}};function ie(a){const{id:t}=U(),r=k(),{handleSubmit:n}=R(),s=F(),g=()=>{a.viewType!=="create"&&a.onClose?a.onClose():r(-1)},o=x("/pages",["pages"]),c=x(`/pages/${t}`,["pages",t]),d=async p=>{try{await o.mutateAsync(p),s("Success","Page created","success")}catch(i){s("Error",v(i),"error")}finally{r("/a/pages")}},l=async p=>{try{await c.mutateAsync(p),s("Success","Page updated","success")}catch(i){s("Error",v(i),"error")}finally{r("/a/pages")}};let h;switch(a.viewType){case"create":h={label:"Publish",onClick:n(d)};break;case"update":h={label:"Update",onClick:n(l)};break}return u("div",{className:"flex w-full justify-between px-8 medium:w-8/12",children:[e(T,{size:"small",variant:"ghost",onClick:g,className:"h-8 w-8 rounded-rounded border",children:e(M,{size:20})}),e("div",{className:"flex gap-x-small",children:e(T,{size:"small",variant:"primary",onClick:h.onClick,className:"rounded-rounded",children:h.label})})]})}const z=a=>{const{control:t,register:r}=R(),n=P.useRef(null),s=P.useRef(null);return u(C,{children:[e(C.Header,{children:e(ie,{...a})}),e(C.Main,{children:e("div",{className:"mb-[25%] flex justify-center",children:u("div",{className:"w-full pt-16 small:w-4/5 medium:w-7/12 large:w-6/12",children:[e("h1",{className:"inter-xlarge-semibold mb-[28px]",children:a.viewType==="create"?"Create new page":"Edit page"}),u("div",{className:"accordion-margin-transition flex flex-col gap-y-small group-radix-state-open:mt-5",children:[e(H,{label:"Title",required:!0,placeholder:"Page title",...r("title",{required:"Title is required"})}),a.viewType==="update"&&e(H,{label:"Slug",placeholder:"Page slug",...r("slug"),prefix:"/pages/"}),e(W,{name:"content",control:t,render:({field:{value:g,onChange:o,...c}})=>u("div",{className:"w-full",children:[e("div",{className:j("inter-small-semibold mb-xsmall flex w-full items-center text-grey-50"),children:e("label",{children:"Content"})}),u("div",{className:"w-full",children:[e(X,{onInit:(d,l)=>n.current=l,value:g??"<p></p>",init:{height:500,menubar:!0,plugins:["advlist","autolink","lists","link","image","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","code","wordcount"],toolbar:"undo redo | styleselect | bold italic forecolor | link | image",color_cols:5,a11y_advanced_options:!0,automatic_uploads:!0,file_picker_types:"image",file_picker_callback(d,l,h){s.current&&(s.current.addEventListener("change",p=>{var y;const i=(y=p.target)!=null&&y.files?p.target.files[0]:null;if(!i||!n.current)return;const b=new FileReader;b.addEventListener("load",()=>{const _="blobid"+new Date().getTime(),S=n.current.editorUpload.blobCache,D=b.result.split(",")[1],N=S.create(_,i,D);S.add(N),d(N.blobUri(),{title:i.name})}),b.readAsDataURL(i)}),s.current.click())},content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"},tinymceScriptSrc:"/tinymce/js/tinymce/tinymce.min.js",onEditorChange:d=>{o(d)}}),e("input",{hidden:!0,type:"file",accept:"image/*",ref:s})]})]})})]})]})})})]})};function oe(){return e(E,{children:e(z,{viewType:"create"})})}function ce(a){return e(m.HeadCell,{className:"w-[100px]",...a.col.getHeaderProps(),children:a.col.render("Header")})}function de(a){return e(m.HeadRow,{...a.headerGroup.getHeaderGroupProps(),children:a.headerGroup.headers.map(t=>e(ce,{col:t},t.id))})}function ue(a){const{row:t}=a,r=F(),n=x(`/pages/${t.original.id}`,["pages",t.original.id]),s=A(`/pages/${t.original.id}`,["pages",t.original.id]),g=()=>{n.mutate({status:t.original.status===f.PUBLISH?f.UNPUBLISH:f.PUBLISH},{onSuccess:()=>{r("Success","Unpublish page","success")},onError:c=>{r("Error",v(c),"error")}})},o=()=>{s.mutate(void 0,{onSuccess:()=>{r("Success","Page deleted","success")},onError:c=>{r("Error",v(c),"error")}})};return e(m.Row,{color:"inherit",linkTo:t.original.id,id:t.original.id,className:"group",actions:[{label:t.original.status===f.PUBLISH?"UnPublish":"Publish",onClick:g,icon:t.original.status===f.PUBLISH?e(re,{size:20}):e(se,{size:20})},{label:"Delete",onClick:o,icon:e(te,{size:20}),variant:"danger"}],...t.getRowProps(),children:t.cells.map((c,d)=>c.render("Cell",{index:d}))})}function me(a){const[t,r]=P.useState(""),{columns:n,count:s,pages:g,options:o,isLoading:c}=a,d={columns:n,data:g||[],initialState:{pageSize:10,pageIndex:0},pageCount:Math.ceil(s/10),manualPagination:!0,autoResetPage:!1},l=Z.useTable(d),h=()=>{},p=()=>{};return ae(t,500),e(ee,{isLoading:c,numberOfRows:10,hasPagination:!0,pagingState:{count:s,offset:0,pageSize:10,title:"Pages",currentPage:l.state.pageIndex+1,pageCount:l.pageCount,nextPage:h,prevPage:p,hasNext:l.canNextPage,hasPrev:l.canPreviousPage},children:u(m,{...l.getTableProps(),...o,enableSearch:o.enableSearch,searchValue:t,handleSearch:o.enableSearch?r:void 0,filteringOptions:o.filter,children:[e(m.Head,{children:l.headerGroups.map((i,b)=>e(de,{headerGroup:i},b))}),e(m.Body,{...l.getTableBodyProps(),children:l.rows.map(i=>(l.prepareRow(i),e(ue,{row:i})))})]})})}const ge=a=>{switch(a){case f.PUBLISH:return e(I,{variant:"primary",title:"Published"});case f.UNPUBLISH:return e(I,{variant:"danger",title:"UnPublished"});default:return null}},pe=[{Header:"Title",accessor:"title",Cell:({cell:{value:a}})=>e(m.Cell,{children:e("span",{className:"inter-small-regular",children:a})})},{Header:"Slug",accessor:"slug",Cell:({cell:{value:a}})=>e(m.Cell,{children:u("span",{className:"inter-small-regular",children:["/pages/",a]})})},{Header:"Status",accessor:"status",Cell:({row:{original:a}})=>e(m.Cell,{children:ge(a.status)})},{Header:"Last Update",accessor:"updatedAt",Cell:({cell:{value:a}})=>e(m.Cell,{children:ne(a).format("DD MMM YYYY")})}];function he(){G();const{data:a,isLoading:t}=L("/pages",["pages"]),r=(a==null?void 0:a.pages)??[],n={};return e("div",{children:e(me,{isLoading:t,columns:pe,count:r.length,pages:r,options:{enableSearch:!0,filter:e(q,{})},...n})})}const fe=()=>{const{id:a}=U(),{data:t,isLoading:r}=L(`/pages/${a}`,["pages",a]);return u("div",{className:"pb-xlarge",children:[e(le,{currentPage:"Edit page",previousBreadcrumb:"Pages",previousRoute:"/a/pages"}),!r&&t.page?e(E,{page:t.page,children:e(z,{viewType:"update"})}):null]})},be=()=>{const a=k();return e("div",{className:"flex h-full flex-col",children:e("div",{className:"flex w-full grow flex-col",children:e(Y,{actionables:[{label:"Add page",onClick:()=>a("/a/pages/new"),icon:e($,{size:20})}],customHeader:e(O,{views:["Pages"]}),className:"h-fit",children:e(he,{})})})})};function Me(){return u(V,{children:[e(w,{index:!0,element:e(be,{})}),e(w,{path:"/new",element:e(oe,{})}),e(w,{path:"/:id",element:e(fe,{})})]})}export{Me as default};
